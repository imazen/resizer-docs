<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ImageResizer: C:/Users/Administrator/Documents/resizer/Core/ImageBuilder.cs Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="resizer-icon-64.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.1.3</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">C:/Users/Administrator/Documents/resizer/Core/ImageBuilder.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 <span class="comment">/* Copyright (c) 2011 Nathanael Jones. See license.txt */</span>
<a name="l00002"></a>00002 <span class="keyword">using</span> System;
<a name="l00003"></a>00003 <span class="keyword">using</span> System.Configuration;
<a name="l00004"></a>00004 <span class="keyword">using</span> System.Drawing;
<a name="l00005"></a>00005 <span class="keyword">using</span> System.IO;
<a name="l00006"></a>00006 <span class="keyword">using</span> System.Drawing.Imaging;
<a name="l00007"></a>00007 <span class="keyword">using</span> System.Collections.Generic;
<a name="l00008"></a>00008 <span class="keyword">using</span> System.Diagnostics;
<a name="l00009"></a>00009 <span class="keyword">using</span> System.Collections.Specialized;
<a name="l00010"></a>00010 <span class="keyword">using</span> System.Drawing.Drawing2D;
<a name="l00011"></a>00011 <span class="keyword">using</span> System.Runtime.InteropServices;
<a name="l00012"></a>00012 <span class="keyword">using</span> System.Reflection;
<a name="l00013"></a>00013 <span class="keyword">using</span> ImageResizer.Resizing;
<a name="l00014"></a>00014 <span class="keyword">using</span> ImageResizer.Encoding;
<a name="l00015"></a>00015 <span class="keyword">using</span> ImageResizer.Util;
<a name="l00016"></a>00016 <span class="keyword">using</span> ImageResizer.Configuration;
<a name="l00017"></a>00017 <span class="keyword">using</span> ImageResizer.Plugins;
<a name="l00018"></a>00018 <span class="keyword">using</span> System.Web.Hosting;
<a name="l00019"></a>00019 
<a name="l00020"></a>00020 <span class="keyword">namespace </span>ImageResizer
<a name="l00021"></a>00021 {<span class="comment"></span>
<a name="l00022"></a>00022 <span class="comment">    /// &lt;summary&gt;</span>
<a name="l00023"></a>00023 <span class="comment">    /// Provides methods for generating resized images, and for reading and writing them to disk.</span>
<a name="l00024"></a>00024 <span class="comment">    /// Use ImageBuilder.Current to get the current instance (as configured in the application configuration), or use ImageBuilder.Current.Create() to control which extensions are used.</span>
<a name="l00025"></a>00025 <span class="comment">    /// &lt;/summary&gt;</span>
<a name="l00026"></a><a class="code" href="class_image_resizer_1_1_image_builder.html">00026</a> <span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">partial class </span><a class="code" href="class_image_resizer_1_1_image_builder.html" title="Provides methods for generating resized images, and for reading and writing them to disk...">ImageBuilder</a> : <a class="code" href="class_image_resizer_1_1_resizing_1_1_abstract_image_processor.html" title="Not for external use. Inherit from BuilderExtension instead. Dual-purpose base class for both ImageBu...">AbstractImageProcessor</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_querystring_plugin.html" title="For plugins that access the query string (important!)">IQuerystringPlugin</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_file_extension_plugin.html" title="For plugins that add support for new source file image extensions.">IFileExtensionPlugin</a>
<a name="l00027"></a>00027     {<span class="comment"></span>
<a name="l00028"></a>00028 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00029"></a>00029 <span class="comment">        /// Shouldn&#39;t be used except to make a factory instance.</span>
<a name="l00030"></a>00030 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00031"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a064d8a5a2a83b8f9f35a0f8b411b0cf9">00031</a> <span class="comment"></span>        <span class="keyword">protected</span> <a class="code" href="class_image_resizer_1_1_image_builder.html#a064d8a5a2a83b8f9f35a0f8b411b0cf9" title="Shouldn&#39;t be used except to make a factory instance.">ImageBuilder</a>() { }
<a name="l00032"></a>00032         <span class="keyword">protected</span> <a class="code" href="interface_image_resizer_1_1_encoding_1_1_i_encoder_provider.html" title="A provider (or selector) of IEncoder instances.">IEncoderProvider</a> _encoderProvider = null;<span class="comment"></span>
<a name="l00033"></a>00033 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00034"></a>00034 <span class="comment">        /// Handles the encoder selection and provision proccess.</span>
<a name="l00035"></a>00035 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00036"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a9bd254f85a8c846eb287a985b3accbde">00036</a> <span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="interface_image_resizer_1_1_encoding_1_1_i_encoder_provider.html" title="A provider (or selector) of IEncoder instances.">IEncoderProvider</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a9bd254f85a8c846eb287a985b3accbde" title="Handles the encoder selection and provision proccess.">EncoderProvider</a> { <span class="keyword">get</span> { <span class="keywordflow">return</span> _encoderProvider; } }
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 
<a name="l00039"></a>00039         <span class="keyword">protected</span> <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_settings_modifier.html">ISettingsModifier</a> _settingsModifier = null;<span class="comment"></span>
<a name="l00040"></a>00040 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00041"></a>00041 <span class="comment">        /// May be null. A class to modify or normalize ResizeSettings instances before they are used.</span>
<a name="l00042"></a>00042 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00043"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#af9bcb1d2b216d219670c2a98a3586792">00043</a> <span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_settings_modifier.html">ISettingsModifier</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#af9bcb1d2b216d219670c2a98a3586792" title="May be null. A class to modify or normalize ResizeSettings instances before they are used...">SettingsModifier</a> { <span class="keyword">get</span> { <span class="keywordflow">return</span> _settingsModifier; } }
<a name="l00044"></a>00044 
<a name="l00045"></a>00045         <span class="keyword">private</span> <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_image_provider.html" title="Implement this to allow your class (or VirtualPathProvider subclass) to be used without registering i...">IVirtualImageProvider</a> _virtualFileProvider;
<a name="l00046"></a>00046 <span class="comment"></span>
<a name="l00047"></a>00047 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00048"></a>00048 <span class="comment">        /// Provides a resolution service for app-relative URLs. </span>
<a name="l00049"></a>00049 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00050"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a391309229993353e75f82223cdf0323f">00050</a> <span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_image_provider.html" title="Implement this to allow your class (or VirtualPathProvider subclass) to be used without registering i...">IVirtualImageProvider</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a391309229993353e75f82223cdf0323f" title="Provides a resolution service for app-relative URLs.">VirtualFileProvider</a> {
<a name="l00051"></a>00051             <span class="keyword">get</span> { <span class="keywordflow">return</span> _virtualFileProvider; }
<a name="l00052"></a>00052         }
<a name="l00053"></a>00053 <span class="comment"></span>
<a name="l00054"></a>00054 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00055"></a>00055 <span class="comment">        /// Returns a shared instance of ImageBuilder or a subclass, equivalent to  Config.Current.CurrentImageBuilder</span>
<a name="l00056"></a>00056 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00057"></a>00057 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00058"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#afcfb7f40a65d121670118ccebfe1ca4b">00058</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="class_image_resizer_1_1_image_builder.html" title="Provides methods for generating resized images, and for reading and writing them to disk...">ImageBuilder</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#afcfb7f40a65d121670118ccebfe1ca4b" title="Returns a shared instance of ImageBuilder or a subclass, equivalent to Config.Current.CurrentImageBuilder.">Current</a> {<span class="keyword">get</span>{ <span class="keywordflow">return</span> <a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html">Config</a>.<a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html#a817438580b0b1f8dc08f4aa15e30f68d" title="Gets the current (app-wide) config instance.">Current</a>.<a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html#a9b11da5f1856427a835034d52700c093" title="Returns a shared instance of ImageManager, (or a subclass if it has been upgraded). Instances change whenever ImageBuilderExtensions change.">CurrentImageBuilder</a>; }}
<a name="l00059"></a>00059 <span class="comment"></span>
<a name="l00060"></a>00060 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00061"></a>00061 <span class="comment">        /// Create a new instance of ImageBuilder using the specified extensions, encoder provider, file provider, and settings filter. Extension methods will be fired in the order they exist in the collection.</span>
<a name="l00062"></a>00062 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00063"></a>00063 <span class="comment">        /// &lt;param name=&quot;extensions&quot;&gt;&lt;/param&gt;</span>
<a name="l00064"></a>00064 <span class="comment">        /// &lt;param name=&quot;encoderProvider&quot;&gt;&lt;/param&gt;</span>
<a name="l00065"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a5fd0abe1e804a676b596f11786ea45a6">00065</a> <span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_image_builder.html#a064d8a5a2a83b8f9f35a0f8b411b0cf9" title="Shouldn&#39;t be used except to make a factory instance.">ImageBuilder</a>(IEnumerable&lt;BuilderExtension&gt; extensions, <a class="code" href="interface_image_resizer_1_1_encoding_1_1_i_encoder_provider.html" title="A provider (or selector) of IEncoder instances.">IEncoderProvider</a> encoderProvider, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_image_provider.html" title="Implement this to allow your class (or VirtualPathProvider subclass) to be used without registering i...">IVirtualImageProvider</a> virtualFileProvider, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_settings_modifier.html">ISettingsModifier</a> settingsModifier)
<a name="l00066"></a>00066             : base(extensions) {
<a name="l00067"></a>00067             this._encoderProvider = encoderProvider;
<a name="l00068"></a>00068             this._virtualFileProvider = virtualFileProvider;
<a name="l00069"></a>00069             this._settingsModifier = settingsModifier;
<a name="l00070"></a>00070         }
<a name="l00071"></a>00071 <span class="comment"></span>
<a name="l00072"></a>00072 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00073"></a>00073 <span class="comment">        /// Creates another instance of the class using the specified extensions. Subclasses should override this and point to their own constructor.</span>
<a name="l00074"></a>00074 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00075"></a>00075 <span class="comment">        /// &lt;param name=&quot;extensions&quot;&gt;&lt;/param&gt;</span>
<a name="l00076"></a>00076 <span class="comment">        /// &lt;param name=&quot;writer&quot;&gt;&lt;/param&gt;</span>
<a name="l00077"></a>00077 <span class="comment">        /// &lt;param name=&quot;virtualFileProvider&quot;&gt;&lt;/param&gt;</span>
<a name="l00078"></a>00078 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00079"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#ac0d37c18d40aeae0148dc56165d826a6">00079</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="class_image_resizer_1_1_image_builder.html" title="Provides methods for generating resized images, and for reading and writing them to disk...">ImageBuilder</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#ac0d37c18d40aeae0148dc56165d826a6" title="Creates another instance of the class using the specified extensions. Subclasses should override this...">Create</a>(IEnumerable&lt;BuilderExtension&gt; extensions, <a class="code" href="interface_image_resizer_1_1_encoding_1_1_i_encoder_provider.html" title="A provider (or selector) of IEncoder instances.">IEncoderProvider</a> writer, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_image_provider.html" title="Implement this to allow your class (or VirtualPathProvider subclass) to be used without registering i...">IVirtualImageProvider</a> virtualFileProvider, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_settings_modifier.html">ISettingsModifier</a> settingsModifier) {
<a name="l00080"></a>00080             <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_builder.html#a064d8a5a2a83b8f9f35a0f8b411b0cf9" title="Shouldn&#39;t be used except to make a factory instance.">ImageBuilder</a>(extensions,writer,virtualFileProvider,settingsModifier);
<a name="l00081"></a>00081         }<span class="comment"></span>
<a name="l00082"></a>00082 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00083"></a>00083 <span class="comment">        /// Copies the instance along with extensions. Subclasses must override this.</span>
<a name="l00084"></a>00084 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00085"></a>00085 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00086"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a1de161f6083813949f26b01c0e10283c">00086</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="class_image_resizer_1_1_image_builder.html" title="Provides methods for generating resized images, and for reading and writing them to disk...">ImageBuilder</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a1de161f6083813949f26b01c0e10283c" title="Copies the instance along with extensions. Subclasses must override this.">Copy</a>(){
<a name="l00087"></a>00087             <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_builder.html#a064d8a5a2a83b8f9f35a0f8b411b0cf9" title="Shouldn&#39;t be used except to make a factory instance.">ImageBuilder</a>(this.<a class="code" href="class_image_resizer_1_1_resizing_1_1_abstract_image_processor.html#a79fd55facde998a6090e73fe8affda85" title="Contains the set of extensions that are called for every method.">exts</a>,this._encoderProvider, this._virtualFileProvider,this._settingsModifier);
<a name="l00088"></a>00088         }
<a name="l00089"></a>00089 
<a name="l00090"></a>00090 
<a name="l00091"></a>00091 <span class="comment"></span>
<a name="l00092"></a>00092 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00093"></a>00093 <span class="comment">        /// Loads a Bitmap from the specified source. If a filename is available, it will be attached to bitmap.Tag in a BitmapTag instance. The Bitmap.Tag.Path value may be a virtual, relative, UNC, windows, or unix path. </span>
<a name="l00094"></a>00094 <span class="comment">        /// Does not dispose &#39;source&#39; if it is a Stream or Image instance - that&#39;s the responsibility of the calling code.</span>
<a name="l00095"></a>00095 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00096"></a>00096 <span class="comment">        /// &lt;param name=&quot;source&quot;&gt;May  be an instance of string, VirtualFile, IVirtualFile IVirtualBitmapFile, HttpPostedFile, Bitmap, Image, or Stream.  If passed an Image instance, the image will be cloned, which will cause metadata, indexed state, and any additional frames to be lost. Accepts physical paths and application relative paths. (C:\... and ~/path) &lt;/param&gt;</span>
<a name="l00097"></a>00097 <span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;Will ignore ICC profile if ?ignoreicc=true.&lt;/param&gt;</span>
<a name="l00098"></a>00098 <span class="comment">        /// &lt;returns&gt;A Bitmap. The .Tag property will include a BitmapTag instance. If .Tag.Source is not null, remember to dispose it when you dispose the Bitmap.&lt;/returns&gt;</span>
<a name="l00099"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a185dcaa809670c427788a45539f2f1f3">00099</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> Bitmap <a class="code" href="class_image_resizer_1_1_image_builder.html#a185dcaa809670c427788a45539f2f1f3" title="Loads a Bitmap from the specified source. If a filename is available, it will be attached to bitmap...">LoadImage</a>(<span class="keywordtype">object</span> source, <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings) {
<a name="l00100"></a>00100             <span class="keywordflow">return</span> <a class="code" href="class_image_resizer_1_1_image_builder.html#a185dcaa809670c427788a45539f2f1f3" title="Loads a Bitmap from the specified source. If a filename is available, it will be attached to bitmap...">LoadImage</a>(source, settings, <span class="keyword">false</span>);
<a name="l00101"></a>00101         }<span class="comment"></span>
<a name="l00102"></a>00102 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00103"></a>00103 <span class="comment">        /// Loads a Bitmap from the specified source. If a filename is available, it will be attached to bitmap.Tag in a BitmapTag instance. The Bitmap.Tag.Path value may be a virtual, relative, UNC, windows, or unix path. </span>
<a name="l00104"></a>00104 <span class="comment">        /// Does not dispose &#39;source&#39; if it is a Stream or Image instance - that&#39;s the responsibility of the calling code.</span>
<a name="l00105"></a>00105 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00106"></a>00106 <span class="comment">        /// &lt;param name=&quot;source&quot;&gt;May  be an instance of string, VirtualFile, IVirtualFile IVirtualBitmapFile, HttpPostedFile, Bitmap, Image, or Stream.  If passed an Image instance, the image will be cloned, which will cause metadata, indexed state, and any additional frames to be lost. Accepts physical paths and application relative paths. (C:\... and ~/path) &lt;/param&gt;</span>
<a name="l00107"></a>00107 <span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;Will ignore ICC profile if ?ignoreicc=true.&lt;/param&gt;</span>
<a name="l00108"></a>00108 <span class="comment">        /// &lt;param name=&quot;restoreStreamPos&quot;&gt;If true, the position of the source stream will be restored after being read&lt;/param&gt;</span>
<a name="l00109"></a>00109 <span class="comment">        /// &lt;returns&gt;A Bitmap. The .Tag property will include a BitmapTag instance. If .Tag.Source is not null, remember to dispose it when you dispose the Bitmap.&lt;/returns&gt;</span>
<a name="l00110"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a17a976acd6935ca64f88b54332a00c2d">00110</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> Bitmap <a class="code" href="class_image_resizer_1_1_image_builder.html#a17a976acd6935ca64f88b54332a00c2d" title="Loads a Bitmap from the specified source. If a filename is available, it will be attached to bitmap...">LoadImage</a>(<span class="keywordtype">object</span> source, <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings, <span class="keywordtype">bool</span> restoreStreamPos){
<a name="l00111"></a>00111 
<a name="l00112"></a>00112             <span class="keywordtype">bool</span> disposeStream = !(source is Stream);
<a name="l00113"></a>00113             <span class="keywordtype">string</span> path = null;
<a name="l00114"></a>00114 
<a name="l00115"></a>00115             <span class="comment">//Fire PreLoadImage(source,settings)</span>
<a name="l00116"></a>00116             this.<a class="code" href="class_image_resizer_1_1_resizing_1_1_abstract_image_processor.html#a28430cfcc4fd24b05821f4b8a891333f" title="Extend this to allow additional types of source objects to be accepted by transforming them into Bitm...">PreLoadImage</a>(ref source, ref path, ref disposeStream,  ref settings);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118             System.Drawing.Bitmap b = null;
<a name="l00119"></a>00119             <span class="keywordtype">string</span> loadFailureReasons = <span class="stringliteral">&quot;File may be corrupted, empty, or may contain a PNG image with a single dimension greater than 65,535 pixels.&quot;</span>;
<a name="l00120"></a>00120             
<a name="l00121"></a>00121             <span class="comment">//Bitmap</span>
<a name="l00122"></a>00122             <span class="keywordflow">if</span> (source is Bitmap) <span class="keywordflow">return</span> source as Bitmap;
<a name="l00123"></a>00123             <span class="comment">//Image</span>
<a name="l00124"></a>00124             <span class="keywordflow">if</span> (source is System.Drawing.Image) 
<a name="l00125"></a>00125                 <span class="keywordflow">return</span> <span class="keyword">new</span> Bitmap((System.Drawing.Image)source); <span class="comment">//Note, this clones just the raw bitmap data - doesn&#39;t copy attributes, bit depth, or anything.</span>
<a name="l00126"></a>00126             <span class="comment">//IVirtualBitmapFile</span>
<a name="l00127"></a>00127             <span class="keywordflow">if</span> (source is <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_bitmap_file.html" title="For virtual files who want to provide their data in Bitmap form (like a PSD reader or gradient genera...">IVirtualBitmapFile</a>) {
<a name="l00128"></a>00128                 b = ((IVirtualBitmapFile)source).GetBitmap();
<a name="l00129"></a>00129                 <span class="keywordflow">if</span> (b.Tag == null) b.Tag = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a>(((IVirtualBitmapFile)source).VirtualPath);
<a name="l00130"></a>00130                 <span class="keywordflow">return</span> b;
<a name="l00131"></a>00131             }
<a name="l00132"></a>00132 
<a name="l00133"></a>00133             <span class="keywordtype">bool</span> restoreStreamPosition = <span class="keyword">false</span>;
<a name="l00134"></a>00134             Stream s = <a class="code" href="class_image_resizer_1_1_image_builder.html#ab51799a036b1624f4e5d9c2aa2fcfa88" title="For plugin use only. Returns a stream instance from the specified source object and settings object...">GetStreamFromSource</a>(source, settings, ref disposeStream, out path, out restoreStreamPosition);
<a name="l00135"></a>00135             <span class="keywordflow">if</span> (s == null) <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;Source may only be an instance of string, VirtualFile, IVirtualBitmapFile, HttpPostedFile, HttpPostedFileBase, Bitmap, Image, or Stream.&quot;</span>, <span class="stringliteral">&quot;source&quot;</span>);
<a name="l00136"></a>00136 
<a name="l00137"></a>00137             <span class="keywordflow">if</span> (restoreStreamPos) restoreStreamPosition = <span class="keyword">true</span>;
<a name="l00138"></a>00138 
<a name="l00139"></a>00139             <span class="comment">//Save the original stream position if it&#39;s an HttpPostedFile</span>
<a name="l00140"></a>00140             <span class="keywordtype">long</span> originalPosition = (restoreStreamPosition) ? s.Position : - 1;
<a name="l00141"></a>00141 
<a name="l00142"></a>00142             <span class="keywordflow">try</span> {
<a name="l00143"></a>00143                 <span class="keywordflow">try</span> {
<a name="l00144"></a>00144                     <span class="comment">//First try DecodeStream</span>
<a name="l00145"></a>00145                     b = <span class="keyword">this</span>.DecodeStream(s, settings, path);
<a name="l00146"></a>00146                     <span class="comment">//Let the fallbacks work. (Only happens when a plugin overrides DecodeStream and retuns null)</span>
<a name="l00147"></a>00147                     <span class="keywordflow">if</span> (b == null) <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_corrupted_exception.html" title="A source file was corrupted.">ImageCorruptedException</a>(<span class="stringliteral">&quot;Failed to decode image. Plugin made DecodeStream return null.&quot;</span>, null);
<a name="l00148"></a>00148                 } <span class="keywordflow">catch</span> (Exception e) {
<a name="l00149"></a>00149                     <span class="comment">//if (Debugger.IsAttached) throw e;</span>
<a name="l00150"></a>00150                     Debug.Write(<span class="stringliteral">&quot;Falling back to DecodeStreamFailed: &quot;</span> + e.Message + <span class="stringliteral">&quot;\n&quot;</span> + e.StackTrace); 
<a name="l00151"></a>00151                     
<a name="l00152"></a>00152                     <span class="keywordflow">if</span> (!s.CanSeek)
<a name="l00153"></a>00153                         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_corrupted_exception.html" title="A source file was corrupted.">ImageCorruptedException</a>(<span class="stringliteral">&quot;Cannot attempt fallback decoding path on a non-seekable stream&quot;</span>, e);
<a name="l00154"></a>00154 
<a name="l00155"></a>00155                     b = <a class="code" href="class_image_resizer_1_1_resizing_1_1_abstract_image_processor.html#a6cb4bce1d3b4b2947f9355d32ec66c68" title="Extensions are executed until one extension returns a non-null value. This is taken to mean that the ...">DecodeStreamFailed</a>(s, settings, path);
<a name="l00156"></a>00156                     <span class="keywordflow">if</span> (b == null) <span class="keywordflow">throw</span> e; <span class="comment">//If none of the extensions loaded the image, throw the exception anyhow.</span>
<a name="l00157"></a>00157                 }
<a name="l00158"></a>00158             } <span class="keywordflow">catch</span> (ArgumentException ae) {
<a name="l00159"></a>00159                 ae.Data.Add(<span class="stringliteral">&quot;path&quot;</span>, path);
<a name="l00160"></a>00160                 <span class="keywordflow">throw</span> <span class="keyword">new</span> ImageCorruptedException(loadFailureReasons, ae);
<a name="l00161"></a>00161             } <span class="keywordflow">catch</span> (ExternalException ee) {
<a name="l00162"></a>00162                 ee.Data.Add(<span class="stringliteral">&quot;path&quot;</span>, path);
<a name="l00163"></a>00163                 <span class="keywordflow">throw</span> <span class="keyword">new</span> ImageCorruptedException(loadFailureReasons, ee);
<a name="l00164"></a>00164             } <span class="keywordflow">finally</span> {
<a name="l00165"></a>00165                 <span class="comment">//Now, we can&#39;t dispose the stream if Bitmap is still using it. </span>
<a name="l00166"></a>00166                 <span class="keywordflow">if</span> (b != null &amp;&amp; b.Tag != null &amp;&amp; b.Tag is <a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a> &amp;&amp; ((<a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a>)b.Tag).Source == s) {
<a name="l00167"></a>00167                     <span class="comment">//And, it looks like Bitmap is still using it.</span>
<a name="l00168"></a>00168                     s = null;
<a name="l00169"></a>00169                 }
<a name="l00170"></a>00170                 <span class="comment">//Dispose the stream if we opened it. If someone passed it to us, they&#39;re responsible.</span>
<a name="l00171"></a>00171                 <span class="keywordflow">if</span> (s != null &amp;&amp; disposeStream) { s.Dispose(); s = null; }
<a name="l00172"></a>00172 
<a name="l00173"></a>00173                 <span class="comment">//Restore the stream position if we were given an HttpPostedFile instance</span>
<a name="l00174"></a>00174                 <span class="keywordflow">if</span> (originalPosition &gt; -1 &amp;&amp; s != null &amp;&amp; s.CanSeek) s.Position = originalPosition;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176                 <span class="comment">//Make sure the bitmap is tagged with its path. DecodeStream usually handles this, only relevant for extension decoders.</span>
<a name="l00177"></a>00177                 <span class="keywordflow">if</span> (b != null &amp;&amp; b.Tag == null &amp;&amp; path != null) b.Tag = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a>(path);
<a name="l00178"></a>00178 
<a name="l00179"></a>00179             }
<a name="l00180"></a>00180             PostDecodeStream(ref b,settings);
<a name="l00181"></a>00181             <span class="keywordflow">return</span> b;            
<a name="l00182"></a>00182         }
<a name="l00183"></a>00183 <span class="comment"></span>
<a name="l00184"></a>00184 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00185"></a>00185 <span class="comment">        /// Decodes the stream into a System.Drawing.Bitmap instance. As of 3.0.7, now ensures the stream can safely be closed after the method returns.</span>
<a name="l00186"></a>00186 <span class="comment">        /// May copy the stream. The copied stream will be in b.Tag.Source. Does not close or dispose any streams.</span>
<a name="l00187"></a>00187 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00188"></a>00188 <span class="comment">        /// &lt;param name=&quot;s&quot;&gt;&lt;/param&gt;</span>
<a name="l00189"></a>00189 <span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;&lt;/param&gt;</span>
<a name="l00190"></a>00190 <span class="comment">        /// &lt;param name=&quot;optionalPath&quot;&gt;&lt;/param&gt;</span>
<a name="l00191"></a>00191 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00192"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#aa00b42693a3af4544751cc1d1be0bbbf">00192</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">override</span> Bitmap <a class="code" href="class_image_resizer_1_1_image_builder.html#aa00b42693a3af4544751cc1d1be0bbbf" title="Decodes the stream into a System.Drawing.Bitmap instance. As of 3.0.7, now ensures the stream can saf...">DecodeStream</a>(Stream s, <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings, <span class="keywordtype">string</span> optionalPath) {
<a name="l00193"></a>00193             Bitmap b = base.DecodeStream(s, settings, optionalPath);
<a name="l00194"></a>00194             <span class="keywordflow">if</span> (b != null &amp;&amp; b.Tag == null) b.Tag = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a>(optionalPath); <span class="comment">//Assume Bitmap wasn&#39;t used.</span>
<a name="l00195"></a>00195             <span class="keywordflow">if</span> (b != null) <span class="keywordflow">return</span> b;
<a name="l00196"></a>00196 
<a name="l00197"></a>00197             <span class="keywordtype">bool</span> useICM = <span class="keyword">true</span>;
<a name="l00198"></a>00198             <span class="keywordflow">if</span> (settings != null &amp;&amp; <span class="stringliteral">&quot;true&quot;</span>.Equals(settings[<span class="stringliteral">&quot;ignoreicc&quot;</span>], StringComparison.OrdinalIgnoreCase)) useICM = <span class="keyword">false</span>;
<a name="l00199"></a>00199 
<a name="l00200"></a>00200             <span class="comment">//NDJ - May 24, 2011 - Copying stream into memory so the original can be closed safely.</span>
<a name="l00201"></a>00201             MemoryStream ms = <a class="code" href="class_image_resizer_1_1_util_1_1_stream_utils.html">StreamUtils</a>.CopyStream(s);
<a name="l00202"></a>00202             b = <span class="keyword">new</span> Bitmap(ms, useICM); 
<a name="l00203"></a>00203             b.Tag = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a>(optionalPath, ms); <span class="comment">//May 25, 2011: Storing a ref to the MemorySteam so it won&#39;t accidentally be garbage collected.</span>
<a name="l00204"></a>00204             <span class="keywordflow">return</span> b;
<a name="l00205"></a>00205         }<span class="comment"></span>
<a name="l00206"></a>00206 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00207"></a>00207 <span class="comment">        /// For plugin use only. </span>
<a name="l00208"></a>00208 <span class="comment">        /// Returns a stream instance from the specified source object and settings object. </span>
<a name="l00209"></a>00209 <span class="comment">        /// To exend this method, override GetStream.</span>
<a name="l00210"></a>00210 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00211"></a>00211 <span class="comment">        /// &lt;param name=&quot;source&quot;&gt;The physical or app-relative path, or a VirtualFile, IVirtualFile, Stream, HttpPostedFile, or HttpPostedFileBase instance.&lt;/param&gt;</span>
<a name="l00212"></a>00212 <span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;Querystring settings to pass to the VirtualFileProvider&lt;/param&gt;</span>
<a name="l00213"></a>00213 <span class="comment">        /// &lt;param name=&quot;disposeStream&quot;&gt;You should externally initialize this to true, unless the user-provided &#39;source&#39; is a Stream instance. Will be set to false for HttpPostedFile and HttpPostedFileBase instances, so they can be reused. &lt;/param&gt;</span>
<a name="l00214"></a>00214 <span class="comment">        /// &lt;param name=&quot;path&quot;&gt;The physical or virtual path associated with the stream (if present). Otherwise null&lt;/param&gt;</span>
<a name="l00215"></a>00215 <span class="comment">        /// &lt;param name=&quot;restoreStreamPosition&quot;&gt;True if you should save and restore the seek position of the stream. True for HttpPostedFile and HttpPostedFileBase instances. &lt;/param&gt;</span>
<a name="l00216"></a>00216 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00217"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#ab51799a036b1624f4e5d9c2aa2fcfa88">00217</a> <span class="comment"></span>        <span class="keyword">public</span> Stream <a class="code" href="class_image_resizer_1_1_image_builder.html#ab51799a036b1624f4e5d9c2aa2fcfa88" title="For plugin use only. Returns a stream instance from the specified source object and settings object...">GetStreamFromSource</a>(<span class="keywordtype">object</span> source, <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings, ref <span class="keywordtype">bool</span> disposeStream, out <span class="keywordtype">string</span> path, out <span class="keywordtype">bool</span> restoreStreamPosition) {
<a name="l00218"></a>00218             <span class="comment">//Allow plugins to extend this</span>
<a name="l00219"></a>00219             <span class="keywordtype">bool</span> disposeS = disposeStream;
<a name="l00220"></a>00220             Stream s = base.GetStream(source, settings, ref disposeS, out path, out restoreStreamPosition);
<a name="l00221"></a>00221             <span class="keywordflow">if</span> (s != null) {
<a name="l00222"></a>00222                 disposeStream = disposeS;
<a name="l00223"></a>00223                 <span class="keywordflow">return</span> s;
<a name="l00224"></a>00224             }
<a name="l00225"></a>00225 
<a name="l00226"></a>00226             <span class="comment">//App-relative path - converted to virtual path</span>
<a name="l00227"></a>00227             <span class="keywordflow">if</span> (source is <span class="keywordtype">string</span>) {
<a name="l00228"></a>00228                 path = source as string;
<a name="l00229"></a>00229                 <span class="comment">//Convert app-relative paths to VirtualFile instances</span>
<a name="l00230"></a>00230                 <span class="keywordflow">if</span> (path.StartsWith(<span class="stringliteral">&quot;~&quot;</span>, StringComparison.OrdinalIgnoreCase)) {
<a name="l00231"></a>00231                     source = this.VirtualFileProvider.GetFile(<a class="code" href="class_image_resizer_1_1_util_1_1_path_utils.html">PathUtils</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_path_utils.html#adafb4cd7d85a3567782842873c1a5176">ResolveAppRelative</a>(path), settings);
<a name="l00232"></a>00232                 }
<a name="l00233"></a>00233             }
<a name="l00234"></a>00234 
<a name="l00235"></a>00235             path = null;
<a name="l00236"></a>00236             restoreStreamPosition = <span class="keyword">false</span>;
<a name="l00237"></a>00237             <span class="comment">//Stream</span>
<a name="l00238"></a>00238             <span class="keywordflow">if</span> (source is Stream) {
<a name="l00239"></a>00239                 s = (Stream)source;
<a name="l00240"></a>00240                 
<a name="l00241"></a>00241                 <span class="keywordflow">try</span>{
<a name="l00242"></a>00242                     <span class="keywordflow">if</span> (s.Length &lt;= s.Position &amp;&amp; s.Position &gt; 0)
<a name="l00243"></a>00243                         <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_processing_exception.html" title="Represents an non-recoverable exception that occured while processing the image. Possible causes are:...">ImageProcessingException</a>(<span class="stringliteral">&quot;Stream already ended. You must call s.Seek(0, SeekOrigin.Begin); before re-using a stream, or use ImageJob with ResetSourceStream=true the first time the stream is read.&quot;</span>);
<a name="l00244"></a>00244                 }<span class="keywordflow">catch</span> (NotSupportedException){
<a name="l00245"></a>00245                 }
<a name="l00246"></a>00246             }
<a name="l00247"></a>00247                 <span class="comment">//VirtualFile</span>
<a name="l00248"></a>00248             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (source is VirtualFile) {
<a name="l00249"></a>00249                 path = ((VirtualFile)source).VirtualPath;
<a name="l00250"></a>00250                 s = ((VirtualFile)source).Open();
<a name="l00251"></a>00251                 <span class="comment">//IVirtualFile</span>
<a name="l00252"></a>00252             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (source is <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_file.html" title="A virtual file. Implementing this allows usage of your VirtualProvider without registering it with AS...">IVirtualFile</a>) {
<a name="l00253"></a>00253                 path = ((IVirtualFile)source).VirtualPath;
<a name="l00254"></a>00254                 s = ((IVirtualFile)source).Open();
<a name="l00255"></a>00255                 <span class="comment">//PhysicalPath</span>
<a name="l00256"></a>00256             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (source is <span class="keywordtype">string</span>) {
<a name="l00257"></a>00257                 path = (string)source;
<a name="l00258"></a>00258                 s = File.Open(path, FileMode.Open, FileAccess.Read, FileShare.Read);
<a name="l00259"></a>00259             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (source is byte[]) {
<a name="l00260"></a>00260                 s = <span class="keyword">new</span> MemoryStream((byte[])source, 0, ((byte[])source).Length, <span class="keyword">false</span>, <span class="keyword">true</span>);
<a name="l00261"></a>00261             } <span class="keywordflow">else</span> {
<a name="l00262"></a>00262                 <span class="comment">//For HttpPostedFile and HttpPostedFileBase - we must use reflection to support .NET 3.5 without losing 2.0 compat.</span>
<a name="l00263"></a>00263                 PropertyInfo pname = source.GetType().GetProperty(<span class="stringliteral">&quot;FileName&quot;</span>, typeof(<span class="keywordtype">string</span>));
<a name="l00264"></a>00264                 PropertyInfo pstream = source.GetType().GetProperty(<span class="stringliteral">&quot;InputStream&quot;</span>);
<a name="l00265"></a>00265 
<a name="l00266"></a>00266                 <span class="keywordflow">if</span> (pname != null &amp;&amp; pstream != null) {
<a name="l00267"></a>00267                     path = pname.GetValue(source, null) as string;
<a name="l00268"></a>00268                     s = pstream.GetValue(source, null) as Stream;
<a name="l00269"></a>00269                     disposeStream = <span class="keyword">false</span>; <span class="comment">//We never want to dispose the HttpPostedFile or HttpPostedFileBase streams..</span>
<a name="l00270"></a>00270                     restoreStreamPosition = <span class="keyword">true</span>;
<a name="l00271"></a>00271                 }
<a name="l00272"></a>00272 
<a name="l00273"></a>00273                 <span class="keywordflow">if</span> (s == null) <span class="keywordflow">return</span> null;
<a name="l00274"></a>00274             }
<a name="l00275"></a>00275             <span class="keywordflow">return</span> s;
<a name="l00276"></a>00276         }
<a name="l00277"></a>00277 
<a name="l00278"></a>00278 
<a name="l00279"></a>00279 <span class="preprocessor">        #region Wrapper overloads</span>
<a name="l00280"></a>00280 <span class="preprocessor"></span><span class="comment">        /// &lt;summary&gt;</span>
<a name="l00281"></a>00281 <span class="comment"></span><span class="comment">        /// Resizes and processes the specified source image and returns a bitmap of the result.</span>
<a name="l00282"></a>00282 <span class="comment"></span><span class="comment">        /// Note! </span>
<a name="l00283"></a>00283 <span class="comment"></span><span class="comment">        /// This method assumes that transparency will be supported in the final output format, and therefore does not apply a matte color. Use &amp;amp;bgcolor to specify a background color</span>
<a name="l00284"></a>00284 <span class="comment"></span><span class="comment">        /// if you use this method with a non-transparent format such as Jpeg.</span>
<a name="l00285"></a>00285 <span class="comment"></span><span class="comment">        /// If passed a source Stream, Bitmap, or Image instance, it will be disposed after use. Use disposeSource=False to disable that behavior. </span>
<a name="l00286"></a>00286 <span class="comment"></span><span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00287"></a>00287 <span class="comment"></span><span class="comment">        /// &lt;param name=&quot;source&quot;&gt;May be an instance of string (a physical path), VirtualFile, IVirtualBitmapFile, HttpPostedFile, Bitmap, Image, or Stream.&lt;/param&gt;</span>
<a name="l00288"></a>00288 <span class="comment"></span><span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;Resizing and processing command to apply to the.&lt;/param&gt;</span>
<a name="l00289"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a12f49b48e9244ee7f6e86fd60fffcc83">00289</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> Bitmap <a class="code" href="class_image_resizer_1_1_image_builder.html#a12f49b48e9244ee7f6e86fd60fffcc83" title="Resizes and processes the specified source image and returns a bitmap of the result. Note! This method assumes that transparency will be supported in the final output format, and therefore does not apply a matte color. Use &amp;bgcolor to specify a background color if you use this method with a non-transparent format such as Jpeg. If passed a source Stream, Bitmap, or Image instance, it will be disposed after use. Use disposeSource=False to disable that behavior.">Build</a>(<span class="keywordtype">object</span> source, <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings) {
<a name="l00290"></a>00290             <span class="keywordflow">return</span> Build(source, settings, <span class="keyword">true</span>);
<a name="l00291"></a>00291         }<span class="comment"></span>
<a name="l00292"></a>00292 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00293"></a>00293 <span class="comment">        /// Resizes and processes the specified source image and returns a bitmap of the result.</span>
<a name="l00294"></a>00294 <span class="comment">        /// Note! </span>
<a name="l00295"></a>00295 <span class="comment">        /// This method assumes that transparency will be supported in the final output format, and therefore does not apply a matte color. Use &amp;amp;bgcolor to specify a background color</span>
<a name="l00296"></a>00296 <span class="comment">        /// if you use this method with a non-transparent format such as Jpeg.</span>
<a name="l00297"></a>00297 <span class="comment">        /// </span>
<a name="l00298"></a>00298 <span class="comment">        /// If passed a source Stream, Bitmap, or Image instance, it will not be disposed unless disposeSource=true.</span>
<a name="l00299"></a>00299 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00300"></a>00300 <span class="comment">        /// &lt;param name=&quot;source&quot;&gt;May be an instance of string (a physical path), VirtualFile, IVirtualBitmapFile, HttpPostedFile, Bitmap, Image, or Stream.&lt;/param&gt;</span>
<a name="l00301"></a>00301 <span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;Resizing and processing command to apply to the.&lt;/param&gt;</span>
<a name="l00302"></a>00302 <span class="comment">        /// &lt;param name=&quot;disposeSource&quot;&gt;If false, &#39;source&#39; will not be disposed. &lt;/param&gt;</span>
<a name="l00303"></a>00303 <span class="comment"></span>       
<a name="l00304"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#ab6583432ca82dfa02d357000d252c45d">00304</a>         <span class="keyword">public</span> <span class="keyword">virtual</span> Bitmap <a class="code" href="class_image_resizer_1_1_image_builder.html#ab6583432ca82dfa02d357000d252c45d" title="Resizes and processes the specified source image and returns a bitmap of the result. Note! This method assumes that transparency will be supported in the final output format, and therefore does not apply a matte color. Use &amp;bgcolor to specify a background color if you use this method with a non-transparent format such as Jpeg.">Build</a>(<span class="keywordtype">object</span> source, <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings, <span class="keywordtype">bool</span> disposeSource) {
<a name="l00305"></a>00305             <a class="code" href="class_image_resizer_1_1_image_job.html">ImageJob</a> j = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_job.html">ImageJob</a>(source, typeof(Bitmap), settings, disposeSource, <span class="keyword">false</span>);
<a name="l00306"></a>00306             Build(j);
<a name="l00307"></a>00307             <span class="keywordflow">return</span> j.<a class="code" href="class_image_resizer_1_1_image_job.html#a81227d737538a12e2e183fbbfab32eaa" title="The result if a Bitmap, BitmapSource, or IWICBitmapSource instance is requested.">Result</a> as Bitmap;
<a name="l00308"></a>00308         }
<a name="l00309"></a>00309 <span class="comment"></span>
<a name="l00310"></a>00310 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00311"></a>00311 <span class="comment">        /// Resizes and processes the specified source image and stores the encoded result in the specified destination.</span>
<a name="l00312"></a>00312 <span class="comment">        /// If passed a source Stream, Bitmap, or Image instance, it will be disposed after use. Use disposeSource=False to disable that behavior. </span>
<a name="l00313"></a>00313 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00314"></a>00314 <span class="comment">        /// &lt;param name=&quot;source&quot;&gt;May be an instance of string (a physical path or app-relative virtual path), VirtualFile, IVirtualBitmapFile, HttpPostedFile, Bitmap, Image, or Stream. App-relative virtual paths will use the VirtualPathProvider system&lt;/param&gt;</span>
<a name="l00315"></a>00315 <span class="comment">        /// &lt;param name=&quot;dest&quot;&gt;May be a physical path (string), or a Stream instance. Does not have to be seekable.&lt;/param&gt;</span>
<a name="l00316"></a>00316 <span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;Resizing and processing command to apply to the image.&lt;/param&gt;</span>
<a name="l00317"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a23d0a1c7686627fc160d5f0173f14cf5">00317</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_image_resizer_1_1_image_builder.html#a23d0a1c7686627fc160d5f0173f14cf5" title="Resizes and processes the specified source image and stores the encoded result in the specified desti...">Build</a>(<span class="keywordtype">object</span> source, <span class="keywordtype">object</span> dest, <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings) {
<a name="l00318"></a>00318             Build(source, dest, settings, <span class="keyword">true</span>);
<a name="l00319"></a>00319         }
<a name="l00320"></a>00320 
<a name="l00321"></a>00321 <span class="comment"></span>
<a name="l00322"></a>00322 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00323"></a>00323 <span class="comment">        /// Resizes and processes the specified source image and stores the encoded result in the specified destination. </span>
<a name="l00324"></a>00324 <span class="comment">        /// If passed a source Stream, Bitmap, or Image instance, it will not be disposed unless disposeSource=true.</span>
<a name="l00325"></a>00325 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00326"></a>00326 <span class="comment">        /// &lt;param name=&quot;source&quot;&gt;May be an instance of string (a physical path or app-relative virtual path), VirtualFile, IVirtualBitmapFile, HttpPostedFile, Bitmap, Image, or Stream. App-relative virtual paths will use the VirtualPathProvider system&lt;/param&gt;</span>
<a name="l00327"></a>00327 <span class="comment">        /// &lt;param name=&quot;dest&quot;&gt;May be a physical path (string), or a Stream instance. Does not have to be seekable.&lt;/param&gt;</span>
<a name="l00328"></a>00328 <span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;Resizing and processing command to apply to the image.&lt;/param&gt;</span>
<a name="l00329"></a>00329 <span class="comment">        /// &lt;param name=&quot;disposeSource&quot;&gt;True to dispose &#39;source&#39; after use. False to leave intact.&lt;/param&gt;</span>
<a name="l00330"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a1528f6e7863248a4dd0d2d3c2d140261">00330</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_image_resizer_1_1_image_builder.html#a1528f6e7863248a4dd0d2d3c2d140261" title="Resizes and processes the specified source image and stores the encoded result in the specified desti...">Build</a>(<span class="keywordtype">object</span> source, <span class="keywordtype">object</span> dest, <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings, <span class="keywordtype">bool</span> disposeSource) {
<a name="l00331"></a>00331             Build(source, dest, settings, disposeSource, <span class="keyword">false</span>);
<a name="l00332"></a>00332         }
<a name="l00333"></a>00333 <span class="comment"></span>
<a name="l00334"></a>00334 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00335"></a>00335 <span class="comment">        /// Resizes and processes the specified source image and stores the encoded result in the specified destination. </span>
<a name="l00336"></a>00336 <span class="comment">        /// If passed a source Stream, Bitmap, or Image instance, it will not be disposed unless disposeSource=true.</span>
<a name="l00337"></a>00337 <span class="comment">        /// If passed a path destination, the physical path of the written file will be returned.</span>
<a name="l00338"></a>00338 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00339"></a>00339 <span class="comment">        /// &lt;param name=&quot;source&quot;&gt;May be an instance of string (a physical path or app-relative virtual path), VirtualFile, IVirtualBitmapFile, HttpPostedFile, Bitmap, Image, or Stream. App-relative virtual paths will use the VirtualPathProvider system&lt;/param&gt;</span>
<a name="l00340"></a>00340 <span class="comment">        /// &lt;param name=&quot;dest&quot;&gt;May be a physical path (string), or a Stream instance. Does not have to be seekable.&lt;/param&gt;</span>
<a name="l00341"></a>00341 <span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;Resizing and processing command to apply to the image.&lt;/param&gt;</span>
<a name="l00342"></a>00342 <span class="comment">        /// &lt;param name=&quot;disposeSource&quot;&gt;True to dispose &#39;source&#39; after use. False to leave intact.&lt;/param&gt;</span>
<a name="l00343"></a>00343 <span class="comment">        /// &lt;param name=&quot;addFileExtension&quot;&gt;If true, will add the correct file extension to &#39;dest&#39; if it is a string. &lt;/param&gt;</span>
<a name="l00344"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a87954c4d5579b7b2d45bec6ca1eb5aab">00344</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keywordtype">string</span> <a class="code" href="class_image_resizer_1_1_image_builder.html#a87954c4d5579b7b2d45bec6ca1eb5aab" title="Resizes and processes the specified source image and stores the encoded result in the specified desti...">Build</a>(<span class="keywordtype">object</span> source, <span class="keywordtype">object</span> dest, <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings, <span class="keywordtype">bool</span> disposeSource, <span class="keywordtype">bool</span> addFileExtension) {
<a name="l00345"></a>00345             <span class="keywordflow">return</span> Build(<span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_job.html">ImageJob</a>(source, dest, settings, disposeSource, addFileExtension)).FinalPath;
<a name="l00346"></a>00346         }
<a name="l00347"></a>00347 <span class="preprocessor">        #endregion</span>
<a name="l00348"></a>00348 <span class="preprocessor"></span>
<a name="l00349"></a>00349         <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="class_image_resizer_1_1_image_job.html">ImageJob</a> Build(<a class="code" href="class_image_resizer_1_1_image_job.html">ImageJob</a> job) {
<a name="l00350"></a>00350             <span class="comment">//Clone and filter settings FIRST, before calling plugins.</span>
<a name="l00351"></a>00351             <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> s = job.<a class="code" href="class_image_resizer_1_1_image_job.html#ab835a4dde8a2962bbe48182641316cee" title="The image processing settings.">Settings</a> == null ? <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a>() : new ResizeSettings(job.Settings);
<a name="l00352"></a>00352             <span class="keywordflow">if</span> (SettingsModifier != null) s = SettingsModifier.Modify(s);
<a name="l00353"></a>00353             job.<a class="code" href="class_image_resizer_1_1_image_job.html#ab835a4dde8a2962bbe48182641316cee" title="The image processing settings.">Settings</a> = s;
<a name="l00354"></a>00354 
<a name="l00355"></a>00355             <span class="keywordflow">try</span> {
<a name="l00356"></a>00356                 <span class="comment">//Allow everything else to be overriden</span>
<a name="l00357"></a>00357                 <span class="keywordflow">if</span> (BuildJob(job) != <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_processing_exception.html" title="Represents an non-recoverable exception that occured while processing the image. Possible causes are:...">ImageProcessingException</a>(<span class="stringliteral">&quot;Nobody did the job&quot;</span>);
<a name="l00358"></a>00358                 <span class="keywordflow">return</span> job;
<a name="l00359"></a>00359             } <span class="keywordflow">finally</span> {
<a name="l00360"></a>00360                 <span class="comment">//Follow the dispose requests</span>
<a name="l00361"></a>00361                 <span class="keywordflow">if</span> (job.<a class="code" href="class_image_resizer_1_1_image_job.html#a5dd32c6152d10115383001b9ff37f640" title="If true, and if &#39;source&#39; is a IDisposable instead like Bitmap or Stream instance, it will be disposed...">DisposeSourceObject</a> &amp;&amp; job.<a class="code" href="class_image_resizer_1_1_image_job.html#a0d47d299ecd8a7316ba4a56d28e246b2" title="The source image&#39;s physical path, app-relative virtual path, or a Stream, byte array, Bitmap, VirtualFile, IVirtualFile, HttpPostedFile, or HttpPostedFileBase instance.">Source</a> is IDisposable &amp;&amp; job.<a class="code" href="class_image_resizer_1_1_image_job.html#a0d47d299ecd8a7316ba4a56d28e246b2" title="The source image&#39;s physical path, app-relative virtual path, or a Stream, byte array, Bitmap, VirtualFile, IVirtualFile, HttpPostedFile, or HttpPostedFileBase instance.">Source</a> != null) ((IDisposable)job.<a class="code" href="class_image_resizer_1_1_image_job.html#a0d47d299ecd8a7316ba4a56d28e246b2" title="The source image&#39;s physical path, app-relative virtual path, or a Stream, byte array, Bitmap, VirtualFile, IVirtualFile, HttpPostedFile, or HttpPostedFileBase instance.">Source</a>).Dispose();
<a name="l00362"></a>00362                 <span class="keywordflow">if</span> (job.<a class="code" href="class_image_resizer_1_1_image_job.html#a29f911ea9f9ede401094e90c950fe1ff" title="If true, and if &#39;dest&#39; is a Stream instance, it will be disposed after the image has been written...">DisposeDestinationStream</a> &amp;&amp; job.<a class="code" href="class_image_resizer_1_1_image_job.html#a04c90612666b1834d038ae9a4bac67b5" title="The destination Stream, physical path, or app-relative virtual path. If a Bitmap instance is desired...">Dest</a> is IDisposable &amp;&amp; job.<a class="code" href="class_image_resizer_1_1_image_job.html#a04c90612666b1834d038ae9a4bac67b5" title="The destination Stream, physical path, or app-relative virtual path. If a Bitmap instance is desired...">Dest</a> != null) ((IDisposable)job.<a class="code" href="class_image_resizer_1_1_image_job.html#a04c90612666b1834d038ae9a4bac67b5" title="The destination Stream, physical path, or app-relative virtual path. If a Bitmap instance is desired...">Dest</a>).Dispose();
<a name="l00363"></a>00363             }
<a name="l00364"></a>00364         }
<a name="l00365"></a>00365 
<a name="l00366"></a>00366         <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> BuildJob(ImageJob job) {
<a name="l00367"></a>00367             <span class="keywordflow">if</span> (base.BuildJob(job) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel;
<a name="l00368"></a>00368 
<a name="l00369"></a>00369             Bitmap b = null;
<a name="l00370"></a>00370             <span class="keywordflow">try</span> {
<a name="l00371"></a>00371                 ResizeSettings s = job.Settings;
<a name="l00372"></a>00372 
<a name="l00373"></a>00373                 <span class="comment">//Load image</span>
<a name="l00374"></a>00374                 b = LoadImage(job.Source, s, job.ResetSourceStream);
<a name="l00375"></a>00375 
<a name="l00376"></a>00376                 <span class="comment">//Save source path info</span>
<a name="l00377"></a>00377                 job.SourcePathData = (b != null &amp;&amp; b.Tag != null &amp;&amp; b.Tag is <a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a>) ? ((<a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a>)b.Tag).Path : null;
<a name="l00378"></a>00378 
<a name="l00379"></a>00379 
<a name="l00380"></a>00380                 <span class="comment">//Fire PreAcquireStream(ref dest, settings) to modify &#39;dest&#39;</span>
<a name="l00381"></a>00381                 <span class="keywordtype">object</span> dest = job.Dest;
<a name="l00382"></a>00382                 this.PreAcquireStream(ref dest, s);
<a name="l00383"></a>00383                 job.Dest = dest;
<a name="l00384"></a>00384 
<a name="l00385"></a>00385                 <span class="keywordflow">if</span> (dest == typeof(Bitmap)) {
<a name="l00386"></a>00386                     job.Result = buildToBitmap(b, s, <span class="keyword">true</span>);
<a name="l00387"></a>00387 
<a name="l00388"></a>00388                     <span class="comment">//Write to Physical file</span>
<a name="l00389"></a>00389                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dest is <span class="keywordtype">string</span>) {
<a name="l00390"></a>00390                     <span class="comment">//Make physical and resolve variable references all at the same time.</span>
<a name="l00391"></a>00391                     job.FinalPath = job.ResolveTemplatedPath(dest as <span class="keywordtype">string</span>,
<a name="l00392"></a>00392                         delegate(<span class="keywordtype">string</span> var) {
<a name="l00393"></a>00393                             <span class="keywordflow">if</span> (<span class="stringliteral">&quot;ext&quot;</span>.Equals(var, StringComparison.OrdinalIgnoreCase)) {
<a name="l00394"></a>00394                                 <a class="code" href="interface_image_resizer_1_1_encoding_1_1_i_encoder.html" title="An image encoder. Exposes methods for suitability checking, encoding, transparency compatibility chec...">IEncoder</a> e = <span class="keyword">this</span>.EncoderProvider.GetEncoder(s, b);
<a name="l00395"></a>00395                                 <span class="keywordflow">if</span> (e != null) <span class="keywordflow">return</span> e.<a class="code" href="interface_image_resizer_1_1_encoding_1_1_i_encoder.html#ad7da126e6577cc319df398bf04949859" title="Returns a file extension appropriate for the output format as currently configured, without a leading dot.">Extension</a>;
<a name="l00396"></a>00396                             }
<a name="l00397"></a>00397                             <span class="keywordflow">if</span> (<span class="stringliteral">&quot;width&quot;</span>.Equals(var, StringComparison.OrdinalIgnoreCase))
<a name="l00398"></a>00398                                 <span class="keywordflow">return</span> GetFinalSize(<span class="keyword">new</span> System.Drawing.Size(b.Width, b.Height), <span class="keyword">new</span> ResizeSettings(job.Settings)).Width.ToString();
<a name="l00399"></a>00399                             <span class="keywordflow">if</span> (<span class="stringliteral">&quot;height&quot;</span>.Equals(var, StringComparison.OrdinalIgnoreCase))
<a name="l00400"></a>00400                                 <span class="keywordflow">return</span> GetFinalSize(<span class="keyword">new</span> System.Drawing.Size(b.Width, b.Height), <span class="keyword">new</span> ResizeSettings(job.Settings)).Height.ToString();
<a name="l00401"></a>00401                             <span class="keywordflow">return</span> null;
<a name="l00402"></a>00402                         });
<a name="l00403"></a>00403                     <span class="comment">//If requested, auto-create the parent directory(ies)</span>
<a name="l00404"></a>00404                     <span class="keywordflow">if</span> (job.CreateParentDirectory) {
<a name="l00405"></a>00405                         <span class="keywordtype">string</span> dirName = Path.GetDirectoryName(job.FinalPath);
<a name="l00406"></a>00406                         <span class="keywordflow">if</span> (!Directory.Exists(dirName)) Directory.CreateDirectory(dirName);
<a name="l00407"></a>00407                     }
<a name="l00408"></a>00408                     System.IO.FileStream fs = <span class="keyword">new</span> FileStream(job.FinalPath, FileMode.Create, FileAccess.Write);
<a name="l00409"></a>00409                     <span class="keyword">using</span> (fs) {
<a name="l00410"></a>00410                         buildToStream(b, fs, s);
<a name="l00411"></a>00411                     }
<a name="l00412"></a>00412                     <span class="comment">//Write to Unknown stream</span>
<a name="l00413"></a>00413                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dest is Stream) {
<a name="l00414"></a>00414                     buildToStream(b, (Stream)dest, s);
<a name="l00415"></a>00415                 } <span class="keywordflow">else</span> <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;Destination may be a string or Stream.&quot;</span>, <span class="stringliteral">&quot;Dest&quot;</span>);
<a name="l00416"></a>00416 
<a name="l00417"></a>00417             } <span class="keywordflow">finally</span> {
<a name="l00418"></a>00418                 <span class="comment">//Get the source bitmap&#39;s underlying stream (may differ from &#39;source&#39;)</span>
<a name="l00419"></a>00419                 Stream underlyingStream = null;
<a name="l00420"></a>00420                 <span class="keywordflow">if</span> (b != null &amp;&amp; b.Tag != null &amp;&amp; b.Tag is <a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a>) underlyingStream = ((BitmapTag)b.Tag).Source;
<a name="l00421"></a>00421 
<a name="l00422"></a>00422                 <span class="comment">//Close the source bitamp&#39;s underlying stream unless it is the same stream (EDIT: or bitmap) we were passed.</span>
<a name="l00423"></a>00423                 <span class="keywordflow">if</span> (b != job.Source &amp;&amp; underlyingStream != job.Source &amp;&amp; underlyingStream != null) underlyingStream.Dispose();
<a name="l00424"></a>00424 
<a name="l00425"></a>00425                 <span class="comment">//Dispose the bitmap unless we were passed it. We check for &#39;null&#39; in case an ImageCorruptedException occured. </span>
<a name="l00426"></a>00426                 <span class="keywordflow">if</span> (b != null &amp;&amp; b != job.Source) b.Dispose();
<a name="l00427"></a>00427             }
<a name="l00428"></a>00428 
<a name="l00429"></a>00429             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel;
<a name="l00430"></a>00430         }
<a name="l00431"></a>00431 <span class="comment"></span>
<a name="l00432"></a>00432 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00433"></a>00433 <span class="comment">        /// Override this when you need to override the behavior of image encoding and/or Bitmap processing</span>
<a name="l00434"></a>00434 <span class="comment">        /// Not for external use. Does NOT dispose of &#39;source&#39; or &#39;source&#39;s underlying stream.</span>
<a name="l00435"></a>00435 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00436"></a>00436 <span class="comment">        /// &lt;param name=&quot;source&quot;&gt;&lt;/param&gt;</span>
<a name="l00437"></a>00437 <span class="comment">        /// &lt;param name=&quot;dest&quot;&gt;&lt;/param&gt;</span>
<a name="l00438"></a>00438 <span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;&lt;/param&gt;</span>
<a name="l00439"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a078dae9f4dba27048dfd41862ce9960b">00439</a> <span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a078dae9f4dba27048dfd41862ce9960b" title="Override this when you need to override the behavior of image encoding and/or Bitmap processing Not f...">buildToStream</a>(Bitmap source, Stream dest, ResizeSettings settings) {
<a name="l00440"></a>00440             <span class="keywordflow">if</span> (base.buildToStream(source, dest, settings) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00441"></a>00441 
<a name="l00442"></a>00442             <a class="code" href="interface_image_resizer_1_1_encoding_1_1_i_encoder.html" title="An image encoder. Exposes methods for suitability checking, encoding, transparency compatibility chec...">IEncoder</a> e = <span class="keyword">this</span>.EncoderProvider.GetEncoder(settings,source);
<a name="l00443"></a>00443             <span class="keywordflow">if</span> (e == null) <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_processing_exception.html" title="Represents an non-recoverable exception that occured while processing the image. Possible causes are:...">ImageProcessingException</a>(<span class="stringliteral">&quot;No image encoder was found for this request.&quot;</span>);
<a name="l00444"></a>00444             <span class="keyword">using</span> (Bitmap b = buildToBitmap(source, settings,e.SupportsTransparency)) {<span class="comment">//Determines output format, includes code for saving in a variety of formats.</span>
<a name="l00445"></a>00445                 <span class="comment">//Save to stream</span>
<a name="l00446"></a>00446                 e.Write(b, dest);
<a name="l00447"></a>00447             }
<a name="l00448"></a>00448             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00449"></a>00449         }
<a name="l00450"></a>00450 <span class="comment"></span>
<a name="l00451"></a>00451 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00452"></a>00452 <span class="comment">        /// Override this when you need to override the behavior of Bitmap processing. </span>
<a name="l00453"></a>00453 <span class="comment">        /// Not for external use. Does NOT dispose of &#39;source&#39; or &#39;source&#39;s underlying stream.</span>
<a name="l00454"></a>00454 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00455"></a>00455 <span class="comment">        /// &lt;param name=&quot;source&quot;&gt;&lt;/param&gt;</span>
<a name="l00456"></a>00456 <span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;&lt;/param&gt;</span>
<a name="l00457"></a>00457 <span class="comment">        /// &lt;param name=&quot;transparencySupported&quot;&gt;True if the output method will support transparency. If false, the image should be provided a matte color&lt;/param&gt;</span>
<a name="l00458"></a>00458 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00459"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a097e510478c85eb23fd6ac0db3cd3078">00459</a> <span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> Bitmap <a class="code" href="class_image_resizer_1_1_image_builder.html#a097e510478c85eb23fd6ac0db3cd3078" title="Override this when you need to override the behavior of Bitmap processing. Not for external use...">buildToBitmap</a>(Bitmap source, ResizeSettings settings, <span class="keywordtype">bool</span> transparencySupported) {
<a name="l00460"></a>00460             Bitmap b = base.buildToBitmap(source,settings,transparencySupported);
<a name="l00461"></a>00461             <span class="keywordflow">if</span> (b != null) <span class="keywordflow">return</span> b; <span class="comment">//Allow extensions to replace the method wholesale.</span>
<a name="l00462"></a>00462 
<a name="l00463"></a>00463             <span class="keyword">using</span> (<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> state = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a>(settings, source.Size, transparencySupported)) {
<a name="l00464"></a>00464                 state.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0" title="The source bitmap. If null, skip drawing commands, but continue layout logic.">sourceBitmap</a> = source;
<a name="l00465"></a>00465 
<a name="l00466"></a>00466                 <span class="comment">//Generic processing of ImageState instances.</span>
<a name="l00467"></a>00467                 Process(state);
<a name="l00468"></a>00468 
<a name="l00469"></a>00469                 <span class="comment">//Save a reference to return</span>
<a name="l00470"></a>00470                 b = state.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a3ecc996b00bfe20e621a43107312233d" title="The destination bitmap. If null, skip drawing commands, but continue layout logic.">destBitmap</a>;
<a name="l00471"></a>00471                 state.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a3ecc996b00bfe20e621a43107312233d" title="The destination bitmap. If null, skip drawing commands, but continue layout logic.">destBitmap</a> = null; <span class="comment">//So it doesn&#39;t get disposed yet</span>
<a name="l00472"></a>00472 
<a name="l00473"></a>00473                 <span class="comment">//Don&#39;t dispose the source bitmap either, just the graphics object.</span>
<a name="l00474"></a>00474                 state.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0" title="The source bitmap. If null, skip drawing commands, but continue layout logic.">sourceBitmap</a> = null;
<a name="l00475"></a>00475             }
<a name="l00476"></a>00476             <span class="keywordflow">return</span> b;
<a name="l00477"></a>00477         }
<a name="l00478"></a>00478 <span class="comment"></span>
<a name="l00479"></a>00479 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00480"></a>00480 <span class="comment">        /// Processes an ImageState instance. Used by Build, GetFinalSize, and TranslatePoint. </span>
<a name="l00481"></a>00481 <span class="comment">        /// Can be overriden by a plugin with the OnProcess method</span>
<a name="l00482"></a>00482 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00483"></a>00483 <span class="comment">        /// &lt;param name=&quot;s&quot;&gt;&lt;/param&gt;</span>
<a name="l00484"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a8e2f4b3bbf8bb38e54249490122ebb71">00484</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_image_resizer_1_1_image_builder.html#a8e2f4b3bbf8bb38e54249490122ebb71" title="Processes an ImageState instance. Used by Build, GetFinalSize, and TranslatePoint. Can be overriden by a plugin with the OnProcess method.">Process</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s){
<a name="l00485"></a>00485             <span class="keywordflow">if</span> (OnProcess(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span>;
<a name="l00486"></a>00486             PrepareSourceBitmap(s);  <span class="comment">// We select the page/frame and flip the source bitmap here</span>
<a name="l00487"></a>00487             PostPrepareSourceBitmap(s);
<a name="l00488"></a>00488             Layout(s); <span class="comment">//Layout everything</span>
<a name="l00489"></a>00489             PrepareDestinationBitmap(s); <span class="comment">//Create a bitmap and graphics object based on s.destSize</span>
<a name="l00490"></a>00490             Render(s); <span class="comment">//Render using the graphics object</span>
<a name="l00491"></a>00491             ProcessFinalBitmap(s); <span class="comment">//Perform the final flipping of the bitmap.</span>
<a name="l00492"></a>00492             EndProcess(s);
<a name="l00493"></a>00493         }<span class="comment"></span>
<a name="l00494"></a>00494 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00495"></a>00495 <span class="comment">        /// Process.3: Handles the layout phase of Processing</span>
<a name="l00496"></a>00496 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00497"></a>00497 <span class="comment">        /// &lt;param name=&quot;s&quot;&gt;&lt;/param&gt;</span>
<a name="l00498"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#ab0e7f7482b1ed782c4c522ca02d004f7">00498</a> <span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#ab0e7f7482b1ed782c4c522ca02d004f7" title="Process.3: Handles the layout phase of Processing.">Layout</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s) {
<a name="l00499"></a>00499             <span class="keywordflow">if</span> (base.Layout(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel;
<a name="l00500"></a>00500             FlipExistingPoints(s); <span class="comment">//Not implemented</span>
<a name="l00501"></a>00501             LayoutImage(s);
<a name="l00502"></a>00502             PostLayoutImage(s);
<a name="l00503"></a>00503             LayoutPadding(s);
<a name="l00504"></a>00504             PostLayoutPadding(s);
<a name="l00505"></a>00505             LayoutBorder(s);
<a name="l00506"></a>00506             PostLayoutBorder(s);
<a name="l00507"></a>00507             LayoutEffects(s);
<a name="l00508"></a>00508             PostLayoutEffects(s);
<a name="l00509"></a>00509             LayoutMargin(s);
<a name="l00510"></a>00510             PostLayoutMargin(s);
<a name="l00511"></a>00511             LayoutRotate(s);
<a name="l00512"></a>00512             PostLayoutRotate(s);
<a name="l00513"></a>00513             LayoutNormalize(s);
<a name="l00514"></a>00514             PostLayoutNormalize(s);
<a name="l00515"></a>00515             LayoutRound(s);
<a name="l00516"></a>00516             PostLayoutRound(s);
<a name="l00517"></a>00517             EndLayout(s);
<a name="l00518"></a>00518             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00519"></a>00519         }<span class="comment"></span>
<a name="l00520"></a>00520 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00521"></a>00521 <span class="comment">        /// Handles the rendering phase of processing</span>
<a name="l00522"></a>00522 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00523"></a>00523 <span class="comment">        /// &lt;param name=&quot;s&quot;&gt;&lt;/param&gt;</span>
<a name="l00524"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#ad3c0e9b89c62b5a6896b062d30db2641">00524</a> <span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#ad3c0e9b89c62b5a6896b062d30db2641" title="Handles the rendering phase of processing.">Render</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s) {
<a name="l00525"></a>00525             <span class="keywordflow">if</span> (base.Render(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel;
<a name="l00526"></a>00526             RenderBackground(s);
<a name="l00527"></a>00527             PostRenderBackground(s);
<a name="l00528"></a>00528             RenderEffects(s);
<a name="l00529"></a>00529             PostRenderEffects(s);
<a name="l00530"></a>00530             RenderPadding(s);
<a name="l00531"></a>00531             PostRenderPadding(s);
<a name="l00532"></a>00532             CreateImageAttribues(s);
<a name="l00533"></a>00533             PostCreateImageAttributes(s);
<a name="l00534"></a>00534             RenderImage(s);
<a name="l00535"></a>00535             PostRenderImage(s);
<a name="l00536"></a>00536             RenderBorder(s);
<a name="l00537"></a>00537             PostRenderBorder(s);
<a name="l00538"></a>00538             PreRenderOverlays(s);
<a name="l00539"></a>00539             RenderOverlays(s);
<a name="l00540"></a>00540             PreFlushChanges(s);
<a name="l00541"></a>00541             FlushChanges(s);
<a name="l00542"></a>00542             PostFlushChanges(s);
<a name="l00543"></a>00543             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00544"></a>00544         }
<a name="l00545"></a>00545 <span class="comment"></span>
<a name="l00546"></a>00546 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00547"></a>00547 <span class="comment">        /// Process.1 Switches the bitmap to the correct frame or page, and applies source flipping commands</span>
<a name="l00548"></a>00548 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00549"></a>00549 <span class="comment">        /// &lt;param name=&quot;s&quot;&gt;&lt;/param&gt;</span>
<a name="l00550"></a>00550 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00551"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a34af5ed805a72bb5477e25591d3b8110">00551</a> <span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> PrepareSourceBitmap(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s)
<a name="l00552"></a>00552         {
<a name="l00553"></a>00553             <span class="keywordflow">if</span> (base.PrepareSourceBitmap(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel ; <span class="comment">//Call extensions</span>
<a name="l00554"></a>00554 
<a name="l00555"></a>00555             if (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0" title="The source bitmap. If null, skip drawing commands, but continue layout logic.">sourceBitmap</a> == null) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None ; <span class="comment">//Nothing to do if there is no bitmap</span>
<a name="l00556"></a>00556 
<a name="l00557"></a>00557             Bitmap src = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0" title="The source bitmap. If null, skip drawing commands, but continue layout logic.">sourceBitmap</a>;
<a name="l00558"></a>00558             ResizeSettings q = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>;
<a name="l00559"></a>00559 
<a name="l00560"></a>00560             <span class="keywordtype">int</span> page = 0;
<a name="l00561"></a>00561             <span class="keywordflow">if</span> (!<span class="keywordtype">string</span>.IsNullOrEmpty(q[<span class="stringliteral">&quot;page&quot;</span>]) &amp;&amp; !<span class="keywordtype">int</span>.TryParse(q[<span class="stringliteral">&quot;page&quot;</span>], out page))
<a name="l00562"></a>00562                 page = 0;
<a name="l00563"></a>00563 
<a name="l00564"></a>00564             <span class="keywordtype">int</span> frame = 0;
<a name="l00565"></a>00565             <span class="keywordflow">if</span> (!<span class="keywordtype">string</span>.IsNullOrEmpty(q[<span class="stringliteral">&quot;frame&quot;</span>]) &amp;&amp; !<span class="keywordtype">int</span>.TryParse(q[<span class="stringliteral">&quot;frame&quot;</span>], out frame))
<a name="l00566"></a>00566                 frame = 0;
<a name="l00567"></a>00567 
<a name="l00568"></a>00568             <span class="comment">//So users can use 1-based numbers</span>
<a name="l00569"></a>00569             page--; frame--;
<a name="l00570"></a>00570 
<a name="l00571"></a>00571             <span class="comment">//Support page selection in a .tiff document.</span>
<a name="l00572"></a>00572             <span class="keywordflow">try</span> {
<a name="l00573"></a>00573                 <span class="comment">//Stay on the last page/frame if out of bounds</span>
<a name="l00574"></a>00574                 <span class="keywordflow">if</span> (page &gt; 0 &amp;&amp; page &gt;= src.GetFrameCount(FrameDimension.Page)) page = src.GetFrameCount(FrameDimension.Page) - 1;
<a name="l00575"></a>00575                 <span class="keywordflow">if</span> (frame &gt; 0 &amp;&amp; frame &gt;= src.GetFrameCount(FrameDimension.Time)) frame = src.GetFrameCount(FrameDimension.Time) - 1;
<a name="l00576"></a>00576 
<a name="l00577"></a>00577                 <span class="comment">//Select the right page/frame if specified</span>
<a name="l00578"></a>00578                 <span class="keywordflow">if</span> (page &gt; 0) src.SelectActiveFrame(FrameDimension.Page, page);
<a name="l00579"></a>00579                 <span class="keywordflow">if</span> (frame &gt; 0) src.SelectActiveFrame(FrameDimension.Time, frame);
<a name="l00580"></a>00580             } <span class="keywordflow">catch</span> (ExternalException) { } <span class="comment">//When somebody tries &amp;frame or &amp;page on a single-frame image</span>
<a name="l00581"></a>00581             
<a name="l00582"></a>00582 
<a name="l00583"></a>00583 
<a name="l00584"></a>00584             <span class="comment">//Flipping has to be done on the original - it can&#39;t be done as part of the DrawImage or later, after the borders are drawn.</span>
<a name="l00585"></a>00585 
<a name="l00586"></a>00586             <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0" title="The source bitmap. If null, skip drawing commands, but continue layout logic.">sourceBitmap</a> != null &amp;&amp; (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a27da93206fc9ebe2834a02d3e5ab62f6" title="[&quot;sFlip&quot;] Allows you to flip the source image vertically, horizontally, or both. Rotation is not supp...">SourceFlip</a> != RotateFlipType.RotateNoneFlipNone || !<span class="keywordtype">string</span>.IsNullOrEmpty(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>[<span class="stringliteral">&quot;sRotate&quot;</span>]))) {
<a name="l00587"></a>00587                 <span class="keywordtype">double</span> angle = <a class="code" href="class_image_resizer_1_1_util_1_1_utils.html">Utils</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_utils.html#a2d7b97a660751d1a406d949730f0411e" title="Returns 0 if not a recognized value. Rounds the value to 0, 90, 180, or 270.">parseRotate</a>(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>[<span class="stringliteral">&quot;sRotate&quot;</span>]);
<a name="l00588"></a>00588 
<a name="l00589"></a>00589                 s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0" title="The source bitmap. If null, skip drawing commands, but continue layout logic.">sourceBitmap</a>.RotateFlip(<a class="code" href="class_image_resizer_1_1_util_1_1_utils.html">Utils</a>.combineFlipAndRotate(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a27da93206fc9ebe2834a02d3e5ab62f6" title="[&quot;sFlip&quot;] Allows you to flip the source image vertically, horizontally, or both. Rotation is not supp...">SourceFlip</a>,angle));
<a name="l00590"></a>00590                 s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a72e11433b4c36caccab68577e864202c" title="The original size of the source bitmap. Use this instead of accessing the bitmap directly for this in...">originalSize</a> = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0" title="The source bitmap. If null, skip drawing commands, but continue layout logic.">sourceBitmap</a>.Size;
<a name="l00591"></a>00591             }
<a name="l00592"></a>00592             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00593"></a>00593         }
<a name="l00594"></a>00594 
<a name="l00595"></a>00595 
<a name="l00596"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a9e22edc2ecc338cf2cc0e2b599d3ba01">00596</a>         <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a9e22edc2ecc338cf2cc0e2b599d3ba01" title="Process.3(Layout).4: Ring &quot;padding&quot; is added to the layout.">LayoutPadding</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s) {
<a name="l00597"></a>00597             <span class="keywordflow">if</span> (base.LayoutPadding(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span>
<a name="l00598"></a>00598 
<a name="l00599"></a>00599             <span class="comment">//We need to add padding</span>
<a name="l00600"></a>00600             if (!s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ab477264bc4feaa672b217f44dc6d3531" title="[&quot;paddingWidth&quot;]: Gets/sets the width(s) of padding inside the image border.">Padding</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_box_padding.html#a4b1353db785a5d82397ed82641f05e0d" title="Returns true if th.">IsEmpty</a>) {
<a name="l00601"></a>00601                 s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>.AddRing(<span class="stringliteral">&quot;padding&quot;</span>,  s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ab477264bc4feaa672b217f44dc6d3531" title="[&quot;paddingWidth&quot;]: Gets/sets the width(s) of padding inside the image border.">Padding</a>);
<a name="l00602"></a>00602             }
<a name="l00603"></a>00603             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00604"></a>00604         }
<a name="l00605"></a>00605 
<a name="l00606"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a5226d94222273bd96dad169ad1d5bec0">00606</a>         <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a5226d94222273bd96dad169ad1d5bec0" title="Process.3(Layout).10: Margins are added to the layout.">LayoutMargin</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s) {
<a name="l00607"></a>00607             <span class="keywordflow">if</span> (base.LayoutMargin(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span>
<a name="l00608"></a>00608 
<a name="l00609"></a>00609             <span class="comment">//We need to add padding</span>
<a name="l00610"></a>00610             if (!s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a743f51d8ee756c4f82c679bac685016d" title="[&quot;margin&quot;]: Gets/sets the width(s) of the margin outside the image border and effects.">Margin</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_box_padding.html#a4b1353db785a5d82397ed82641f05e0d" title="Returns true if th.">IsEmpty</a>) {
<a name="l00611"></a>00611                 s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>.AddRing(<span class="stringliteral">&quot;margin&quot;</span>, s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a743f51d8ee756c4f82c679bac685016d" title="[&quot;margin&quot;]: Gets/sets the width(s) of the margin outside the image border and effects.">Margin</a>);
<a name="l00612"></a>00612             }
<a name="l00613"></a>00613             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00614"></a>00614         }
<a name="l00615"></a>00615 
<a name="l00616"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#ace292d7e6b4cf7093d00f2c8d3ea52d7">00616</a>         <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#ace292d7e6b4cf7093d00f2c8d3ea52d7" title="Process.3(Layout).6: Ring &quot;border&quot; is added to the layout.">LayoutBorder</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s) {
<a name="l00617"></a>00617             <span class="keywordflow">if</span> (base.LayoutBorder(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span>
<a name="l00618"></a>00618 
<a name="l00619"></a>00619             <span class="comment">//And borders</span>
<a name="l00620"></a>00620             if (!s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae5ee543eced4b1d204325b4c598b9002" title="Friendly get/set accessor for the [&quot;borderWidth&quot;] value. Returns BoxPadding.Empty when unspecified...">Border</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_box_padding.html#a4b1353db785a5d82397ed82641f05e0d" title="Returns true if th.">IsEmpty</a>) {
<a name="l00621"></a>00621                 s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>.AddRing(<span class="stringliteral">&quot;border&quot;</span>, s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae5ee543eced4b1d204325b4c598b9002" title="Friendly get/set accessor for the [&quot;borderWidth&quot;] value. Returns BoxPadding.Empty when unspecified...">Border</a>);
<a name="l00622"></a>00622             }
<a name="l00623"></a>00623             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00624"></a>00624         }
<a name="l00625"></a>00625 
<a name="l00626"></a>00626         
<a name="l00627"></a>00627 
<a name="l00628"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a251f5ddd07226dbc98abec4673afa07e">00628</a>         <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> LayoutRound(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s)
<a name="l00629"></a>00629         {
<a name="l00630"></a>00630             <span class="keywordflow">if</span> (base.LayoutRound(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span>
<a name="l00631"></a>00631             <span class="comment">//Todo, round points here.</span>
<a name="l00632"></a>00632             <span class="comment">//s.layout.Round();</span>
<a name="l00633"></a>00633             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00634"></a>00634         }
<a name="l00635"></a>00635 
<a name="l00636"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#ad7d2c54cc300e532a28e76a34de35186">00636</a>         <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> LayoutRotate(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s)
<a name="l00637"></a>00637         {
<a name="l00638"></a>00638             <span class="keywordflow">if</span> (base.LayoutRotate(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span>
<a name="l00639"></a>00639             <span class="comment">//Now, rotate all rings.</span>
<a name="l00640"></a>00640             s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_layout_builder.html#a90faf403e3c1fad5e4ff80aec2605518" title="Rotates all existing rings (Except those flagged ignore)">Rotate</a>(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#af0a73e8db4a3e4e40f0564d0dca29833" title="[&quot;rotate&quot;] The degress to rotate the image clockwise. -360 to 360.">Rotate</a>, <span class="keyword">new</span> PointF(0, 0));
<a name="l00641"></a>00641             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00642"></a>00642         }
<a name="l00643"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#ad4e099c55af7db2a764bf7429e0c1c7f">00643</a>         <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> LayoutNormalize(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s)
<a name="l00644"></a>00644         {
<a name="l00645"></a>00645             <span class="keywordflow">if</span> (base.LayoutNormalize(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span>
<a name="l00646"></a>00646             <span class="comment">//Normalize all the rings</span>
<a name="l00647"></a>00647             s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_layout_builder.html#a051b209e5c0d4a59998c266d79a1daa2" title="Normalizes all rings and invisible polygons so that the outermost ring&#39;s bounding box starts at the s...">Normalize</a>(<span class="keyword">new</span> PointF(0, 0));
<a name="l00648"></a>00648             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00649"></a>00649         }
<a name="l00650"></a>00650 
<a name="l00651"></a>00651 
<a name="l00652"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#ad3c48a100d8e661aec4dbb56783c8508">00652</a>         <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> EndLayout(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s)
<a name="l00653"></a>00653         {
<a name="l00654"></a>00654             <span class="keywordflow">if</span> (base.EndLayout(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span>
<a name="l00655"></a>00655 
<a name="l00656"></a>00656             <span class="comment">//Calculates a bounding box around all the rings in the layout, then rounds that size. Creates a 1x1 pixel destSize value at minimum.</span>
<a name="l00657"></a>00657             s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#af7685bdf458df8b87e3de9f18629c919" title="The size of the target bitmap image. Set after all sizing operations have completed.">destSize</a> = <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a3bd9aa254e8639eb72e580d324f929b9" title="Rounds the elements of the specified array [not used].">RoundPoints</a>(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_layout_builder.html#aa648f003522418c8c8a6677a62c1df4e" title="Gets a bounding box that encloses all rings that don&#39;t have ExcludeFromBoundingBox set...">GetBoundingBox</a>().Size);
<a name="l00658"></a>00658             s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#af7685bdf458df8b87e3de9f18629c919" title="The size of the target bitmap image. Set after all sizing operations have completed.">destSize</a> = <span class="keyword">new</span> Size((<span class="keywordtype">int</span>)Math.Max(1, s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#af7685bdf458df8b87e3de9f18629c919" title="The size of the target bitmap image. Set after all sizing operations have completed.">destSize</a>.Width), (int)Math.Max(1, s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#af7685bdf458df8b87e3de9f18629c919" title="The size of the target bitmap image. Set after all sizing operations have completed.">destSize</a>.Height));
<a name="l00659"></a>00659             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00660"></a>00660         }
<a name="l00661"></a>00661 <span class="comment"></span>
<a name="l00662"></a>00662 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00663"></a>00663 <span class="comment">        /// Creates a bitmap of s.destSize dimensions, intializes a graphics object for it, and configures all the default settings.</span>
<a name="l00664"></a>00664 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00665"></a>00665 <span class="comment">        /// &lt;param name=&quot;s&quot;&gt;&lt;/param&gt;</span>
<a name="l00666"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a4cb07c8d3c0aea9841613431614a3fa9">00666</a> <span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>  PrepareDestinationBitmap(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s)
<a name="l00667"></a>00667         {
<a name="l00668"></a>00668             <span class="keywordflow">if</span> (base.PrepareDestinationBitmap(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel;
<a name="l00669"></a>00669 
<a name="l00670"></a>00670              if (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0" title="The source bitmap. If null, skip drawing commands, but continue layout logic.">sourceBitmap</a> == null) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00671"></a>00671 
<a name="l00672"></a>00672             <span class="comment">//Create new bitmap using calculated size. </span>
<a name="l00673"></a>00673             s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a3ecc996b00bfe20e621a43107312233d" title="The destination bitmap. If null, skip drawing commands, but continue layout logic.">destBitmap</a> = <span class="keyword">new</span> Bitmap(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#af7685bdf458df8b87e3de9f18629c919" title="The size of the target bitmap image. Set after all sizing operations have completed.">destSize</a>.Width,s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#af7685bdf458df8b87e3de9f18629c919" title="The size of the target bitmap image. Set after all sizing operations have completed.">destSize</a>.Height, PixelFormat.Format32bppArgb);
<a name="l00674"></a>00674             
<a name="l00675"></a>00675 
<a name="l00676"></a>00676             <span class="comment">//Create graphics handle</span>
<a name="l00677"></a>00677             Graphics g = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b" title="A graphics object to write to the destination bitmap. If null, skip drawing commands, but continue layout logic.">destGraphics</a> = Graphics.FromImage(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a3ecc996b00bfe20e621a43107312233d" title="The destination bitmap. If null, skip drawing commands, but continue layout logic.">destBitmap</a>);
<a name="l00678"></a>00678 
<a name="l00679"></a>00679             <span class="comment">//High quality everthing</span>
<a name="l00680"></a>00680             g.InterpolationMode = System.Drawing.Drawing2D.InterpolationMode.HighQualityBicubic;
<a name="l00681"></a>00681             g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.HighQuality;
<a name="l00682"></a>00682             g.PixelOffsetMode = System.Drawing.Drawing2D.PixelOffsetMode.HighQuality;
<a name="l00683"></a>00683             g.CompositingQuality = System.Drawing.Drawing2D.CompositingQuality.HighQuality;
<a name="l00684"></a>00684             g.CompositingMode = CompositingMode.SourceOver;
<a name="l00685"></a>00685             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00686"></a>00686         }
<a name="l00687"></a>00687 <span class="comment"></span>
<a name="l00688"></a>00688 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00689"></a>00689 <span class="comment">        /// Sets the background color if needed or requested</span>
<a name="l00690"></a>00690 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00691"></a>00691 <span class="comment">        /// &lt;param name=&quot;s&quot;&gt;&lt;/param&gt;</span>
<a name="l00692"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a32558f4f0b1a0aaed2500dc9e5b849ea">00692</a> <span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a32558f4f0b1a0aaed2500dc9e5b849ea" title="Sets the background color if needed or requested.">RenderBackground</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s) {
<a name="l00693"></a>00693             <span class="keywordflow">if</span> (base.RenderBackground(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span>
<a name="l00694"></a>00694 
<a name="l00695"></a>00695             <span class="comment">//Skip this when we are doing simulations</span>
<a name="l00696"></a>00696             if (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b" title="A graphics object to write to the destination bitmap. If null, skip drawing commands, but continue layout logic.">destGraphics</a> == null) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00697"></a>00697 
<a name="l00698"></a>00698             Graphics g = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b" title="A graphics object to write to the destination bitmap. If null, skip drawing commands, but continue layout logic.">destGraphics</a>;
<a name="l00699"></a>00699 
<a name="l00700"></a>00700             <span class="comment">//If the image doesn&#39;t support transparency, we need to fill the background color now.</span>
<a name="l00701"></a>00701             Color background = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a40623c01b19422d9dc93b8809ef3dbc2" title="[&quot;bgcolor&quot;]: Named and hex values are supported. (rgb and rgba, both 3, 6, and 8 digits).">BackgroundColor</a>;
<a name="l00702"></a>00702 
<a name="l00703"></a>00703             <span class="comment">//Find out if we can safely know that nothing will be showing from behind the image (no margin, padding, etc, and source format doesn&#39;t have alpha channel).</span>
<a name="l00704"></a>00704             <span class="keywordtype">bool</span> nothingToShow = (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0" title="The source bitmap. If null, skip drawing commands, but continue layout logic.">sourceBitmap</a> != null &amp;&amp; (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0" title="The source bitmap. If null, skip drawing commands, but continue layout logic.">sourceBitmap</a>.PixelFormat == PixelFormat.Format24bppRgb ||
<a name="l00705"></a>00705                         s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0" title="The source bitmap. If null, skip drawing commands, but continue layout logic.">sourceBitmap</a>.PixelFormat == PixelFormat.Format32bppRgb || 
<a name="l00706"></a>00706                         s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0" title="The source bitmap. If null, skip drawing commands, but continue layout logic.">sourceBitmap</a>.PixelFormat == PixelFormat.Format48bppRgb) &amp;&amp;
<a name="l00707"></a>00707                         <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a091c43453f558cb12f8f4f4e485a711d" title="Returns true if the member elements of the specified arrays match, and the arrays are of the same len...">ArraysEqual</a>(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>[<span class="stringliteral">&quot;image&quot;</span>], s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_layout_builder.html#a25cec5c2a949a13ac66102e713d07db4" title="Returns the last ring that was added. Only returns PointSets where flags = Ring.">LastRing</a>.points) &amp;&amp;
<a name="l00708"></a>00708                         <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a6a28a2a5551836ef6fbc3dc5db592f74" title="Verifies that the specified 4 points are not rotated - that each point shares either the x or y coord...">IsUnrotated</a>(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>[<span class="stringliteral">&quot;image&quot;</span>]));
<a name="l00709"></a>00709 
<a name="l00710"></a>00710             <span class="comment">//Set the background to white if the background will be showing and the destination format doesn&#39;t support transparency.</span>
<a name="l00711"></a>00711             <span class="keywordflow">if</span> (background == Color.Transparent &amp;&amp; !s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a4292474d3ba45b4f0c20fb7b38e8631c" title="Rendering choices can depend on whether the output format supports transparency.">supportsTransparency</a> &amp; !nothingToShow) 
<a name="l00712"></a>00712                 background = Color.White;
<a name="l00713"></a>00713 
<a name="l00714"></a>00714 
<a name="l00715"></a>00715             
<a name="l00716"></a>00716             <span class="comment">//Fill background</span>
<a name="l00717"></a>00717             <span class="keywordflow">if</span> (background != Color.Transparent) <span class="comment">//This causes increased aliasing at the edges - i.e., a faint white border that is even more pronounced than usual.</span>
<a name="l00718"></a>00718                 g.Clear(background); <span class="comment">//Does this work for Color.Transparent? -- </span>
<a name="l00719"></a>00719             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00720"></a>00720         }
<a name="l00721"></a>00721 
<a name="l00722"></a>00722 
<a name="l00723"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a6095ca220f026fec0fd15b3ebf4ef12a">00723</a>         <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a6095ca220f026fec0fd15b3ebf4ef12a" title="Process.5(Render).5 Image padding is drawn.">RenderPadding</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s) {
<a name="l00724"></a>00724             <span class="keywordflow">if</span> (base.RenderPadding(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span>
<a name="l00725"></a>00725 
<a name="l00726"></a>00726             <span class="comment">//Skip this when we are doing simulations</span>
<a name="l00727"></a>00727             if (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b" title="A graphics object to write to the destination bitmap. If null, skip drawing commands, but continue layout logic.">destGraphics</a> == null) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00728"></a>00728 
<a name="l00729"></a>00729             <span class="keywordflow">if</span> (!s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>.ContainsRing(<span class="stringliteral">&quot;padding&quot;</span>)) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00730"></a>00730 
<a name="l00731"></a>00731             Color paddingColor = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#aecaac2b7c431f38d796545950119abeb" title="Gets/sets [&quot;paddingColor&quot;]. Named and hex values are supported. (rgb and rgba, both 3...">PaddingColor</a>;
<a name="l00732"></a>00732             <span class="comment">//Inherit color</span>
<a name="l00733"></a>00733             if (paddingColor.Equals(Color.Transparent)) paddingColor = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a40623c01b19422d9dc93b8809ef3dbc2" title="[&quot;bgcolor&quot;]: Named and hex values are supported. (rgb and rgba, both 3, 6, and 8 digits).">BackgroundColor</a>;
<a name="l00734"></a>00734             <span class="comment">//Draw padding around image if needed.</span>
<a name="l00735"></a>00735             if (!paddingColor.Equals(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a40623c01b19422d9dc93b8809ef3dbc2" title="[&quot;bgcolor&quot;]: Named and hex values are supported. (rgb and rgba, both 3, 6, and 8 digits).">BackgroundColor</a>) &amp;&amp; paddingColor != Color.Transparent)
<a name="l00736"></a>00736                 <span class="keyword">using</span> (Brush b = <span class="keyword">new</span> SolidBrush(paddingColor)) s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b" title="A graphics object to write to the destination bitmap. If null, skip drawing commands, but continue layout logic.">destGraphics</a>.FillPolygon(b, s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>[<span class="stringliteral">&quot;padding&quot;</span>]);
<a name="l00737"></a>00737 
<a name="l00738"></a>00738             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00739"></a>00739         }
<a name="l00740"></a>00740 
<a name="l00741"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a70a8ba17d8b08e48d273f72b256b5573">00741</a>         <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a70a8ba17d8b08e48d273f72b256b5573" title="Process.5(Render).7: An ImageAttributes instance is created if it doesn&#39;t already exist...">CreateImageAttribues</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s) {
<a name="l00742"></a>00742             <span class="keywordflow">if</span> (base.CreateImageAttribues(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span>
<a name="l00743"></a>00743             if (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a0575a388f0e3235d967cb62f4904fe09" title="Allows color correction/modification during the image copy.">copyAttibutes</a> == null) s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a0575a388f0e3235d967cb62f4904fe09" title="Allows color correction/modification during the image copy.">copyAttibutes</a> = <span class="keyword">new</span> ImageAttributes();
<a name="l00744"></a>00744             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00745"></a>00745         }
<a name="l00746"></a>00746 
<a name="l00747"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a0d9f4fd12809ec0cc17bbb2fb33a7309">00747</a>         <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a0d9f4fd12809ec0cc17bbb2fb33a7309" title="Process.5(Render).9: The image is copied to the destination parallelogram specified by ring &#39;image&#39;...">RenderImage</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s) {
<a name="l00748"></a>00748             <span class="keywordflow">if</span> (base.RenderImage(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span>
<a name="l00749"></a>00749 
<a name="l00750"></a>00750             <span class="comment">//Skip this when we are doing simulations</span>
<a name="l00751"></a>00751             if (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b" title="A graphics object to write to the destination bitmap. If null, skip drawing commands, but continue layout logic.">destGraphics</a> == null) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00752"></a>00752 
<a name="l00753"></a>00753             s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a0575a388f0e3235d967cb62f4904fe09" title="Allows color correction/modification during the image copy.">copyAttibutes</a>.SetWrapMode(WrapMode.TileFlipXY);
<a name="l00754"></a>00754             s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b" title="A graphics object to write to the destination bitmap. If null, skip drawing commands, but continue layout logic.">destGraphics</a>.DrawImage(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0" title="The source bitmap. If null, skip drawing commands, but continue layout logic.">sourceBitmap</a>, <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a28d60a0db031946a534a4efbc85e2728" title="Moves element 4 to spot 3 and truncates to 3 elements. For compatiblity with Graphics.DrawImage.">getParallelogram</a>(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>[<span class="stringliteral">&quot;image&quot;</span>]), s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a22528462bb2ca64173878ef4441bad28" title="The rectangular portion of the source image to copy.">copyRect</a>, GraphicsUnit.Pixel, s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a0575a388f0e3235d967cb62f4904fe09" title="Allows color correction/modification during the image copy.">copyAttibutes</a>);
<a name="l00755"></a>00755 
<a name="l00756"></a>00756             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00757"></a>00757         }
<a name="l00758"></a>00758 
<a name="l00759"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a73ee8389af6a5b923455dc80da3ac66e">00759</a>         <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a73ee8389af6a5b923455dc80da3ac66e" title="Process.5(Render).11: The border is rendered.">RenderBorder</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s) {
<a name="l00760"></a>00760             <span class="keywordflow">if</span> (base.RenderBorder(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span>
<a name="l00761"></a>00761 
<a name="l00762"></a>00762             <span class="comment">//Skip this when we are doing simulations</span>
<a name="l00763"></a>00763             if (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b" title="A graphics object to write to the destination bitmap. If null, skip drawing commands, but continue layout logic.">destGraphics</a> == null) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00764"></a>00764 
<a name="l00765"></a>00765             <span class="comment">//Draw border</span>
<a name="l00766"></a>00766             <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae5ee543eced4b1d204325b4c598b9002" title="Friendly get/set accessor for the [&quot;borderWidth&quot;] value. Returns BoxPadding.Empty when unspecified...">Border</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_box_padding.html#a4b1353db785a5d82397ed82641f05e0d" title="Returns true if th.">IsEmpty</a>) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00767"></a>00767 
<a name="l00768"></a>00768             <span class="keywordflow">if</span> (<span class="keywordtype">double</span>.IsNaN(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae5ee543eced4b1d204325b4c598b9002" title="Friendly get/set accessor for the [&quot;borderWidth&quot;] value. Returns BoxPadding.Empty when unspecified...">Border</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_box_padding.html#a5a549837cdd68bdbd6fa61c9d11f9e52" title="Returns double.NaN unless all edges are the same width, in which case that width is returned...">All</a>)) {
<a name="l00769"></a>00769                 <span class="keywordtype">float</span>[] widths = <span class="keyword">new</span> <span class="keywordtype">float</span>[] { (float)s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae5ee543eced4b1d204325b4c598b9002" title="Friendly get/set accessor for the [&quot;borderWidth&quot;] value. Returns BoxPadding.Empty when unspecified...">Border</a>.Top * -1, (<span class="keywordtype">float</span>)s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae5ee543eced4b1d204325b4c598b9002" title="Friendly get/set accessor for the [&quot;borderWidth&quot;] value. Returns BoxPadding.Empty when unspecified...">Border</a>.Right * -1, (float)s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae5ee543eced4b1d204325b4c598b9002" title="Friendly get/set accessor for the [&quot;borderWidth&quot;] value. Returns BoxPadding.Empty when unspecified...">Border</a>.Bottom * -1, (<span class="keywordtype">float</span>)s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae5ee543eced4b1d204325b4c598b9002" title="Friendly get/set accessor for the [&quot;borderWidth&quot;] value. Returns BoxPadding.Empty when unspecified...">Border</a>.Left * -1 };
<a name="l00770"></a>00770                 PointF[,] corners = <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a9533ccbfea8b33beaea2fb9dd3f38004" title="Returns an array of parallelograms. These parallelgrams are the &#39;corners&#39; outside each vertex in &#39;pol...">GetCorners</a>(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>[<span class="stringliteral">&quot;border&quot;</span>],widths);
<a name="l00771"></a>00771 
<a name="l00772"></a>00772                 <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt;= corners.GetUpperBound(0); i++) {
<a name="l00773"></a>00773                     <span class="keywordtype">int</span> last = i == 0 ? corners.GetUpperBound(0) : i -1;
<a name="l00774"></a>00774 
<a name="l00775"></a>00775                     PointF start = <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a826b109164045c010e8458296f566b2c" title="Returns a point equidistant beweteen A and B.">Average</a>(corners[last, 3], corners[last, 0]);
<a name="l00776"></a>00776                     PointF end = <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a826b109164045c010e8458296f566b2c" title="Returns a point equidistant beweteen A and B.">Average</a>(corners[i, 0], corners[i, 1]);
<a name="l00777"></a>00777 
<a name="l00778"></a>00778                     <span class="keyword">using</span> (Pen p = <span class="keyword">new</span> Pen(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#aeff2f3a99b045d45b46e3a417c2ab1fd" title="Gets/sets [&quot;borderColor&quot;]. Named and hex values are supported. (rgb and rgba, both 3...">BorderColor</a>, widths[i &lt; 1 ? 3 : i -1] * -1)) {
<a name="l00779"></a>00779                         p.Alignment = System.Drawing.Drawing2D.PenAlignment.Center; <span class="comment">//PenAlignment.Center is the only supported mode.</span>
<a name="l00780"></a>00780                         p.LineJoin = System.Drawing.Drawing2D.LineJoin.Miter;
<a name="l00781"></a>00781                         s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b" title="A graphics object to write to the destination bitmap. If null, skip drawing commands, but continue layout logic.">destGraphics</a>.DrawLine(p, start, end);
<a name="l00782"></a>00782                     }
<a name="l00783"></a>00783 
<a name="l00784"></a>00784                 }
<a name="l00785"></a>00785             } <span class="keywordflow">else</span> {
<a name="l00786"></a>00786                 <span class="keyword">using</span> (Pen p = <span class="keyword">new</span> Pen(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#aeff2f3a99b045d45b46e3a417c2ab1fd" title="Gets/sets [&quot;borderColor&quot;]. Named and hex values are supported. (rgb and rgba, both 3...">BorderColor</a>, (<span class="keywordtype">float</span>)s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae5ee543eced4b1d204325b4c598b9002" title="Friendly get/set accessor for the [&quot;borderWidth&quot;] value. Returns BoxPadding.Empty when unspecified...">Border</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_box_padding.html#a5a549837cdd68bdbd6fa61c9d11f9e52" title="Returns double.NaN unless all edges are the same width, in which case that width is returned...">All</a>)) {
<a name="l00787"></a>00787                     p.Alignment = System.Drawing.Drawing2D.PenAlignment.Center; <span class="comment">//PenAlignment.Center is the only supported mode.</span>
<a name="l00788"></a>00788                     p.LineJoin = System.Drawing.Drawing2D.LineJoin.Miter;
<a name="l00789"></a>00789                     s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b" title="A graphics object to write to the destination bitmap. If null, skip drawing commands, but continue layout logic.">destGraphics</a>.DrawPolygon(p, <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a062fe5752402710804fe0368016df808" title="Expands all sides on the specified polygon by the specified offset. Assumes the polygon is concave...">InflatePoly</a>(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>[<span class="stringliteral">&quot;border&quot;</span>], (<span class="keywordtype">float</span>)(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae5ee543eced4b1d204325b4c598b9002" title="Friendly get/set accessor for the [&quot;borderWidth&quot;] value. Returns BoxPadding.Empty when unspecified...">Border</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_box_padding.html#a5a549837cdd68bdbd6fa61c9d11f9e52" title="Returns double.NaN unless all edges are the same width, in which case that width is returned...">All</a> / -2.0))); <span class="comment">//I hope GDI rounds the same way as .NET.. Otherwise there may be an off-by-one error..</span>
<a name="l00790"></a>00790                 }
<a name="l00791"></a>00791             }
<a name="l00792"></a>00792 
<a name="l00793"></a>00793             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00794"></a>00794         }
<a name="l00795"></a>00795 
<a name="l00796"></a>00796 
<a name="l00797"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#af7321daa43947075d5963a33f3473883">00797</a>         <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#af7321daa43947075d5963a33f3473883" title="Process.5(Render).16: Changes are flushed to the bitmap here and the graphics object is destroyed...">FlushChanges</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s) {
<a name="l00798"></a>00798             <span class="keywordflow">if</span> (base.FlushChanges(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span>
<a name="l00799"></a>00799 
<a name="l00800"></a>00800             if (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b" title="A graphics object to write to the destination bitmap. If null, skip drawing commands, but continue layout logic.">destGraphics</a> == null) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00801"></a>00801             <span class="comment">//Commit changes.</span>
<a name="l00802"></a>00802             s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b" title="A graphics object to write to the destination bitmap. If null, skip drawing commands, but continue layout logic.">destGraphics</a>.Flush(FlushIntention.Flush);
<a name="l00803"></a>00803             s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b" title="A graphics object to write to the destination bitmap. If null, skip drawing commands, but continue layout logic.">destGraphics</a>.Dispose();
<a name="l00804"></a>00804             s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b" title="A graphics object to write to the destination bitmap. If null, skip drawing commands, but continue layout logic.">destGraphics</a> = null;
<a name="l00805"></a>00805             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00806"></a>00806         }
<a name="l00807"></a>00807 
<a name="l00808"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a5f3df5920c5ec3f75085a91d4268157a">00808</a>         <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a5f3df5920c5ec3f75085a91d4268157a" title="Process.6: Non-rendering changes to the bitmap object occur here, such as flipping. The graphics object is unavailable.">ProcessFinalBitmap</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s) {
<a name="l00809"></a>00809             <span class="keywordflow">if</span> (base.ProcessFinalBitmap(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span>
<a name="l00810"></a>00810 
<a name="l00811"></a>00811             <span class="comment">//The default if we are doing a simulation</span>
<a name="l00812"></a>00812 
<a name="l00813"></a>00813             s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#ab7d7513afe8fad1300bf8cb96942f06f" title="The dimensions of the bitmap afer all operations have been applied to it (Calling FlipRotate can chan...">finalSize</a> = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#af7685bdf458df8b87e3de9f18629c919" title="The size of the target bitmap image. Set after all sizing operations have completed.">destSize</a>;
<a name="l00814"></a>00814             <span class="comment">//Skip this when we are doing simulations</span>
<a name="l00815"></a>00815             if (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a3ecc996b00bfe20e621a43107312233d" title="The destination bitmap. If null, skip drawing commands, but continue layout logic.">destBitmap</a> == null) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00816"></a>00816 
<a name="l00817"></a>00817             <span class="comment">//The last flipping.</span>
<a name="l00818"></a>00818             <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ad6f58c2c9129334491b436b2abdbc9b5" title="Allows you to flip the entire resulting image vertically, horizontally, or both. Rotation is not supp...">Flip</a> != RotateFlipType.RotateNoneFlipNone)
<a name="l00819"></a>00819                 s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a3ecc996b00bfe20e621a43107312233d" title="The destination bitmap. If null, skip drawing commands, but continue layout logic.">destBitmap</a>.RotateFlip(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ad6f58c2c9129334491b436b2abdbc9b5" title="Allows you to flip the entire resulting image vertically, horizontally, or both. Rotation is not supp...">Flip</a>);
<a name="l00820"></a>00820 
<a name="l00821"></a>00821             <span class="comment">//Set DPI value</span>
<a name="l00822"></a>00822             <span class="keywordflow">if</span> (!<span class="keywordtype">string</span>.IsNullOrEmpty(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>[<span class="stringliteral">&quot;dpi&quot;</span>])){
<a name="l00823"></a>00823                 <span class="keywordtype">int</span> dpi = Util.Utils.getInt(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>,<span class="stringliteral">&quot;dpi&quot;</span>,96);
<a name="l00824"></a>00824                 s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a3ecc996b00bfe20e621a43107312233d" title="The destination bitmap. If null, skip drawing commands, but continue layout logic.">destBitmap</a>.SetResolution(dpi, dpi);
<a name="l00825"></a>00825             }
<a name="l00826"></a>00826             
<a name="l00827"></a>00827             s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#ab7d7513afe8fad1300bf8cb96942f06f" title="The dimensions of the bitmap afer all operations have been applied to it (Calling FlipRotate can chan...">finalSize</a> = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a3ecc996b00bfe20e621a43107312233d" title="The destination bitmap. If null, skip drawing commands, but continue layout logic.">destBitmap</a>.Size;
<a name="l00828"></a>00828             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00829"></a>00829         }
<a name="l00830"></a>00830        
<a name="l00831"></a>00831 <span class="comment"></span>
<a name="l00832"></a>00832 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00833"></a>00833 <span class="comment">        /// Doesn&#39;t support flipping. Translate a point on the original bitmap to a point on the new bitmap. If the original point no longer exists, returns Empty</span>
<a name="l00834"></a>00834 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00835"></a>00835 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00836"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#af498e87cf9e20dee93b0fb711e39581f">00836</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> PointF[] <a class="code" href="class_image_resizer_1_1_image_builder.html#af498e87cf9e20dee93b0fb711e39581f" title="Doesn&#39;t support flipping. Translate a point on the original bitmap to a point on the new bitmap...">TranslatePoints</a>(PointF[] sourcePoints, Size originalSize, ResizeSettings q) {
<a name="l00837"></a>00837             <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a>(q, originalSize, <span class="keyword">true</span>);
<a name="l00838"></a>00838             s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>.AddInvisiblePolygon(<span class="stringliteral">&quot;points&quot;</span>, sourcePoints);
<a name="l00839"></a>00839             Process(s);
<a name="l00840"></a>00840             <span class="keywordflow">return</span> s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>[<span class="stringliteral">&quot;points&quot;</span>];
<a name="l00841"></a>00841         }
<a name="l00842"></a>00842          
<a name="l00843"></a>00843 
<a name="l00844"></a>00844 <span class="comment"></span>
<a name="l00845"></a>00845 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00846"></a>00846 <span class="comment">        /// Gets the final size of an image</span>
<a name="l00847"></a>00847 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00848"></a>00848 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00849"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#ac0ad7c5f8e03ca9a50e6538677c3475d">00849</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> Size GetFinalSize(Size originalSize, ResizeSettings q)
<a name="l00850"></a>00850         {
<a name="l00851"></a>00851             <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a>(q, originalSize, <span class="keyword">true</span>);
<a name="l00852"></a>00852             Process(s);
<a name="l00853"></a>00853             <span class="keywordflow">return</span> s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#ab7d7513afe8fad1300bf8cb96942f06f" title="The dimensions of the bitmap afer all operations have been applied to it (Calling FlipRotate can chan...">finalSize</a>;
<a name="l00854"></a>00854         }
<a name="l00855"></a>00855 
<a name="l00856"></a>00856   
<a name="l00857"></a>00857 
<a name="l00858"></a>00858 
<a name="l00859"></a>00859 
<a name="l00860"></a>00860 <span class="comment"></span>
<a name="l00861"></a>00861 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00862"></a>00862 <span class="comment">        /// Populates copyRect, as well as Rings image and imageArea. Translates and scales any existing rings as if they existed on the original bitmap.</span>
<a name="l00863"></a>00863 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00864"></a>00864 <span class="comment">        /// &lt;param name=&quot;s&quot;&gt;&lt;/param&gt;</span>
<a name="l00865"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a0649c6799567d75a2f0c46d3cd0f6196">00865</a> <span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a0649c6799567d75a2f0c46d3cd0f6196" title="Populates copyRect, as well as Rings image and imageArea. Translates and scales any existing rings as...">LayoutImage</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s) {
<a name="l00866"></a>00866             <span class="keywordflow">if</span> (base.LayoutImage(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span>
<a name="l00867"></a>00867 
<a name="l00868"></a>00868             <span class="comment">//Use the crop size if present.</span>
<a name="l00869"></a>00869             s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a22528462bb2ca64173878ef4441bad28" title="The rectangular portion of the source image to copy.">copyRect</a> = <span class="keyword">new</span> RectangleF(<span class="keyword">new</span> PointF(0,0),s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a72e11433b4c36caccab68577e864202c" title="The original size of the source bitmap. Use this instead of accessing the bitmap directly for this in...">originalSize</a>);
<a name="l00870"></a>00870             <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a6f5f21e0d3390dd6b3ca20f562806869" title="[&quot;crop&quot;]=none|auto Defaults to None - letterboxing is used if both width and height are supplied...">CropMode</a> == <a class="code" href="namespace_image_resizer.html#a288a233240980da59e426df4651ec850">CropMode</a>.Custom) {
<a name="l00871"></a>00871                 s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a22528462bb2ca64173878ef4441bad28" title="The rectangular portion of the source image to copy.">copyRect</a> = <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a61b50db80ba6c732565d07ef6163c0a0" title="Rounds a floating-point rectangle to an integer rectangle using System.Round.">ToRectangle</a>(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.getCustomCropSourceRect(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a72e11433b4c36caccab68577e864202c" title="The original size of the source bitmap. Use this instead of accessing the bitmap directly for this in...">originalSize</a>)); <span class="comment">//Round the custom crop rectangle coordinates</span>
<a name="l00872"></a>00872                 <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a22528462bb2ca64173878ef4441bad28" title="The rectangular portion of the source image to copy.">copyRect</a>.Size.IsEmpty) <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;You must specify a custom crop rectange if crop=custom&quot;</span>);
<a name="l00873"></a>00873             }
<a name="l00874"></a>00874             <span class="comment">//Save the manual crop size.</span>
<a name="l00875"></a>00875             SizeF manualCropSize = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a0a8e5171b83599382074f3462944c4dd" title="(read-only) Same as copyRect.Size, convenience property.">copySize</a>;
<a name="l00876"></a>00876 
<a name="l00877"></a>00877             <a class="code" href="namespace_image_resizer.html#affd730f8b2250fecace497124be5a37d" title="How do deal with aspect ratio differences between the requested size and the original image&#39;s size...">FitMode</a> fit = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae85b8620285cccbd4f5dcd86f862b0db" title="[&quot;mode&quot;]: Sets the fit mode for the image. max, min, pad, crop, carve, stretch">Mode</a>;
<a name="l00878"></a>00878             <span class="comment">//Determine fit mode to use if both vertical and horizontal limits are used.</span>
<a name="l00879"></a>00879             <span class="keywordflow">if</span> (fit == <a class="code" href="namespace_image_resizer.html#affd730f8b2250fecace497124be5a37d" title="How do deal with aspect ratio differences between the requested size and the original image&#39;s size...">FitMode</a>.None){
<a name="l00880"></a>00880                 <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a80001d573cec108c39e5376f6d854993" title="[&quot;width&quot;]: Sets the desired width of the image. (minus padding, borders, margins, effects, and rotation). The only instance the resulting image will be smaller is if the original source image is smaller. Set Scale=Both to upscale these images and ensure the output always matches &#39;width&#39; and &#39;height&#39;. If both width and height are specified, the image will be &#39;letterboxed&#39; to match the desired aspect ratio. Use maxwidth/maxheight, crop=auto, or stretch=fill to avoid this behavior.">Width</a> != -1 || s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a7145aef3affc3244969cad8841359e3f" title="[&quot;height&quot;]: Sets the desired height of the image. (minus padding, borders, margins, effects, and rotation) The only instance the resulting image will be smaller is if the original source image is smaller. Set Scale=Both to upscale these images and ensure the output always matches &#39;width&#39; and &#39;height&#39;. If both width and height are specified, the image will be &#39;letterboxed&#39; to match the desired aspect ratio. Use maxwidth/maxheight, crop=auto, or stretch=fill to avoid this behavior.">Height</a> != -1){
<a name="l00881"></a>00881 
<a name="l00882"></a>00882                     <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a2f8c18ab03453a0c9f74a087f206a443" title="[Depreciated] (Replaced by mode=stretch) Whether to preserve aspect ratio or stretch to fill the boun...">Stretch</a> == <a class="code" href="namespace_image_resizer.html#ac2f2172bdae0792555449bdc8547b8bc" title="[Depreciated (Use FitMode.Stretch)] Previously used to force an image to be &#39;stretched&#39; to match a di...">StretchMode</a>.Fill) fit = <a class="code" href="namespace_image_resizer.html#affd730f8b2250fecace497124be5a37d" title="How do deal with aspect ratio differences between the requested size and the original image&#39;s size...">FitMode</a>.Stretch;
<a name="l00883"></a>00883                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="stringliteral">&quot;auto&quot;</span>.Equals(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>[<span class="stringliteral">&quot;crop&quot;</span>], StringComparison.OrdinalIgnoreCase)) fit = <a class="code" href="namespace_image_resizer.html#affd730f8b2250fecace497124be5a37d" title="How do deal with aspect ratio differences between the requested size and the original image&#39;s size...">FitMode</a>.Crop;
<a name="l00884"></a>00884                     <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<span class="keywordtype">string</span>.IsNullOrEmpty(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>[<span class="stringliteral">&quot;carve&quot;</span>]) 
<a name="l00885"></a>00885                         &amp;&amp; !<span class="stringliteral">&quot;false&quot;</span>.Equals(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>[<span class="stringliteral">&quot;carve&quot;</span>], StringComparison.OrdinalIgnoreCase)
<a name="l00886"></a>00886                         &amp;&amp; !<span class="stringliteral">&quot;none&quot;</span>.Equals(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>[<span class="stringliteral">&quot;carve&quot;</span>], StringComparison.OrdinalIgnoreCase)) fit = <a class="code" href="namespace_image_resizer.html#affd730f8b2250fecace497124be5a37d" title="How do deal with aspect ratio differences between the requested size and the original image&#39;s size...">FitMode</a>.Carve;
<a name="l00887"></a>00887                     <span class="keywordflow">else</span> fit = <a class="code" href="namespace_image_resizer.html#affd730f8b2250fecace497124be5a37d" title="How do deal with aspect ratio differences between the requested size and the original image&#39;s size...">FitMode</a>.Pad;
<a name="l00888"></a>00888                 }<span class="keywordflow">else</span>{
<a name="l00889"></a>00889                     fit = <a class="code" href="namespace_image_resizer.html#affd730f8b2250fecace497124be5a37d" title="How do deal with aspect ratio differences between the requested size and the original image&#39;s size...">FitMode</a>.Max;
<a name="l00890"></a>00890                 }
<a name="l00891"></a>00891 
<a name="l00892"></a>00892             }
<a name="l00893"></a>00893             
<a name="l00894"></a>00894 
<a name="l00895"></a>00895 
<a name="l00896"></a>00896 
<a name="l00897"></a>00897             <span class="comment">//Aspect ratio of the image</span>
<a name="l00898"></a>00898             <span class="keywordtype">double</span> imageRatio = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a0a8e5171b83599382074f3462944c4dd" title="(read-only) Same as copyRect.Size, convenience property.">copySize</a>.Width / s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a0a8e5171b83599382074f3462944c4dd" title="(read-only) Same as copyRect.Size, convenience property.">copySize</a>.Height;
<a name="l00899"></a>00899 
<a name="l00900"></a>00900             <span class="comment">//Zoom factor</span>
<a name="l00901"></a>00901             <span class="keywordtype">double</span> zoom = <a class="code" href="class_image_resizer_1_1_util_1_1_utils.html">Utils</a>.getDouble(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>, <span class="stringliteral">&quot;zoom&quot;</span>, 1);
<a name="l00902"></a>00902 
<a name="l00903"></a>00903             <span class="comment">//The target size for the image </span>
<a name="l00904"></a>00904             SizeF targetSize = <span class="keyword">new</span> SizeF(-1, -1);
<a name="l00905"></a>00905             <span class="comment">//Target area for the image</span>
<a name="l00906"></a>00906             SizeF areaSize = <span class="keyword">new</span> SizeF(-1, -1);
<a name="l00907"></a>00907             <span class="comment">//If any dimensions are specified, calculate. Otherwise, use original image dimensions</span>
<a name="l00908"></a>00908             <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a80001d573cec108c39e5376f6d854993" title="[&quot;width&quot;]: Sets the desired width of the image. (minus padding, borders, margins, effects, and rotation). The only instance the resulting image will be smaller is if the original source image is smaller. Set Scale=Both to upscale these images and ensure the output always matches &#39;width&#39; and &#39;height&#39;. If both width and height are specified, the image will be &#39;letterboxed&#39; to match the desired aspect ratio. Use maxwidth/maxheight, crop=auto, or stretch=fill to avoid this behavior.">Width</a> != -1 || s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a7145aef3affc3244969cad8841359e3f" title="[&quot;height&quot;]: Sets the desired height of the image. (minus padding, borders, margins, effects, and rotation) The only instance the resulting image will be smaller is if the original source image is smaller. Set Scale=Both to upscale these images and ensure the output always matches &#39;width&#39; and &#39;height&#39;. If both width and height are specified, the image will be &#39;letterboxed&#39; to match the desired aspect ratio. Use maxwidth/maxheight, crop=auto, or stretch=fill to avoid this behavior.">Height</a> != -1 || s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a16d3547dfb87d598876fb64e54c0a938" title="[&quot;maxheight&quot;]: Sets the maximum desired height of the image. (minus padding, borders, margins, effects, and rotation). The image may be smaller than this value to maintain aspect ratio when both maxwidth and maxheight are specified.">MaxHeight</a> != -1 || s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a80fd5f97f3264009aa2c2648bb1379d7" title="[&quot;maxwidth&quot;]: Sets the maximum desired width of the image. (minus padding, borders, margins, effects, and rotation). The image may be smaller than this value to maintain aspect ratio when both maxwidth and maxheight are specified.">MaxWidth</a> != -1) {
<a name="l00909"></a>00909                 <span class="comment">//A dimension was specified. </span>
<a name="l00910"></a>00910                 <span class="comment">//We first calculate the largest size the image can be under the width/height/maxwidth/maxheight restrictions.</span>
<a name="l00911"></a>00911                 <span class="comment">//- pretending stretch=fill and scale=both</span>
<a name="l00912"></a>00912 
<a name="l00913"></a>00913                 <span class="comment">//Temp vars - results stored in targetSize and areaSize</span>
<a name="l00914"></a>00914                 <span class="keywordtype">double</span> width = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a80001d573cec108c39e5376f6d854993" title="[&quot;width&quot;]: Sets the desired width of the image. (minus padding, borders, margins, effects, and rotation). The only instance the resulting image will be smaller is if the original source image is smaller. Set Scale=Both to upscale these images and ensure the output always matches &#39;width&#39; and &#39;height&#39;. If both width and height are specified, the image will be &#39;letterboxed&#39; to match the desired aspect ratio. Use maxwidth/maxheight, crop=auto, or stretch=fill to avoid this behavior.">Width</a>;
<a name="l00915"></a>00915                 <span class="keywordtype">double</span> height = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a7145aef3affc3244969cad8841359e3f" title="[&quot;height&quot;]: Sets the desired height of the image. (minus padding, borders, margins, effects, and rotation) The only instance the resulting image will be smaller is if the original source image is smaller. Set Scale=Both to upscale these images and ensure the output always matches &#39;width&#39; and &#39;height&#39;. If both width and height are specified, the image will be &#39;letterboxed&#39; to match the desired aspect ratio. Use maxwidth/maxheight, crop=auto, or stretch=fill to avoid this behavior.">Height</a>;
<a name="l00916"></a>00916                 <span class="keywordtype">double</span> maxwidth = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a80fd5f97f3264009aa2c2648bb1379d7" title="[&quot;maxwidth&quot;]: Sets the maximum desired width of the image. (minus padding, borders, margins, effects, and rotation). The image may be smaller than this value to maintain aspect ratio when both maxwidth and maxheight are specified.">MaxWidth</a>;
<a name="l00917"></a>00917                 <span class="keywordtype">double</span> maxheight = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a16d3547dfb87d598876fb64e54c0a938" title="[&quot;maxheight&quot;]: Sets the maximum desired height of the image. (minus padding, borders, margins, effects, and rotation). The image may be smaller than this value to maintain aspect ratio when both maxwidth and maxheight are specified.">MaxHeight</a>;
<a name="l00918"></a>00918 
<a name="l00919"></a>00919                 <span class="comment">//Handle cases of width/maxheight and height/maxwidth as in legacy versions. </span>
<a name="l00920"></a>00920                 <span class="keywordflow">if</span> (width != -1 &amp;&amp; maxheight != -1) maxheight = Math.Min(maxheight, (width /imageRatio));
<a name="l00921"></a>00921                 <span class="keywordflow">if</span> (height != -1 &amp;&amp; maxwidth != -1) maxwidth = Math.Min(maxwidth, (height * imageRatio));
<a name="l00922"></a>00922 
<a name="l00923"></a>00923                 <span class="comment">//Eliminate cases where both a value and a max value are specified: use the smaller value for the width/height </span>
<a name="l00924"></a>00924                 <span class="keywordflow">if</span> (maxwidth &gt; 0 &amp;&amp; width &gt; 0) {   width = Math.Min(maxwidth, width);    maxwidth = -1;  }
<a name="l00925"></a>00925                 <span class="keywordflow">if</span> (maxheight &gt; 0 &amp;&amp; height &gt; 0) { height = Math.Min(maxheight, height); maxheight = -1; }
<a name="l00926"></a>00926 
<a name="l00927"></a>00927                 <span class="comment">//Move max values to width/height. FitMode should already reflect the mode we are using, and we&#39;ve already resolved mixed modes above.</span>
<a name="l00928"></a>00928                 width = Math.Max(width, maxwidth);
<a name="l00929"></a>00929                 height = Math.Max(height, maxheight);
<a name="l00930"></a>00930 
<a name="l00931"></a>00931                 <span class="comment">//Calculate missing value (a missing value is handled the same everywhere). </span>
<a name="l00932"></a>00932                 <span class="keywordflow">if</span> (width &gt; 0 &amp;&amp; height &lt;= 0) height = width/ imageRatio;
<a name="l00933"></a>00933                 <span class="keywordflow">else</span> <span class="keywordflow">if</span> (height &gt; 0 &amp;&amp; width &lt;= 0) width = height * imageRatio;
<a name="l00934"></a>00934 
<a name="l00935"></a>00935                 <span class="comment">//We now have width &amp; height, our target size. It will only be a different aspect ratio from the image if both &#39;width&#39; and &#39;height&#39; are specified.</span>
<a name="l00936"></a>00936 
<a name="l00937"></a>00937                 <span class="comment">//FitMode.Max</span>
<a name="l00938"></a>00938                 <span class="keywordflow">if</span> (fit == <a class="code" href="namespace_image_resizer.html#affd730f8b2250fecace497124be5a37d" title="How do deal with aspect ratio differences between the requested size and the original image&#39;s size...">FitMode</a>.Max) {
<a name="l00939"></a>00939                     areaSize = targetSize = <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a0495fc6849c286b9f880c900d1b66e7d" title="Scales &#39;inner&#39; to fit inside &#39;bounding&#39; while maintaining aspect ratio. Upscales and downscales...">ScaleInside</a>(manualCropSize, <span class="keyword">new</span> SizeF((<span class="keywordtype">float</span>)width, (<span class="keywordtype">float</span>)height));
<a name="l00940"></a>00940                 <span class="comment">//FitMode.Pad</span>
<a name="l00941"></a>00941                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fit == <a class="code" href="namespace_image_resizer.html#affd730f8b2250fecace497124be5a37d" title="How do deal with aspect ratio differences between the requested size and the original image&#39;s size...">FitMode</a>.Pad) {
<a name="l00942"></a>00942                     areaSize = <span class="keyword">new</span> SizeF((<span class="keywordtype">float</span>)width, (<span class="keywordtype">float</span>)height);
<a name="l00943"></a>00943                     targetSize = <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a0495fc6849c286b9f880c900d1b66e7d" title="Scales &#39;inner&#39; to fit inside &#39;bounding&#39; while maintaining aspect ratio. Upscales and downscales...">ScaleInside</a>(manualCropSize, areaSize);
<a name="l00944"></a>00944                 <span class="comment">//FitMode.crop</span>
<a name="l00945"></a>00945                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fit == <a class="code" href="namespace_image_resizer.html#affd730f8b2250fecace497124be5a37d" title="How do deal with aspect ratio differences between the requested size and the original image&#39;s size...">FitMode</a>.Crop) {
<a name="l00946"></a>00946                     <span class="comment">//We autocrop - so both target and area match the requested size</span>
<a name="l00947"></a>00947                     areaSize = targetSize = <span class="keyword">new</span> SizeF((<span class="keywordtype">float</span>)width, (<span class="keywordtype">float</span>)height);
<a name="l00948"></a>00948                     <span class="comment">//Determine the size of the area we are copying</span>
<a name="l00949"></a>00949                     Size sourceSize = <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a3bd9aa254e8639eb72e580d324f929b9" title="Rounds the elements of the specified array [not used].">RoundPoints</a>(<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a0495fc6849c286b9f880c900d1b66e7d" title="Scales &#39;inner&#39; to fit inside &#39;bounding&#39; while maintaining aspect ratio. Upscales and downscales...">ScaleInside</a>(areaSize, manualCropSize)); 
<a name="l00950"></a>00950                     <span class="comment">//Center the portion we are copying within the manualCropSize</span>
<a name="l00951"></a>00951                     s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a22528462bb2ca64173878ef4441bad28" title="The rectangular portion of the source image to copy.">copyRect</a> = <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a61b50db80ba6c732565d07ef6163c0a0" title="Rounds a floating-point rectangle to an integer rectangle using System.Round.">ToRectangle</a>(<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#ac55469f83724581600d27eabd617c582" title="Aligns the specified rectangle object with its reference (&#39;container&#39;) rectangle using the specified ...">AlignWith</a>(<span class="keyword">new</span> RectangleF(0, 0, sourceSize.Width, sourceSize.Height), s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a22528462bb2ca64173878ef4441bad28" title="The rectangular portion of the source image to copy.">copyRect</a>, s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a753bf2d269715c21237d0786255167ad" title="How to anchor the image when cropping or adding whitespace to meet sizing requirements.">Anchor</a>));
<a name="l00952"></a>00952 
<a name="l00953"></a>00953                 } <span class="keywordflow">else</span> { <span class="comment">//Stretch and carve both act like stretching, so do that:</span>
<a name="l00954"></a>00954                     areaSize = targetSize = <span class="keyword">new</span> SizeF((<span class="keywordtype">float</span>)width, (<span class="keywordtype">float</span>)height);
<a name="l00955"></a>00955                 }
<a name="l00956"></a>00956 
<a name="l00957"></a>00957 
<a name="l00958"></a>00958             }<span class="keywordflow">else</span>{
<a name="l00959"></a>00959                 <span class="comment">//No dimensions specified, no fit mode needed. Use manual crop dimensions</span>
<a name="l00960"></a>00960                 areaSize = targetSize = manualCropSize; 
<a name="l00961"></a>00961             }
<a name="l00962"></a>00962 
<a name="l00963"></a>00963             <span class="comment">//Multiply both areaSize and targetSize by zoom. </span>
<a name="l00964"></a>00964             areaSize.Width *= (float)zoom;
<a name="l00965"></a>00965             areaSize.Height *= (float)zoom;
<a name="l00966"></a>00966             targetSize.Width *= (float)zoom;
<a name="l00967"></a>00967             targetSize.Height *= (float)zoom;
<a name="l00968"></a>00968                 
<a name="l00969"></a>00969             <span class="comment">//Now do upscale/downscale checks. If they take effect, set targetSize to imageSize</span>
<a name="l00970"></a>00970             <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae7fc16e795fb8ebf6423f3df628dc404" title="[&quot;scale&quot;] Whether to downscale, upscale, upscale the canvas, or both upscale or downscale the image a...">Scale</a> == <a class="code" href="namespace_image_resizer.html#aca52f6f1e90c78a5e5e79c6d709a571c" title="Controls whether the image is allowed to upscale, downscale, both, or if only the canvas gets to be u...">ScaleMode</a>.DownscaleOnly) {
<a name="l00971"></a>00971                 <span class="keywordflow">if</span> (<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a98c83ada594ba88b34d97d26176f8ada" title="Returns true if &#39;inner&#39; fits inside or equals &#39;outer&#39;.">FitsInside</a>(manualCropSize, targetSize)) {
<a name="l00972"></a>00972                     <span class="comment">//The image is smaller or equal to its target polygon. Use original image coordinates instead.</span>
<a name="l00973"></a>00973                     areaSize = targetSize = manualCropSize;
<a name="l00974"></a>00974                 }
<a name="l00975"></a>00975             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae7fc16e795fb8ebf6423f3df628dc404" title="[&quot;scale&quot;] Whether to downscale, upscale, upscale the canvas, or both upscale or downscale the image a...">Scale</a> == <a class="code" href="namespace_image_resizer.html#aca52f6f1e90c78a5e5e79c6d709a571c" title="Controls whether the image is allowed to upscale, downscale, both, or if only the canvas gets to be u...">ScaleMode</a>.UpscaleOnly) {
<a name="l00976"></a>00976                 <span class="keywordflow">if</span> (!<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a98c83ada594ba88b34d97d26176f8ada" title="Returns true if &#39;inner&#39; fits inside or equals &#39;outer&#39;.">FitsInside</a>(manualCropSize, targetSize)) {
<a name="l00977"></a>00977                     <span class="comment">//The image is larger than its target. Use original image coordintes instead</span>
<a name="l00978"></a>00978                     areaSize = targetSize = manualCropSize;
<a name="l00979"></a>00979 
<a name="l00980"></a>00980                 }
<a name="l00981"></a>00981             } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae7fc16e795fb8ebf6423f3df628dc404" title="[&quot;scale&quot;] Whether to downscale, upscale, upscale the canvas, or both upscale or downscale the image a...">Scale</a> == <a class="code" href="namespace_image_resizer.html#aca52f6f1e90c78a5e5e79c6d709a571c" title="Controls whether the image is allowed to upscale, downscale, both, or if only the canvas gets to be u...">ScaleMode</a>.UpscaleCanvas) {
<a name="l00982"></a>00982                 <span class="comment">//Same as downscaleonly, except areaSize isn&#39;t changed.</span>
<a name="l00983"></a>00983                 <span class="keywordflow">if</span> (<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a98c83ada594ba88b34d97d26176f8ada" title="Returns true if &#39;inner&#39; fits inside or equals &#39;outer&#39;.">FitsInside</a>(manualCropSize, targetSize)) {
<a name="l00984"></a>00984                     <span class="comment">//The image is smaller or equal to its target polygon. Use original image coordinates instead.</span>
<a name="l00985"></a>00985 
<a name="l00986"></a>00986                     targetSize = manualCropSize;
<a name="l00987"></a>00987                 }
<a name="l00988"></a>00988             }
<a name="l00989"></a>00989 
<a name="l00990"></a>00990 
<a name="l00991"></a>00991             <span class="comment">//May 12: require max dimension and round values to minimize rounding differences later.</span>
<a name="l00992"></a>00992             areaSize.Width = Math.Max(1, (<span class="keywordtype">float</span>)Math.Round(areaSize.Width));
<a name="l00993"></a>00993             areaSize.Height = Math.Max(1, (<span class="keywordtype">float</span>)Math.Round(areaSize.Height));
<a name="l00994"></a>00994             targetSize.Width = Math.Max(1, (<span class="keywordtype">float</span>)Math.Round(targetSize.Width));
<a name="l00995"></a>00995             targetSize.Height = Math.Max(1, (<span class="keywordtype">float</span>)Math.Round(targetSize.Height));
<a name="l00996"></a>00996             
<a name="l00997"></a>00997 
<a name="l00998"></a>00998             <span class="comment">//Translate and scale all existing rings</span>
<a name="l00999"></a>00999             s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_layout_builder.html#a69742c38ab6136c7ef2978d8d2bec5b0" title="Translates and scales all rings and invisible polygons as specified.">Shift</a>(<span class="keyword">new</span> RectangleF(0, 0, s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a72e11433b4c36caccab68577e864202c" title="The original size of the source bitmap. Use this instead of accessing the bitmap directly for this in...">originalSize</a>.Width, s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a72e11433b4c36caccab68577e864202c" title="The original size of the source bitmap. Use this instead of accessing the bitmap directly for this in...">originalSize</a>.Height), <span class="keyword">new</span> RectangleF(<span class="keyword">new</span> Point(0, 0), targetSize));
<a name="l01000"></a>01000 
<a name="l01001"></a>01001             s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>.AddRing(<span class="stringliteral">&quot;image&quot;</span>, <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#ac49aeb808917493b95d26e6e36183285" title="Returns a clockwise array of points on the rectangle. Point 0 is top-left.">ToPoly</a>(<span class="keyword">new</span> RectangleF(<span class="keyword">new</span> PointF(0, 0), targetSize)));
<a name="l01002"></a>01002 
<a name="l01003"></a>01003             s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>.AddRing(<span class="stringliteral">&quot;imageArea&quot;</span>,<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#ac49aeb808917493b95d26e6e36183285" title="Returns a clockwise array of points on the rectangle. Point 0 is top-left.">ToPoly</a>(<span class="keyword">new</span> RectangleF(<span class="keyword">new</span> PointF(0, 0), areaSize)));
<a name="l01004"></a>01004 
<a name="l01005"></a>01005             <span class="comment">//Center imageArea around &#39;image&#39;</span>
<a name="l01006"></a>01006             s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>[<span class="stringliteral">&quot;imageArea&quot;</span>] = <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#ac55469f83724581600d27eabd617c582" title="Aligns the specified rectangle object with its reference (&#39;container&#39;) rectangle using the specified ...">AlignWith</a>(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>[<span class="stringliteral">&quot;imageArea&quot;</span>], s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>[<span class="stringliteral">&quot;image&quot;</span>], s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a753bf2d269715c21237d0786255167ad" title="How to anchor the image when cropping or adding whitespace to meet sizing requirements.">Anchor</a>);
<a name="l01007"></a>01007 
<a name="l01008"></a>01008             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l01009"></a>01009         }
<a name="l01010"></a>01010 
<a name="l01011"></a>01011 
<a name="l01012"></a>01012 
<a name="l01013"></a>01013         <span class="keyword">private</span> readonly <span class="keywordtype">string</span>[] _supportedFileExtensions = <span class="keyword">new</span> <span class="keywordtype">string</span>[]
<a name="l01014"></a>01014              {<span class="stringliteral">&quot;bmp&quot;</span>,<span class="stringliteral">&quot;gif&quot;</span>,<span class="stringliteral">&quot;exif&quot;</span>,<span class="stringliteral">&quot;png&quot;</span>,<span class="stringliteral">&quot;tif&quot;</span>,<span class="stringliteral">&quot;tiff&quot;</span>,<span class="stringliteral">&quot;tff&quot;</span>,<span class="stringliteral">&quot;jpg&quot;</span>,<span class="stringliteral">&quot;jpeg&quot;</span>, <span class="stringliteral">&quot;jpe&quot;</span>,<span class="stringliteral">&quot;jif&quot;</span>,<span class="stringliteral">&quot;jfif&quot;</span>,<span class="stringliteral">&quot;jfi&quot;</span>};
<a name="l01015"></a>01015 <span class="comment"></span>
<a name="l01016"></a>01016 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l01017"></a>01017 <span class="comment">        /// Returns a list of the file extensions ImageBuilder can load by default. Plugins can implement IFileExtensionPlugin to add new ones.</span>
<a name="l01018"></a>01018 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l01019"></a>01019 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l01020"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a303922cae5567e1e58462695000ec705">01020</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> IEnumerable&lt;string&gt; <a class="code" href="class_image_resizer_1_1_image_builder.html#a303922cae5567e1e58462695000ec705" title="Returns a list of the file extensions ImageBuilder can load by default. Plugins can implement IFileEx...">GetSupportedFileExtensions</a>() {
<a name="l01021"></a>01021             <span class="keywordflow">return</span> _supportedFileExtensions;
<a name="l01022"></a>01022         }
<a name="l01023"></a>01023        
<a name="l01024"></a>01024         <span class="keyword">private</span> readonly <span class="keywordtype">string</span>[] _supportedQuerystringKeys = <span class="keyword">new</span> <span class="keywordtype">string</span>[]{
<a name="l01025"></a>01025                     <span class="stringliteral">&quot;format&quot;</span>, <span class="stringliteral">&quot;thumbnail&quot;</span>, <span class="stringliteral">&quot;maxwidth&quot;</span>, <span class="stringliteral">&quot;maxheight&quot;</span>,
<a name="l01026"></a>01026                 <span class="stringliteral">&quot;width&quot;</span>, <span class="stringliteral">&quot;height&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>,<span class="stringliteral">&quot;h&quot;</span>,
<a name="l01027"></a>01027                 <span class="stringliteral">&quot;scale&quot;</span>, <span class="stringliteral">&quot;stretch&quot;</span>, <span class="stringliteral">&quot;crop&quot;</span>, <span class="stringliteral">&quot;cropxunits&quot;</span>, <span class="stringliteral">&quot;cropyunits&quot;</span>, <span class="stringliteral">&quot;page&quot;</span>, <span class="stringliteral">&quot;bgcolor&quot;</span>,
<a name="l01028"></a>01028                 <span class="stringliteral">&quot;rotate&quot;</span>, <span class="stringliteral">&quot;flip&quot;</span>, <span class="stringliteral">&quot;sourceFlip&quot;</span>, <span class="stringliteral">&quot;sFlip&quot;</span>, <span class="stringliteral">&quot;sRotate&quot;</span>, <span class="stringliteral">&quot;borderWidth&quot;</span>,
<a name="l01029"></a>01029                 <span class="stringliteral">&quot;borderColor&quot;</span>, <span class="stringliteral">&quot;paddingWidth&quot;</span>, <span class="stringliteral">&quot;paddingColor&quot;</span>,
<a name="l01030"></a>01030                 <span class="stringliteral">&quot;ignoreicc&quot;</span>, <span class="stringliteral">&quot;frame&quot;</span>, <span class="stringliteral">&quot;useresizingpipeline&quot;</span>, 
<a name="l01031"></a>01031                 <span class="stringliteral">&quot;cache&quot;</span>, <span class="stringliteral">&quot;process&quot;</span>, <span class="stringliteral">&quot;margin&quot;</span>, <span class="stringliteral">&quot;anchor&quot;</span>,<span class="stringliteral">&quot;dpi&quot;</span>,<span class="stringliteral">&quot;mode&quot;</span>, <span class="stringliteral">&quot;zoom&quot;</span>};
<a name="l01032"></a>01032 <span class="comment"></span>
<a name="l01033"></a>01033 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l01034"></a>01034 <span class="comment">        /// Returns a list of the querystring commands ImageBuilder can parse by default. Plugins can implement IQuerystringPlugin to add new ones.</span>
<a name="l01035"></a>01035 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l01036"></a>01036 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l01037"></a><a class="code" href="class_image_resizer_1_1_image_builder.html#a4d055522b14dc97d8edf5eb8ec3a1296">01037</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> IEnumerable&lt;string&gt; <a class="code" href="class_image_resizer_1_1_image_builder.html#a4d055522b14dc97d8edf5eb8ec3a1296" title="Returns a list of the querystring commands ImageBuilder can parse by default. Plugins can implement I...">GetSupportedQuerystringKeys</a>() {
<a name="l01038"></a>01038             <span class="keywordflow">return</span> _supportedQuerystringKeys;
<a name="l01039"></a>01039         }
<a name="l01040"></a>01040     }
<a name="l01041"></a>01041 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
