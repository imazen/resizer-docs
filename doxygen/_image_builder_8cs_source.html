<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>ImageResizer: C:/Users/nathanael/Documents/resizer/Core/ImageBuilder.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="imageresizer-logo-00aec4.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.4.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_c6310732a22f63c0c2fc5595561e68f1.html">Core</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">ImageBuilder.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* Copyright (c) 2011 Nathanael Jones. See license.txt */</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">using</span> System;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">using</span> System.Configuration;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using</span> System.Drawing;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using</span> System.IO;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">using</span> System.Drawing.Imaging;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">using</span> System.Collections.Generic;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using</span> System.Diagnostics;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">using</span> System.Collections.Specialized;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">using</span> System.Drawing.Drawing2D;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">using</span> System.Runtime.InteropServices;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">using</span> System.Reflection;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">using</span> ImageResizer.Resizing;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">using</span> ImageResizer.Encoding;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keyword">using</span> ImageResizer.Util;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">using</span> ImageResizer.Configuration;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">using</span> ImageResizer.Plugins;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">using</span> System.Globalization;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">using</span> ImageResizer.ExtensionMethods;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keyword">namespace </span>ImageResizer</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;{<span class="comment"></span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">    /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">    /// Provides methods for generating resized images, and for reading and writing them to disk.</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">    /// Use ImageBuilder.Current to get the current instance (as configured in the application configuration), or use ImageBuilder.Current.Create() to control which extensions are used.</span></div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="comment">    /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00027"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html">   27</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">partial class </span><a class="code" href="class_image_resizer_1_1_image_builder.html">ImageBuilder</a> : <a class="code" href="class_image_resizer_1_1_resizing_1_1_abstract_image_processor.html">AbstractImageProcessor</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_querystring_plugin.html">IQuerystringPlugin</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_file_extension_plugin.html">IFileExtensionPlugin</a></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;    {<span class="comment"></span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">        /// Shouldn&#39;t be used except to make a factory instance.</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a064d8a5a2a83b8f9f35a0f8b411b0cf9">   32</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <a class="code" href="class_image_resizer_1_1_image_builder.html#a064d8a5a2a83b8f9f35a0f8b411b0cf9">ImageBuilder</a>() { }</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;        <span class="keyword">protected</span> <a class="code" href="interface_image_resizer_1_1_encoding_1_1_i_encoder_provider.html">IEncoderProvider</a> _encoderProvider = null;<span class="comment"></span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">        /// Handles the encoder selection and provision proccess.</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a9bd254f85a8c846eb287a985b3accbde">   37</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="interface_image_resizer_1_1_encoding_1_1_i_encoder_provider.html">IEncoderProvider</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a9bd254f85a8c846eb287a985b3accbde">EncoderProvider</a> { <span class="keyword">get</span> { <span class="keywordflow">return</span> _encoderProvider; } }</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        <span class="keyword">protected</span> <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_settings_modifier.html">ISettingsModifier</a> _settingsModifier = null;<span class="comment"></span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;<span class="comment">        /// May be null. A class to modify or normalize ResizeSettings instances before they are used.</span></div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00044"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#af9bcb1d2b216d219670c2a98a3586792">   44</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_settings_modifier.html">ISettingsModifier</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#af9bcb1d2b216d219670c2a98a3586792">SettingsModifier</a> { <span class="keyword">get</span> { <span class="keywordflow">return</span> _settingsModifier; } }</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        <span class="keyword">private</span> <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_image_provider.html">IVirtualImageProvider</a> _virtualFileProvider;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">        /// Provides a resolution service for app-relative URLs. </span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a391309229993353e75f82223cdf0323f">   51</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_image_provider.html">IVirtualImageProvider</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a391309229993353e75f82223cdf0323f">VirtualFileProvider</a> {</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;            <span class="keyword">get</span> { <span class="keywordflow">return</span> _virtualFileProvider; }</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        }</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">        /// Returns a shared instance of ImageBuilder or a subclass, equivalent to  Config.Current.CurrentImageBuilder</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span></div>
<div class="line"><a name="l00059"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#afcfb7f40a65d121670118ccebfe1ca4b">   59</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">static</span> <a class="code" href="class_image_resizer_1_1_image_builder.html">ImageBuilder</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#afcfb7f40a65d121670118ccebfe1ca4b">Current</a> {<span class="keyword">get</span>{ <span class="keywordflow">return</span> Config.Current.CurrentImageBuilder; }}</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">        /// Create a new instance of ImageBuilder using the specified extensions, encoder provider, file provider, and settings filter. Extension methods will be fired in the order they exist in the collection.</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment">        /// &lt;param name=&quot;extensions&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;<span class="comment">        /// &lt;param name=&quot;encoderProvider&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;<span class="comment">        /// &lt;param name=&quot;settingsModifier&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;<span class="comment">        /// &lt;param name=&quot;virtualFileProvider&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00068"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a5fd0abe1e804a676b596f11786ea45a6">   68</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_image_builder.html#a5fd0abe1e804a676b596f11786ea45a6">ImageBuilder</a>(IEnumerable&lt;BuilderExtension&gt; extensions, <a class="code" href="interface_image_resizer_1_1_encoding_1_1_i_encoder_provider.html">IEncoderProvider</a> encoderProvider, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_image_provider.html">IVirtualImageProvider</a> virtualFileProvider, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_settings_modifier.html">ISettingsModifier</a> settingsModifier)</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            : base(extensions) {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            this._encoderProvider = encoderProvider;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            this._virtualFileProvider = virtualFileProvider;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            this._settingsModifier = settingsModifier;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        }</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;<span class="comment">        /// Creates another instance of the class using the specified extensions. Subclasses should override this and point to their own constructor.</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;<span class="comment">        /// &lt;param name=&quot;extensions&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;<span class="comment">        /// &lt;param name=&quot;writer&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="comment">        /// &lt;param name=&quot;virtualFileProvider&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="comment">        /// &lt;param name=&quot;settingsModifier&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span></div>
<div class="line"><a name="l00083"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#ac0d37c18d40aeae0148dc56165d826a6">   83</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="class_image_resizer_1_1_image_builder.html">ImageBuilder</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#ac0d37c18d40aeae0148dc56165d826a6">Create</a>(IEnumerable&lt;BuilderExtension&gt; extensions, <a class="code" href="interface_image_resizer_1_1_encoding_1_1_i_encoder_provider.html">IEncoderProvider</a> writer, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_image_provider.html">IVirtualImageProvider</a> virtualFileProvider, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_settings_modifier.html">ISettingsModifier</a> settingsModifier) {</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_builder.html#a064d8a5a2a83b8f9f35a0f8b411b0cf9">ImageBuilder</a>(extensions,writer,virtualFileProvider,settingsModifier);</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;        }<span class="comment"></span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">        /// Copies the instance along with extensions. Subclasses must override this.</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span></div>
<div class="line"><a name="l00090"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a1de161f6083813949f26b01c0e10283c">   90</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="class_image_resizer_1_1_image_builder.html">ImageBuilder</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a1de161f6083813949f26b01c0e10283c">Copy</a>(){</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_builder.html#a064d8a5a2a83b8f9f35a0f8b411b0cf9">ImageBuilder</a>(this.<a class="code" href="class_image_resizer_1_1_resizing_1_1_abstract_image_processor.html#a79fd55facde998a6090e73fe8affda85">exts</a>,this._encoderProvider, this._virtualFileProvider,this._settingsModifier);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;<span class="comment">        /// Loads a Bitmap from the specified source. If a filename is available, it will be attached to bitmap.Tag in a BitmapTag instance. The Bitmap.Tag.Path value may be a virtual, relative, UNC, windows, or unix path. </span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment">        /// Does not dispose &#39;source&#39; if it is a Stream or Image instance - that&#39;s the responsibility of the calling code.</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">        /// &lt;param name=&quot;source&quot;&gt;May  be an instance of string, VirtualFile, IVirtualFile IVirtualBitmapFile, HttpPostedFile, Bitmap, Image, or Stream.  If passed an Image instance, the image will be cloned, which will cause metadata, indexed state, and any additional frames to be lost. Accepts physical paths and application relative paths. (C:\... and ~/path) &lt;/param&gt;</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;Will ignore ICC profile if ?ignoreicc=true.&lt;/param&gt;</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">        /// &lt;returns&gt;A Bitmap. The .Tag property will include a BitmapTag instance. If .Tag.Source is not null, remember to dispose it when you dispose the Bitmap.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment"></span>        [Obsolete(<span class="stringliteral">&quot;This method returns an unmanaged, shoot-yourself-in-the-foot Bitmap instance. Use Build(ImageJob) or LoadImageInfo(source, new string[]{\&quot;source.width\&quot;,\&quot;source.height\&quot;})&quot;</span>)]</div>
<div class="line"><a name="l00104"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a185dcaa809670c427788a45539f2f1f3">  104</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">virtual</span> Bitmap <a class="code" href="class_image_resizer_1_1_image_builder.html#a185dcaa809670c427788a45539f2f1f3">LoadImage</a>(<span class="keywordtype">object</span> source, <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> settings) {</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="class_image_resizer_1_1_image_builder.html#a185dcaa809670c427788a45539f2f1f3">LoadImage</a>(source, settings, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;        }</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;<span class="comment">        /// Returns a dictionary of information about the given image. </span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;<span class="comment">        /// &lt;param name=&quot;source&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;<span class="comment">        /// &lt;param name=&quot;requestedInfo&quot;&gt;Pass null to get the defaults (&quot;source.width&quot;, source.height&quot;)&lt;/param&gt;</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span></div>
<div class="line"><a name="l00114"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#af3553cf8d81e99e9739491bdd34c38e1">  114</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> IDictionary&lt;string,object&gt; <a class="code" href="class_image_resizer_1_1_image_builder.html#af3553cf8d81e99e9739491bdd34c38e1">LoadImageInfo</a>(<span class="keywordtype">object</span> source, IEnumerable&lt;string&gt; requestedInfo){</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="class_image_resizer_1_1_image_builder.html#a12f49b48e9244ee7f6e86fd60fffcc83">Build</a>(<span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_job.html">ImageJob</a>(source, requestedInfo)).ResultInfo;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;        }</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">        /// Loads a Bitmap from the specified source. If a filename is available, it will be attached to bitmap.Tag in a BitmapTag instance. The Bitmap.Tag.Path value may be a virtual, relative, UNC, windows, or unix path. </span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment">        /// Does not dispose &#39;source&#39; if it is a Stream or Image instance - that&#39;s the responsibility of the calling code.</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">        /// &lt;param name=&quot;source&quot;&gt;May  be an instance of string, VirtualFile, IVirtualFile IVirtualBitmapFile, HttpPostedFile, Bitmap, Image, or Stream.  If passed an Image instance, the image will be cloned, which will cause metadata, indexed state, and any additional frames to be lost. Accepts physical paths and application relative paths. (C:\... and ~/path) &lt;/param&gt;</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;Will ignore ICC profile if ?ignoreicc=true.&lt;/param&gt;</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">        /// &lt;param name=&quot;restoreStreamPos&quot;&gt;If true, the position of the source stream will be restored after being read&lt;/param&gt;</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">        /// &lt;returns&gt;A Bitmap. The .Tag property will include a BitmapTag instance. If .Tag.Source is not null, remember to dispose it when you dispose the Bitmap.&lt;/returns&gt;</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment"></span>        [Obsolete(<span class="stringliteral">&quot;This method returns an unmanaged, shoot-yourself-in-the-foot Bitmap instance. Use Build(ImageJob) or LoadImageInfo(source, new string[]{\&quot;source.width\&quot;,\&quot;source.height\&quot;})&quot;</span>)]</div>
<div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a17a976acd6935ca64f88b54332a00c2d">  127</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">virtual</span> Bitmap <a class="code" href="class_image_resizer_1_1_image_builder.html#a17a976acd6935ca64f88b54332a00c2d">LoadImage</a>(<span class="keywordtype">object</span> source, <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> settings, <span class="keywordtype">bool</span> restoreStreamPos){</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            <span class="keywordflow">if</span> (source == null) <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="stringliteral">&quot;source&quot;</span>, <span class="stringliteral">&quot;The source argument cannot be null; how do you load an image from a null value?&quot;</span>);</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            <span class="keywordtype">bool</span> disposeStream = !(source is Stream);</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            <span class="keywordtype">string</span> path = null;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            <span class="comment">//Fire PreLoadImage(source,settings)</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            this.PreLoadImage(ref source, ref path, ref disposeStream,  ref settings);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            System.Drawing.Bitmap b = null;</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;            <span class="keywordtype">string</span> loadFailureReasons = <span class="stringliteral">&quot;File may be corrupted, empty, or may contain a PNG image with a single dimension greater than 65,535 pixels.&quot;</span>;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            </div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            <span class="comment">//Bitmap</span></div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            <span class="keywordflow">if</span> (source is Bitmap) <span class="keywordflow">return</span> source as Bitmap;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            <span class="comment">//Image</span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            <span class="keywordflow">if</span> (source is System.Drawing.Image) </div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">new</span> Bitmap((System.Drawing.Image)source); <span class="comment">//Note, this clones just the raw bitmap data - doesn&#39;t copy attributes, bit depth, or anything.</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            <span class="comment">//IVirtualBitmapFile</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;            <span class="keywordflow">if</span> (source is <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_bitmap_file.html">IVirtualBitmapFile</a>) {</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                b = ((IVirtualBitmapFile)source).GetBitmap();</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;                <span class="keywordflow">if</span> (b.Tag == null) b.Tag = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a>(((IVirtualBitmapFile)source).VirtualPath);</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;                <span class="keywordflow">return</span> b;</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            }</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            <span class="keywordtype">bool</span> restoreStreamPosition = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            Stream s = <a class="code" href="class_image_resizer_1_1_image_builder.html#ab51799a036b1624f4e5d9c2aa2fcfa88">GetStreamFromSource</a>(source, settings, ref disposeStream, out path, out restoreStreamPosition);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            <span class="keywordflow">if</span> (s == null) <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;Source may only be an instance of string, VirtualFile, IVirtualBitmapFile, HttpPostedFile, HttpPostedFileBase, Bitmap, Image, or Stream.&quot;</span>, <span class="stringliteral">&quot;source&quot;</span>);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            <span class="keywordflow">if</span> (restoreStreamPos) restoreStreamPosition = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            <span class="comment">//Save the original stream position if it&#39;s an HttpPostedFile</span></div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            <span class="keywordtype">long</span> originalPosition = (restoreStreamPosition) ? s.Position : - 1;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                    <span class="comment">//First try DecodeStream</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                    b = <span class="keyword">this</span>.DecodeStream(s, settings, path);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                    <span class="comment">//Let the fallbacks work. (Only happens when a plugin overrides DecodeStream and retuns null)</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                    <span class="keywordflow">if</span> (b == null) <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_corrupted_exception.html">ImageCorruptedException</a>(<span class="stringliteral">&quot;Failed to decode image. Plugin made DecodeStream return null.&quot;</span>, null);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                } <span class="keywordflow">catch</span> (Exception e) {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                    <span class="comment">//if (Debugger.IsAttached) throw e;</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                    Debug.Write(<span class="stringliteral">&quot;Falling back to DecodeStreamFailed: &quot;</span> + e.Message + <span class="stringliteral">&quot;\n&quot;</span> + e.StackTrace); </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                    </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                    <span class="keywordflow">if</span> (!s.CanSeek)</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                        <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_corrupted_exception.html">ImageCorruptedException</a>(<span class="stringliteral">&quot;Cannot attempt fallback decoding path on a non-seekable stream&quot;</span>, e);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                    b = <a class="code" href="class_image_resizer_1_1_resizing_1_1_abstract_image_processor.html#a6cb4bce1d3b4b2947f9355d32ec66c68">DecodeStreamFailed</a>(s, settings, path);</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                    <span class="keywordflow">if</span> (b == null) <span class="keywordflow">throw</span>; <span class="comment">//If none of the extensions loaded the image, throw the exception anyhow.</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                }</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            } <span class="keywordflow">catch</span> (ArgumentException ae) {</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                ae.Data.Add(<span class="stringliteral">&quot;path&quot;</span>, path);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> ImageCorruptedException(loadFailureReasons, ae);</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            } <span class="keywordflow">catch</span> (ExternalException ee) {</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                ee.Data.Add(<span class="stringliteral">&quot;path&quot;</span>, path);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> ImageCorruptedException(loadFailureReasons, ee);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            } <span class="keywordflow">finally</span> {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                <span class="comment">//Now, we can&#39;t dispose the stream if Bitmap is still using it. </span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                <span class="keywordflow">if</span> (b != null &amp;&amp; b.Tag != null &amp;&amp; b.Tag is <a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a> &amp;&amp; ((<a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a>)b.Tag).Source == s) {</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                    <span class="comment">//And, it looks like Bitmap is still using it.</span></div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                    s = null;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                }</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                <span class="comment">//Dispose the stream if we opened it. If someone passed it to us, they&#39;re responsible.</span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                <span class="keywordflow">if</span> (s != null &amp;&amp; disposeStream) { s.Dispose(); s = null; }</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                <span class="comment">//Restore the stream position if we were given an HttpPostedFile instance</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                <span class="keywordflow">if</span> (originalPosition &gt; -1 &amp;&amp; s != null &amp;&amp; s.CanSeek) s.Position = originalPosition;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                <span class="comment">//Make sure the bitmap is tagged with its path. DecodeStream usually handles this, only relevant for extension decoders.</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                <span class="keywordflow">if</span> (b != null &amp;&amp; b.Tag == null &amp;&amp; path != null) b.Tag = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a>(path);</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;            }</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            PostDecodeStream(ref b,settings);</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            <span class="keywordflow">return</span> b;            </div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;        }</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">        /// Decodes the stream into a System.Drawing.Bitmap instance. As of 3.0.7, now ensures the stream can safely be closed after the method returns.</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">        /// May copy the stream. The copied stream will be in b.Tag.Source. Does not close or dispose any streams.</span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;<span class="comment">        /// &lt;param name=&quot;s&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;<span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;<span class="comment">        /// &lt;param name=&quot;optionalPath&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;<span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span></div>
<div class="line"><a name="l00210"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#aa00b42693a3af4544751cc1d1be0bbbf">  210</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">override</span> Bitmap <a class="code" href="class_image_resizer_1_1_image_builder.html#aa00b42693a3af4544751cc1d1be0bbbf">DecodeStream</a>(Stream s, <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> settings, <span class="keywordtype">string</span> optionalPath) {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            Bitmap b = base.DecodeStream(s, settings, optionalPath);</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <span class="keywordflow">if</span> (b != null &amp;&amp; b.Tag == null) b.Tag = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a>(optionalPath); <span class="comment">//Assume Bitmap wasn&#39;t used.</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <span class="keywordflow">if</span> (b != null) <span class="keywordflow">return</span> b;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            <span class="keywordtype">bool</span> useICM = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <span class="keywordflow">if</span> (settings != null &amp;&amp; <span class="stringliteral">&quot;true&quot;</span>.Equals(settings[<span class="stringliteral">&quot;ignoreicc&quot;</span>], StringComparison.OrdinalIgnoreCase)) useICM = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            <span class="comment">//NDJ - May 24, 2011 - Copying stream into memory so the original can be closed safely.</span></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            MemoryStream ms = StreamExtensions.CopyToMemoryStream(s); </div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            b = <span class="keyword">new</span> Bitmap(ms, useICM); </div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            b.Tag = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a>(optionalPath, ms); <span class="comment">//May 25, 2011: Storing a ref to the MemorySteam so it won&#39;t accidentally be garbage collected.</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            <span class="keywordflow">return</span> b;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;        }<span class="comment"></span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;<span class="comment">        /// For plugin use only. </span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;<span class="comment">        /// Returns a stream instance from the specified source object and settings object. </span></div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;<span class="comment">        /// To exend this method, override GetStream.</span></div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;<span class="comment">        /// &lt;param name=&quot;source&quot;&gt;The physical or app-relative path, or a VirtualFile, IVirtualFile, Stream, HttpPostedFile, or HttpPostedFileBase instance.&lt;/param&gt;</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;<span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;Querystring settings to pass to the VirtualFileProvider&lt;/param&gt;</span></div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;<span class="comment">        /// &lt;param name=&quot;disposeStream&quot;&gt;You should externally initialize this to true, unless the user-provided &#39;source&#39; is a Stream instance. Will be set to false for HttpPostedFile and HttpPostedFileBase instances, so they can be reused. &lt;/param&gt;</span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;<span class="comment">        /// &lt;param name=&quot;path&quot;&gt;The physical or virtual path associated with the stream (if present). Otherwise null&lt;/param&gt;</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;<span class="comment">        /// &lt;param name=&quot;restoreStreamPosition&quot;&gt;True if you should save and restore the seek position of the stream. True for HttpPostedFile and HttpPostedFileBase instances. &lt;/param&gt;</span></div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;<span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span></div>
<div class="line"><a name="l00235"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#ab51799a036b1624f4e5d9c2aa2fcfa88">  235</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> Stream <a class="code" href="class_image_resizer_1_1_image_builder.html#ab51799a036b1624f4e5d9c2aa2fcfa88">GetStreamFromSource</a>(<span class="keywordtype">object</span> source, <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> settings, ref <span class="keywordtype">bool</span> disposeStream, out <span class="keywordtype">string</span> path, out <span class="keywordtype">bool</span> restoreStreamPosition) {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            <span class="keywordflow">if</span> (source == null) <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="stringliteral">&quot;source&quot;</span>, <span class="stringliteral">&quot;The source argument cannot be null; how do you load an image from a null value?&quot;</span>);</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            <span class="keywordflow">if</span> (settings == null) settings = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a>();</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            <span class="comment">//Allow plugins to extend this</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            <span class="keywordtype">bool</span> disposeS = disposeStream;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            Stream s = base.GetStream(source, settings, ref disposeS, out path, out restoreStreamPosition);</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            <span class="keywordflow">if</span> (s != null) {</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                disposeStream = disposeS;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            }</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;            <span class="comment">//App-relative path - converted to virtual path</span></div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;            <span class="keywordflow">if</span> (source is <span class="keywordtype">string</span>) {</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                path = source as string;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                <span class="comment">//Convert app-relative paths to VirtualFile instances</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                <span class="keywordflow">if</span> (path.StartsWith(<span class="stringliteral">&quot;~&quot;</span>, StringComparison.OrdinalIgnoreCase)) {</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                    source = this.VirtualFileProvider.GetFile(PathUtils.ResolveAppRelative(path), settings);</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                    <span class="keywordflow">if</span> (source == null) <span class="keywordflow">throw</span> <span class="keyword">new</span> FileNotFoundException(<span class="stringliteral">&quot;The specified virtual file could not be found.&quot;</span>, <a class="code" href="class_image_resizer_1_1_util_1_1_path_utils.html">PathUtils</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_path_utils.html#adafb4cd7d85a3567782842873c1a5176">ResolveAppRelative</a>(path));</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;            }</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;            path = null;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            restoreStreamPosition = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            <span class="comment">//Stream</span></div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;            <span class="keywordflow">if</span> (source is Stream) {</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                s = (Stream)source;</div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;            }</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                <span class="comment">//VirtualFile</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (source is System.Web.Hosting.VirtualFile) {</div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                path = ((System.Web.Hosting.VirtualFile)source).VirtualPath;</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                s = ((System.Web.Hosting.VirtualFile)source).Open();</div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                <span class="comment">//IVirtualFile</span></div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (source is <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_file.html">IVirtualFile</a>) {</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                path = ((IVirtualFile)source).VirtualPath;</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                s = ((IVirtualFile)source).Open();</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                <span class="comment">//PhysicalPath</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (source is <span class="keywordtype">string</span>) {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                path = (string)source;</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                s = File.Open(path, FileMode.Open, FileAccess.Read, FileShare.Read);</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (source is byte[]) {</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                s = <span class="keyword">new</span> MemoryStream((byte[])source, 0, ((byte[])source).Length, <span class="keyword">false</span>, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                <span class="comment">//For HttpPostedFile and HttpPostedFileBase - we must use reflection to support .NET 3.5 without losing 2.0 compat.</span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                PropertyInfo pname = source.GetType().GetProperty(<span class="stringliteral">&quot;FileName&quot;</span>, typeof(<span class="keywordtype">string</span>));</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                PropertyInfo pstream = source.GetType().GetProperty(<span class="stringliteral">&quot;InputStream&quot;</span>);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;                <span class="keywordflow">if</span> (pname != null &amp;&amp; pstream != null) {</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;                    path = pname.GetValue(source, null) as <span class="keywordtype">string</span>;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;                    s = pstream.GetValue(source, null) as Stream;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;                    disposeStream = <span class="keyword">false</span>; <span class="comment">//We never want to dispose the HttpPostedFile or HttpPostedFileBase streams..</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;                    restoreStreamPosition = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;                }</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;                <span class="keywordflow">if</span> (s == null) <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            }</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;            <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;                <span class="keywordflow">if</span> (s != null &amp;&amp; s.Length &lt;= s.Position &amp;&amp; s.Position &gt; 0)</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;                    <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_processing_exception.html">ImageProcessingException</a>(<span class="stringliteral">&quot;The source stream is at the end (have you already read it?). You must call stream.Seek(0, SeekOrigin.Begin); before re-using a stream, or use ImageJob with ResetSourceStream=true the first time the stream is read.&quot;</span>);</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;                <span class="keywordflow">if</span> (s != null &amp;&amp; s.Length == 0)</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                    <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_processing_exception.html">ImageProcessingException</a>(<span class="stringliteral">&quot;Source stream is empty; it has a length of 0. No bytes, no data. We can&#39;t work with this.&quot;</span>);</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            } <span class="keywordflow">catch</span> (NotSupportedException) {</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;            <span class="keywordflow">return</span> s;</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;        }</div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="preprocessor">        #region Wrapper overloads</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="preprocessor"></span><span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment"></span><span class="comment">        /// Resizes and processes the specified source image and returns a bitmap of the result.</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment"></span><span class="comment">        /// Note! </span></div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;<span class="comment"></span><span class="comment">        /// This method assumes that transparency will be supported in the final output format, and therefore does not apply a matte color. Use &amp;amp;bgcolor to specify a background color</span></div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;<span class="comment"></span><span class="comment">        /// if you use this method with a non-transparent format such as Jpeg.</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;<span class="comment"></span><span class="comment">        /// If passed a source Stream, Bitmap, or Image instance, it will be disposed after use. Use disposeSource=False to disable that behavior. </span></div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;<span class="comment"></span><span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;<span class="comment"></span><span class="comment">        /// &lt;param name=&quot;source&quot;&gt;May be an instance of string (a physical path), VirtualFile, IVirtualBitmapFile, HttpPostedFile, Bitmap, Image, or Stream.&lt;/param&gt;</span></div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;<span class="comment"></span><span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;Resizing and processing command to apply to the.&lt;/param&gt;</span></div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;<span class="comment"></span>        [Obsolete(<span class="stringliteral">&quot;Use ImageJob with dest=typeof(Bitmap) instead - but only as a last resort. This method returns an umanaged, un-garbage collected object that can kill your server. Use Build(source,dest, instructions) instead of handing the Bitmap instance yourself.&quot;</span>)]</div>
<div class="line"><a name="l00319"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a12f49b48e9244ee7f6e86fd60fffcc83">  319</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">virtual</span> Bitmap <a class="code" href="class_image_resizer_1_1_image_builder.html#a12f49b48e9244ee7f6e86fd60fffcc83">Build</a>(<span class="keywordtype">object</span> source, <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> settings) {</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            <span class="keywordflow">return</span> Build(source, settings, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;        }<span class="comment"></span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;<span class="comment">        /// Resizes and processes the specified source image and returns a bitmap of the result.</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;<span class="comment">        /// Note! </span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;<span class="comment">        /// This method assumes that transparency will be supported in the final output format, and therefore does not apply a matte color. Use &amp;amp;bgcolor to specify a background color</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;<span class="comment">        /// if you use this method with a non-transparent format such as Jpeg.</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;<span class="comment">        /// </span></div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;<span class="comment">        /// If passed a source Stream, Bitmap, or Image instance, it will not be disposed unless disposeSource=true.</span></div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;<span class="comment">        /// &lt;param name=&quot;source&quot;&gt;May be an instance of string (a physical path), VirtualFile, IVirtualBitmapFile, HttpPostedFile, Bitmap, Image, or Stream.&lt;/param&gt;</span></div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;<span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;Resizing and processing command to apply to the.&lt;/param&gt;</span></div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;<span class="comment">        /// &lt;param name=&quot;disposeSource&quot;&gt;If false, &#39;source&#39; will not be disposed. &lt;/param&gt;</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;<span class="comment"></span>        [Obsolete(<span class="stringliteral">&quot;Use ImageJob with dest=typeof(Bitmap) instead - but only as a last resort. This method returns an umanaged, un-garbage collected object that can kill your server. Use Build(source,dest) instead of handing the Bitmap instance yourself.&quot;</span>)]</div>
<div class="line"><a name="l00334"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#ab6583432ca82dfa02d357000d252c45d">  334</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">virtual</span> Bitmap <a class="code" href="class_image_resizer_1_1_image_builder.html#ab6583432ca82dfa02d357000d252c45d">Build</a>(<span class="keywordtype">object</span> source, <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> settings, <span class="keywordtype">bool</span> disposeSource) {</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            <a class="code" href="class_image_resizer_1_1_image_job.html">ImageJob</a> j = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_job.html">ImageJob</a>(source, typeof(Bitmap), settings, disposeSource, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            Build(j);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            <span class="keywordflow">return</span> j.Result as Bitmap;</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;        }</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;<span class="comment">        /// Resizes and processes the specified source image and stores the encoded result in the specified destination.</span></div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;<span class="comment">        /// If passed a source Stream, Bitmap, or Image instance, it will be disposed after use. Use disposeSource=False to disable that behavior. </span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;<span class="comment">        /// &lt;param name=&quot;source&quot;&gt;May be an instance of string (a physical path or app-relative virtual path), VirtualFile, IVirtualBitmapFile, HttpPostedFile, Bitmap, Image, or Stream. App-relative virtual paths will use the VirtualPathProvider system&lt;/param&gt;</span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;<span class="comment">        /// &lt;param name=&quot;dest&quot;&gt;May be a physical path (string), or a Stream instance. Does not have to be seekable.&lt;/param&gt;</span></div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;<span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;Resizing and processing command to apply to the image.&lt;/param&gt;</span></div>
<div class="line"><a name="l00347"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a23d0a1c7686627fc160d5f0173f14cf5">  347</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_image_resizer_1_1_image_builder.html#a23d0a1c7686627fc160d5f0173f14cf5">Build</a>(<span class="keywordtype">object</span> source, <span class="keywordtype">object</span> dest, <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> settings) {</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            Build(source, dest, settings, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;        }</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;<span class="comment">        /// Resizes and processes the specified source image and stores the encoded result in the specified destination.</span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;<span class="comment">        /// If passed a source Stream, Bitmap, or Image instance, it will be disposed after use. Use disposeSource=False to disable that behavior. </span></div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;<span class="comment">        /// &lt;param name=&quot;source&quot;&gt;May be an instance of string (a physical path or app-relative virtual path), VirtualFile, IVirtualBitmapFile, HttpPostedFile, Bitmap, Image, or Stream. App-relative virtual paths will use the VirtualPathProvider system&lt;/param&gt;</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;<span class="comment">        /// &lt;param name=&quot;dest&quot;&gt;May be a physical path (string), or a Stream instance. Does not have to be seekable.&lt;/param&gt;</span></div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;<span class="comment">        /// &lt;param name=&quot;instructions&quot;&gt;Resizing and processing command to apply to the image.&lt;/param&gt;</span></div>
<div class="line"><a name="l00358"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#adb8515a05af3dd9bc790f032d065aaca">  358</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="class_image_resizer_1_1_image_job.html">ImageJob</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#adb8515a05af3dd9bc790f032d065aaca">Build</a>(<span class="keywordtype">object</span> source, <span class="keywordtype">object</span> dest, <a class="code" href="class_image_resizer_1_1_instructions.html">Instructions</a> instructions)</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;        {</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            var j = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_job.html">ImageJob</a>(source, dest, instructions, <span class="keyword">true</span>, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            Build(j);</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            <span class="keywordflow">return</span> j;</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;        }</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;<span class="comment">        /// Resizes and processes the specified source image and stores the encoded result in the specified destination. </span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;<span class="comment">        /// If passed a source Stream, Bitmap, or Image instance, it will not be disposed unless disposeSource=true.</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;<span class="comment">        /// &lt;param name=&quot;source&quot;&gt;May be an instance of string (a physical path or app-relative virtual path), VirtualFile, IVirtualBitmapFile, HttpPostedFile, Bitmap, Image, or Stream. App-relative virtual paths will use the VirtualPathProvider system&lt;/param&gt;</span></div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;<span class="comment">        /// &lt;param name=&quot;dest&quot;&gt;May be a physical path (string), or a Stream instance. Does not have to be seekable.&lt;/param&gt;</span></div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;<span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;Resizing and processing command to apply to the image.&lt;/param&gt;</span></div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;<span class="comment">        /// &lt;param name=&quot;disposeSource&quot;&gt;True to dispose &#39;source&#39; after use. False to leave intact.&lt;/param&gt;</span></div>
<div class="line"><a name="l00373"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a1528f6e7863248a4dd0d2d3c2d140261">  373</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_image_resizer_1_1_image_builder.html#a1528f6e7863248a4dd0d2d3c2d140261">Build</a>(<span class="keywordtype">object</span> source, <span class="keywordtype">object</span> dest, <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> settings, <span class="keywordtype">bool</span> disposeSource) {</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            Build(source, dest, settings, disposeSource, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;        }</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;   </div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;<span class="comment">        /// Resizes and processes the specified source image and stores the encoded result in the specified destination. </span></div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;<span class="comment">        /// If passed a source Stream, Bitmap, or Image instance, it will not be disposed unless disposeSource=true.</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;<span class="comment">        /// If passed a path destination, the physical path of the written file will be returned.</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;<span class="comment">        /// &lt;param name=&quot;source&quot;&gt;May be an instance of string (a physical path or app-relative virtual path), VirtualFile, IVirtualBitmapFile, HttpPostedFile, Bitmap, Image, or Stream. App-relative virtual paths will use the VirtualPathProvider system&lt;/param&gt;</span></div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;<span class="comment">        /// &lt;param name=&quot;dest&quot;&gt;May be a physical path (string), or a Stream instance. Does not have to be seekable.&lt;/param&gt;</span></div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;<span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;Resizing and processing command to apply to the image.&lt;/param&gt;</span></div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;<span class="comment">        /// &lt;param name=&quot;disposeSource&quot;&gt;True to dispose &#39;source&#39; after use. False to leave intact.&lt;/param&gt;</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;<span class="comment">        /// &lt;param name=&quot;addFileExtension&quot;&gt;If true, will add the correct file extension to &#39;dest&#39; if it is a string. &lt;/param&gt;</span></div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;<span class="comment"></span>        [Obsolete(<span class="stringliteral">&quot;Use .Build(new ImageJob(source, dest, settings, disposeSource, addFileExtension)).FinalPath  instead&quot;</span>)]</div>
<div class="line"><a name="l00390"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a87954c4d5579b7b2d45bec6ca1eb5aab">  390</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keywordtype">string</span> <a class="code" href="class_image_resizer_1_1_image_builder.html#a87954c4d5579b7b2d45bec6ca1eb5aab">Build</a>(<span class="keywordtype">object</span> source, <span class="keywordtype">object</span> dest, <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> settings, <span class="keywordtype">bool</span> disposeSource, <span class="keywordtype">bool</span> addFileExtension) {</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;            <span class="keywordflow">return</span> Build(<span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_job.html">ImageJob</a>(source, dest, settings, disposeSource, addFileExtension)).FinalPath;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;        }</div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;<span class="preprocessor">        #endregion</span></div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;<span class="preprocessor"></span><span class="comment"></span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;<span class="comment">        /// The most flexible method for processing an image</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;<span class="comment">        /// &lt;param name=&quot;job&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;<span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span></div>
<div class="line"><a name="l00400"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a521141a412897869bff44e38e375f85a">  400</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <a class="code" href="class_image_resizer_1_1_image_job.html">ImageJob</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a521141a412897869bff44e38e375f85a">Build</a>(<a class="code" href="class_image_resizer_1_1_image_job.html">ImageJob</a> job) {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;            <span class="keywordflow">if</span> (job == null) <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentNullException(<span class="stringliteral">&quot;job&quot;</span>, <span class="stringliteral">&quot;ImageJob parameter null. Cannot Build a null ImageJob instance&quot;</span>);</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;            <span class="comment">//Clone and filter settings FIRST, before calling plugins.</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> s = job.Settings == null ? <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a>() : <span class="keyword">new</span> ResizeSettings(job.<a class="code" href="class_image_resizer_1_1_image_job.html#ab835a4dde8a2962bbe48182641316cee">Settings</a>);</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            <span class="keywordflow">if</span> (SettingsModifier != null) s = SettingsModifier.Modify(s);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            job.Settings = s;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;            <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                <span class="comment">//Allow everything else to be overriden</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                <span class="keywordflow">if</span> (BuildJob(job) != RequestedAction.Cancel) <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_processing_exception.html">ImageProcessingException</a>(<span class="stringliteral">&quot;Nobody did the job&quot;</span>);</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                <span class="keywordflow">return</span> job;</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;            } <span class="keywordflow">finally</span> {</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                <span class="comment">//Follow the dispose requests</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                <span class="keywordflow">if</span> (job.<a class="code" href="class_image_resizer_1_1_image_job.html#a5dd32c6152d10115383001b9ff37f640">DisposeSourceObject</a> &amp;&amp; job.<a class="code" href="class_image_resizer_1_1_image_job.html#a0d47d299ecd8a7316ba4a56d28e246b2">Source</a> is IDisposable &amp;&amp; job.<a class="code" href="class_image_resizer_1_1_image_job.html#a0d47d299ecd8a7316ba4a56d28e246b2">Source</a> != null) ((IDisposable)job.<a class="code" href="class_image_resizer_1_1_image_job.html#a0d47d299ecd8a7316ba4a56d28e246b2">Source</a>).Dispose();</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                <span class="keywordflow">if</span> (job.<a class="code" href="class_image_resizer_1_1_image_job.html#a29f911ea9f9ede401094e90c950fe1ff">DisposeDestinationStream</a> &amp;&amp; job.<a class="code" href="class_image_resizer_1_1_image_job.html#a04c90612666b1834d038ae9a4bac67b5">Dest</a> is IDisposable &amp;&amp; job.<a class="code" href="class_image_resizer_1_1_image_job.html#a04c90612666b1834d038ae9a4bac67b5">Dest</a> != null) ((IDisposable)job.<a class="code" href="class_image_resizer_1_1_image_job.html#a04c90612666b1834d038ae9a4bac67b5">Dest</a>).Dispose();</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            }</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;        }</div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;</div>
<div class="line"><a name="l00421"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#ab1824012ca6ccf41e119ef03a60b12cc">  421</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#ab1824012ca6ccf41e119ef03a60b12cc">BuildJob</a>(<a class="code" href="class_image_resizer_1_1_image_job.html">ImageJob</a> job) {</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            <span class="keywordflow">if</span> (base.BuildJob(job) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            Bitmap b = null;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> s = job.<a class="code" href="class_image_resizer_1_1_image_job.html#ab835a4dde8a2962bbe48182641316cee">Settings</a>;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                <span class="comment">//Load image</span></div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;                b = LoadImage(job.<a class="code" href="class_image_resizer_1_1_image_job.html#a0d47d299ecd8a7316ba4a56d28e246b2">Source</a>, s, job.<a class="code" href="class_image_resizer_1_1_image_job.html#aa6cb13a20ee55698d62de78f6d749d07">ResetSourceStream</a>);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                <span class="comment">//Save source path info</span></div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;                job.SourcePathData = (b != null &amp;&amp; b.Tag != null &amp;&amp; b.Tag is <a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a>) ? ((<a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a>)b.Tag).Path : null;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;                job.ResultInfo[<span class="stringliteral">&quot;source.width&quot;</span>] = b.Width;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                job.ResultInfo[<span class="stringliteral">&quot;source.height&quot;</span>] = b.Height;</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;                <span class="comment">//Calucalte the appropriate file extension and mime type</span></div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                <span class="keywordflow">if</span> (job.<a class="code" href="class_image_resizer_1_1_image_job.html#a04c90612666b1834d038ae9a4bac67b5">Dest</a> != typeof(Bitmap)){</div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                    <a class="code" href="interface_image_resizer_1_1_encoding_1_1_i_encoder.html">IEncoder</a> e = this.EncoderProvider.GetEncoder(s, b);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                    <span class="keywordflow">if</span> (e != null)</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;                    {</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;                        job.ResultInfo[<span class="stringliteral">&quot;result.ext&quot;</span>] = e.Extension;</div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;                        job.ResultInfo[<span class="stringliteral">&quot;result.mime&quot;</span>] = e.MimeType;</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                    }</div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                }</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;                <span class="keywordflow">if</span> (job.<a class="code" href="class_image_resizer_1_1_image_job.html#a04c90612666b1834d038ae9a4bac67b5">Dest</a> == typeof(IDictionary&lt;string, object&gt;))</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;                {<span class="comment"></span></div>
<div class="line"><a name="l00449"></a><span class="lineno">  449</span>&#160;<span class="comment">                    ///They only want information/attributes</span></div>
<div class="line"><a name="l00450"></a><span class="lineno">  450</span>&#160;<span class="comment"></span>                    job.Result = job.ResultInfo;</div>
<div class="line"><a name="l00451"></a><span class="lineno">  451</span>&#160;                    <span class="keywordflow">return</span> RequestedAction.Cancel;</div>
<div class="line"><a name="l00452"></a><span class="lineno">  452</span>&#160;                }</div>
<div class="line"><a name="l00453"></a><span class="lineno">  453</span>&#160;</div>
<div class="line"><a name="l00454"></a><span class="lineno">  454</span>&#160;                <span class="comment">//Fire PreAcquireStream(ref dest, settings) to modify &#39;dest&#39;</span></div>
<div class="line"><a name="l00455"></a><span class="lineno">  455</span>&#160;                <span class="keywordtype">object</span> dest = job.Dest;</div>
<div class="line"><a name="l00456"></a><span class="lineno">  456</span>&#160;                this.PreAcquireStream(ref dest, s);</div>
<div class="line"><a name="l00457"></a><span class="lineno">  457</span>&#160;                job.Dest = dest;</div>
<div class="line"><a name="l00458"></a><span class="lineno">  458</span>&#160;                </div>
<div class="line"><a name="l00459"></a><span class="lineno">  459</span>&#160;                <span class="keywordflow">if</span> (dest == typeof(Bitmap)) {</div>
<div class="line"><a name="l00460"></a><span class="lineno">  460</span>&#160;                    job.Result = buildToBitmap(b, s, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00461"></a><span class="lineno">  461</span>&#160;                    </div>
<div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;                    <span class="comment">//Write to Physical file</span></div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dest is <span class="keywordtype">string</span>) {</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;                    <span class="comment">//Make physical and resolve variable references all at the same time.</span></div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;                    job.FinalPath = job.ResolveTemplatedPath(dest as string,</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;                        delegate(<span class="keywordtype">string</span> var) {</div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;                            <span class="keywordflow">if</span> (<span class="stringliteral">&quot;ext&quot;</span>.Equals(var, StringComparison.OrdinalIgnoreCase)) {</div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;                                <span class="keywordflow">return</span> job.ResultFileExtension;</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;                            }</div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;                            <span class="keywordflow">if</span> (<span class="stringliteral">&quot;width&quot;</span>.Equals(var, StringComparison.OrdinalIgnoreCase))</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;                                <span class="keywordflow">return</span> GetFinalSize(<span class="keyword">new</span> System.Drawing.Size(b.Width, b.Height), <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a>(job.<a class="code" href="class_image_resizer_1_1_image_job.html#ab835a4dde8a2962bbe48182641316cee">Settings</a>)).Width.ToString(NumberFormatInfo.InvariantInfo);</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;                            <span class="keywordflow">if</span> (<span class="stringliteral">&quot;height&quot;</span>.Equals(var, StringComparison.OrdinalIgnoreCase))</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;                                <span class="keywordflow">return</span> GetFinalSize(<span class="keyword">new</span> System.Drawing.Size(b.Width, b.Height), <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a>(job.<a class="code" href="class_image_resizer_1_1_image_job.html#ab835a4dde8a2962bbe48182641316cee">Settings</a>)).Height.ToString(NumberFormatInfo.InvariantInfo);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;                            <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;                        });</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;                    <span class="comment">//If requested, auto-create the parent directory(ies)</span></div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;                    <span class="keywordflow">if</span> (job.<a class="code" href="class_image_resizer_1_1_image_job.html#aa364f02160b72d8fb1b0df47d65e59b5">CreateParentDirectory</a>) {</div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;                        <span class="keywordtype">string</span> dirName = Path.GetDirectoryName(job.FinalPath);</div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;                        <span class="keywordflow">if</span> (!Directory.Exists(dirName)) Directory.CreateDirectory(dirName);</div>
<div class="line"><a name="l00480"></a><span class="lineno">  480</span>&#160;                    }</div>
<div class="line"><a name="l00481"></a><span class="lineno">  481</span>&#160;                    System.IO.FileStream fs = <span class="keyword">new</span> FileStream(job.<a class="code" href="class_image_resizer_1_1_image_job.html#a4ffc5aa55609b62ecbda6b35ba019745">FinalPath</a>, FileMode.Create, FileAccess.Write);</div>
<div class="line"><a name="l00482"></a><span class="lineno">  482</span>&#160;                    <span class="keyword">using</span> (fs) {</div>
<div class="line"><a name="l00483"></a><span class="lineno">  483</span>&#160;                        buildToStream(b, fs, s);</div>
<div class="line"><a name="l00484"></a><span class="lineno">  484</span>&#160;                        fs.Flush();<span class="comment">//TODO: Switch to .Flush(true) with .NET 4</span></div>
<div class="line"><a name="l00485"></a><span class="lineno">  485</span>&#160;                    }</div>
<div class="line"><a name="l00486"></a><span class="lineno">  486</span>&#160;                    <span class="comment">//Write to Unknown stream</span></div>
<div class="line"><a name="l00487"></a><span class="lineno">  487</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dest is Stream) {</div>
<div class="line"><a name="l00488"></a><span class="lineno">  488</span>&#160;                    buildToStream(b, (Stream)dest, s);</div>
<div class="line"><a name="l00489"></a><span class="lineno">  489</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;Destination may be a string or Stream.&quot;</span>, <span class="stringliteral">&quot;Dest&quot;</span>);</div>
<div class="line"><a name="l00490"></a><span class="lineno">  490</span>&#160;</div>
<div class="line"><a name="l00491"></a><span class="lineno">  491</span>&#160;            } <span class="keywordflow">finally</span> {</div>
<div class="line"><a name="l00492"></a><span class="lineno">  492</span>&#160;                <span class="comment">//Get the source bitmap&#39;s underlying stream (may differ from &#39;source&#39;)</span></div>
<div class="line"><a name="l00493"></a><span class="lineno">  493</span>&#160;                Stream underlyingStream = null;</div>
<div class="line"><a name="l00494"></a><span class="lineno">  494</span>&#160;                <span class="keywordflow">if</span> (b != null &amp;&amp; b.Tag != null &amp;&amp; b.Tag is <a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a>) underlyingStream = ((BitmapTag)b.Tag).Source;</div>
<div class="line"><a name="l00495"></a><span class="lineno">  495</span>&#160;</div>
<div class="line"><a name="l00496"></a><span class="lineno">  496</span>&#160;                <span class="comment">//Close the source bitamp&#39;s underlying stream unless it is the same stream (EDIT: or bitmap) we were passed.</span></div>
<div class="line"><a name="l00497"></a><span class="lineno">  497</span>&#160;                var closeUnderlyingStream = (b != job.Source &amp;&amp; underlyingStream != job.Source &amp;&amp; underlyingStream != null);</div>
<div class="line"><a name="l00498"></a><span class="lineno">  498</span>&#160;</div>
<div class="line"><a name="l00499"></a><span class="lineno">  499</span>&#160;                <span class="comment">//Dispose the bitmap unless we were passed it. We check for &#39;null&#39; in case an ImageCorruptedException occured. </span></div>
<div class="line"><a name="l00500"></a><span class="lineno">  500</span>&#160;                <span class="keywordflow">if</span> (b != null &amp;&amp; b != job.Source) b.Dispose();</div>
<div class="line"><a name="l00501"></a><span class="lineno">  501</span>&#160;</div>
<div class="line"><a name="l00502"></a><span class="lineno">  502</span>&#160;                <span class="comment">//Dispose the underlying stream after disposing the bitmap</span></div>
<div class="line"><a name="l00503"></a><span class="lineno">  503</span>&#160;                <span class="keywordflow">if</span> (closeUnderlyingStream) underlyingStream.Dispose();</div>
<div class="line"><a name="l00504"></a><span class="lineno">  504</span>&#160;            }</div>
<div class="line"><a name="l00505"></a><span class="lineno">  505</span>&#160;</div>
<div class="line"><a name="l00506"></a><span class="lineno">  506</span>&#160;            <span class="keywordflow">return</span> RequestedAction.Cancel;</div>
<div class="line"><a name="l00507"></a><span class="lineno">  507</span>&#160;        }</div>
<div class="line"><a name="l00508"></a><span class="lineno">  508</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00509"></a><span class="lineno">  509</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00510"></a><span class="lineno">  510</span>&#160;<span class="comment">        /// Override this when you need to override the behavior of image encoding and/or Bitmap processing</span></div>
<div class="line"><a name="l00511"></a><span class="lineno">  511</span>&#160;<span class="comment">        /// Not for external use. Does NOT dispose of &#39;source&#39; or &#39;source&#39;s underlying stream.</span></div>
<div class="line"><a name="l00512"></a><span class="lineno">  512</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00513"></a><span class="lineno">  513</span>&#160;<span class="comment">        /// &lt;param name=&quot;source&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;<span class="comment">        /// &lt;param name=&quot;dest&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;<span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00516"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a078dae9f4dba27048dfd41862ce9960b">  516</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a078dae9f4dba27048dfd41862ce9960b">buildToStream</a>(Bitmap source, Stream dest, <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> settings) {</div>
<div class="line"><a name="l00517"></a><span class="lineno">  517</span>&#160;            <span class="keywordflow">if</span> (base.buildToStream(source, dest, settings) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.None;</div>
<div class="line"><a name="l00518"></a><span class="lineno">  518</span>&#160;</div>
<div class="line"><a name="l00519"></a><span class="lineno">  519</span>&#160;            <a class="code" href="interface_image_resizer_1_1_encoding_1_1_i_encoder.html">IEncoder</a> e = <span class="keyword">this</span>.EncoderProvider.GetEncoder(settings,source);</div>
<div class="line"><a name="l00520"></a><span class="lineno">  520</span>&#160;            <span class="keywordflow">if</span> (e == null) <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_processing_exception.html">ImageProcessingException</a>(<span class="stringliteral">&quot;No image encoder was found for this request.&quot;</span>);</div>
<div class="line"><a name="l00521"></a><span class="lineno">  521</span>&#160;            <span class="keyword">using</span> (Bitmap b = buildToBitmap(source, settings,e.SupportsTransparency)) {<span class="comment">//Determines output format, includes code for saving in a variety of formats.</span></div>
<div class="line"><a name="l00522"></a><span class="lineno">  522</span>&#160;                <span class="comment">//Save to stream</span></div>
<div class="line"><a name="l00523"></a><span class="lineno">  523</span>&#160;                e.Write(b, dest);</div>
<div class="line"><a name="l00524"></a><span class="lineno">  524</span>&#160;            }</div>
<div class="line"><a name="l00525"></a><span class="lineno">  525</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00526"></a><span class="lineno">  526</span>&#160;        }</div>
<div class="line"><a name="l00527"></a><span class="lineno">  527</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00528"></a><span class="lineno">  528</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00529"></a><span class="lineno">  529</span>&#160;<span class="comment">        /// Override this when you need to override the behavior of Bitmap processing. </span></div>
<div class="line"><a name="l00530"></a><span class="lineno">  530</span>&#160;<span class="comment">        /// Not for external use. Does NOT dispose of &#39;source&#39; or &#39;source&#39;s underlying stream.</span></div>
<div class="line"><a name="l00531"></a><span class="lineno">  531</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00532"></a><span class="lineno">  532</span>&#160;<span class="comment">        /// &lt;param name=&quot;source&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00533"></a><span class="lineno">  533</span>&#160;<span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00534"></a><span class="lineno">  534</span>&#160;<span class="comment">        /// &lt;param name=&quot;transparencySupported&quot;&gt;True if the output method will support transparency. If false, the image should be provided a matte color&lt;/param&gt;</span></div>
<div class="line"><a name="l00535"></a><span class="lineno">  535</span>&#160;<span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span></div>
<div class="line"><a name="l00536"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a097e510478c85eb23fd6ac0db3cd3078">  536</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> Bitmap <a class="code" href="class_image_resizer_1_1_image_builder.html#a097e510478c85eb23fd6ac0db3cd3078">buildToBitmap</a>(Bitmap source, <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> settings, <span class="keywordtype">bool</span> transparencySupported) {</div>
<div class="line"><a name="l00537"></a><span class="lineno">  537</span>&#160;            Bitmap b = base.buildToBitmap(source,settings,transparencySupported);</div>
<div class="line"><a name="l00538"></a><span class="lineno">  538</span>&#160;            <span class="keywordflow">if</span> (b != null) <span class="keywordflow">return</span> b; <span class="comment">//Allow extensions to replace the method wholesale.</span></div>
<div class="line"><a name="l00539"></a><span class="lineno">  539</span>&#160;</div>
<div class="line"><a name="l00540"></a><span class="lineno">  540</span>&#160;            <span class="keyword">using</span> (<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> state = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a>(settings, source.Size, transparencySupported)) {</div>
<div class="line"><a name="l00541"></a><span class="lineno">  541</span>&#160;                state.sourceBitmap = source;</div>
<div class="line"><a name="l00542"></a><span class="lineno">  542</span>&#160;</div>
<div class="line"><a name="l00543"></a><span class="lineno">  543</span>&#160;                <span class="comment">//Generic processing of ImageState instances.</span></div>
<div class="line"><a name="l00544"></a><span class="lineno">  544</span>&#160;                Process(state);</div>
<div class="line"><a name="l00545"></a><span class="lineno">  545</span>&#160;</div>
<div class="line"><a name="l00546"></a><span class="lineno">  546</span>&#160;                <span class="comment">//Save a reference to return</span></div>
<div class="line"><a name="l00547"></a><span class="lineno">  547</span>&#160;                b = state.destBitmap;</div>
<div class="line"><a name="l00548"></a><span class="lineno">  548</span>&#160;                state.destBitmap = null; <span class="comment">//So it doesn&#39;t get disposed yet</span></div>
<div class="line"><a name="l00549"></a><span class="lineno">  549</span>&#160;</div>
<div class="line"><a name="l00550"></a><span class="lineno">  550</span>&#160;                <span class="comment">//Don&#39;t dispose the source bitmap either, just the graphics object.</span></div>
<div class="line"><a name="l00551"></a><span class="lineno">  551</span>&#160;                state.sourceBitmap = null;</div>
<div class="line"><a name="l00552"></a><span class="lineno">  552</span>&#160;            }</div>
<div class="line"><a name="l00553"></a><span class="lineno">  553</span>&#160;            <span class="keywordflow">return</span> b;</div>
<div class="line"><a name="l00554"></a><span class="lineno">  554</span>&#160;        }</div>
<div class="line"><a name="l00555"></a><span class="lineno">  555</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00556"></a><span class="lineno">  556</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00557"></a><span class="lineno">  557</span>&#160;<span class="comment">        /// Processes an ImageState instance. Used by Build, GetFinalSize, and TranslatePoint. </span></div>
<div class="line"><a name="l00558"></a><span class="lineno">  558</span>&#160;<span class="comment">        /// Can be overriden by a plugin with the OnProcess method</span></div>
<div class="line"><a name="l00559"></a><span class="lineno">  559</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00560"></a><span class="lineno">  560</span>&#160;<span class="comment">        /// &lt;param name=&quot;s&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00561"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a8e2f4b3bbf8bb38e54249490122ebb71">  561</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_image_resizer_1_1_image_builder.html#a8e2f4b3bbf8bb38e54249490122ebb71">Process</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s){</div>
<div class="line"><a name="l00562"></a><span class="lineno">  562</span>&#160;            <span class="keywordflow">if</span> (OnProcess(s) == <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00563"></a><span class="lineno">  563</span>&#160;            PrepareSourceBitmap(s);  <span class="comment">// We select the page/frame and flip the source bitmap here</span></div>
<div class="line"><a name="l00564"></a><span class="lineno">  564</span>&#160;            PostPrepareSourceBitmap(s);</div>
<div class="line"><a name="l00565"></a><span class="lineno">  565</span>&#160;            Layout(s); <span class="comment">//Layout everything</span></div>
<div class="line"><a name="l00566"></a><span class="lineno">  566</span>&#160;            PrepareDestinationBitmap(s); <span class="comment">//Create a bitmap and graphics object based on s.destSize</span></div>
<div class="line"><a name="l00567"></a><span class="lineno">  567</span>&#160;            Render(s); <span class="comment">//Render using the graphics object</span></div>
<div class="line"><a name="l00568"></a><span class="lineno">  568</span>&#160;            ProcessFinalBitmap(s); <span class="comment">//Perform the final flipping of the bitmap.</span></div>
<div class="line"><a name="l00569"></a><span class="lineno">  569</span>&#160;            EndProcess(s);</div>
<div class="line"><a name="l00570"></a><span class="lineno">  570</span>&#160;        }<span class="comment"></span></div>
<div class="line"><a name="l00571"></a><span class="lineno">  571</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00572"></a><span class="lineno">  572</span>&#160;<span class="comment">        /// Process.3: Handles the layout phase of Processing</span></div>
<div class="line"><a name="l00573"></a><span class="lineno">  573</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00574"></a><span class="lineno">  574</span>&#160;<span class="comment">        /// &lt;param name=&quot;s&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00575"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#ab0e7f7482b1ed782c4c522ca02d004f7">  575</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#ab0e7f7482b1ed782c4c522ca02d004f7">Layout</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s) {</div>
<div class="line"><a name="l00576"></a><span class="lineno">  576</span>&#160;            <span class="keywordflow">if</span> (base.Layout(s) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel;</div>
<div class="line"><a name="l00577"></a><span class="lineno">  577</span>&#160;            FlipExistingPoints(s); <span class="comment">//Not implemented</span></div>
<div class="line"><a name="l00578"></a><span class="lineno">  578</span>&#160;            LayoutImage(s);</div>
<div class="line"><a name="l00579"></a><span class="lineno">  579</span>&#160;            PostLayoutImage(s);</div>
<div class="line"><a name="l00580"></a><span class="lineno">  580</span>&#160;            LayoutPadding(s);</div>
<div class="line"><a name="l00581"></a><span class="lineno">  581</span>&#160;            PostLayoutPadding(s);</div>
<div class="line"><a name="l00582"></a><span class="lineno">  582</span>&#160;            LayoutBorder(s);</div>
<div class="line"><a name="l00583"></a><span class="lineno">  583</span>&#160;            PostLayoutBorder(s);</div>
<div class="line"><a name="l00584"></a><span class="lineno">  584</span>&#160;            LayoutEffects(s);</div>
<div class="line"><a name="l00585"></a><span class="lineno">  585</span>&#160;            PostLayoutEffects(s);</div>
<div class="line"><a name="l00586"></a><span class="lineno">  586</span>&#160;            LayoutMargin(s);</div>
<div class="line"><a name="l00587"></a><span class="lineno">  587</span>&#160;            PostLayoutMargin(s);</div>
<div class="line"><a name="l00588"></a><span class="lineno">  588</span>&#160;            LayoutRotate(s);</div>
<div class="line"><a name="l00589"></a><span class="lineno">  589</span>&#160;            PostLayoutRotate(s);</div>
<div class="line"><a name="l00590"></a><span class="lineno">  590</span>&#160;            LayoutNormalize(s);</div>
<div class="line"><a name="l00591"></a><span class="lineno">  591</span>&#160;            PostLayoutNormalize(s);</div>
<div class="line"><a name="l00592"></a><span class="lineno">  592</span>&#160;            LayoutRound(s);</div>
<div class="line"><a name="l00593"></a><span class="lineno">  593</span>&#160;            PostLayoutRound(s);</div>
<div class="line"><a name="l00594"></a><span class="lineno">  594</span>&#160;            EndLayout(s);</div>
<div class="line"><a name="l00595"></a><span class="lineno">  595</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00596"></a><span class="lineno">  596</span>&#160;        }<span class="comment"></span></div>
<div class="line"><a name="l00597"></a><span class="lineno">  597</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00598"></a><span class="lineno">  598</span>&#160;<span class="comment">        /// Handles the rendering phase of processing</span></div>
<div class="line"><a name="l00599"></a><span class="lineno">  599</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00600"></a><span class="lineno">  600</span>&#160;<span class="comment">        /// &lt;param name=&quot;s&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00601"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#ad3c0e9b89c62b5a6896b062d30db2641">  601</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#ad3c0e9b89c62b5a6896b062d30db2641">Render</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s) {</div>
<div class="line"><a name="l00602"></a><span class="lineno">  602</span>&#160;            <span class="keywordflow">if</span> (base.Render(s) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel;</div>
<div class="line"><a name="l00603"></a><span class="lineno">  603</span>&#160;            RenderBackground(s);</div>
<div class="line"><a name="l00604"></a><span class="lineno">  604</span>&#160;            PostRenderBackground(s);</div>
<div class="line"><a name="l00605"></a><span class="lineno">  605</span>&#160;            RenderEffects(s);</div>
<div class="line"><a name="l00606"></a><span class="lineno">  606</span>&#160;            PostRenderEffects(s);</div>
<div class="line"><a name="l00607"></a><span class="lineno">  607</span>&#160;            RenderPadding(s);</div>
<div class="line"><a name="l00608"></a><span class="lineno">  608</span>&#160;            PostRenderPadding(s);</div>
<div class="line"><a name="l00609"></a><span class="lineno">  609</span>&#160;            CreateImageAttribues(s);</div>
<div class="line"><a name="l00610"></a><span class="lineno">  610</span>&#160;            PostCreateImageAttributes(s);</div>
<div class="line"><a name="l00611"></a><span class="lineno">  611</span>&#160;            PreRenderImage(s);</div>
<div class="line"><a name="l00612"></a><span class="lineno">  612</span>&#160;            RenderImage(s);</div>
<div class="line"><a name="l00613"></a><span class="lineno">  613</span>&#160;            PostRenderImage(s);</div>
<div class="line"><a name="l00614"></a><span class="lineno">  614</span>&#160;            RenderBorder(s);</div>
<div class="line"><a name="l00615"></a><span class="lineno">  615</span>&#160;            PostRenderBorder(s);</div>
<div class="line"><a name="l00616"></a><span class="lineno">  616</span>&#160;            PreRenderOverlays(s);</div>
<div class="line"><a name="l00617"></a><span class="lineno">  617</span>&#160;            RenderOverlays(s);</div>
<div class="line"><a name="l00618"></a><span class="lineno">  618</span>&#160;            PreFlushChanges(s);</div>
<div class="line"><a name="l00619"></a><span class="lineno">  619</span>&#160;            FlushChanges(s);</div>
<div class="line"><a name="l00620"></a><span class="lineno">  620</span>&#160;            PostFlushChanges(s);</div>
<div class="line"><a name="l00621"></a><span class="lineno">  621</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00622"></a><span class="lineno">  622</span>&#160;        }</div>
<div class="line"><a name="l00623"></a><span class="lineno">  623</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00624"></a><span class="lineno">  624</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00625"></a><span class="lineno">  625</span>&#160;<span class="comment">        /// Process.1 Switches the bitmap to the correct frame or page, and applies source flipping commands</span></div>
<div class="line"><a name="l00626"></a><span class="lineno">  626</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00627"></a><span class="lineno">  627</span>&#160;<span class="comment">        /// &lt;param name=&quot;s&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00628"></a><span class="lineno">  628</span>&#160;<span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span></div>
<div class="line"><a name="l00629"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a34af5ed805a72bb5477e25591d3b8110">  629</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a34af5ed805a72bb5477e25591d3b8110">PrepareSourceBitmap</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s)</div>
<div class="line"><a name="l00630"></a><span class="lineno">  630</span>&#160;        {</div>
<div class="line"><a name="l00631"></a><span class="lineno">  631</span>&#160;            <span class="keywordflow">if</span> (base.PrepareSourceBitmap(s) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel ; <span class="comment">//Call extensions</span></div>
<div class="line"><a name="l00632"></a><span class="lineno">  632</span>&#160;</div>
<div class="line"><a name="l00633"></a><span class="lineno">  633</span>&#160;            if (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0">sourceBitmap</a> == null) <span class="keywordflow">return</span> RequestedAction.None ; <span class="comment">//Nothing to do if there is no bitmap</span></div>
<div class="line"><a name="l00634"></a><span class="lineno">  634</span>&#160;</div>
<div class="line"><a name="l00635"></a><span class="lineno">  635</span>&#160;            Bitmap src = s.sourceBitmap;</div>
<div class="line"><a name="l00636"></a><span class="lineno">  636</span>&#160;            <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> q = s.settings;</div>
<div class="line"><a name="l00637"></a><span class="lineno">  637</span>&#160;</div>
<div class="line"><a name="l00638"></a><span class="lineno">  638</span>&#160;            <span class="keywordtype">int</span> page = 0;</div>
<div class="line"><a name="l00639"></a><span class="lineno">  639</span>&#160;            <span class="keywordflow">if</span> (!<span class="keywordtype">string</span>.IsNullOrEmpty(q[<span class="stringliteral">&quot;page&quot;</span>]) &amp;&amp; !int.TryParse(q[<span class="stringliteral">&quot;page&quot;</span>], NumberStyles.Integer, NumberFormatInfo.InvariantInfo, out page))</div>
<div class="line"><a name="l00640"></a><span class="lineno">  640</span>&#160;                page = 0;</div>
<div class="line"><a name="l00641"></a><span class="lineno">  641</span>&#160;</div>
<div class="line"><a name="l00642"></a><span class="lineno">  642</span>&#160;            <span class="keywordtype">int</span> frame = 0;</div>
<div class="line"><a name="l00643"></a><span class="lineno">  643</span>&#160;            <span class="keywordflow">if</span> (!<span class="keywordtype">string</span>.IsNullOrEmpty(q[<span class="stringliteral">&quot;frame&quot;</span>]) &amp;&amp; !int.TryParse(q[<span class="stringliteral">&quot;frame&quot;</span>], NumberStyles.Integer, NumberFormatInfo.InvariantInfo, out frame))</div>
<div class="line"><a name="l00644"></a><span class="lineno">  644</span>&#160;                frame = 0;</div>
<div class="line"><a name="l00645"></a><span class="lineno">  645</span>&#160;</div>
<div class="line"><a name="l00646"></a><span class="lineno">  646</span>&#160;            <span class="comment">//So users can use 1-based numbers</span></div>
<div class="line"><a name="l00647"></a><span class="lineno">  647</span>&#160;            page--; frame--;</div>
<div class="line"><a name="l00648"></a><span class="lineno">  648</span>&#160;</div>
<div class="line"><a name="l00649"></a><span class="lineno">  649</span>&#160;            <span class="comment">//Support page selection in a .tiff document.</span></div>
<div class="line"><a name="l00650"></a><span class="lineno">  650</span>&#160;            <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00651"></a><span class="lineno">  651</span>&#160;                <span class="comment">//Stay on the last page/frame if out of bounds</span></div>
<div class="line"><a name="l00652"></a><span class="lineno">  652</span>&#160;                <span class="keywordflow">if</span> (page &gt; 0 &amp;&amp; page &gt;= src.GetFrameCount(FrameDimension.Page)) page = src.GetFrameCount(FrameDimension.Page) - 1;</div>
<div class="line"><a name="l00653"></a><span class="lineno">  653</span>&#160;                <span class="keywordflow">if</span> (frame &gt; 0 &amp;&amp; frame &gt;= src.GetFrameCount(FrameDimension.Time)) frame = src.GetFrameCount(FrameDimension.Time) - 1;</div>
<div class="line"><a name="l00654"></a><span class="lineno">  654</span>&#160;</div>
<div class="line"><a name="l00655"></a><span class="lineno">  655</span>&#160;                <span class="comment">//Select the right page/frame if specified</span></div>
<div class="line"><a name="l00656"></a><span class="lineno">  656</span>&#160;                <span class="keywordflow">if</span> (page &gt; 0) src.SelectActiveFrame(FrameDimension.Page, page);</div>
<div class="line"><a name="l00657"></a><span class="lineno">  657</span>&#160;                <span class="keywordflow">if</span> (frame &gt; 0) src.SelectActiveFrame(FrameDimension.Time, frame);</div>
<div class="line"><a name="l00658"></a><span class="lineno">  658</span>&#160;                s.originalSize = s.sourceBitmap.Size;</div>
<div class="line"><a name="l00659"></a><span class="lineno">  659</span>&#160;            } <span class="keywordflow">catch</span> (ExternalException) { } <span class="comment">//When somebody tries &amp;frame or &amp;page on a single-frame image</span></div>
<div class="line"><a name="l00660"></a><span class="lineno">  660</span>&#160;            </div>
<div class="line"><a name="l00661"></a><span class="lineno">  661</span>&#160;</div>
<div class="line"><a name="l00662"></a><span class="lineno">  662</span>&#160;</div>
<div class="line"><a name="l00663"></a><span class="lineno">  663</span>&#160;            <span class="comment">//Flipping has to be done on the original - it can&#39;t be done as part of the DrawImage or later, after the borders are drawn.</span></div>
<div class="line"><a name="l00664"></a><span class="lineno">  664</span>&#160;</div>
<div class="line"><a name="l00665"></a><span class="lineno">  665</span>&#160;            <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0">sourceBitmap</a> != null &amp;&amp; (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a27da93206fc9ebe2834a02d3e5ab62f6">SourceFlip</a> != RotateFlipType.RotateNoneFlipNone || !<span class="keywordtype">string</span>.IsNullOrEmpty(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>[<span class="stringliteral">&quot;sRotate&quot;</span>]))) {</div>
<div class="line"><a name="l00666"></a><span class="lineno">  666</span>&#160;                <span class="keywordtype">double</span> angle = s.settings.Get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;sRotate&quot;</span>,0);</div>
<div class="line"><a name="l00667"></a><span class="lineno">  667</span>&#160;</div>
<div class="line"><a name="l00668"></a><span class="lineno">  668</span>&#160;                s.EnsurePreRenderBitmap();</div>
<div class="line"><a name="l00669"></a><span class="lineno">  669</span>&#160;                s.preRenderBitmap.RotateFlip(PolygonMath.CombineFlipAndRotate(s.settings.SourceFlip, angle));</div>
<div class="line"><a name="l00670"></a><span class="lineno">  670</span>&#160;                s.originalSize = s.preRenderBitmap.Size;</div>
<div class="line"><a name="l00671"></a><span class="lineno">  671</span>&#160;            }</div>
<div class="line"><a name="l00672"></a><span class="lineno">  672</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00673"></a><span class="lineno">  673</span>&#160;        }</div>
<div class="line"><a name="l00674"></a><span class="lineno">  674</span>&#160;</div>
<div class="line"><a name="l00675"></a><span class="lineno">  675</span>&#160;       </div>
<div class="line"><a name="l00676"></a><span class="lineno">  676</span>&#160;</div>
<div class="line"><a name="l00677"></a><span class="lineno">  677</span>&#160;  </div>
<div class="line"><a name="l00678"></a><span class="lineno">  678</span>&#160;</div>
<div class="line"><a name="l00679"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a9e22edc2ecc338cf2cc0e2b599d3ba01">  679</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a9e22edc2ecc338cf2cc0e2b599d3ba01">LayoutPadding</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s) {</div>
<div class="line"><a name="l00680"></a><span class="lineno">  680</span>&#160;            <span class="keywordflow">if</span> (base.LayoutPadding(s) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span></div>
<div class="line"><a name="l00681"></a><span class="lineno">  681</span>&#160;</div>
<div class="line"><a name="l00682"></a><span class="lineno">  682</span>&#160;            <span class="comment">//We need to add padding</span></div>
<div class="line"><a name="l00683"></a><span class="lineno">  683</span>&#160;            if (!s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ab477264bc4feaa672b217f44dc6d3531">Padding</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_box_padding.html#a4b1353db785a5d82397ed82641f05e0d">IsEmpty</a>) {</div>
<div class="line"><a name="l00684"></a><span class="lineno">  684</span>&#160;                s.layout.AddRing(<span class="stringliteral">&quot;padding&quot;</span>,  s.settings.Padding);</div>
<div class="line"><a name="l00685"></a><span class="lineno">  685</span>&#160;            }</div>
<div class="line"><a name="l00686"></a><span class="lineno">  686</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00687"></a><span class="lineno">  687</span>&#160;        }</div>
<div class="line"><a name="l00688"></a><span class="lineno">  688</span>&#160;</div>
<div class="line"><a name="l00689"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a5226d94222273bd96dad169ad1d5bec0">  689</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a5226d94222273bd96dad169ad1d5bec0">LayoutMargin</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s) {</div>
<div class="line"><a name="l00690"></a><span class="lineno">  690</span>&#160;            <span class="keywordflow">if</span> (base.LayoutMargin(s) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span></div>
<div class="line"><a name="l00691"></a><span class="lineno">  691</span>&#160;</div>
<div class="line"><a name="l00692"></a><span class="lineno">  692</span>&#160;            <span class="comment">//We need to add padding</span></div>
<div class="line"><a name="l00693"></a><span class="lineno">  693</span>&#160;            if (!s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a743f51d8ee756c4f82c679bac685016d">Margin</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_box_padding.html#a4b1353db785a5d82397ed82641f05e0d">IsEmpty</a>) {</div>
<div class="line"><a name="l00694"></a><span class="lineno">  694</span>&#160;                s.layout.AddRing(<span class="stringliteral">&quot;margin&quot;</span>, s.settings.Margin);</div>
<div class="line"><a name="l00695"></a><span class="lineno">  695</span>&#160;            }</div>
<div class="line"><a name="l00696"></a><span class="lineno">  696</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00697"></a><span class="lineno">  697</span>&#160;        }</div>
<div class="line"><a name="l00698"></a><span class="lineno">  698</span>&#160;</div>
<div class="line"><a name="l00699"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#ace292d7e6b4cf7093d00f2c8d3ea52d7">  699</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#ace292d7e6b4cf7093d00f2c8d3ea52d7">LayoutBorder</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s) {</div>
<div class="line"><a name="l00700"></a><span class="lineno">  700</span>&#160;            <span class="keywordflow">if</span> (base.LayoutBorder(s) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span></div>
<div class="line"><a name="l00701"></a><span class="lineno">  701</span>&#160;</div>
<div class="line"><a name="l00702"></a><span class="lineno">  702</span>&#160;            <span class="comment">//And borders</span></div>
<div class="line"><a name="l00703"></a><span class="lineno">  703</span>&#160;            if (!s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae5ee543eced4b1d204325b4c598b9002">Border</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_box_padding.html#a4b1353db785a5d82397ed82641f05e0d">IsEmpty</a>) {</div>
<div class="line"><a name="l00704"></a><span class="lineno">  704</span>&#160;                s.layout.AddRing(<span class="stringliteral">&quot;border&quot;</span>, s.settings.Border);</div>
<div class="line"><a name="l00705"></a><span class="lineno">  705</span>&#160;            }</div>
<div class="line"><a name="l00706"></a><span class="lineno">  706</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00707"></a><span class="lineno">  707</span>&#160;        }</div>
<div class="line"><a name="l00708"></a><span class="lineno">  708</span>&#160;</div>
<div class="line"><a name="l00709"></a><span class="lineno">  709</span>&#160;        </div>
<div class="line"><a name="l00710"></a><span class="lineno">  710</span>&#160;</div>
<div class="line"><a name="l00711"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a251f5ddd07226dbc98abec4673afa07e">  711</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a251f5ddd07226dbc98abec4673afa07e">LayoutRound</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s)</div>
<div class="line"><a name="l00712"></a><span class="lineno">  712</span>&#160;        {</div>
<div class="line"><a name="l00713"></a><span class="lineno">  713</span>&#160;            <span class="keywordflow">if</span> (base.LayoutRound(s) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span></div>
<div class="line"><a name="l00714"></a><span class="lineno">  714</span>&#160;            <span class="comment">//Todo, round points here.</span></div>
<div class="line"><a name="l00715"></a><span class="lineno">  715</span>&#160;            <span class="comment">//s.layout.Round();</span></div>
<div class="line"><a name="l00716"></a><span class="lineno">  716</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.None;</div>
<div class="line"><a name="l00717"></a><span class="lineno">  717</span>&#160;        }</div>
<div class="line"><a name="l00718"></a><span class="lineno">  718</span>&#160;</div>
<div class="line"><a name="l00719"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#ad7d2c54cc300e532a28e76a34de35186">  719</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#ad7d2c54cc300e532a28e76a34de35186">LayoutRotate</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s)</div>
<div class="line"><a name="l00720"></a><span class="lineno">  720</span>&#160;        {</div>
<div class="line"><a name="l00721"></a><span class="lineno">  721</span>&#160;            <span class="keywordflow">if</span> (base.LayoutRotate(s) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span></div>
<div class="line"><a name="l00722"></a><span class="lineno">  722</span>&#160;            <span class="comment">//Now, rotate all rings.</span></div>
<div class="line"><a name="l00723"></a><span class="lineno">  723</span>&#160;            s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e">layout</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_layout_builder.html#a90faf403e3c1fad5e4ff80aec2605518">Rotate</a>(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#af0a73e8db4a3e4e40f0564d0dca29833">Rotate</a>, <span class="keyword">new</span> PointF(0, 0));</div>
<div class="line"><a name="l00724"></a><span class="lineno">  724</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00725"></a><span class="lineno">  725</span>&#160;        }</div>
<div class="line"><a name="l00726"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#ad4e099c55af7db2a764bf7429e0c1c7f">  726</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#ad4e099c55af7db2a764bf7429e0c1c7f">LayoutNormalize</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s)</div>
<div class="line"><a name="l00727"></a><span class="lineno">  727</span>&#160;        {</div>
<div class="line"><a name="l00728"></a><span class="lineno">  728</span>&#160;            <span class="keywordflow">if</span> (base.LayoutNormalize(s) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span></div>
<div class="line"><a name="l00729"></a><span class="lineno">  729</span>&#160;            <span class="comment">//Normalize all the rings</span></div>
<div class="line"><a name="l00730"></a><span class="lineno">  730</span>&#160;            s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e">layout</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_layout_builder.html#a051b209e5c0d4a59998c266d79a1daa2">Normalize</a>(<span class="keyword">new</span> PointF(0, 0));</div>
<div class="line"><a name="l00731"></a><span class="lineno">  731</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00732"></a><span class="lineno">  732</span>&#160;        }</div>
<div class="line"><a name="l00733"></a><span class="lineno">  733</span>&#160;</div>
<div class="line"><a name="l00734"></a><span class="lineno">  734</span>&#160;</div>
<div class="line"><a name="l00735"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#ad3c48a100d8e661aec4dbb56783c8508">  735</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#ad3c48a100d8e661aec4dbb56783c8508">EndLayout</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s)</div>
<div class="line"><a name="l00736"></a><span class="lineno">  736</span>&#160;        {</div>
<div class="line"><a name="l00737"></a><span class="lineno">  737</span>&#160;            <span class="keywordflow">if</span> (base.EndLayout(s) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span></div>
<div class="line"><a name="l00738"></a><span class="lineno">  738</span>&#160;</div>
<div class="line"><a name="l00739"></a><span class="lineno">  739</span>&#160;            <span class="comment">//Calculates a bounding box around all the rings in the layout, then rounds that size. Creates a 1x1 pixel destSize value at minimum.</span></div>
<div class="line"><a name="l00740"></a><span class="lineno">  740</span>&#160;            s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#af7685bdf458df8b87e3de9f18629c919">destSize</a> = <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a3bd9aa254e8639eb72e580d324f929b9">RoundPoints</a>(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e">layout</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_layout_builder.html#aa648f003522418c8c8a6677a62c1df4e">GetBoundingBox</a>().Size);</div>
<div class="line"><a name="l00741"></a><span class="lineno">  741</span>&#160;            s.destSize = <span class="keyword">new</span> Size((<span class="keywordtype">int</span>)Math.Max(1, s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#af7685bdf458df8b87e3de9f18629c919">destSize</a>.Width), (int)Math.Max(1, s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#af7685bdf458df8b87e3de9f18629c919">destSize</a>.Height));</div>
<div class="line"><a name="l00742"></a><span class="lineno">  742</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00743"></a><span class="lineno">  743</span>&#160;        }</div>
<div class="line"><a name="l00744"></a><span class="lineno">  744</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00745"></a><span class="lineno">  745</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00746"></a><span class="lineno">  746</span>&#160;<span class="comment">        /// Creates a bitmap of s.destSize dimensions, intializes a graphics object for it, and configures all the default settings.</span></div>
<div class="line"><a name="l00747"></a><span class="lineno">  747</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00748"></a><span class="lineno">  748</span>&#160;<span class="comment">        /// &lt;param name=&quot;s&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00749"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a4cb07c8d3c0aea9841613431614a3fa9">  749</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>  <a class="code" href="class_image_resizer_1_1_image_builder.html#a4cb07c8d3c0aea9841613431614a3fa9">PrepareDestinationBitmap</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s)</div>
<div class="line"><a name="l00750"></a><span class="lineno">  750</span>&#160;        {</div>
<div class="line"><a name="l00751"></a><span class="lineno">  751</span>&#160;            <span class="keywordflow">if</span> (base.PrepareDestinationBitmap(s) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel;</div>
<div class="line"><a name="l00752"></a><span class="lineno">  752</span>&#160;</div>
<div class="line"><a name="l00753"></a><span class="lineno">  753</span>&#160;             if (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0">sourceBitmap</a> == null) <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00754"></a><span class="lineno">  754</span>&#160;</div>
<div class="line"><a name="l00755"></a><span class="lineno">  755</span>&#160;            <span class="comment">//Create new bitmap using calculated size. </span></div>
<div class="line"><a name="l00756"></a><span class="lineno">  756</span>&#160;            s.destBitmap = <span class="keyword">new</span> Bitmap(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#af7685bdf458df8b87e3de9f18629c919">destSize</a>.Width,s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#af7685bdf458df8b87e3de9f18629c919">destSize</a>.Height, PixelFormat.Format32bppArgb);</div>
<div class="line"><a name="l00757"></a><span class="lineno">  757</span>&#160;            </div>
<div class="line"><a name="l00758"></a><span class="lineno">  758</span>&#160;</div>
<div class="line"><a name="l00759"></a><span class="lineno">  759</span>&#160;            <span class="comment">//Create graphics handle</span></div>
<div class="line"><a name="l00760"></a><span class="lineno">  760</span>&#160;            Graphics g = s.destGraphics = Graphics.FromImage(s.destBitmap);</div>
<div class="line"><a name="l00761"></a><span class="lineno">  761</span>&#160;</div>
<div class="line"><a name="l00762"></a><span class="lineno">  762</span>&#160;            <span class="comment">//High quality everthing</span></div>
<div class="line"><a name="l00763"></a><span class="lineno">  763</span>&#160;            g.InterpolationMode = System.Drawing.Drawing2D.InterpolationMode.HighQualityBicubic;</div>
<div class="line"><a name="l00764"></a><span class="lineno">  764</span>&#160;            g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.HighQuality;</div>
<div class="line"><a name="l00765"></a><span class="lineno">  765</span>&#160;            g.PixelOffsetMode = System.Drawing.Drawing2D.PixelOffsetMode.HighQuality;</div>
<div class="line"><a name="l00766"></a><span class="lineno">  766</span>&#160;            g.CompositingQuality = System.Drawing.Drawing2D.CompositingQuality.HighQuality;</div>
<div class="line"><a name="l00767"></a><span class="lineno">  767</span>&#160;            g.CompositingMode = CompositingMode.SourceOver;</div>
<div class="line"><a name="l00768"></a><span class="lineno">  768</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00769"></a><span class="lineno">  769</span>&#160;        }</div>
<div class="line"><a name="l00770"></a><span class="lineno">  770</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00771"></a><span class="lineno">  771</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00772"></a><span class="lineno">  772</span>&#160;<span class="comment">        /// Sets the background color if needed or requested</span></div>
<div class="line"><a name="l00773"></a><span class="lineno">  773</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00774"></a><span class="lineno">  774</span>&#160;<span class="comment">        /// &lt;param name=&quot;s&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00775"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a32558f4f0b1a0aaed2500dc9e5b849ea">  775</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a32558f4f0b1a0aaed2500dc9e5b849ea">RenderBackground</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s) {</div>
<div class="line"><a name="l00776"></a><span class="lineno">  776</span>&#160;            <span class="keywordflow">if</span> (base.RenderBackground(s) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span></div>
<div class="line"><a name="l00777"></a><span class="lineno">  777</span>&#160;</div>
<div class="line"><a name="l00778"></a><span class="lineno">  778</span>&#160;            <span class="comment">//Skip this when we are doing simulations</span></div>
<div class="line"><a name="l00779"></a><span class="lineno">  779</span>&#160;            if (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b">destGraphics</a> == null) <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00780"></a><span class="lineno">  780</span>&#160;</div>
<div class="line"><a name="l00781"></a><span class="lineno">  781</span>&#160;            Graphics g = s.destGraphics;</div>
<div class="line"><a name="l00782"></a><span class="lineno">  782</span>&#160;</div>
<div class="line"><a name="l00783"></a><span class="lineno">  783</span>&#160;            <span class="comment">//If the image doesn&#39;t support transparency, we need to fill the background color now.</span></div>
<div class="line"><a name="l00784"></a><span class="lineno">  784</span>&#160;            Color background = s.settings.BackgroundColor;</div>
<div class="line"><a name="l00785"></a><span class="lineno">  785</span>&#160;</div>
<div class="line"><a name="l00786"></a><span class="lineno">  786</span>&#160; </div>
<div class="line"><a name="l00787"></a><span class="lineno">  787</span>&#160;</div>
<div class="line"><a name="l00788"></a><span class="lineno">  788</span>&#160;            <span class="comment">//Find out if we can safely know that nothing will be showing from behind the image (no margin, padding, etc, and source format doesn&#39;t have alpha channel).</span></div>
<div class="line"><a name="l00789"></a><span class="lineno">  789</span>&#160;            <span class="comment">//Doesn&#39;t know anything about s.preRenderBitmap</span></div>
<div class="line"><a name="l00790"></a><span class="lineno">  790</span>&#160;            <span class="keywordtype">bool</span> nothingToShow = (s.sourceBitmap != null &amp;&amp; (s.sourceBitmap.PixelFormat == PixelFormat.Format24bppRgb ||</div>
<div class="line"><a name="l00791"></a><span class="lineno">  791</span>&#160;                        s.sourceBitmap.PixelFormat == PixelFormat.Format32bppRgb || </div>
<div class="line"><a name="l00792"></a><span class="lineno">  792</span>&#160;                        s.sourceBitmap.PixelFormat == PixelFormat.Format48bppRgb) &amp;&amp;</div>
<div class="line"><a name="l00793"></a><span class="lineno">  793</span>&#160;                        <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a091c43453f558cb12f8f4f4e485a711d">ArraysEqual</a>(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e">layout</a>[<span class="stringliteral">&quot;image&quot;</span>], s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e">layout</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_layout_builder.html#a25cec5c2a949a13ac66102e713d07db4">LastRing</a>.points) &amp;&amp;</div>
<div class="line"><a name="l00794"></a><span class="lineno">  794</span>&#160;                        PolygonMath.IsUnrotated(s.layout[<span class="stringliteral">&quot;image&quot;</span>]) &amp;&amp; <span class="keywordtype">string</span>.IsNullOrEmpty(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>[<span class="stringliteral">&quot;s.alpha&quot;</span>])</div>
<div class="line"><a name="l00795"></a><span class="lineno">  795</span>&#160;                            &amp;&amp; string.IsNullOrEmpty(s.settings[<span class="stringliteral">&quot;s.roundcorners&quot;</span>])</div>
<div class="line"><a name="l00796"></a><span class="lineno">  796</span>&#160;                            &amp;&amp; <span class="keywordtype">string</span>.IsNullOrEmpty(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>[<span class="stringliteral">&quot;filter&quot;</span>]));</div>
<div class="line"><a name="l00797"></a><span class="lineno">  797</span>&#160;</div>
<div class="line"><a name="l00798"></a><span class="lineno">  798</span>&#160;            <span class="comment">//Set the background to white if the background will be showing and the destination format doesn&#39;t support transparency.</span></div>
<div class="line"><a name="l00799"></a><span class="lineno">  799</span>&#160;            <span class="keywordflow">if</span> (background == Color.Transparent &amp;&amp; !s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a4292474d3ba45b4f0c20fb7b38e8631c">supportsTransparency</a> &amp; !nothingToShow) </div>
<div class="line"><a name="l00800"></a><span class="lineno">  800</span>&#160;                background = Color.White;</div>
<div class="line"><a name="l00801"></a><span class="lineno">  801</span>&#160;</div>
<div class="line"><a name="l00802"></a><span class="lineno">  802</span>&#160;</div>
<div class="line"><a name="l00803"></a><span class="lineno">  803</span>&#160;            </div>
<div class="line"><a name="l00804"></a><span class="lineno">  804</span>&#160;            <span class="comment">//Fill background</span></div>
<div class="line"><a name="l00805"></a><span class="lineno">  805</span>&#160;            <span class="keywordflow">if</span> (background != Color.Transparent) <span class="comment">//This causes increased aliasing at the edges - i.e., a faint white border that is even more pronounced than usual.</span></div>
<div class="line"><a name="l00806"></a><span class="lineno">  806</span>&#160;                g.Clear(background); <span class="comment">//Does this work for Color.Transparent? -- </span></div>
<div class="line"><a name="l00807"></a><span class="lineno">  807</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00808"></a><span class="lineno">  808</span>&#160;        }</div>
<div class="line"><a name="l00809"></a><span class="lineno">  809</span>&#160;</div>
<div class="line"><a name="l00810"></a><span class="lineno">  810</span>&#160;</div>
<div class="line"><a name="l00811"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a6095ca220f026fec0fd15b3ebf4ef12a">  811</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a6095ca220f026fec0fd15b3ebf4ef12a">RenderPadding</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s) {</div>
<div class="line"><a name="l00812"></a><span class="lineno">  812</span>&#160;            <span class="keywordflow">if</span> (base.RenderPadding(s) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span></div>
<div class="line"><a name="l00813"></a><span class="lineno">  813</span>&#160;</div>
<div class="line"><a name="l00814"></a><span class="lineno">  814</span>&#160;            <span class="comment">//Skip this when we are doing simulations</span></div>
<div class="line"><a name="l00815"></a><span class="lineno">  815</span>&#160;            if (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b">destGraphics</a> == null) <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00816"></a><span class="lineno">  816</span>&#160;</div>
<div class="line"><a name="l00817"></a><span class="lineno">  817</span>&#160;            <span class="keywordflow">if</span> (!s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e">layout</a>.ContainsRing(<span class="stringliteral">&quot;padding&quot;</span>)) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.None;</div>
<div class="line"><a name="l00818"></a><span class="lineno">  818</span>&#160;</div>
<div class="line"><a name="l00819"></a><span class="lineno">  819</span>&#160;            Color paddingColor = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#aecaac2b7c431f38d796545950119abeb">PaddingColor</a>;</div>
<div class="line"><a name="l00820"></a><span class="lineno">  820</span>&#160;            <span class="comment">//Inherit color</span></div>
<div class="line"><a name="l00821"></a><span class="lineno">  821</span>&#160;            if (paddingColor.Equals(Color.Transparent)) paddingColor = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a40623c01b19422d9dc93b8809ef3dbc2">BackgroundColor</a>;</div>
<div class="line"><a name="l00822"></a><span class="lineno">  822</span>&#160;            <span class="comment">//Draw padding around image if needed.</span></div>
<div class="line"><a name="l00823"></a><span class="lineno">  823</span>&#160;            if (!paddingColor.Equals(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a40623c01b19422d9dc93b8809ef3dbc2">BackgroundColor</a>) &amp;&amp; paddingColor != Color.Transparent)</div>
<div class="line"><a name="l00824"></a><span class="lineno">  824</span>&#160;                <span class="keyword">using</span> (Brush b = <span class="keyword">new</span> SolidBrush(paddingColor)) s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b">destGraphics</a>.FillPolygon(b, s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e">layout</a>[<span class="stringliteral">&quot;padding&quot;</span>]);</div>
<div class="line"><a name="l00825"></a><span class="lineno">  825</span>&#160;          </div>
<div class="line"><a name="l00826"></a><span class="lineno">  826</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00827"></a><span class="lineno">  827</span>&#160;        }</div>
<div class="line"><a name="l00828"></a><span class="lineno">  828</span>&#160;</div>
<div class="line"><a name="l00829"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a70a8ba17d8b08e48d273f72b256b5573">  829</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a70a8ba17d8b08e48d273f72b256b5573">CreateImageAttribues</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s) {</div>
<div class="line"><a name="l00830"></a><span class="lineno">  830</span>&#160;            <span class="keywordflow">if</span> (base.CreateImageAttribues(s) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span></div>
<div class="line"><a name="l00831"></a><span class="lineno">  831</span>&#160;            if (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a0575a388f0e3235d967cb62f4904fe09">copyAttibutes</a> == null) s.copyAttibutes = <span class="keyword">new</span> ImageAttributes();</div>
<div class="line"><a name="l00832"></a><span class="lineno">  832</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00833"></a><span class="lineno">  833</span>&#160;        }</div>
<div class="line"><a name="l00834"></a><span class="lineno">  834</span>&#160;</div>
<div class="line"><a name="l00835"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a0d9f4fd12809ec0cc17bbb2fb33a7309">  835</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a0d9f4fd12809ec0cc17bbb2fb33a7309">RenderImage</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s) {</div>
<div class="line"><a name="l00836"></a><span class="lineno">  836</span>&#160;            <span class="keywordflow">if</span> (base.RenderImage(s) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span></div>
<div class="line"><a name="l00837"></a><span class="lineno">  837</span>&#160;</div>
<div class="line"><a name="l00838"></a><span class="lineno">  838</span>&#160;            <span class="comment">//Skip this when we are doing simulations</span></div>
<div class="line"><a name="l00839"></a><span class="lineno">  839</span>&#160;            if (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b">destGraphics</a> == null) <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00840"></a><span class="lineno">  840</span>&#160;</div>
<div class="line"><a name="l00841"></a><span class="lineno">  841</span>&#160;            <span class="keywordflow">if</span> (!<span class="keywordtype">string</span>.IsNullOrEmpty(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>[<span class="stringliteral">&quot;gdi.filter&quot;</span>])) {</div>
<div class="line"><a name="l00842"></a><span class="lineno">  842</span>&#160;                s.destGraphics.InterpolationMode = s.settings.Get&lt;InterpolationMode&gt;(<span class="stringliteral">&quot;gdi.filter&quot;</span>, s.destGraphics.InterpolationMode);</div>
<div class="line"><a name="l00843"></a><span class="lineno">  843</span>&#160;            }</div>
<div class="line"><a name="l00844"></a><span class="lineno">  844</span>&#160;</div>
<div class="line"><a name="l00845"></a><span class="lineno">  845</span>&#160;            s.copyAttibutes.SetWrapMode(WrapMode.TileFlipXY);</div>
<div class="line"><a name="l00846"></a><span class="lineno">  846</span>&#160;            <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#acd58bc890cee2f8d314ae94c2508d0b5">preRenderBitmap</a> != null) {</div>
<div class="line"><a name="l00847"></a><span class="lineno">  847</span>&#160;                <span class="keyword">using</span> (Bitmap b = s.preRenderBitmap) { <span class="comment">//Dispose the intermediate bitmap aggressively</span></div>
<div class="line"><a name="l00848"></a><span class="lineno">  848</span>&#160;                    s.destGraphics.DrawImage(s.preRenderBitmap, PolygonMath.getParallelogram(s.layout[<span class="stringliteral">&quot;image&quot;</span>]), </div>
<div class="line"><a name="l00849"></a><span class="lineno">  849</span>&#160;                        s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a22528462bb2ca64173878ef4441bad28">copyRect</a>, GraphicsUnit.Pixel, s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a0575a388f0e3235d967cb62f4904fe09">copyAttibutes</a>);</div>
<div class="line"><a name="l00850"></a><span class="lineno">  850</span>&#160;                }</div>
<div class="line"><a name="l00851"></a><span class="lineno">  851</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00852"></a><span class="lineno">  852</span>&#160;                s.destGraphics.DrawImage(s.sourceBitmap, PolygonMath.getParallelogram(s.layout[<span class="stringliteral">&quot;image&quot;</span>]), s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a22528462bb2ca64173878ef4441bad28">copyRect</a>, GraphicsUnit.Pixel, s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a0575a388f0e3235d967cb62f4904fe09">copyAttibutes</a>);</div>
<div class="line"><a name="l00853"></a><span class="lineno">  853</span>&#160;            }</div>
<div class="line"><a name="l00854"></a><span class="lineno">  854</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00855"></a><span class="lineno">  855</span>&#160;        }</div>
<div class="line"><a name="l00856"></a><span class="lineno">  856</span>&#160;</div>
<div class="line"><a name="l00857"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a73ee8389af6a5b923455dc80da3ac66e">  857</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a73ee8389af6a5b923455dc80da3ac66e">RenderBorder</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s) {</div>
<div class="line"><a name="l00858"></a><span class="lineno">  858</span>&#160;            <span class="keywordflow">if</span> (base.RenderBorder(s) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span></div>
<div class="line"><a name="l00859"></a><span class="lineno">  859</span>&#160;</div>
<div class="line"><a name="l00860"></a><span class="lineno">  860</span>&#160;            <span class="comment">//Skip this when we are doing simulations</span></div>
<div class="line"><a name="l00861"></a><span class="lineno">  861</span>&#160;            if (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b">destGraphics</a> == null) <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00862"></a><span class="lineno">  862</span>&#160;</div>
<div class="line"><a name="l00863"></a><span class="lineno">  863</span>&#160;            <span class="comment">//Draw border</span></div>
<div class="line"><a name="l00864"></a><span class="lineno">  864</span>&#160;            <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae5ee543eced4b1d204325b4c598b9002">Border</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_box_padding.html#a4b1353db785a5d82397ed82641f05e0d">IsEmpty</a>) <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00865"></a><span class="lineno">  865</span>&#160;</div>
<div class="line"><a name="l00866"></a><span class="lineno">  866</span>&#160;            <span class="keywordflow">if</span> (<span class="keywordtype">double</span>.IsNaN(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae5ee543eced4b1d204325b4c598b9002">Border</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_box_padding.html#a5a549837cdd68bdbd6fa61c9d11f9e52">All</a>)) {</div>
<div class="line"><a name="l00867"></a><span class="lineno">  867</span>&#160;                <span class="keywordtype">float</span>[] widths = <span class="keyword">new</span> <span class="keywordtype">float</span>[] { (float)s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae5ee543eced4b1d204325b4c598b9002">Border</a>.Top * -1, (<span class="keywordtype">float</span>)s.settings.Border.Right * -1, (float)s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae5ee543eced4b1d204325b4c598b9002">Border</a>.Bottom * -1, (<span class="keywordtype">float</span>)s.settings.Border.Left * -1 };</div>
<div class="line"><a name="l00868"></a><span class="lineno">  868</span>&#160;                PointF[,] corners = PolygonMath.GetCorners(s.layout[<span class="stringliteral">&quot;border&quot;</span>],widths);</div>
<div class="line"><a name="l00869"></a><span class="lineno">  869</span>&#160;</div>
<div class="line"><a name="l00870"></a><span class="lineno">  870</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt;= corners.GetUpperBound(0); i++) {</div>
<div class="line"><a name="l00871"></a><span class="lineno">  871</span>&#160;                    <span class="keywordtype">int</span> last = i == 0 ? corners.GetUpperBound(0) : i -1;</div>
<div class="line"><a name="l00872"></a><span class="lineno">  872</span>&#160;</div>
<div class="line"><a name="l00873"></a><span class="lineno">  873</span>&#160;                    PointF start = PolygonMath.Average(corners[last, 3], corners[last, 0]);</div>
<div class="line"><a name="l00874"></a><span class="lineno">  874</span>&#160;                    PointF end = PolygonMath.Average(corners[i, 0], corners[i, 1]);</div>
<div class="line"><a name="l00875"></a><span class="lineno">  875</span>&#160;</div>
<div class="line"><a name="l00876"></a><span class="lineno">  876</span>&#160;                    <span class="keyword">using</span> (Pen p = <span class="keyword">new</span> Pen(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#aeff2f3a99b045d45b46e3a417c2ab1fd">BorderColor</a>, widths[i &lt; 1 ? 3 : i -1] * -1)) {</div>
<div class="line"><a name="l00877"></a><span class="lineno">  877</span>&#160;                        p.Alignment = System.Drawing.Drawing2D.PenAlignment.Center; <span class="comment">//PenAlignment.Center is the only supported mode.</span></div>
<div class="line"><a name="l00878"></a><span class="lineno">  878</span>&#160;                        p.LineJoin = System.Drawing.Drawing2D.LineJoin.Miter;</div>
<div class="line"><a name="l00879"></a><span class="lineno">  879</span>&#160;                        s.destGraphics.DrawLine(p, start, end);</div>
<div class="line"><a name="l00880"></a><span class="lineno">  880</span>&#160;                    }</div>
<div class="line"><a name="l00881"></a><span class="lineno">  881</span>&#160;</div>
<div class="line"><a name="l00882"></a><span class="lineno">  882</span>&#160;                }</div>
<div class="line"><a name="l00883"></a><span class="lineno">  883</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00884"></a><span class="lineno">  884</span>&#160;                <span class="keyword">using</span> (Pen p = <span class="keyword">new</span> Pen(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#aeff2f3a99b045d45b46e3a417c2ab1fd">BorderColor</a>, (<span class="keywordtype">float</span>)s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae5ee543eced4b1d204325b4c598b9002">Border</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_box_padding.html#a5a549837cdd68bdbd6fa61c9d11f9e52">All</a>)) {</div>
<div class="line"><a name="l00885"></a><span class="lineno">  885</span>&#160;                    p.Alignment = System.Drawing.Drawing2D.PenAlignment.Center; <span class="comment">//PenAlignment.Center is the only supported mode.</span></div>
<div class="line"><a name="l00886"></a><span class="lineno">  886</span>&#160;                    p.LineJoin = System.Drawing.Drawing2D.LineJoin.Miter;</div>
<div class="line"><a name="l00887"></a><span class="lineno">  887</span>&#160;                    s.destGraphics.DrawPolygon(p, PolygonMath.InflatePoly(s.layout[<span class="stringliteral">&quot;border&quot;</span>], (float)(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae5ee543eced4b1d204325b4c598b9002">Border</a>.<a class="code" href="class_image_resizer_1_1_resizing_1_1_box_padding.html#a5a549837cdd68bdbd6fa61c9d11f9e52">All</a> / -2.0))); <span class="comment">//I hope GDI rounds the same way as .NET.. Otherwise there may be an off-by-one error..</span></div>
<div class="line"><a name="l00888"></a><span class="lineno">  888</span>&#160;                }</div>
<div class="line"><a name="l00889"></a><span class="lineno">  889</span>&#160;            }</div>
<div class="line"><a name="l00890"></a><span class="lineno">  890</span>&#160;</div>
<div class="line"><a name="l00891"></a><span class="lineno">  891</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00892"></a><span class="lineno">  892</span>&#160;        }</div>
<div class="line"><a name="l00893"></a><span class="lineno">  893</span>&#160;</div>
<div class="line"><a name="l00894"></a><span class="lineno">  894</span>&#160;</div>
<div class="line"><a name="l00895"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#af7321daa43947075d5963a33f3473883">  895</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#af7321daa43947075d5963a33f3473883">FlushChanges</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s) {</div>
<div class="line"><a name="l00896"></a><span class="lineno">  896</span>&#160;            <span class="keywordflow">if</span> (base.FlushChanges(s) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span></div>
<div class="line"><a name="l00897"></a><span class="lineno">  897</span>&#160;</div>
<div class="line"><a name="l00898"></a><span class="lineno">  898</span>&#160;            if (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b">destGraphics</a> == null) <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00899"></a><span class="lineno">  899</span>&#160;            <span class="comment">//Commit changes.</span></div>
<div class="line"><a name="l00900"></a><span class="lineno">  900</span>&#160;            s.destGraphics.Flush(FlushIntention.Flush);</div>
<div class="line"><a name="l00901"></a><span class="lineno">  901</span>&#160;            s.destGraphics.Dispose();</div>
<div class="line"><a name="l00902"></a><span class="lineno">  902</span>&#160;            s.destGraphics = null;</div>
<div class="line"><a name="l00903"></a><span class="lineno">  903</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00904"></a><span class="lineno">  904</span>&#160;        }</div>
<div class="line"><a name="l00905"></a><span class="lineno">  905</span>&#160;</div>
<div class="line"><a name="l00906"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a5f3df5920c5ec3f75085a91d4268157a">  906</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a5f3df5920c5ec3f75085a91d4268157a">ProcessFinalBitmap</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s) {</div>
<div class="line"><a name="l00907"></a><span class="lineno">  907</span>&#160;            <span class="keywordflow">if</span> (base.ProcessFinalBitmap(s) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span></div>
<div class="line"><a name="l00908"></a><span class="lineno">  908</span>&#160;</div>
<div class="line"><a name="l00909"></a><span class="lineno">  909</span>&#160;            <span class="comment">//The default if we are doing a simulation</span></div>
<div class="line"><a name="l00910"></a><span class="lineno">  910</span>&#160;</div>
<div class="line"><a name="l00911"></a><span class="lineno">  911</span>&#160;            s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#ab7d7513afe8fad1300bf8cb96942f06f">finalSize</a> = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#af7685bdf458df8b87e3de9f18629c919">destSize</a>;</div>
<div class="line"><a name="l00912"></a><span class="lineno">  912</span>&#160;            <span class="comment">//Skip this when we are doing simulations</span></div>
<div class="line"><a name="l00913"></a><span class="lineno">  913</span>&#160;            if (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a3ecc996b00bfe20e621a43107312233d">destBitmap</a> == null) <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00914"></a><span class="lineno">  914</span>&#160;</div>
<div class="line"><a name="l00915"></a><span class="lineno">  915</span>&#160;            <span class="comment">//The last flipping.</span></div>
<div class="line"><a name="l00916"></a><span class="lineno">  916</span>&#160;            <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ad6f58c2c9129334491b436b2abdbc9b5">Flip</a> != RotateFlipType.RotateNoneFlipNone)</div>
<div class="line"><a name="l00917"></a><span class="lineno">  917</span>&#160;                s.destBitmap.RotateFlip(s.settings.Flip);</div>
<div class="line"><a name="l00918"></a><span class="lineno">  918</span>&#160;</div>
<div class="line"><a name="l00919"></a><span class="lineno">  919</span>&#160;            <span class="comment">//Set DPI value</span></div>
<div class="line"><a name="l00920"></a><span class="lineno">  920</span>&#160;            <span class="keywordflow">if</span> (!<span class="keywordtype">string</span>.IsNullOrEmpty(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>[<span class="stringliteral">&quot;dpi&quot;</span>])){</div>
<div class="line"><a name="l00921"></a><span class="lineno">  921</span>&#160;                <span class="keywordtype">int</span> dpi = s.settings.Get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;dpi&quot;</span>,96);</div>
<div class="line"><a name="l00922"></a><span class="lineno">  922</span>&#160;                s.destBitmap.SetResolution(dpi, dpi);</div>
<div class="line"><a name="l00923"></a><span class="lineno">  923</span>&#160;            }</div>
<div class="line"><a name="l00924"></a><span class="lineno">  924</span>&#160;            </div>
<div class="line"><a name="l00925"></a><span class="lineno">  925</span>&#160;            s.finalSize = s.destBitmap.Size;</div>
<div class="line"><a name="l00926"></a><span class="lineno">  926</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00927"></a><span class="lineno">  927</span>&#160;        }</div>
<div class="line"><a name="l00928"></a><span class="lineno">  928</span>&#160;       </div>
<div class="line"><a name="l00929"></a><span class="lineno">  929</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00930"></a><span class="lineno">  930</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00931"></a><span class="lineno">  931</span>&#160;<span class="comment">        /// Doesn&#39;t support flipping. Translate a point on the original bitmap to a point on the new bitmap. If the original point no longer exists, returns Empty</span></div>
<div class="line"><a name="l00932"></a><span class="lineno">  932</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00933"></a><span class="lineno">  933</span>&#160;<span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span></div>
<div class="line"><a name="l00934"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#af498e87cf9e20dee93b0fb711e39581f">  934</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> PointF[] <a class="code" href="class_image_resizer_1_1_image_builder.html#af498e87cf9e20dee93b0fb711e39581f">TranslatePoints</a>(PointF[] sourcePoints, Size originalSize, <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> q) {</div>
<div class="line"><a name="l00935"></a><span class="lineno">  935</span>&#160;            <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a>(q, originalSize, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00936"></a><span class="lineno">  936</span>&#160;            s.layout.AddInvisiblePolygon(<span class="stringliteral">&quot;points&quot;</span>, sourcePoints);</div>
<div class="line"><a name="l00937"></a><span class="lineno">  937</span>&#160;            Process(s);</div>
<div class="line"><a name="l00938"></a><span class="lineno">  938</span>&#160;            <span class="keywordflow">return</span> s.layout[<span class="stringliteral">&quot;points&quot;</span>];</div>
<div class="line"><a name="l00939"></a><span class="lineno">  939</span>&#160;        }</div>
<div class="line"><a name="l00940"></a><span class="lineno">  940</span>&#160;         </div>
<div class="line"><a name="l00941"></a><span class="lineno">  941</span>&#160;</div>
<div class="line"><a name="l00942"></a><span class="lineno">  942</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00943"></a><span class="lineno">  943</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00944"></a><span class="lineno">  944</span>&#160;<span class="comment">        /// Gets the final size of an image</span></div>
<div class="line"><a name="l00945"></a><span class="lineno">  945</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00946"></a><span class="lineno">  946</span>&#160;<span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span></div>
<div class="line"><a name="l00947"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#ac0ad7c5f8e03ca9a50e6538677c3475d">  947</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> Size <a class="code" href="class_image_resizer_1_1_image_builder.html#ac0ad7c5f8e03ca9a50e6538677c3475d">GetFinalSize</a>(Size originalSize, <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> q)</div>
<div class="line"><a name="l00948"></a><span class="lineno">  948</span>&#160;        {</div>
<div class="line"><a name="l00949"></a><span class="lineno">  949</span>&#160;            <span class="keywordflow">return</span> GetFinalSize(originalSize, <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_instructions.html">Instructions</a>(q));</div>
<div class="line"><a name="l00950"></a><span class="lineno">  950</span>&#160;        }</div>
<div class="line"><a name="l00951"></a><span class="lineno">  951</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00952"></a><span class="lineno">  952</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00953"></a><span class="lineno">  953</span>&#160;<span class="comment">        /// Gets the final size of an image</span></div>
<div class="line"><a name="l00954"></a><span class="lineno">  954</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00955"></a><span class="lineno">  955</span>&#160;<span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span></div>
<div class="line"><a name="l00956"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a1824384380315ef898318f888d7322ad">  956</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> Size <a class="code" href="class_image_resizer_1_1_image_builder.html#a1824384380315ef898318f888d7322ad">GetFinalSize</a>(Size originalSize, <a class="code" href="class_image_resizer_1_1_instructions.html">Instructions</a> q)</div>
<div class="line"><a name="l00957"></a><span class="lineno">  957</span>&#160;        {</div>
<div class="line"><a name="l00958"></a><span class="lineno">  958</span>&#160;            <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a>(<span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a>(q), originalSize, <span class="keyword">true</span>);</div>
<div class="line"><a name="l00959"></a><span class="lineno">  959</span>&#160;            Process(s);</div>
<div class="line"><a name="l00960"></a><span class="lineno">  960</span>&#160;            <span class="keywordflow">return</span> s.finalSize;</div>
<div class="line"><a name="l00961"></a><span class="lineno">  961</span>&#160;        }</div>
<div class="line"><a name="l00962"></a><span class="lineno">  962</span>&#160;</div>
<div class="line"><a name="l00963"></a><span class="lineno">  963</span>&#160;  </div>
<div class="line"><a name="l00964"></a><span class="lineno">  964</span>&#160;</div>
<div class="line"><a name="l00965"></a><span class="lineno">  965</span>&#160;</div>
<div class="line"><a name="l00966"></a><span class="lineno">  966</span>&#160;</div>
<div class="line"><a name="l00967"></a><span class="lineno">  967</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00968"></a><span class="lineno">  968</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00969"></a><span class="lineno">  969</span>&#160;<span class="comment">        /// Populates copyRect, as well as Rings image and imageArea. Translates and scales any existing rings as if they existed on the original bitmap.</span></div>
<div class="line"><a name="l00970"></a><span class="lineno">  970</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00971"></a><span class="lineno">  971</span>&#160;<span class="comment">        /// &lt;param name=&quot;s&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00972"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a0649c6799567d75a2f0c46d3cd0f6196">  972</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_image_builder.html#a0649c6799567d75a2f0c46d3cd0f6196">LayoutImage</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s) {</div>
<div class="line"><a name="l00973"></a><span class="lineno">  973</span>&#160;            <span class="keywordflow">if</span> (base.LayoutImage(s) == RequestedAction.Cancel) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.Cancel; <span class="comment">//Call extensions</span></div>
<div class="line"><a name="l00974"></a><span class="lineno">  974</span>&#160;</div>
<div class="line"><a name="l00975"></a><span class="lineno">  975</span>&#160;            if (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a22528462bb2ca64173878ef4441bad28">copyRect</a>.IsEmpty) {</div>
<div class="line"><a name="l00976"></a><span class="lineno">  976</span>&#160;                <span class="comment">//Use the crop size if present.</span></div>
<div class="line"><a name="l00977"></a><span class="lineno">  977</span>&#160;                s.copyRect = <span class="keyword">new</span> RectangleF(<span class="keyword">new</span> PointF(0, 0), s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a72e11433b4c36caccab68577e864202c">originalSize</a>);</div>
<div class="line"><a name="l00978"></a><span class="lineno">  978</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="class_image_resizer_1_1_extension_methods_1_1_name_value_collection_extensions.html">NameValueCollectionExtensions</a>.GetList&lt;<span class="keywordtype">double</span>&gt;(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>, <span class="stringliteral">&quot;crop&quot;</span>, 0, 4) != null) {</div>
<div class="line"><a name="l00979"></a><span class="lineno">  979</span>&#160;                    s.copyRect = PolygonMath.ToRectangle(s.settings.getCustomCropSourceRect(s.originalSize)); <span class="comment">//Round the custom crop rectangle coordinates</span></div>
<div class="line"><a name="l00980"></a><span class="lineno">  980</span>&#160;                    <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a22528462bb2ca64173878ef4441bad28">copyRect</a>.Size.IsEmpty) <span class="keywordflow">throw</span> <span class="keyword">new</span> Exception(<span class="stringliteral">&quot;You must specify a custom crop rectange if crop=custom&quot;</span>);</div>
<div class="line"><a name="l00981"></a><span class="lineno">  981</span>&#160;                }</div>
<div class="line"><a name="l00982"></a><span class="lineno">  982</span>&#160;            }</div>
<div class="line"><a name="l00983"></a><span class="lineno">  983</span>&#160;            <span class="comment">//Save the manual crop size.</span></div>
<div class="line"><a name="l00984"></a><span class="lineno">  984</span>&#160;            SizeF manualCropSize = s.copySize;</div>
<div class="line"><a name="l00985"></a><span class="lineno">  985</span>&#160;            RectangleF manualCropRect = s.copyRect;</div>
<div class="line"><a name="l00986"></a><span class="lineno">  986</span>&#160;</div>
<div class="line"><a name="l00987"></a><span class="lineno">  987</span>&#160;            <a class="code" href="namespace_image_resizer.html#affd730f8b2250fecace497124be5a37d">FitMode</a> fit = s.settings.Mode;</div>
<div class="line"><a name="l00988"></a><span class="lineno">  988</span>&#160;            <span class="comment">//Determine fit mode to use if both vertical and horizontal limits are used.</span></div>
<div class="line"><a name="l00989"></a><span class="lineno">  989</span>&#160;            <span class="keywordflow">if</span> (fit == <a class="code" href="namespace_image_resizer.html#affd730f8b2250fecace497124be5a37d">FitMode</a>.None){</div>
<div class="line"><a name="l00990"></a><span class="lineno">  990</span>&#160;                <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a80001d573cec108c39e5376f6d854993">Width</a> != -1 || s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a7145aef3affc3244969cad8841359e3f">Height</a> != -1){</div>
<div class="line"><a name="l00991"></a><span class="lineno">  991</span>&#160;</div>
<div class="line"><a name="l00992"></a><span class="lineno">  992</span>&#160;                    <span class="keywordflow">if</span> (<span class="stringliteral">&quot;fill&quot;</span>.Equals(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>[<span class="stringliteral">&quot;stretch&quot;</span>], StringComparison.OrdinalIgnoreCase)) fit = FitMode.Stretch;</div>
<div class="line"><a name="l00993"></a><span class="lineno">  993</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (<span class="stringliteral">&quot;auto&quot;</span>.Equals(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>[<span class="stringliteral">&quot;crop&quot;</span>], StringComparison.OrdinalIgnoreCase)) fit = FitMode.Crop;</div>
<div class="line"><a name="l00994"></a><span class="lineno">  994</span>&#160;                    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (!<span class="keywordtype">string</span>.IsNullOrEmpty(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>[<span class="stringliteral">&quot;carve&quot;</span>]) </div>
<div class="line"><a name="l00995"></a><span class="lineno">  995</span>&#160;                        &amp;&amp; !<span class="stringliteral">&quot;false&quot;</span>.Equals(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>[<span class="stringliteral">&quot;carve&quot;</span>], StringComparison.OrdinalIgnoreCase)</div>
<div class="line"><a name="l00996"></a><span class="lineno">  996</span>&#160;                        &amp;&amp; !<span class="stringliteral">&quot;none&quot;</span>.Equals(s.settings[<span class="stringliteral">&quot;carve&quot;</span>], StringComparison.OrdinalIgnoreCase)) fit = FitMode.Carve;</div>
<div class="line"><a name="l00997"></a><span class="lineno">  997</span>&#160;                    <span class="keywordflow">else</span> fit = FitMode.Pad;</div>
<div class="line"><a name="l00998"></a><span class="lineno">  998</span>&#160;                }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l00999"></a><span class="lineno">  999</span>&#160;                    fit = FitMode.Max;</div>
<div class="line"><a name="l01000"></a><span class="lineno"> 1000</span>&#160;                }</div>
<div class="line"><a name="l01001"></a><span class="lineno"> 1001</span>&#160;</div>
<div class="line"><a name="l01002"></a><span class="lineno"> 1002</span>&#160;            }</div>
<div class="line"><a name="l01003"></a><span class="lineno"> 1003</span>&#160;            </div>
<div class="line"><a name="l01004"></a><span class="lineno"> 1004</span>&#160;</div>
<div class="line"><a name="l01005"></a><span class="lineno"> 1005</span>&#160;</div>
<div class="line"><a name="l01006"></a><span class="lineno"> 1006</span>&#160;</div>
<div class="line"><a name="l01007"></a><span class="lineno"> 1007</span>&#160;            <span class="comment">//Aspect ratio of the image</span></div>
<div class="line"><a name="l01008"></a><span class="lineno"> 1008</span>&#160;            <span class="keywordtype">double</span> imageRatio = s.copySize.Width / s.copySize.Height;</div>
<div class="line"><a name="l01009"></a><span class="lineno"> 1009</span>&#160;</div>
<div class="line"><a name="l01010"></a><span class="lineno"> 1010</span>&#160;            <span class="comment">//Zoom factor</span></div>
<div class="line"><a name="l01011"></a><span class="lineno"> 1011</span>&#160;            <span class="keywordtype">double</span> zoom = s.settings.Get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;zoom&quot;</span>, 1);</div>
<div class="line"><a name="l01012"></a><span class="lineno"> 1012</span>&#160;</div>
<div class="line"><a name="l01013"></a><span class="lineno"> 1013</span>&#160;            <span class="comment">//The target size for the image </span></div>
<div class="line"><a name="l01014"></a><span class="lineno"> 1014</span>&#160;            SizeF targetSize = <span class="keyword">new</span> SizeF(-1, -1);</div>
<div class="line"><a name="l01015"></a><span class="lineno"> 1015</span>&#160;            <span class="comment">//Target area for the image</span></div>
<div class="line"><a name="l01016"></a><span class="lineno"> 1016</span>&#160;            SizeF areaSize = <span class="keyword">new</span> SizeF(-1, -1);</div>
<div class="line"><a name="l01017"></a><span class="lineno"> 1017</span>&#160;            <span class="comment">//If any dimensions are specified, calculate. Otherwise, use original image dimensions</span></div>
<div class="line"><a name="l01018"></a><span class="lineno"> 1018</span>&#160;            <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a80001d573cec108c39e5376f6d854993">Width</a> != -1 || s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a7145aef3affc3244969cad8841359e3f">Height</a> != -1 || s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a16d3547dfb87d598876fb64e54c0a938">MaxHeight</a> != -1 || s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a80fd5f97f3264009aa2c2648bb1379d7">MaxWidth</a> != -1) {</div>
<div class="line"><a name="l01019"></a><span class="lineno"> 1019</span>&#160;                <span class="comment">//A dimension was specified. </span></div>
<div class="line"><a name="l01020"></a><span class="lineno"> 1020</span>&#160;                <span class="comment">//We first calculate the largest size the image can be under the width/height/maxwidth/maxheight restrictions.</span></div>
<div class="line"><a name="l01021"></a><span class="lineno"> 1021</span>&#160;                <span class="comment">//- pretending stretch=fill and scale=both</span></div>
<div class="line"><a name="l01022"></a><span class="lineno"> 1022</span>&#160;</div>
<div class="line"><a name="l01023"></a><span class="lineno"> 1023</span>&#160;                <span class="comment">//Temp vars - results stored in targetSize and areaSize</span></div>
<div class="line"><a name="l01024"></a><span class="lineno"> 1024</span>&#160;                <span class="keywordtype">double</span> width = s.settings.Width;</div>
<div class="line"><a name="l01025"></a><span class="lineno"> 1025</span>&#160;                <span class="keywordtype">double</span> height = s.settings.Height;</div>
<div class="line"><a name="l01026"></a><span class="lineno"> 1026</span>&#160;                <span class="keywordtype">double</span> maxwidth = s.settings.MaxWidth;</div>
<div class="line"><a name="l01027"></a><span class="lineno"> 1027</span>&#160;                <span class="keywordtype">double</span> maxheight = s.settings.MaxHeight;</div>
<div class="line"><a name="l01028"></a><span class="lineno"> 1028</span>&#160;</div>
<div class="line"><a name="l01029"></a><span class="lineno"> 1029</span>&#160;                <span class="comment">//Eliminate cases where both a value and a max value are specified: use the smaller value for the width/height </span></div>
<div class="line"><a name="l01030"></a><span class="lineno"> 1030</span>&#160;                <span class="keywordflow">if</span> (maxwidth &gt; 0 &amp;&amp; width &gt; 0) {   width = Math.Min(maxwidth, width);    maxwidth = -1;  }</div>
<div class="line"><a name="l01031"></a><span class="lineno"> 1031</span>&#160;                <span class="keywordflow">if</span> (maxheight &gt; 0 &amp;&amp; height &gt; 0) { height = Math.Min(maxheight, height); maxheight = -1; }</div>
<div class="line"><a name="l01032"></a><span class="lineno"> 1032</span>&#160;</div>
<div class="line"><a name="l01033"></a><span class="lineno"> 1033</span>&#160;                <span class="comment">//Handle cases of width/maxheight and height/maxwidth as in legacy versions. </span></div>
<div class="line"><a name="l01034"></a><span class="lineno"> 1034</span>&#160;                <span class="keywordflow">if</span> (width != -1 &amp;&amp; maxheight != -1) maxheight = Math.Min(maxheight, (width / imageRatio));</div>
<div class="line"><a name="l01035"></a><span class="lineno"> 1035</span>&#160;                <span class="keywordflow">if</span> (height != -1 &amp;&amp; maxwidth != -1) maxwidth = Math.Min(maxwidth, (height * imageRatio));</div>
<div class="line"><a name="l01036"></a><span class="lineno"> 1036</span>&#160;</div>
<div class="line"><a name="l01037"></a><span class="lineno"> 1037</span>&#160;</div>
<div class="line"><a name="l01038"></a><span class="lineno"> 1038</span>&#160;                <span class="comment">//Move max values to width/height. FitMode should already reflect the mode we are using, and we&#39;ve already resolved mixed modes above.</span></div>
<div class="line"><a name="l01039"></a><span class="lineno"> 1039</span>&#160;                width = Math.Max(width, maxwidth);</div>
<div class="line"><a name="l01040"></a><span class="lineno"> 1040</span>&#160;                height = Math.Max(height, maxheight);</div>
<div class="line"><a name="l01041"></a><span class="lineno"> 1041</span>&#160;</div>
<div class="line"><a name="l01042"></a><span class="lineno"> 1042</span>&#160;                <span class="comment">//Calculate missing value (a missing value is handled the same everywhere). </span></div>
<div class="line"><a name="l01043"></a><span class="lineno"> 1043</span>&#160;                <span class="keywordflow">if</span> (width &gt; 0 &amp;&amp; height &lt;= 0) height = width/ imageRatio;</div>
<div class="line"><a name="l01044"></a><span class="lineno"> 1044</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (height &gt; 0 &amp;&amp; width &lt;= 0) width = height * imageRatio;</div>
<div class="line"><a name="l01045"></a><span class="lineno"> 1045</span>&#160;</div>
<div class="line"><a name="l01046"></a><span class="lineno"> 1046</span>&#160;                <span class="comment">//We now have width &amp; height, our target size. It will only be a different aspect ratio from the image if both &#39;width&#39; and &#39;height&#39; are specified.</span></div>
<div class="line"><a name="l01047"></a><span class="lineno"> 1047</span>&#160;</div>
<div class="line"><a name="l01048"></a><span class="lineno"> 1048</span>&#160;                <span class="comment">//FitMode.Max</span></div>
<div class="line"><a name="l01049"></a><span class="lineno"> 1049</span>&#160;                <span class="keywordflow">if</span> (fit == <a class="code" href="namespace_image_resizer.html#affd730f8b2250fecace497124be5a37d">FitMode</a>.Max) {</div>
<div class="line"><a name="l01050"></a><span class="lineno"> 1050</span>&#160;                    areaSize = targetSize = PolygonMath.ScaleInside(manualCropSize, <span class="keyword">new</span> SizeF((<span class="keywordtype">float</span>)width, (<span class="keywordtype">float</span>)height));</div>
<div class="line"><a name="l01051"></a><span class="lineno"> 1051</span>&#160;                <span class="comment">//FitMode.Pad</span></div>
<div class="line"><a name="l01052"></a><span class="lineno"> 1052</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fit == <a class="code" href="namespace_image_resizer.html#affd730f8b2250fecace497124be5a37d">FitMode</a>.Pad) {</div>
<div class="line"><a name="l01053"></a><span class="lineno"> 1053</span>&#160;                    areaSize = <span class="keyword">new</span> SizeF((<span class="keywordtype">float</span>)width, (<span class="keywordtype">float</span>)height);</div>
<div class="line"><a name="l01054"></a><span class="lineno"> 1054</span>&#160;                    targetSize = PolygonMath.ScaleInside(manualCropSize, areaSize);</div>
<div class="line"><a name="l01055"></a><span class="lineno"> 1055</span>&#160;                <span class="comment">//FitMode.crop</span></div>
<div class="line"><a name="l01056"></a><span class="lineno"> 1056</span>&#160;                } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (fit == <a class="code" href="namespace_image_resizer.html#affd730f8b2250fecace497124be5a37d">FitMode</a>.Crop) {</div>
<div class="line"><a name="l01057"></a><span class="lineno"> 1057</span>&#160;                    <span class="comment">//We autocrop - so both target and area match the requested size</span></div>
<div class="line"><a name="l01058"></a><span class="lineno"> 1058</span>&#160;                    areaSize = targetSize = <span class="keyword">new</span> SizeF((<span class="keywordtype">float</span>)width, (<span class="keywordtype">float</span>)height);</div>
<div class="line"><a name="l01059"></a><span class="lineno"> 1059</span>&#160;                    <span class="comment">//Determine the size of the area we are copying</span></div>
<div class="line"><a name="l01060"></a><span class="lineno"> 1060</span>&#160;                    Size sourceSize = PolygonMath.RoundPoints(PolygonMath.ScaleInside(areaSize, manualCropSize)); </div>
<div class="line"><a name="l01061"></a><span class="lineno"> 1061</span>&#160;                    <span class="comment">//Center the portion we are copying within the manualCropSize</span></div>
<div class="line"><a name="l01062"></a><span class="lineno"> 1062</span>&#160;                    s.copyRect = PolygonMath.ToRectangle(PolygonMath.AlignWith(<span class="keyword">new</span> RectangleF(0, 0, sourceSize.Width, sourceSize.Height), s.copyRect, s.settings.Anchor));</div>
<div class="line"><a name="l01063"></a><span class="lineno"> 1063</span>&#160;</div>
<div class="line"><a name="l01064"></a><span class="lineno"> 1064</span>&#160;                } <span class="keywordflow">else</span> { <span class="comment">//Stretch and carve both act like stretching, so do that:</span></div>
<div class="line"><a name="l01065"></a><span class="lineno"> 1065</span>&#160;                    areaSize = targetSize = <span class="keyword">new</span> SizeF((<span class="keywordtype">float</span>)width, (<span class="keywordtype">float</span>)height);</div>
<div class="line"><a name="l01066"></a><span class="lineno"> 1066</span>&#160;                }</div>
<div class="line"><a name="l01067"></a><span class="lineno"> 1067</span>&#160;</div>
<div class="line"><a name="l01068"></a><span class="lineno"> 1068</span>&#160;</div>
<div class="line"><a name="l01069"></a><span class="lineno"> 1069</span>&#160;            }<span class="keywordflow">else</span>{</div>
<div class="line"><a name="l01070"></a><span class="lineno"> 1070</span>&#160;                <span class="comment">//No dimensions specified, no fit mode needed. Use manual crop dimensions</span></div>
<div class="line"><a name="l01071"></a><span class="lineno"> 1071</span>&#160;                areaSize = targetSize = manualCropSize; </div>
<div class="line"><a name="l01072"></a><span class="lineno"> 1072</span>&#160;            }</div>
<div class="line"><a name="l01073"></a><span class="lineno"> 1073</span>&#160;</div>
<div class="line"><a name="l01074"></a><span class="lineno"> 1074</span>&#160;            <span class="comment">//Multiply both areaSize and targetSize by zoom. </span></div>
<div class="line"><a name="l01075"></a><span class="lineno"> 1075</span>&#160;            areaSize.Width *= (float)zoom;</div>
<div class="line"><a name="l01076"></a><span class="lineno"> 1076</span>&#160;            areaSize.Height *= (float)zoom;</div>
<div class="line"><a name="l01077"></a><span class="lineno"> 1077</span>&#160;            targetSize.Width *= (float)zoom;</div>
<div class="line"><a name="l01078"></a><span class="lineno"> 1078</span>&#160;            targetSize.Height *= (float)zoom;</div>
<div class="line"><a name="l01079"></a><span class="lineno"> 1079</span>&#160;            </div>
<div class="line"><a name="l01080"></a><span class="lineno"> 1080</span>&#160;            <span class="comment">//Todo: automatic crop is permitted to break the scaling rules. Fix!!</span></div>
<div class="line"><a name="l01081"></a><span class="lineno"> 1081</span>&#160;</div>
<div class="line"><a name="l01082"></a><span class="lineno"> 1082</span>&#160;            <span class="comment">//Now do upscale/downscale checks. If they take effect, set targetSize to imageSize</span></div>
<div class="line"><a name="l01083"></a><span class="lineno"> 1083</span>&#160;            <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae7fc16e795fb8ebf6423f3df628dc404">Scale</a> == <a class="code" href="namespace_image_resizer.html#aca52f6f1e90c78a5e5e79c6d709a571c">ScaleMode</a>.DownscaleOnly) {</div>
<div class="line"><a name="l01084"></a><span class="lineno"> 1084</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a98c83ada594ba88b34d97d26176f8ada">FitsInside</a>(manualCropSize, targetSize)) {</div>
<div class="line"><a name="l01085"></a><span class="lineno"> 1085</span>&#160;                    <span class="comment">//The image is smaller or equal to its target polygon. Use original image coordinates instead.</span></div>
<div class="line"><a name="l01086"></a><span class="lineno"> 1086</span>&#160;                    areaSize = targetSize = manualCropSize;</div>
<div class="line"><a name="l01087"></a><span class="lineno"> 1087</span>&#160;                    s.copyRect = manualCropRect;</div>
<div class="line"><a name="l01088"></a><span class="lineno"> 1088</span>&#160;                }</div>
<div class="line"><a name="l01089"></a><span class="lineno"> 1089</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae7fc16e795fb8ebf6423f3df628dc404">Scale</a> == <a class="code" href="namespace_image_resizer.html#aca52f6f1e90c78a5e5e79c6d709a571c">ScaleMode</a>.UpscaleOnly) {</div>
<div class="line"><a name="l01090"></a><span class="lineno"> 1090</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a98c83ada594ba88b34d97d26176f8ada">FitsInside</a>(manualCropSize, targetSize)) {</div>
<div class="line"><a name="l01091"></a><span class="lineno"> 1091</span>&#160;                    <span class="comment">//The image is larger than its target. Use original image coordintes instead</span></div>
<div class="line"><a name="l01092"></a><span class="lineno"> 1092</span>&#160;                    areaSize = targetSize = manualCropSize;</div>
<div class="line"><a name="l01093"></a><span class="lineno"> 1093</span>&#160;                    s.copyRect = manualCropRect;</div>
<div class="line"><a name="l01094"></a><span class="lineno"> 1094</span>&#160;                }</div>
<div class="line"><a name="l01095"></a><span class="lineno"> 1095</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae7fc16e795fb8ebf6423f3df628dc404">Scale</a> == <a class="code" href="namespace_image_resizer.html#aca52f6f1e90c78a5e5e79c6d709a571c">ScaleMode</a>.UpscaleCanvas) {</div>
<div class="line"><a name="l01096"></a><span class="lineno"> 1096</span>&#160;                <span class="comment">//Same as downscaleonly, except areaSize isn&#39;t changed.</span></div>
<div class="line"><a name="l01097"></a><span class="lineno"> 1097</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a98c83ada594ba88b34d97d26176f8ada">FitsInside</a>(manualCropSize, targetSize)) {</div>
<div class="line"><a name="l01098"></a><span class="lineno"> 1098</span>&#160;                    <span class="comment">//The image is smaller or equal to its target polygon. </span></div>
<div class="line"><a name="l01099"></a><span class="lineno"> 1099</span>&#160;                    </div>
<div class="line"><a name="l01100"></a><span class="lineno"> 1100</span>&#160;                    <span class="comment">//Use manual copy rect/size instead.</span></div>
<div class="line"><a name="l01101"></a><span class="lineno"> 1101</span>&#160;</div>
<div class="line"><a name="l01102"></a><span class="lineno"> 1102</span>&#160;                    targetSize = manualCropSize;</div>
<div class="line"><a name="l01103"></a><span class="lineno"> 1103</span>&#160;                    s.copyRect = manualCropRect;</div>
<div class="line"><a name="l01104"></a><span class="lineno"> 1104</span>&#160;                }</div>
<div class="line"><a name="l01105"></a><span class="lineno"> 1105</span>&#160;            }</div>
<div class="line"><a name="l01106"></a><span class="lineno"> 1106</span>&#160;</div>
<div class="line"><a name="l01107"></a><span class="lineno"> 1107</span>&#160;</div>
<div class="line"><a name="l01108"></a><span class="lineno"> 1108</span>&#160;            <span class="comment">//May 12: require max dimension and round values to minimize rounding differences later.</span></div>
<div class="line"><a name="l01109"></a><span class="lineno"> 1109</span>&#160;            areaSize.Width = Math.Max(1, (float)Math.Round(areaSize.Width));</div>
<div class="line"><a name="l01110"></a><span class="lineno"> 1110</span>&#160;            areaSize.Height = Math.Max(1, (float)Math.Round(areaSize.Height));</div>
<div class="line"><a name="l01111"></a><span class="lineno"> 1111</span>&#160;            targetSize.Width = Math.Max(1, (float)Math.Round(targetSize.Width));</div>
<div class="line"><a name="l01112"></a><span class="lineno"> 1112</span>&#160;            targetSize.Height = Math.Max(1, (float)Math.Round(targetSize.Height));</div>
<div class="line"><a name="l01113"></a><span class="lineno"> 1113</span>&#160;            </div>
<div class="line"><a name="l01114"></a><span class="lineno"> 1114</span>&#160;</div>
<div class="line"><a name="l01115"></a><span class="lineno"> 1115</span>&#160;            <span class="comment">//Translate and scale all existing rings</span></div>
<div class="line"><a name="l01116"></a><span class="lineno"> 1116</span>&#160;            s.layout.Shift(s.copyRect, <span class="keyword">new</span> RectangleF(<span class="keyword">new</span> Point(0, 0), targetSize));</div>
<div class="line"><a name="l01117"></a><span class="lineno"> 1117</span>&#160;</div>
<div class="line"><a name="l01118"></a><span class="lineno"> 1118</span>&#160;            s.layout.AddRing(<span class="stringliteral">&quot;image&quot;</span>, PolygonMath.ToPoly(<span class="keyword">new</span> RectangleF(<span class="keyword">new</span> PointF(0, 0), targetSize)));</div>
<div class="line"><a name="l01119"></a><span class="lineno"> 1119</span>&#160;</div>
<div class="line"><a name="l01120"></a><span class="lineno"> 1120</span>&#160;            s.layout.AddRing(<span class="stringliteral">&quot;imageArea&quot;</span>,PolygonMath.ToPoly(<span class="keyword">new</span> RectangleF(<span class="keyword">new</span> PointF(0, 0), areaSize)));</div>
<div class="line"><a name="l01121"></a><span class="lineno"> 1121</span>&#160;</div>
<div class="line"><a name="l01122"></a><span class="lineno"> 1122</span>&#160;            <span class="comment">//Center imageArea around &#39;image&#39;</span></div>
<div class="line"><a name="l01123"></a><span class="lineno"> 1123</span>&#160;            s.layout[<span class="stringliteral">&quot;imageArea&quot;</span>] = PolygonMath.AlignWith(s.layout[<span class="stringliteral">&quot;imageArea&quot;</span>], s.layout[<span class="stringliteral">&quot;image&quot;</span>], s.settings.Anchor);</div>
<div class="line"><a name="l01124"></a><span class="lineno"> 1124</span>&#160;</div>
<div class="line"><a name="l01125"></a><span class="lineno"> 1125</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l01126"></a><span class="lineno"> 1126</span>&#160;        }</div>
<div class="line"><a name="l01127"></a><span class="lineno"> 1127</span>&#160;</div>
<div class="line"><a name="l01128"></a><span class="lineno"> 1128</span>&#160;</div>
<div class="line"><a name="l01129"></a><span class="lineno"> 1129</span>&#160;</div>
<div class="line"><a name="l01130"></a><span class="lineno"> 1130</span>&#160;        <span class="keyword">private</span> readonly <span class="keywordtype">string</span>[] _supportedFileExtensions = <span class="keyword">new</span> <span class="keywordtype">string</span>[]</div>
<div class="line"><a name="l01131"></a><span class="lineno"> 1131</span>&#160;             {<span class="stringliteral">&quot;bmp&quot;</span>,<span class="stringliteral">&quot;gif&quot;</span>,<span class="stringliteral">&quot;exif&quot;</span>,<span class="stringliteral">&quot;png&quot;</span>,<span class="stringliteral">&quot;tif&quot;</span>,<span class="stringliteral">&quot;tiff&quot;</span>,<span class="stringliteral">&quot;tff&quot;</span>,<span class="stringliteral">&quot;jpg&quot;</span>,<span class="stringliteral">&quot;jpeg&quot;</span>, <span class="stringliteral">&quot;jpe&quot;</span>,<span class="stringliteral">&quot;jif&quot;</span>,<span class="stringliteral">&quot;jfif&quot;</span>,<span class="stringliteral">&quot;jfi&quot;</span>};</div>
<div class="line"><a name="l01132"></a><span class="lineno"> 1132</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01133"></a><span class="lineno"> 1133</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l01134"></a><span class="lineno"> 1134</span>&#160;<span class="comment">        /// Returns a list of the file extensions ImageBuilder can load by default. Plugins can implement IFileExtensionPlugin to add new ones.</span></div>
<div class="line"><a name="l01135"></a><span class="lineno"> 1135</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l01136"></a><span class="lineno"> 1136</span>&#160;<span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span></div>
<div class="line"><a name="l01137"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a303922cae5567e1e58462695000ec705"> 1137</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> IEnumerable&lt;string&gt; <a class="code" href="class_image_resizer_1_1_image_builder.html#a303922cae5567e1e58462695000ec705">GetSupportedFileExtensions</a>() {</div>
<div class="line"><a name="l01138"></a><span class="lineno"> 1138</span>&#160;            <span class="keywordflow">return</span> _supportedFileExtensions;</div>
<div class="line"><a name="l01139"></a><span class="lineno"> 1139</span>&#160;        }</div>
<div class="line"><a name="l01140"></a><span class="lineno"> 1140</span>&#160;       </div>
<div class="line"><a name="l01141"></a><span class="lineno"> 1141</span>&#160;        <span class="keyword">private</span> readonly <span class="keywordtype">string</span>[] _supportedQuerystringKeys = <span class="keyword">new</span> <span class="keywordtype">string</span>[]{</div>
<div class="line"><a name="l01142"></a><span class="lineno"> 1142</span>&#160;                    <span class="stringliteral">&quot;format&quot;</span>, <span class="stringliteral">&quot;thumbnail&quot;</span>, <span class="stringliteral">&quot;maxwidth&quot;</span>, <span class="stringliteral">&quot;maxheight&quot;</span>,</div>
<div class="line"><a name="l01143"></a><span class="lineno"> 1143</span>&#160;                <span class="stringliteral">&quot;width&quot;</span>, <span class="stringliteral">&quot;height&quot;</span>,<span class="stringliteral">&quot;w&quot;</span>,<span class="stringliteral">&quot;h&quot;</span>,</div>
<div class="line"><a name="l01144"></a><span class="lineno"> 1144</span>&#160;                <span class="stringliteral">&quot;scale&quot;</span>, <span class="stringliteral">&quot;stretch&quot;</span>, <span class="stringliteral">&quot;crop&quot;</span>, <span class="stringliteral">&quot;cropxunits&quot;</span>, <span class="stringliteral">&quot;cropyunits&quot;</span>, <span class="stringliteral">&quot;page&quot;</span>, <span class="stringliteral">&quot;bgcolor&quot;</span>,</div>
<div class="line"><a name="l01145"></a><span class="lineno"> 1145</span>&#160;                <span class="stringliteral">&quot;rotate&quot;</span>, <span class="stringliteral">&quot;flip&quot;</span>, <span class="stringliteral">&quot;sourceFlip&quot;</span>, <span class="stringliteral">&quot;sFlip&quot;</span>, <span class="stringliteral">&quot;sRotate&quot;</span>, <span class="stringliteral">&quot;borderWidth&quot;</span>,</div>
<div class="line"><a name="l01146"></a><span class="lineno"> 1146</span>&#160;                <span class="stringliteral">&quot;borderColor&quot;</span>, <span class="stringliteral">&quot;paddingWidth&quot;</span>, <span class="stringliteral">&quot;paddingColor&quot;</span>,</div>
<div class="line"><a name="l01147"></a><span class="lineno"> 1147</span>&#160;                <span class="stringliteral">&quot;ignoreicc&quot;</span>, <span class="stringliteral">&quot;frame&quot;</span>, <span class="stringliteral">&quot;useresizingpipeline&quot;</span>, </div>
<div class="line"><a name="l01148"></a><span class="lineno"> 1148</span>&#160;                <span class="stringliteral">&quot;cache&quot;</span>, <span class="stringliteral">&quot;process&quot;</span>, <span class="stringliteral">&quot;margin&quot;</span>, <span class="stringliteral">&quot;anchor&quot;</span>,<span class="stringliteral">&quot;dpi&quot;</span>,<span class="stringliteral">&quot;mode&quot;</span>, <span class="stringliteral">&quot;zoom&quot;</span>};</div>
<div class="line"><a name="l01149"></a><span class="lineno"> 1149</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l01150"></a><span class="lineno"> 1150</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l01151"></a><span class="lineno"> 1151</span>&#160;<span class="comment">        /// Returns a list of the querystring commands ImageBuilder can parse by default. Plugins can implement IQuerystringPlugin to add new ones.</span></div>
<div class="line"><a name="l01152"></a><span class="lineno"> 1152</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l01153"></a><span class="lineno"> 1153</span>&#160;<span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span></div>
<div class="line"><a name="l01154"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_image_builder.html#a4d055522b14dc97d8edf5eb8ec3a1296"> 1154</a></span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">virtual</span> IEnumerable&lt;string&gt; <a class="code" href="class_image_resizer_1_1_image_builder.html#a4d055522b14dc97d8edf5eb8ec3a1296">GetSupportedQuerystringKeys</a>() {</div>
<div class="line"><a name="l01155"></a><span class="lineno"> 1155</span>&#160;            <span class="keywordflow">return</span> _supportedQuerystringKeys;</div>
<div class="line"><a name="l01156"></a><span class="lineno"> 1156</span>&#160;        }</div>
<div class="line"><a name="l01157"></a><span class="lineno"> 1157</span>&#160;    }</div>
<div class="line"><a name="l01158"></a><span class="lineno"> 1158</span>&#160;}</div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_ad3c0e9b89c62b5a6896b062d30db2641"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#ad3c0e9b89c62b5a6896b062d30db2641">ImageResizer.ImageBuilder.Render</a></div><div class="ttdeci">override RequestedAction Render(ImageState s)</div><div class="ttdoc">Handles the rendering phase of processing </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00601">ImageBuilder.cs:601</a></div></div>
<div class="ttc" id="namespace_image_resizer_1_1_resizing_html_a22bbb53580a122efe469a26ad584fa86"><div class="ttname"><a href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">ImageResizer.Resizing.RequestedAction</a></div><div class="ttdeci">RequestedAction</div><div class="ttdoc">What to do about remaining handlers/methods for the specified section </div><div class="ttdef"><b>Definition:</b> <a href="_abstract_image_processor_8cs_source.html#l00013">AbstractImageProcessor.cs:13</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a23d0a1c7686627fc160d5f0173f14cf5"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a23d0a1c7686627fc160d5f0173f14cf5">ImageResizer.ImageBuilder.Build</a></div><div class="ttdeci">virtual void Build(object source, object dest, ResizeSettings settings)</div><div class="ttdoc">Resizes and processes the specified source image and stores the encoded result in the specified desti...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00347">ImageBuilder.cs:347</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a0d9f4fd12809ec0cc17bbb2fb33a7309"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a0d9f4fd12809ec0cc17bbb2fb33a7309">ImageResizer.ImageBuilder.RenderImage</a></div><div class="ttdeci">override RequestedAction RenderImage(ImageState s)</div><div class="ttdoc">Process.5(Render).10: The image is copied to the destination parallelogram specified by ring &amp;#39;image&amp;#39;...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00835">ImageBuilder.cs:835</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_util_1_1_polygon_math_html_a091c43453f558cb12f8f4f4e485a711d"><div class="ttname"><a href="class_image_resizer_1_1_util_1_1_polygon_math.html#a091c43453f558cb12f8f4f4e485a711d">ImageResizer.Util.PolygonMath.ArraysEqual</a></div><div class="ttdeci">static Boolean ArraysEqual(PointF[] a1, PointF[] a2)</div><div class="ttdoc">Returns true if the member elements of the specified arrays match, and the arrays are of the same len...</div><div class="ttdef"><b>Definition:</b> <a href="_polygon_math_8cs_source.html#l00275">PolygonMath.cs:275</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_job_html_ab835a4dde8a2962bbe48182641316cee"><div class="ttname"><a href="class_image_resizer_1_1_image_job.html#ab835a4dde8a2962bbe48182641316cee">ImageResizer.ImageJob.Settings</a></div><div class="ttdeci">ResizeSettings Settings</div><div class="ttdoc">The image processing settings </div><div class="ttdef"><b>Definition:</b> <a href="_image_job_8cs_source.html#l00136">ImageJob.cs:136</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html_a80fd5f97f3264009aa2c2648bb1379d7"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html#a80fd5f97f3264009aa2c2648bb1379d7">ImageResizer.ResizeSettings.MaxWidth</a></div><div class="ttdeci">int MaxWidth</div><div class="ttdoc">[&amp;quot;maxwidth&amp;quot;]: Sets the maximum desired width of the image. (minus padding, borders, margins, effects, and rotation). The image may be smaller than this value to maintain aspect ratio when both maxwidth and maxheight are specified. </div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00089">ResizeSettings.cs:89</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_corrupted_exception_html"><div class="ttname"><a href="class_image_resizer_1_1_image_corrupted_exception.html">ImageResizer.ImageCorruptedException</a></div><div class="ttdoc">A source file was corrupted </div><div class="ttdef"><b>Definition:</b> <a href="_image_processing_exception_8cs_source.html#l00045">ImageProcessingException.cs:45</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a1528f6e7863248a4dd0d2d3c2d140261"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a1528f6e7863248a4dd0d2d3c2d140261">ImageResizer.ImageBuilder.Build</a></div><div class="ttdeci">virtual void Build(object source, object dest, ResizeSettings settings, bool disposeSource)</div><div class="ttdoc">Resizes and processes the specified source image and stores the encoded result in the specified desti...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00373">ImageBuilder.cs:373</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_layout_builder_html_a25cec5c2a949a13ac66102e713d07db4"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_layout_builder.html#a25cec5c2a949a13ac66102e713d07db4">ImageResizer.Resizing.LayoutBuilder.LastRing</a></div><div class="ttdeci">PointSet LastRing</div><div class="ttdoc">Returns the last ring that was added. Only returns PointSets where flags = Ring </div><div class="ttdef"><b>Definition:</b> <a href="_layout_builder_8cs_source.html#l00078">LayoutBuilder.cs:78</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html_af0a73e8db4a3e4e40f0564d0dca29833"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html#af0a73e8db4a3e4e40f0564d0dca29833">ImageResizer.ResizeSettings.Rotate</a></div><div class="ttdeci">double Rotate</div><div class="ttdoc">[&amp;quot;rotate&amp;quot;] The degress to rotate the image clockwise. -360 to 360. </div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00138">ResizeSettings.cs:138</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_image_state_html_a14723e4f7de63667e37fcbdb6a00055b"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b">ImageResizer.Resizing.ImageState.destGraphics</a></div><div class="ttdeci">Graphics destGraphics</div><div class="ttdoc">A graphics object to write to the destination bitmap. If null, skip drawing commands, but continue layout logic. </div><div class="ttdef"><b>Definition:</b> <a href="_image_state_8cs_source.html#l00182">ImageState.cs:182</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_abstract_image_processor_html"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_abstract_image_processor.html">ImageResizer.Resizing.AbstractImageProcessor</a></div><div class="ttdoc">Not for external use. Inherit from BuilderExtension instead. Dual-purpose base class for both ImageBu...</div><div class="ttdef"><b>Definition:</b> <a href="_abstract_image_processor_8cs_source.html#l00031">AbstractImageProcessor.cs:31</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_plugins_1_1_i_virtual_file_html"><div class="ttname"><a href="interface_image_resizer_1_1_plugins_1_1_i_virtual_file.html">ImageResizer.Plugins.IVirtualFile</a></div><div class="ttdoc">A virtual file to support IVirtualImageProvider </div><div class="ttdef"><b>Definition:</b> <a href="_i_virtual_file_8cs_source.html#l00010">IVirtualFile.cs:10</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html_aecaac2b7c431f38d796545950119abeb"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html#aecaac2b7c431f38d796545950119abeb">ImageResizer.ResizeSettings.PaddingColor</a></div><div class="ttdeci">Color PaddingColor</div><div class="ttdoc">Gets/sets [&amp;quot;paddingColor&amp;quot;]. Named and hex values are supported. (rgb and rgba, both 3...</div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00286">ResizeSettings.cs:286</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_ad7d2c54cc300e532a28e76a34de35186"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#ad7d2c54cc300e532a28e76a34de35186">ImageResizer.ImageBuilder.LayoutRotate</a></div><div class="ttdeci">override RequestedAction LayoutRotate(ImageState s)</div><div class="ttdoc">Process.3(Layout).anytime: Occurs when the layout is rotated. May be called anytime during Layout() ...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00719">ImageBuilder.cs:719</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_util_1_1_polygon_math_html_a3bd9aa254e8639eb72e580d324f929b9"><div class="ttname"><a href="class_image_resizer_1_1_util_1_1_polygon_math.html#a3bd9aa254e8639eb72e580d324f929b9">ImageResizer.Util.PolygonMath.RoundPoints</a></div><div class="ttdeci">static PointF[] RoundPoints(PointF[] a)</div><div class="ttdoc">Rounds the elements of the specified array [not used] </div><div class="ttdef"><b>Definition:</b> <a href="_polygon_math_8cs_source.html#l00020">PolygonMath.cs:20</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_instructions_html"><div class="ttname"><a href="class_image_resizer_1_1_instructions.html">ImageResizer.Instructions</a></div><div class="ttdoc">A name/value collection of image processsing instructions. The successor to ResizeSettings. Just because a key doesn&amp;#39;t have a property wrapper doesn&amp;#39;t mean you can&amp;#39;t use it. i[&amp;quot;key&amp;quot;] = value; isnt&amp;#39; that scary. </div><div class="ttdef"><b>Definition:</b> <a href="_instructions_8cs_source.html#l00015">Instructions.cs:15</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_job_html_a29f911ea9f9ede401094e90c950fe1ff"><div class="ttname"><a href="class_image_resizer_1_1_image_job.html#a29f911ea9f9ede401094e90c950fe1ff">ImageResizer.ImageJob.DisposeDestinationStream</a></div><div class="ttdeci">bool DisposeDestinationStream</div><div class="ttdoc">If true, and if &amp;#39;dest&amp;#39; is a Stream instance, it will be disposed after the image has been written...</div><div class="ttdef"><b>Definition:</b> <a href="_image_job_8cs_source.html#l00169">ImageJob.cs:169</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html_ae5ee543eced4b1d204325b4c598b9002"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html#ae5ee543eced4b1d204325b4c598b9002">ImageResizer.ResizeSettings.Border</a></div><div class="ttdeci">BoxPadding Border</div><div class="ttdoc">Friendly get/set accessor for the [&amp;quot;borderWidth&amp;quot;] value. Returns BoxPadding.Empty when unspecified...</div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00322">ResizeSettings.cs:322</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_ac0ad7c5f8e03ca9a50e6538677c3475d"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#ac0ad7c5f8e03ca9a50e6538677c3475d">ImageResizer.ImageBuilder.GetFinalSize</a></div><div class="ttdeci">virtual Size GetFinalSize(Size originalSize, ResizeSettings q)</div><div class="ttdoc">Gets the final size of an image </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00947">ImageBuilder.cs:947</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_job_html_a0d47d299ecd8a7316ba4a56d28e246b2"><div class="ttname"><a href="class_image_resizer_1_1_image_job.html#a0d47d299ecd8a7316ba4a56d28e246b2">ImageResizer.ImageJob.Source</a></div><div class="ttdeci">object Source</div><div class="ttdoc">The source image&amp;#39;s physical path, app-relative virtual path, or a Stream, byte array, Bitmap, VirtualFile, IVirtualFile, HttpPostedFile, or HttpPostedFileBase instance. </div><div class="ttdef"><b>Definition:</b> <a href="_image_job_8cs_source.html#l00086">ImageJob.cs:86</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_plugins_1_1_i_virtual_image_provider_html"><div class="ttname"><a href="interface_image_resizer_1_1_plugins_1_1_i_virtual_image_provider.html">ImageResizer.Plugins.IVirtualImageProvider</a></div><div class="ttdoc">Implement this to allow your class (or VirtualPathProvider subclass) to be used without registering i...</div><div class="ttdef"><b>Definition:</b> <a href="_i_virtual_image_provider_8cs_source.html#l00011">IVirtualImageProvider.cs:11</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_extension_methods_1_1_name_value_collection_extensions_html"><div class="ttname"><a href="class_image_resizer_1_1_extension_methods_1_1_name_value_collection_extensions.html">ImageResizer.ExtensionMethods.NameValueCollectionExtensions</a></div><div class="ttdef"><b>Definition:</b> <a href="_name_value_collection_8cs_source.html#l00010">NameValueCollection.cs:10</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_af9bcb1d2b216d219670c2a98a3586792"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#af9bcb1d2b216d219670c2a98a3586792">ImageResizer.ImageBuilder.SettingsModifier</a></div><div class="ttdeci">ISettingsModifier SettingsModifier</div><div class="ttdoc">May be null. A class to modify or normalize ResizeSettings instances before they are used...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00044">ImageBuilder.cs:44</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html_ae7fc16e795fb8ebf6423f3df628dc404"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html#ae7fc16e795fb8ebf6423f3df628dc404">ImageResizer.ResizeSettings.Scale</a></div><div class="ttdeci">ScaleMode Scale</div><div class="ttdoc">[&amp;quot;scale&amp;quot;] Whether to downscale, upscale, upscale the canvas, or both upscale or downscale the image a...</div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00176">ResizeSettings.cs:176</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_util_1_1_polygon_math_html_a98c83ada594ba88b34d97d26176f8ada"><div class="ttname"><a href="class_image_resizer_1_1_util_1_1_polygon_math.html#a98c83ada594ba88b34d97d26176f8ada">ImageResizer.Util.PolygonMath.FitsInside</a></div><div class="ttdeci">static bool FitsInside(SizeF inner, SizeF outer)</div><div class="ttdoc">Returns true if &amp;#39;inner&amp;#39; fits inside or equals &amp;#39;outer&amp;#39; </div><div class="ttdef"><b>Definition:</b> <a href="_polygon_math_8cs_source.html#l00420">PolygonMath.cs:420</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_plugins_1_1_i_settings_modifier_html"><div class="ttname"><a href="interface_image_resizer_1_1_plugins_1_1_i_settings_modifier.html">ImageResizer.Plugins.ISettingsModifier</a></div><div class="ttdoc">Provides a way to modify settings before they reach the managed API. Does not execute early enough to...</div><div class="ttdef"><b>Definition:</b> <a href="_i_settings_modifier_8cs_source.html#l00009">ISettingsModifier.cs:9</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_aa00b42693a3af4544751cc1d1be0bbbf"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#aa00b42693a3af4544751cc1d1be0bbbf">ImageResizer.ImageBuilder.DecodeStream</a></div><div class="ttdeci">override Bitmap DecodeStream(Stream s, ResizeSettings settings, string optionalPath)</div><div class="ttdoc">Decodes the stream into a System.Drawing.Bitmap instance. As of 3.0.7, now ensures the stream can saf...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00210">ImageBuilder.cs:210</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html_a40623c01b19422d9dc93b8809ef3dbc2"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html#a40623c01b19422d9dc93b8809ef3dbc2">ImageResizer.ResizeSettings.BackgroundColor</a></div><div class="ttdeci">Color BackgroundColor</div><div class="ttdoc">[&amp;quot;bgcolor&amp;quot;]: Named and hex values are supported. (rgb and rgba, both 3, 6, and 8 digits). </div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00278">ResizeSettings.cs:278</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_image_state_html_a7229be6e840514ac987e571bfa7a9179"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">ImageResizer.Resizing.ImageState.settings</a></div><div class="ttdeci">ResizeSettings settings</div><div class="ttdoc">The commands to apply to the bitmap </div><div class="ttdef"><b>Definition:</b> <a href="_image_state_8cs_source.html#l00025">ImageState.cs:25</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_layout_builder_html_a90faf403e3c1fad5e4ff80aec2605518"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_layout_builder.html#a90faf403e3c1fad5e4ff80aec2605518">ImageResizer.Resizing.LayoutBuilder.Rotate</a></div><div class="ttdeci">void Rotate(double degrees, PointF origin)</div><div class="ttdoc">Rotates all existing rings (Except those flagged ignore) </div><div class="ttdef"><b>Definition:</b> <a href="_layout_builder_8cs_source.html#l00147">LayoutBuilder.cs:147</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_plugins_1_1_i_querystring_plugin_html"><div class="ttname"><a href="interface_image_resizer_1_1_plugins_1_1_i_querystring_plugin.html">ImageResizer.Plugins.IQuerystringPlugin</a></div><div class="ttdoc">For plugins that access the query string (important!) </div><div class="ttdef"><b>Definition:</b> <a href="_i_querystring_plugin_8cs_source.html#l00010">IQuerystringPlugin.cs:10</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_ad3c48a100d8e661aec4dbb56783c8508"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#ad3c48a100d8e661aec4dbb56783c8508">ImageResizer.ImageBuilder.EndLayout</a></div><div class="ttdeci">override RequestedAction EndLayout(ImageState s)</div><div class="ttdoc">Process.3(Layout).12: Occurs once layout has finished. No more changes should occur to points or ring...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00735">ImageBuilder.cs:735</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_layout_builder_html_a051b209e5c0d4a59998c266d79a1daa2"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_layout_builder.html#a051b209e5c0d4a59998c266d79a1daa2">ImageResizer.Resizing.LayoutBuilder.Normalize</a></div><div class="ttdeci">void Normalize(PointF origin)</div><div class="ttdoc">Normalizes all rings and invisible polygons so that the outermost ring&amp;#39;s bounding box starts at the s...</div><div class="ttdef"><b>Definition:</b> <a href="_layout_builder_8cs_source.html#l00158">LayoutBuilder.cs:158</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_image_state_html_a3ecc996b00bfe20e621a43107312233d"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_image_state.html#a3ecc996b00bfe20e621a43107312233d">ImageResizer.Resizing.ImageState.destBitmap</a></div><div class="ttdeci">Bitmap destBitmap</div><div class="ttdoc">The destination bitmap. If null, skip drawing commands, but continue layout logic. </div><div class="ttdef"><b>Definition:</b> <a href="_image_state_8cs_source.html#l00178">ImageState.cs:178</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a17a976acd6935ca64f88b54332a00c2d"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a17a976acd6935ca64f88b54332a00c2d">ImageResizer.ImageBuilder.LoadImage</a></div><div class="ttdeci">virtual Bitmap LoadImage(object source, ResizeSettings settings, bool restoreStreamPos)</div><div class="ttdoc">Loads a Bitmap from the specified source. If a filename is available, it will be attached to bitmap...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00127">ImageBuilder.cs:127</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_box_padding_html_a4b1353db785a5d82397ed82641f05e0d"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_box_padding.html#a4b1353db785a5d82397ed82641f05e0d">ImageResizer.Resizing.BoxPadding.IsEmpty</a></div><div class="ttdeci">bool IsEmpty</div><div class="ttdoc">Returns true if th </div><div class="ttdef"><b>Definition:</b> <a href="_box_padding_8cs_source.html#l00106">BoxPadding.cs:106</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a5f3df5920c5ec3f75085a91d4268157a"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a5f3df5920c5ec3f75085a91d4268157a">ImageResizer.ImageBuilder.ProcessFinalBitmap</a></div><div class="ttdeci">override RequestedAction ProcessFinalBitmap(ImageState s)</div><div class="ttdoc">Process.6: Non-rendering changes to the bitmap object occur here, such as flipping. The graphics object is unavailable. </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00906">ImageBuilder.cs:906</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html_a27da93206fc9ebe2834a02d3e5ab62f6"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html#a27da93206fc9ebe2834a02d3e5ab62f6">ImageResizer.ResizeSettings.SourceFlip</a></div><div class="ttdeci">RotateFlipType SourceFlip</div><div class="ttdoc">[&amp;quot;sFlip&amp;quot;] Allows you to flip the source image vertically, horizontally, or both. Rotation is not supp...</div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00164">ResizeSettings.cs:164</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_image_state_html_a8aa9f1c77100b8bb71c5ffa1bdff62d0"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0">ImageResizer.Resizing.ImageState.sourceBitmap</a></div><div class="ttdeci">Bitmap sourceBitmap</div><div class="ttdoc">The source bitmap. If null, skip drawing commands, but continue layout logic. </div><div class="ttdef"><b>Definition:</b> <a href="_image_state_8cs_source.html#l00066">ImageState.cs:66</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a6095ca220f026fec0fd15b3ebf4ef12a"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a6095ca220f026fec0fd15b3ebf4ef12a">ImageResizer.ImageBuilder.RenderPadding</a></div><div class="ttdeci">override RequestedAction RenderPadding(ImageState s)</div><div class="ttdoc">Process.5(Render).5 Image padding is drawn </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00811">ImageBuilder.cs:811</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a32558f4f0b1a0aaed2500dc9e5b849ea"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a32558f4f0b1a0aaed2500dc9e5b849ea">ImageResizer.ImageBuilder.RenderBackground</a></div><div class="ttdeci">override RequestedAction RenderBackground(ImageState s)</div><div class="ttdoc">Sets the background color if needed or requested </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00775">ImageBuilder.cs:775</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_image_state_html_af7685bdf458df8b87e3de9f18629c919"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_image_state.html#af7685bdf458df8b87e3de9f18629c919">ImageResizer.Resizing.ImageState.destSize</a></div><div class="ttdeci">Size destSize</div><div class="ttdoc">The size of the target bitmap image. Set after all sizing operations have completed. </div><div class="ttdef"><b>Definition:</b> <a href="_image_state_8cs_source.html#l00047">ImageState.cs:47</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_ad4e099c55af7db2a764bf7429e0c1c7f"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#ad4e099c55af7db2a764bf7429e0c1c7f">ImageResizer.ImageBuilder.LayoutNormalize</a></div><div class="ttdeci">override RequestedAction LayoutNormalize(ImageState s)</div><div class="ttdoc">Process.3(Layout).anytime: Occurs when the layout is normalized to 0,0. May be called anytime during ...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00726">ImageBuilder.cs:726</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a1de161f6083813949f26b01c0e10283c"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a1de161f6083813949f26b01c0e10283c">ImageResizer.ImageBuilder.Copy</a></div><div class="ttdeci">virtual ImageBuilder Copy()</div><div class="ttdoc">Copies the instance along with extensions. Subclasses must override this. </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00090">ImageBuilder.cs:90</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html_a80001d573cec108c39e5376f6d854993"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html#a80001d573cec108c39e5376f6d854993">ImageResizer.ResizeSettings.Width</a></div><div class="ttdeci">int Width</div><div class="ttdoc">[&amp;quot;width&amp;quot;]: Sets the desired width of the image. (minus padding, borders, margins, effects, and rotation). The only instance the resulting image will be smaller is if the original source image is smaller. Set Scale=Both to upscale these images and ensure the output always matches &amp;#39;width&amp;#39; and &amp;#39;height&amp;#39;. If both width and height are specified, the image will be &amp;#39;letterboxed&amp;#39; to match the desired aspect ratio. Change the Mode property to adjust this behavior. </div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00066">ResizeSettings.cs:66</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html_ad6f58c2c9129334491b436b2abdbc9b5"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html#ad6f58c2c9129334491b436b2abdbc9b5">ImageResizer.ResizeSettings.Flip</a></div><div class="ttdeci">RotateFlipType Flip</div><div class="ttdoc">Allows you to flip the entire resulting image vertically, horizontally, or both. Rotation is not supp...</div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00155">ResizeSettings.cs:155</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a73ee8389af6a5b923455dc80da3ac66e"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a73ee8389af6a5b923455dc80da3ac66e">ImageResizer.ImageBuilder.RenderBorder</a></div><div class="ttdeci">override RequestedAction RenderBorder(ImageState s)</div><div class="ttdoc">Process.5(Render).12: The border is rendered </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00857">ImageBuilder.cs:857</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_af498e87cf9e20dee93b0fb711e39581f"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#af498e87cf9e20dee93b0fb711e39581f">ImageResizer.ImageBuilder.TranslatePoints</a></div><div class="ttdeci">virtual PointF[] TranslatePoints(PointF[] sourcePoints, Size originalSize, ResizeSettings q)</div><div class="ttdoc">Doesn&amp;#39;t support flipping. Translate a point on the original bitmap to a point on the new bitmap...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00934">ImageBuilder.cs:934</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_job_html_a4ffc5aa55609b62ecbda6b35ba019745"><div class="ttname"><a href="class_image_resizer_1_1_image_job.html#a4ffc5aa55609b62ecbda6b35ba019745">ImageResizer.ImageJob.FinalPath</a></div><div class="ttdeci">string FinalPath</div><div class="ttdoc">Contains the final physical path to the image (if &amp;#39;dest&amp;#39; was a path - null otherwise) ...</div><div class="ttdef"><b>Definition:</b> <a href="_image_job_8cs_source.html#l00178">ImageJob.cs:178</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_job_html_a5dd32c6152d10115383001b9ff37f640"><div class="ttname"><a href="class_image_resizer_1_1_image_job.html#a5dd32c6152d10115383001b9ff37f640">ImageResizer.ImageJob.DisposeSourceObject</a></div><div class="ttdeci">bool DisposeSourceObject</div><div class="ttdoc">If true, and if &amp;#39;source&amp;#39; is a IDisposable instead like Bitmap or Stream instance, it will be disposed...</div><div class="ttdef"><b>Definition:</b> <a href="_image_job_8cs_source.html#l00150">ImageJob.cs:150</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_layout_builder_html_aa648f003522418c8c8a6677a62c1df4e"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_layout_builder.html#aa648f003522418c8c8a6677a62c1df4e">ImageResizer.Resizing.LayoutBuilder.GetBoundingBox</a></div><div class="ttdeci">RectangleF GetBoundingBox()</div><div class="ttdoc">Gets a bounding box that encloses all rings that don&amp;#39;t have ExcludeFromBoundingBox set...</div><div class="ttdef"><b>Definition:</b> <a href="_layout_builder_8cs_source.html#l00133">LayoutBuilder.cs:133</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_plugins_1_1_i_file_extension_plugin_html"><div class="ttname"><a href="interface_image_resizer_1_1_plugins_1_1_i_file_extension_plugin.html">ImageResizer.Plugins.IFileExtensionPlugin</a></div><div class="ttdoc">For plugins that add support for new source file image extensions. </div><div class="ttdef"><b>Definition:</b> <a href="_i_file_extension_plugin_8cs_source.html#l00010">IFileExtensionPlugin.cs:10</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a34af5ed805a72bb5477e25591d3b8110"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a34af5ed805a72bb5477e25591d3b8110">ImageResizer.ImageBuilder.PrepareSourceBitmap</a></div><div class="ttdeci">override RequestedAction PrepareSourceBitmap(ImageState s)</div><div class="ttdoc">Process.1 Switches the bitmap to the correct frame or page, and applies source flipping commands ...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00629">ImageBuilder.cs:629</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a0649c6799567d75a2f0c46d3cd0f6196"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a0649c6799567d75a2f0c46d3cd0f6196">ImageResizer.ImageBuilder.LayoutImage</a></div><div class="ttdeci">override RequestedAction LayoutImage(ImageState s)</div><div class="ttdoc">Populates copyRect, as well as Rings image and imageArea. Translates and scales any existing rings as...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00972">ImageBuilder.cs:972</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_job_html"><div class="ttname"><a href="class_image_resizer_1_1_image_job.html">ImageResizer.ImageJob</a></div><div class="ttdef"><b>Definition:</b> <a href="_image_job_8cs_source.html#l00010">ImageJob.cs:10</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_ab0e7f7482b1ed782c4c522ca02d004f7"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#ab0e7f7482b1ed782c4c522ca02d004f7">ImageResizer.ImageBuilder.Layout</a></div><div class="ttdeci">override RequestedAction Layout(ImageState s)</div><div class="ttdoc">Process.3: Handles the layout phase of Processing </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00575">ImageBuilder.cs:575</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_util_1_1_polygon_math_html"><div class="ttname"><a href="class_image_resizer_1_1_util_1_1_polygon_math.html">ImageResizer.Util.PolygonMath</a></div><div class="ttdoc">Defines a collection of utility functions for manipulating polygons. These functions may be (re)moved...</div><div class="ttdef"><b>Definition:</b> <a href="_polygon_math_8cs_source.html#l00013">PolygonMath.cs:13</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html">ImageResizer.ResizeSettings</a></div><div class="ttdoc">Represents the settings which will be used to process the image. Extends NameValueCollection to provi...</div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00020">ResizeSettings.cs:20</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a251f5ddd07226dbc98abec4673afa07e"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a251f5ddd07226dbc98abec4673afa07e">ImageResizer.ImageBuilder.LayoutRound</a></div><div class="ttdeci">override RequestedAction LayoutRound(ImageState s)</div><div class="ttdoc">Process.3(Layout).anytime: Occurs when the layout point values are rounded to integers. May be called anytime during Layout() </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00711">ImageBuilder.cs:711</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_ac0d37c18d40aeae0148dc56165d826a6"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#ac0d37c18d40aeae0148dc56165d826a6">ImageResizer.ImageBuilder.Create</a></div><div class="ttdeci">virtual ImageBuilder Create(IEnumerable&lt; BuilderExtension &gt; extensions, IEncoderProvider writer, IVirtualImageProvider virtualFileProvider, ISettingsModifier settingsModifier)</div><div class="ttdoc">Creates another instance of the class using the specified extensions. Subclasses should override this...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00083">ImageBuilder.cs:83</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_job_html_aa364f02160b72d8fb1b0df47d65e59b5"><div class="ttname"><a href="class_image_resizer_1_1_image_job.html#aa364f02160b72d8fb1b0df47d65e59b5">ImageResizer.ImageJob.CreateParentDirectory</a></div><div class="ttdeci">bool CreateParentDirectory</div><div class="ttdoc">Defaults to false. When true, the parent directory of the destination filename will be created if it ...</div><div class="ttdef"><b>Definition:</b> <a href="_image_job_8cs_source.html#l00217">ImageJob.cs:217</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_processing_exception_html"><div class="ttname"><a href="class_image_resizer_1_1_image_processing_exception.html">ImageResizer.ImageProcessingException</a></div><div class="ttdoc">Represents an non-recoverable exception that occured while processing the image. Possible causes are:...</div><div class="ttdef"><b>Definition:</b> <a href="_image_processing_exception_8cs_source.html#l00013">ImageProcessingException.cs:13</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_image_state_html"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageResizer.Resizing.ImageState</a></div><div class="ttdoc">Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...</div><div class="ttdef"><b>Definition:</b> <a href="_image_state_8cs_source.html#l00015">ImageState.cs:15</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html_ab477264bc4feaa672b217f44dc6d3531"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html#ab477264bc4feaa672b217f44dc6d3531">ImageResizer.ResizeSettings.Padding</a></div><div class="ttdeci">BoxPadding Padding</div><div class="ttdoc">[&amp;quot;paddingWidth&amp;quot;]: Gets/sets the width(s) of padding inside the image border. </div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00293">ResizeSettings.cs:293</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_image_state_html_a0575a388f0e3235d967cb62f4904fe09"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_image_state.html#a0575a388f0e3235d967cb62f4904fe09">ImageResizer.Resizing.ImageState.copyAttibutes</a></div><div class="ttdeci">ImageAttributes copyAttibutes</div><div class="ttdoc">Allows color correction/modification during the image copy. </div><div class="ttdef"><b>Definition:</b> <a href="_image_state_8cs_source.html#l00186">ImageState.cs:186</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a4cb07c8d3c0aea9841613431614a3fa9"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a4cb07c8d3c0aea9841613431614a3fa9">ImageResizer.ImageBuilder.PrepareDestinationBitmap</a></div><div class="ttdeci">override RequestedAction PrepareDestinationBitmap(ImageState s)</div><div class="ttdoc">Creates a bitmap of s.destSize dimensions, intializes a graphics object for it, and configures all th...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00749">ImageBuilder.cs:749</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_af7321daa43947075d5963a33f3473883"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#af7321daa43947075d5963a33f3473883">ImageResizer.ImageBuilder.FlushChanges</a></div><div class="ttdeci">override RequestedAction FlushChanges(ImageState s)</div><div class="ttdoc">Process.5(Render).17: Changes are flushed to the bitmap here and the graphics object is destroyed...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00895">ImageBuilder.cs:895</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_image_state_html_acd58bc890cee2f8d314ae94c2508d0b5"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_image_state.html#acd58bc890cee2f8d314ae94c2508d0b5">ImageResizer.Resizing.ImageState.preRenderBitmap</a></div><div class="ttdeci">Bitmap preRenderBitmap</div><div class="ttdoc">An optional intermediate bitmap, created by plugins who need to process the source bitmap it gets ren...</div><div class="ttdef"><b>Definition:</b> <a href="_image_state_8cs_source.html#l00071">ImageState.cs:71</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a9bd254f85a8c846eb287a985b3accbde"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a9bd254f85a8c846eb287a985b3accbde">ImageResizer.ImageBuilder.EncoderProvider</a></div><div class="ttdeci">IEncoderProvider EncoderProvider</div><div class="ttdoc">Handles the encoder selection and provision proccess. </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00037">ImageBuilder.cs:37</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_image_state_html_a72e11433b4c36caccab68577e864202c"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_image_state.html#a72e11433b4c36caccab68577e864202c">ImageResizer.Resizing.ImageState.originalSize</a></div><div class="ttdeci">Size originalSize</div><div class="ttdoc">The original size of the source bitmap. Use this instead of accessing the bitmap directly for this in...</div><div class="ttdef"><b>Definition:</b> <a href="_image_state_8cs_source.html#l00030">ImageState.cs:30</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_util_1_1_path_utils_html"><div class="ttname"><a href="class_image_resizer_1_1_util_1_1_path_utils.html">ImageResizer.Util.PathUtils</a></div><div class="ttdoc">A set of utility methods for manipulating virtual paths </div><div class="ttdef"><b>Definition:</b> <a href="_path_utils_8cs_source.html#l00017">PathUtils.cs:17</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a8e2f4b3bbf8bb38e54249490122ebb71"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a8e2f4b3bbf8bb38e54249490122ebb71">ImageResizer.ImageBuilder.Process</a></div><div class="ttdeci">virtual void Process(ImageState s)</div><div class="ttdoc">Processes an ImageState instance. Used by Build, GetFinalSize, and TranslatePoint. Can be overriden by a plugin with the OnProcess method </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00561">ImageBuilder.cs:561</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_bitmap_tag_html"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">ImageResizer.Resizing.BitmapTag</a></div><div class="ttdef"><b>Definition:</b> <a href="_bitmap_tag_8cs_source.html#l00011">BitmapTag.cs:11</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a097e510478c85eb23fd6ac0db3cd3078"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a097e510478c85eb23fd6ac0db3cd3078">ImageResizer.ImageBuilder.buildToBitmap</a></div><div class="ttdeci">override Bitmap buildToBitmap(Bitmap source, ResizeSettings settings, bool transparencySupported)</div><div class="ttdoc">Override this when you need to override the behavior of Bitmap processing. Not for external use...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00536">ImageBuilder.cs:536</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_ab6583432ca82dfa02d357000d252c45d"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#ab6583432ca82dfa02d357000d252c45d">ImageResizer.ImageBuilder.Build</a></div><div class="ttdeci">virtual Bitmap Build(object source, ResizeSettings settings, bool disposeSource)</div><div class="ttdoc">Resizes and processes the specified source image and returns a bitmap of the result. Note! This method assumes that transparency will be supported in the final output format, and therefore does not apply a matte color. Use &amp;amp;bgcolor to specify a background color if you use this method with a non-transparent format such as Jpeg. </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00334">ImageBuilder.cs:334</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html_a743f51d8ee756c4f82c679bac685016d"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html#a743f51d8ee756c4f82c679bac685016d">ImageResizer.ResizeSettings.Margin</a></div><div class="ttdeci">BoxPadding Margin</div><div class="ttdoc">[&amp;quot;margin&amp;quot;]: Gets/sets the width(s) of the margin outside the image border and effects. </div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00304">ResizeSettings.cs:304</a></div></div>
<div class="ttc" id="namespace_image_resizer_html_aca52f6f1e90c78a5e5e79c6d709a571c"><div class="ttname"><a href="namespace_image_resizer.html#aca52f6f1e90c78a5e5e79c6d709a571c">ImageResizer.ScaleMode</a></div><div class="ttdeci">ScaleMode</div><div class="ttdoc">Controls whether the image is allowed to upscale, downscale, both, or if only the canvas gets to be u...</div><div class="ttdef"><b>Definition:</b> <a href="_enumerations_8cs_source.html#l00075">Enumerations.cs:75</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a5226d94222273bd96dad169ad1d5bec0"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a5226d94222273bd96dad169ad1d5bec0">ImageResizer.ImageBuilder.LayoutMargin</a></div><div class="ttdeci">override RequestedAction LayoutMargin(ImageState s)</div><div class="ttdoc">Process.3(Layout).10: Margins are added to the layout </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00689">ImageBuilder.cs:689</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a064d8a5a2a83b8f9f35a0f8b411b0cf9"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a064d8a5a2a83b8f9f35a0f8b411b0cf9">ImageResizer.ImageBuilder.ImageBuilder</a></div><div class="ttdeci">ImageBuilder()</div><div class="ttdoc">Shouldn&amp;#39;t be used except to make a factory instance. </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00032">ImageBuilder.cs:32</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_ace292d7e6b4cf7093d00f2c8d3ea52d7"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#ace292d7e6b4cf7093d00f2c8d3ea52d7">ImageResizer.ImageBuilder.LayoutBorder</a></div><div class="ttdeci">override RequestedAction LayoutBorder(ImageState s)</div><div class="ttdoc">Process.3(Layout).6: Ring &amp;quot;border&amp;quot; is added to the layout </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00699">ImageBuilder.cs:699</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_ab51799a036b1624f4e5d9c2aa2fcfa88"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#ab51799a036b1624f4e5d9c2aa2fcfa88">ImageResizer.ImageBuilder.GetStreamFromSource</a></div><div class="ttdeci">Stream GetStreamFromSource(object source, ResizeSettings settings, ref bool disposeStream, out string path, out bool restoreStreamPosition)</div><div class="ttdoc">For plugin use only. Returns a stream instance from the specified source object and settings object...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00235">ImageBuilder.cs:235</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a5fd0abe1e804a676b596f11786ea45a6"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a5fd0abe1e804a676b596f11786ea45a6">ImageResizer.ImageBuilder.ImageBuilder</a></div><div class="ttdeci">ImageBuilder(IEnumerable&lt; BuilderExtension &gt; extensions, IEncoderProvider encoderProvider, IVirtualImageProvider virtualFileProvider, ISettingsModifier settingsModifier)</div><div class="ttdoc">Create a new instance of ImageBuilder using the specified extensions, encoder provider, file provider, and settings filter. Extension methods will be fired in the order they exist in the collection. </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00068">ImageBuilder.cs:68</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a185dcaa809670c427788a45539f2f1f3"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a185dcaa809670c427788a45539f2f1f3">ImageResizer.ImageBuilder.LoadImage</a></div><div class="ttdeci">virtual Bitmap LoadImage(object source, ResizeSettings settings)</div><div class="ttdoc">Loads a Bitmap from the specified source. If a filename is available, it will be attached to bitmap...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00104">ImageBuilder.cs:104</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html_a16d3547dfb87d598876fb64e54c0a938"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html#a16d3547dfb87d598876fb64e54c0a938">ImageResizer.ResizeSettings.MaxHeight</a></div><div class="ttdeci">int MaxHeight</div><div class="ttdoc">[&amp;quot;maxheight&amp;quot;]: Sets the maximum desired height of the image. (minus padding, borders, margins, effects, and rotation). The image may be smaller than this value to maintain aspect ratio when both maxwidth and maxheight are specified. </div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00111">ResizeSettings.cs:111</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a1824384380315ef898318f888d7322ad"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a1824384380315ef898318f888d7322ad">ImageResizer.ImageBuilder.GetFinalSize</a></div><div class="ttdeci">virtual Size GetFinalSize(Size originalSize, Instructions q)</div><div class="ttdoc">Gets the final size of an image </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00956">ImageBuilder.cs:956</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_job_html_a04c90612666b1834d038ae9a4bac67b5"><div class="ttname"><a href="class_image_resizer_1_1_image_job.html#a04c90612666b1834d038ae9a4bac67b5">ImageResizer.ImageJob.Dest</a></div><div class="ttdeci">object Dest</div><div class="ttdoc">The destination Stream, physical path, or app-relative virtual path. If a Bitmap instance is desired...</div><div class="ttdef"><b>Definition:</b> <a href="_image_job_8cs_source.html#l00096">ImageJob.cs:96</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_encoding_1_1_i_encoder_provider_html"><div class="ttname"><a href="interface_image_resizer_1_1_encoding_1_1_i_encoder_provider.html">ImageResizer.Encoding.IEncoderProvider</a></div><div class="ttdoc">A provider (or selector) of IEncoder instances. </div><div class="ttdef"><b>Definition:</b> <a href="_i_encoder_provider_8cs_source.html#l00010">IEncoderProvider.cs:10</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_image_state_html_a845b5dc0d563cd83e8591ceccdbfe31e"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e">ImageResizer.Resizing.ImageState.layout</a></div><div class="ttdeci">LayoutBuilder layout</div><div class="ttdoc">The layout object. Used for calculated and flowing the layout of the various rings around the image (...</div><div class="ttdef"><b>Definition:</b> <a href="_image_state_8cs_source.html#l00042">ImageState.cs:42</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html_aeff2f3a99b045d45b46e3a417c2ab1fd"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html#aeff2f3a99b045d45b46e3a417c2ab1fd">ImageResizer.ResizeSettings.BorderColor</a></div><div class="ttdeci">Color BorderColor</div><div class="ttdoc">Gets/sets [&amp;quot;borderColor&amp;quot;]. Named and hex values are supported. (rgb and rgba, both 3...</div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00315">ResizeSettings.cs:315</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_adb8515a05af3dd9bc790f032d065aaca"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#adb8515a05af3dd9bc790f032d065aaca">ImageResizer.ImageBuilder.Build</a></div><div class="ttdeci">virtual ImageJob Build(object source, object dest, Instructions instructions)</div><div class="ttdoc">Resizes and processes the specified source image and stores the encoded result in the specified desti...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00358">ImageBuilder.cs:358</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_ab1824012ca6ccf41e119ef03a60b12cc"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#ab1824012ca6ccf41e119ef03a60b12cc">ImageResizer.ImageBuilder.BuildJob</a></div><div class="ttdeci">override RequestedAction BuildJob(ImageJob job)</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00421">ImageBuilder.cs:421</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a4d055522b14dc97d8edf5eb8ec3a1296"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a4d055522b14dc97d8edf5eb8ec3a1296">ImageResizer.ImageBuilder.GetSupportedQuerystringKeys</a></div><div class="ttdeci">virtual IEnumerable&lt; string &gt; GetSupportedQuerystringKeys()</div><div class="ttdoc">Returns a list of the querystring commands ImageBuilder can parse by default. Plugins can implement I...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l01154">ImageBuilder.cs:1154</a></div></div>
<div class="ttc" id="namespace_image_resizer_html_affd730f8b2250fecace497124be5a37d"><div class="ttname"><a href="namespace_image_resizer.html#affd730f8b2250fecace497124be5a37d">ImageResizer.FitMode</a></div><div class="ttdeci">FitMode</div><div class="ttdoc">How to resolve aspect ratio differences between the requested size and the original image&amp;#39;s size...</div><div class="ttdef"><b>Definition:</b> <a href="_enumerations_8cs_source.html#l00114">Enumerations.cs:114</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a078dae9f4dba27048dfd41862ce9960b"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a078dae9f4dba27048dfd41862ce9960b">ImageResizer.ImageBuilder.buildToStream</a></div><div class="ttdeci">override RequestedAction buildToStream(Bitmap source, Stream dest, ResizeSettings settings)</div><div class="ttdoc">Override this when you need to override the behavior of image encoding and/or Bitmap processing Not f...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00516">ImageBuilder.cs:516</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_image_state_html_a22528462bb2ca64173878ef4441bad28"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_image_state.html#a22528462bb2ca64173878ef4441bad28">ImageResizer.Resizing.ImageState.copyRect</a></div><div class="ttdeci">RectangleF copyRect</div><div class="ttdoc">The rectangular portion of the source image to copy </div><div class="ttdef"><b>Definition:</b> <a href="_image_state_8cs_source.html#l00057">ImageState.cs:57</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a9e22edc2ecc338cf2cc0e2b599d3ba01"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a9e22edc2ecc338cf2cc0e2b599d3ba01">ImageResizer.ImageBuilder.LayoutPadding</a></div><div class="ttdeci">override RequestedAction LayoutPadding(ImageState s)</div><div class="ttdoc">Process.3(Layout).4: Ring &amp;quot;padding&amp;quot; is added to the layout </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00679">ImageBuilder.cs:679</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_af3553cf8d81e99e9739491bdd34c38e1"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#af3553cf8d81e99e9739491bdd34c38e1">ImageResizer.ImageBuilder.LoadImageInfo</a></div><div class="ttdeci">virtual IDictionary&lt; string, object &gt; LoadImageInfo(object source, IEnumerable&lt; string &gt; requestedInfo)</div><div class="ttdoc">Returns a dictionary of information about the given image. </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00114">ImageBuilder.cs:114</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a303922cae5567e1e58462695000ec705"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a303922cae5567e1e58462695000ec705">ImageResizer.ImageBuilder.GetSupportedFileExtensions</a></div><div class="ttdeci">virtual IEnumerable&lt; string &gt; GetSupportedFileExtensions()</div><div class="ttdoc">Returns a list of the file extensions ImageBuilder can load by default. Plugins can implement IFileEx...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l01137">ImageBuilder.cs:1137</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a70a8ba17d8b08e48d273f72b256b5573"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a70a8ba17d8b08e48d273f72b256b5573">ImageResizer.ImageBuilder.CreateImageAttribues</a></div><div class="ttdeci">override RequestedAction CreateImageAttribues(ImageState s)</div><div class="ttdoc">Process.5(Render).7: An ImageAttributes instance is created if it doesn&amp;#39;t already exist...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00829">ImageBuilder.cs:829</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a87954c4d5579b7b2d45bec6ca1eb5aab"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a87954c4d5579b7b2d45bec6ca1eb5aab">ImageResizer.ImageBuilder.Build</a></div><div class="ttdeci">virtual string Build(object source, object dest, ResizeSettings settings, bool disposeSource, bool addFileExtension)</div><div class="ttdoc">Resizes and processes the specified source image and stores the encoded result in the specified desti...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00390">ImageBuilder.cs:390</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_abstract_image_processor_html_a79fd55facde998a6090e73fe8affda85"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_abstract_image_processor.html#a79fd55facde998a6090e73fe8affda85">ImageResizer.Resizing.AbstractImageProcessor.exts</a></div><div class="ttdeci">volatile IEnumerable&lt; BuilderExtension &gt; exts</div><div class="ttdoc">Contains the set of extensions that are called for every method. </div><div class="ttdef"><b>Definition:</b> <a href="_abstract_image_processor_8cs_source.html#l00050">AbstractImageProcessor.cs:50</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_job_html_aa6cb13a20ee55698d62de78f6d749d07"><div class="ttname"><a href="class_image_resizer_1_1_image_job.html#aa6cb13a20ee55698d62de78f6d749d07">ImageResizer.ImageJob.ResetSourceStream</a></div><div class="ttdeci">bool ResetSourceStream</div><div class="ttdoc">If true, and if &amp;#39;source&amp;#39; is seekable, the stream will be reset to its previous position after being r...</div><div class="ttdef"><b>Definition:</b> <a href="_image_job_8cs_source.html#l00160">ImageJob.cs:160</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_util_1_1_path_utils_html_adafb4cd7d85a3567782842873c1a5176"><div class="ttname"><a href="class_image_resizer_1_1_util_1_1_path_utils.html#adafb4cd7d85a3567782842873c1a5176">ImageResizer.Util.PathUtils.ResolveAppRelative</a></div><div class="ttdeci">static string ResolveAppRelative(string virtualPath)</div><div class="ttdoc">Resolves app-relative paths to virtual paths. Does nothing with virtual or relative paths...</div><div class="ttdef"><b>Definition:</b> <a href="_path_utils_8cs_source.html#l00150">PathUtils.cs:150</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_box_padding_html_a5a549837cdd68bdbd6fa61c9d11f9e52"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_box_padding.html#a5a549837cdd68bdbd6fa61c9d11f9e52">ImageResizer.Resizing.BoxPadding.All</a></div><div class="ttdeci">double All</div><div class="ttdoc">Returns double.NaN unless all edges are the same width, in which case that width is returned ...</div><div class="ttdef"><b>Definition:</b> <a href="_box_padding_8cs_source.html#l00088">BoxPadding.cs:88</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a12f49b48e9244ee7f6e86fd60fffcc83"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a12f49b48e9244ee7f6e86fd60fffcc83">ImageResizer.ImageBuilder.Build</a></div><div class="ttdeci">virtual Bitmap Build(object source, ResizeSettings settings)</div><div class="ttdoc">Resizes and processes the specified source image and returns a bitmap of the result. Note! This method assumes that transparency will be supported in the final output format, and therefore does not apply a matte color. Use &amp;amp;bgcolor to specify a background color if you use this method with a non-transparent format such as Jpeg. If passed a source Stream, Bitmap, or Image instance, it will be disposed after use. Use disposeSource=False to disable that behavior. </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00319">ImageBuilder.cs:319</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html">ImageResizer.ImageBuilder</a></div><div class="ttdoc">Provides methods for generating resized images, and for reading and writing them to disk...</div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00027">ImageBuilder.cs:27</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a521141a412897869bff44e38e375f85a"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a521141a412897869bff44e38e375f85a">ImageResizer.ImageBuilder.Build</a></div><div class="ttdeci">virtual ImageJob Build(ImageJob job)</div><div class="ttdoc">The most flexible method for processing an image </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00400">ImageBuilder.cs:400</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_afcfb7f40a65d121670118ccebfe1ca4b"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#afcfb7f40a65d121670118ccebfe1ca4b">ImageResizer.ImageBuilder.Current</a></div><div class="ttdeci">static ImageBuilder Current</div><div class="ttdoc">Returns a shared instance of ImageBuilder or a subclass, equivalent to Config.Current.CurrentImageBuilder </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00059">ImageBuilder.cs:59</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_image_state_html_ab7d7513afe8fad1300bf8cb96942f06f"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_image_state.html#ab7d7513afe8fad1300bf8cb96942f06f">ImageResizer.Resizing.ImageState.finalSize</a></div><div class="ttdeci">Size finalSize</div><div class="ttdoc">The dimensions of the bitmap afer all operations have been applied to it (Calling FlipRotate can chan...</div><div class="ttdef"><b>Definition:</b> <a href="_image_state_8cs_source.html#l00051">ImageState.cs:51</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_image_state_html_a4292474d3ba45b4f0c20fb7b38e8631c"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_image_state.html#a4292474d3ba45b4f0c20fb7b38e8631c">ImageResizer.Resizing.ImageState.supportsTransparency</a></div><div class="ttdeci">bool supportsTransparency</div><div class="ttdoc">Rendering choices can depend on whether the output format supports transparency. </div><div class="ttdef"><b>Definition:</b> <a href="_image_state_8cs_source.html#l00036">ImageState.cs:36</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_plugins_1_1_i_virtual_bitmap_file_html"><div class="ttname"><a href="interface_image_resizer_1_1_plugins_1_1_i_virtual_bitmap_file.html">ImageResizer.Plugins.IVirtualBitmapFile</a></div><div class="ttdoc">For virtual files who want to provide their data in Bitmap form (like a PSD reader or gradient genera...</div><div class="ttdef"><b>Definition:</b> <a href="_i_virtual_bitmap_file_8cs_source.html#l00010">IVirtualBitmapFile.cs:10</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_encoding_1_1_i_encoder_html"><div class="ttname"><a href="interface_image_resizer_1_1_encoding_1_1_i_encoder.html">ImageResizer.Encoding.IEncoder</a></div><div class="ttdoc">An image encoder. Exposes methods for suitability checking, encoding, transparency compatibility chec...</div><div class="ttdef"><b>Definition:</b> <a href="_i_encoder_8cs_source.html#l00013">IEncoder.cs:13</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_abstract_image_processor_html_a6cb4bce1d3b4b2947f9355d32ec66c68"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_abstract_image_processor.html#a6cb4bce1d3b4b2947f9355d32ec66c68">ImageResizer.Resizing.AbstractImageProcessor.DecodeStreamFailed</a></div><div class="ttdeci">virtual Bitmap DecodeStreamFailed(Stream s, ResizeSettings settings, string optionalPath)</div><div class="ttdoc">Extensions are executed until one extension returns a non-null value. This is taken to mean that the ...</div><div class="ttdef"><b>Definition:</b> <a href="_abstract_image_processor_8cs_source.html#l00095">AbstractImageProcessor.cs:95</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_builder_html_a391309229993353e75f82223cdf0323f"><div class="ttname"><a href="class_image_resizer_1_1_image_builder.html#a391309229993353e75f82223cdf0323f">ImageResizer.ImageBuilder.VirtualFileProvider</a></div><div class="ttdeci">IVirtualImageProvider VirtualFileProvider</div><div class="ttdoc">Provides a resolution service for app-relative URLs. </div><div class="ttdef"><b>Definition:</b> <a href="_image_builder_8cs_source.html#l00051">ImageBuilder.cs:51</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html_a7145aef3affc3244969cad8841359e3f"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html#a7145aef3affc3244969cad8841359e3f">ImageResizer.ResizeSettings.Height</a></div><div class="ttdeci">int Height</div><div class="ttdoc">[&amp;quot;height&amp;quot;]: Sets the desired height of the image. (minus padding, borders, margins, effects, and rotation) The only instance the resulting image will be smaller is if the original source image is smaller. Set Scale=Both to upscale these images and ensure the output always matches &amp;#39;width&amp;#39; and &amp;#39;height&amp;#39;. If both width and height are specified, the image will be &amp;#39;letterboxed&amp;#39; to match the desired aspect ratio. Change the Mode property to adjust this behavior. </div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00079">ResizeSettings.cs:79</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
