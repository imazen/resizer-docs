<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ImageResizer: C:/Users/Administrator/Documents/resizer/Core/Resizing/ImageState.cs Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="imageresizer-logo-00aec4.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.3.3</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">C:/Users/Administrator/Documents/resizer/Core/Resizing/ImageState.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 ï»¿<span class="comment">/* Copyright (c) 2011 Nathanael Jones. See license.txt */</span>
<a name="l00002"></a>00002 <span class="keyword">using</span> System;
<a name="l00003"></a>00003 <span class="keyword">using</span> System.Collections.Generic;
<a name="l00004"></a>00004 <span class="keyword">using</span> System.Text;
<a name="l00005"></a>00005 <span class="keyword">using</span> System.Drawing;
<a name="l00006"></a>00006 <span class="keyword">using</span> System.Drawing.Imaging;
<a name="l00007"></a>00007 
<a name="l00008"></a>00008 <span class="keyword">namespace </span>ImageResizer.Resizing {<span class="comment"></span>
<a name="l00009"></a>00009 <span class="comment">    /// &lt;summary&gt;</span>
<a name="l00010"></a>00010 <span class="comment">    /// Encapsulates the state of an image being resized. </span>
<a name="l00011"></a>00011 <span class="comment">    /// Can be used to simulate a resize as well as actually perform one.</span>
<a name="l00012"></a>00012 <span class="comment">    /// All code should ignore when Bitmaps and Graphics objects are null, and go about simulating all the mathematical functions as normal.</span>
<a name="l00013"></a>00013 <span class="comment">    /// </span>
<a name="l00014"></a>00014 <span class="comment">    /// &lt;/summary&gt;</span>
<a name="l00015"></a><a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">00015</a> <span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> :IDisposable {
<a name="l00016"></a>00016 
<a name="l00017"></a>00017         <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a>(<a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings, Size originalSize, <span class="keywordtype">bool</span> transparencySupported) {
<a name="l00018"></a>00018             this.settings = settings;
<a name="l00019"></a>00019             this.originalSize = originalSize;
<a name="l00020"></a>00020             this.supportsTransparency = transparencySupported;
<a name="l00021"></a>00021         }<span class="comment"></span>
<a name="l00022"></a>00022 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00023"></a>00023 <span class="comment">        /// The commands to apply to the bitmap</span>
<a name="l00024"></a>00024 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00025"></a><a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">00025</a> <span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>;
<a name="l00026"></a>00026 <span class="comment"></span>
<a name="l00027"></a>00027 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00028"></a>00028 <span class="comment">        /// The original size of the source bitmap. Use this instead of accessing the bitmap directly for this information, since the bitmap may not always be available</span>
<a name="l00029"></a>00029 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00030"></a><a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a72e11433b4c36caccab68577e864202c">00030</a> <span class="comment"></span>        <span class="keyword">public</span> Size <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a72e11433b4c36caccab68577e864202c" title="The original size of the source bitmap. Use this instead of accessing the bitmap directly for this in...">originalSize</a>;
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="comment"></span>
<a name="l00033"></a>00033 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00034"></a>00034 <span class="comment">        /// Rendering choices can depend on whether the output format supports transparency.</span>
<a name="l00035"></a>00035 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00036"></a><a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a4292474d3ba45b4f0c20fb7b38e8631c">00036</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">bool</span> supportsTransparency = <span class="keyword">true</span>;
<a name="l00037"></a>00037 
<a name="l00038"></a>00038 <span class="comment"></span>
<a name="l00039"></a>00039 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00040"></a>00040 <span class="comment">        /// The layout object. Used for calculated and flowing the layout of the various rings around the image (padding, border, effect, margin, etc).</span>
<a name="l00041"></a>00041 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00042"></a><a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e">00042</a> <span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_layout_builder.html">LayoutBuilder</a> layout = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_layout_builder.html">LayoutBuilder</a>();
<a name="l00043"></a>00043 <span class="comment"></span>
<a name="l00044"></a>00044 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00045"></a>00045 <span class="comment">        /// The size of the target bitmap image. Set after all sizing operations have completed.</span>
<a name="l00046"></a>00046 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00047"></a><a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#af7685bdf458df8b87e3de9f18629c919">00047</a> <span class="comment"></span>        <span class="keyword">public</span> Size <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#af7685bdf458df8b87e3de9f18629c919" title="The size of the target bitmap image. Set after all sizing operations have completed.">destSize</a>;<span class="comment"></span>
<a name="l00048"></a>00048 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00049"></a>00049 <span class="comment">        /// The dimensions of the bitmap afer all operations have been applied to it (Calling FlipRotate can change the bitmap dimensions).</span>
<a name="l00050"></a>00050 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00051"></a><a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#ab7d7513afe8fad1300bf8cb96942f06f">00051</a> <span class="comment"></span>        <span class="keyword">public</span> Size <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#ab7d7513afe8fad1300bf8cb96942f06f" title="The dimensions of the bitmap afer all operations have been applied to it (Calling FlipRotate can chan...">finalSize</a>;
<a name="l00052"></a>00052 
<a name="l00053"></a>00053 <span class="comment"></span>
<a name="l00054"></a>00054 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00055"></a>00055 <span class="comment">        /// The rectangular portion of the source image to copy</span>
<a name="l00056"></a>00056 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00057"></a><a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a22528462bb2ca64173878ef4441bad28">00057</a> <span class="comment"></span>        <span class="keyword">public</span> RectangleF <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a22528462bb2ca64173878ef4441bad28" title="The rectangular portion of the source image to copy.">copyRect</a>;<span class="comment"></span>
<a name="l00058"></a>00058 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00059"></a>00059 <span class="comment">        /// (read-only) Same as copyRect.Size, convenience property.</span>
<a name="l00060"></a>00060 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00061"></a><a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a0a8e5171b83599382074f3462944c4dd">00061</a> <span class="comment"></span>        <span class="keyword">public</span> SizeF copySize { <span class="keyword">get</span> { <span class="keywordflow">return</span> copyRect.Size; } }
<a name="l00062"></a>00062        <span class="comment"></span>
<a name="l00063"></a>00063 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00064"></a>00064 <span class="comment">        /// The source bitmap.  If null, skip drawing commands, but continue layout logic.</span>
<a name="l00065"></a>00065 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00066"></a><a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0">00066</a> <span class="comment"></span>        <span class="keyword">public</span> Bitmap <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0" title="The source bitmap. If null, skip drawing commands, but continue layout logic.">sourceBitmap</a>;
<a name="l00067"></a>00067 <span class="comment"></span>
<a name="l00068"></a>00068 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00069"></a>00069 <span class="comment">        /// An optional intermediate bitmap, created by plugins who need to process the source bitmap it gets rendered to destBitmap. If defined, it should be used instead of sourceBitmap during RenderImage(), and disposed immediately after use.</span>
<a name="l00070"></a>00070 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00071"></a><a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#acd58bc890cee2f8d314ae94c2508d0b5">00071</a> <span class="comment"></span>        <span class="keyword">public</span> Bitmap <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#acd58bc890cee2f8d314ae94c2508d0b5" title="An optional intermediate bitmap, created by plugins who need to process the source bitmap it gets ren...">preRenderBitmap</a>;<span class="comment"></span>
<a name="l00072"></a>00072 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00073"></a>00073 <span class="comment">        /// The destination bitmap.  If null, skip drawing commands, but continue layout logic.</span>
<a name="l00074"></a>00074 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00075"></a><a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a3ecc996b00bfe20e621a43107312233d">00075</a> <span class="comment"></span>        <span class="keyword">public</span> Bitmap <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a3ecc996b00bfe20e621a43107312233d" title="The destination bitmap. If null, skip drawing commands, but continue layout logic.">destBitmap</a>;<span class="comment"></span>
<a name="l00076"></a>00076 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00077"></a>00077 <span class="comment">        /// A graphics object to write to the destination bitmap. If null, skip drawing commands, but continue layout logic.</span>
<a name="l00078"></a>00078 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00079"></a><a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b">00079</a> <span class="comment"></span>        <span class="keyword">public</span> Graphics <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b" title="A graphics object to write to the destination bitmap. If null, skip drawing commands, but continue layout logic.">destGraphics</a>;<span class="comment"></span>
<a name="l00080"></a>00080 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00081"></a>00081 <span class="comment">        /// Allows color correction/modification during the image copy.</span>
<a name="l00082"></a>00082 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00083"></a><a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a0575a388f0e3235d967cb62f4904fe09">00083</a> <span class="comment"></span>        <span class="keyword">public</span> ImageAttributes <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a0575a388f0e3235d967cb62f4904fe09" title="Allows color correction/modification during the image copy.">copyAttibutes</a>;
<a name="l00084"></a>00084 
<a name="l00085"></a>00085         <span class="keyword">private</span> Dictionary&lt;string, object&gt; data = <span class="keyword">new</span> Dictionary&lt;string, object&gt;(StringComparer.OrdinalIgnoreCase);<span class="comment"></span>
<a name="l00086"></a>00086 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00087"></a>00087 <span class="comment">        /// Allows extensions to store data along with the image state</span>
<a name="l00088"></a>00088 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00089"></a><a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a995d9c7d9b9c8faf2f8cc1cbf15d8174">00089</a> <span class="comment"></span>        <span class="keyword">public</span> Dictionary&lt;string, object&gt; Data {
<a name="l00090"></a>00090             <span class="keyword">get</span> { <span class="keywordflow">return</span> data; }
<a name="l00091"></a>00091         }
<a name="l00092"></a>00092 
<a name="l00093"></a>00093         
<a name="l00094"></a>00094 
<a name="l00095"></a>00095         <span class="comment"></span>
<a name="l00096"></a>00096 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00097"></a>00097 <span class="comment">        /// Disposes sourceBitmap, destGraphics, destBitmap, and copyAttributes if they are non-null</span>
<a name="l00098"></a>00098 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00099"></a><a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a04bc1fbdf10a7f4fcc5ffffdb406f491">00099</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">void</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a04bc1fbdf10a7f4fcc5ffffdb406f491" title="Disposes sourceBitmap, destGraphics, destBitmap, and copyAttributes if they are non-null.">Dispose</a>() {
<a name="l00100"></a>00100             <span class="keywordflow">try</span> {
<a name="l00101"></a>00101                 <span class="comment">//Close the source file stream if tagged for disposal.</span>
<a name="l00102"></a>00102                 <span class="keywordflow">if</span> (sourceBitmap != null) {
<a name="l00103"></a>00103                     <span class="keywordflow">if</span> (sourceBitmap.Tag != null &amp;&amp; sourceBitmap.Tag is <a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a>) {
<a name="l00104"></a>00104                         System.IO.Stream s = ((BitmapTag)sourceBitmap.Tag).Source;
<a name="l00105"></a>00105                         <span class="keywordflow">if</span> (s != null) s.Dispose();
<a name="l00106"></a>00106                     }
<a name="l00107"></a>00107                     sourceBitmap.Dispose();
<a name="l00108"></a>00108                 }
<a name="l00109"></a>00109             } <span class="keywordflow">finally</span> {
<a name="l00110"></a>00110                 <span class="keywordflow">try</span> {
<a name="l00111"></a>00111                     <span class="keywordflow">if</span> (destGraphics != null) destGraphics.Dispose();
<a name="l00112"></a>00112                 } <span class="keywordflow">finally</span> {
<a name="l00113"></a>00113                     <span class="keywordflow">try</span> {
<a name="l00114"></a>00114                         <span class="keywordflow">if</span> (destBitmap != null) destBitmap.Dispose();
<a name="l00115"></a>00115                     } <span class="keywordflow">finally</span> {
<a name="l00116"></a>00116                         <span class="keywordflow">try</span> {
<a name="l00117"></a>00117                             <span class="keywordflow">if</span> (copyAttibutes != null) copyAttibutes.Dispose();
<a name="l00118"></a>00118                         } <span class="keywordflow">finally</span> {
<a name="l00119"></a>00119                             <span class="keywordflow">if</span> (preRenderBitmap != null) preRenderBitmap.Dispose();
<a name="l00120"></a>00120                         }
<a name="l00121"></a>00121                     }
<a name="l00122"></a>00122                 }
<a name="l00123"></a>00123 
<a name="l00124"></a>00124             }
<a name="l00125"></a>00125         }
<a name="l00126"></a>00126     }
<a name="l00127"></a>00127 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
