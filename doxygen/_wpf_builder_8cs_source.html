<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ImageResizer: C:/Users/Administrator/Documents/resizer/Plugins/Wpf/WpfBuilder.cs Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="resizer-icon-64.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.2.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">C:/Users/Administrator/Documents/resizer/Plugins/Wpf/WpfBuilder.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 ï»¿using System;
<a name="l00002"></a>00002 <span class="keyword">using</span> System.Collections.Generic;
<a name="l00003"></a>00003 <span class="keyword">using</span> System.Text;
<a name="l00004"></a>00004 <span class="keyword">using</span> ImageResizer.Resizing;
<a name="l00005"></a>00005 <span class="keyword">using</span> ImageResizer.Encoding;
<a name="l00006"></a>00006 <span class="keyword">using</span> ImageResizer.Configuration.Issues;
<a name="l00007"></a>00007 <span class="keyword">using</span> ImageResizer.Util;
<a name="l00008"></a>00008 <span class="keyword">using</span> ImageResizer.Plugins.Basic;
<a name="l00009"></a>00009 <span class="keyword">using</span> System.IO;
<a name="l00010"></a>00010 <span class="keyword">using</span> ImageResizer.Configuration;
<a name="l00011"></a>00011 <span class="keyword">using</span> System.Web.Hosting;
<a name="l00012"></a>00012 <span class="keyword">using</span> System.Runtime.InteropServices;
<a name="l00013"></a>00013 <span class="keyword">using</span> System.Runtime.InteropServices.ComTypes;
<a name="l00014"></a>00014 <span class="keyword">using</span> System.Windows.Media.Imaging;
<a name="l00015"></a>00015 <span class="keyword">using</span> System.Windows.Media;
<a name="l00016"></a>00016 <span class="keyword">using</span> System.Drawing;
<a name="l00017"></a>00017 <span class="keyword">using</span> System.Windows;
<a name="l00018"></a>00018 <span class="keyword">using</span> ImageResizer.ExtensionMethods;
<a name="l00019"></a>00019 
<a name="l00020"></a><a class="code" href="namespace_image_resizer_1_1_plugins_1_1_wpf_builder.html">00020</a> <span class="keyword">namespace </span>ImageResizer.Plugins.WpfBuilder
<a name="l00021"></a>00021 {
<a name="l00022"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_image_settings.html">00022</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_image_settings.html">WpfImageSettings</a> 
<a name="l00023"></a>00023     {<span class="comment"></span>
<a name="l00024"></a>00024 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00025"></a>00025 <span class="comment">        /// The x offset (positive or negative) used to draw the image rect inside the DrawingContext</span>
<a name="l00026"></a>00026 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00027"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_image_settings.html#ab0cc2e70ce481c2305d02f3b7496d28b">00027</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">float</span> OffsetX { <span class="keyword">get</span>; <span class="keyword">set</span>; }
<a name="l00028"></a>00028 <span class="comment"></span>
<a name="l00029"></a>00029 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00030"></a>00030 <span class="comment">        /// The y offset (positive or negative) used to draw the image rect inside the DrawingContext</span>
<a name="l00031"></a>00031 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00032"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_image_settings.html#a694c72469bb77a19a29abec3af5697f6">00032</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">float</span> OffsetY { <span class="keyword">get</span>; <span class="keyword">set</span>; }
<a name="l00033"></a>00033 <span class="comment"></span>
<a name="l00034"></a>00034 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00035"></a>00035 <span class="comment">        /// The final visible image width</span>
<a name="l00036"></a>00036 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00037"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_image_settings.html#a5a109a873cdaf1c2d656fe4575664499">00037</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">float</span> DestinationImageCanvasWidth { <span class="keyword">get</span>; <span class="keyword">set</span>; }
<a name="l00038"></a>00038 <span class="comment"></span>
<a name="l00039"></a>00039 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00040"></a>00040 <span class="comment">        /// The final visible image height</span>
<a name="l00041"></a>00041 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00042"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_image_settings.html#aceeeb522545133fb893b54021ab6795c">00042</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">float</span> DestinationImageCanvasHeight { <span class="keyword">get</span>; <span class="keyword">set</span>; }
<a name="l00043"></a>00043 <span class="comment"></span>
<a name="l00044"></a>00044 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00045"></a>00045 <span class="comment">        /// The width of the image inside the rect drawned into the DrawingContext</span>
<a name="l00046"></a>00046 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00047"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_image_settings.html#aeba710c05caf82217635a0839ae966d5">00047</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">float</span> DestinationImageWidth { <span class="keyword">get</span>; <span class="keyword">set</span>; }
<a name="l00048"></a>00048 <span class="comment"></span>
<a name="l00049"></a>00049 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00050"></a>00050 <span class="comment">        /// The height of the image inside the rect drawned into the DrawingContext</span>
<a name="l00051"></a>00051 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00052"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_image_settings.html#ad43328ef7f6204f6a98d46a865b7bed4">00052</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">float</span> DestinationImageHeight { <span class="keyword">get</span>; <span class="keyword">set</span>; }
<a name="l00053"></a>00053 
<a name="l00054"></a>00054         <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_image_settings.html">WpfImageSettings</a>() { }
<a name="l00055"></a>00055     }
<a name="l00056"></a>00056 
<a name="l00057"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_builder_plugin.html">00057</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_builder_plugin.html">WpfBuilderPlugin</a> : <a class="code" href="class_image_resizer_1_1_resizing_1_1_builder_extension.html" title="Provides a useable base class that can be used to modify the behavior of ImageBuilder. When registered with an ImageBuilder instance, the ImageBuilder will call the corresponding methods on the extension prior to executing its own methods.">BuilderExtension</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html" title="All plugins must implement this. Enables web.config addition and removal.">IPlugin</a>, <a class="code" href="interface_image_resizer_1_1_configuration_1_1_issues_1_1_i_issue_provider.html">IIssueProvider</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_file_extension_plugin.html" title="For plugins that add support for new source file image extensions.">IFileExtensionPlugin</a>
<a name="l00058"></a>00058     {
<a name="l00059"></a>00059         <a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html">Config</a> c;
<a name="l00060"></a>00060         <span class="keyword">public</span> <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html" title="All plugins must implement this. Enables web.config addition and removal.">IPlugin</a> Install(Configuration.Config c)
<a name="l00061"></a>00061         {
<a name="l00062"></a>00062             c.Plugins.add_plugin(<span class="keyword">this</span>);
<a name="l00063"></a>00063             this.c = c;
<a name="l00064"></a>00064             <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00065"></a>00065         }
<a name="l00066"></a>00066 
<a name="l00067"></a>00067         <span class="keyword">public</span> <span class="keywordtype">bool</span> Uninstall(Configuration.Config c)
<a name="l00068"></a>00068         {
<a name="l00069"></a>00069             c.Plugins.remove_plugin(<span class="keyword">this</span>);
<a name="l00070"></a>00070             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00071"></a>00071         }
<a name="l00072"></a>00072 
<a name="l00073"></a>00073         <span class="keyword">private</span> <span class="keywordtype">void</span> calculateImageSize(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> imageState, out <span class="keywordtype">int</span> destWidth, out <span class="keywordtype">int</span> destHeight) 
<a name="l00074"></a>00074         {
<a name="l00075"></a>00075             destWidth = 0;
<a name="l00076"></a>00076             destHeight = 0;
<a name="l00077"></a>00077 
<a name="l00078"></a>00078             destHeight = Convert.ToInt32(imageState.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>[<span class="stringliteral">&quot;image&quot;</span>][3].Y - imageState.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>[<span class="stringliteral">&quot;image&quot;</span>][0].Y);
<a name="l00079"></a>00079             destWidth = Convert.ToInt32(imageState.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>[<span class="stringliteral">&quot;image&quot;</span>][1].X - imageState.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>[<span class="stringliteral">&quot;image&quot;</span>][3].X);
<a name="l00080"></a>00080         }
<a name="l00081"></a>00081 
<a name="l00082"></a>00082         <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> BuildJob(<a class="code" href="class_image_resizer_1_1_image_job.html">ImageJob</a> job)
<a name="l00083"></a>00083         {
<a name="l00084"></a>00084             <span class="keywordflow">if</span> (!<span class="stringliteral">&quot;wpf&quot;</span>.Equals(job.<a class="code" href="class_image_resizer_1_1_image_job.html#ab835a4dde8a2962bbe48182641316cee" title="The image processing settings.">Settings</a>[<span class="stringliteral">&quot;builder&quot;</span>])) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00085"></a>00085 
<a name="l00086"></a>00086             <span class="comment">// Estrazione delle ResizeSettings</span>
<a name="l00087"></a>00087             <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings = job.<a class="code" href="class_image_resizer_1_1_image_job.html#ab835a4dde8a2962bbe48182641316cee" title="The image processing settings.">Settings</a>;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089 
<a name="l00090"></a>00090             Stream s = null;
<a name="l00091"></a>00091             <span class="keywordtype">bool</span> disposeStream = !(job.<a class="code" href="class_image_resizer_1_1_image_job.html#a0d47d299ecd8a7316ba4a56d28e246b2" title="The source image&#39;s physical path, app-relative virtual path, or a Stream, byte array, Bitmap, VirtualFile, IVirtualFile, HttpPostedFile, or HttpPostedFileBase instance.">Source</a> is Stream);
<a name="l00092"></a>00092             <span class="keywordtype">long</span> originalPosition = 0;
<a name="l00093"></a>00093             <span class="keywordtype">bool</span> restoreStreamPosition = <span class="keyword">false</span>;
<a name="l00094"></a>00094 
<a name="l00095"></a>00095             <span class="keywordtype">string</span> path;
<a name="l00096"></a>00096             s = c.CurrentImageBuilder.GetStreamFromSource(job.<a class="code" href="class_image_resizer_1_1_image_job.html#a0d47d299ecd8a7316ba4a56d28e246b2" title="The source image&#39;s physical path, app-relative virtual path, or a Stream, byte array, Bitmap, VirtualFile, IVirtualFile, HttpPostedFile, or HttpPostedFileBase instance.">Source</a>, job.<a class="code" href="class_image_resizer_1_1_image_job.html#ab835a4dde8a2962bbe48182641316cee" title="The image processing settings.">Settings</a>, ref disposeStream, out path, out restoreStreamPosition);
<a name="l00097"></a>00097             <span class="keywordflow">if</span> (s == null) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None; <span class="comment">//We don&#39;t support the source object!</span>
<a name="l00098"></a>00098             <span class="keywordflow">if</span> (job.<a class="code" href="class_image_resizer_1_1_image_job.html#aa6cb13a20ee55698d62de78f6d749d07" title="If true, and if &#39;source&#39; is seekable, the stream will be reset to its previous position after being r...">ResetSourceStream</a>) restoreStreamPosition = <span class="keyword">true</span>;
<a name="l00099"></a>00099             job.<a class="code" href="class_image_resizer_1_1_image_job.html#abcb3343acc3389bbefeae232b2a26773" title="If &#39;source&#39; contains any path-related data, it is copied into this member for use by format detetctio...">SourcePathData</a> = path;
<a name="l00100"></a>00100 
<a name="l00101"></a>00101             <span class="comment">// Instanzio uno stream locale per le operazioni WPF</span>
<a name="l00102"></a>00102             <span class="keyword">using</span> (MemoryStream localStream = (s is MemoryStream) ? (MemoryStream)s : s.CopyToMemoryStream()) 
<a name="l00103"></a>00103             {
<a name="l00104"></a>00104                 <span class="keywordflow">if</span> (s != null &amp;&amp; restoreStreamPosition &amp;&amp; s.CanSeek) 
<a name="l00105"></a>00105                     s.Seek(originalPosition, SeekOrigin.Begin);
<a name="l00106"></a>00106 
<a name="l00107"></a>00107                 <span class="keywordflow">if</span> (disposeStream) 
<a name="l00108"></a>00108                     s.Dispose();
<a name="l00109"></a>00109 
<a name="l00110"></a>00110                 <span class="comment">/* ? ? ? */</span>
<a name="l00111"></a>00111                 <a class="code" href="interface_image_resizer_1_1_encoding_1_1_i_encoder.html" title="An image encoder. Exposes methods for suitability checking, encoding, transparency compatibility chec...">IEncoder</a> managedEncoder = c.Plugins.GetEncoder(job.<a class="code" href="class_image_resizer_1_1_image_job.html#ab835a4dde8a2962bbe48182641316cee" title="The image processing settings.">Settings</a>, job.<a class="code" href="class_image_resizer_1_1_image_job.html#abcb3343acc3389bbefeae232b2a26773" title="If &#39;source&#39; contains any path-related data, it is copied into this member for use by format detetctio...">SourcePathData</a>);
<a name="l00112"></a>00112                 <span class="keywordtype">bool</span> supportsTransparency = managedEncoder.<a class="code" href="interface_image_resizer_1_1_encoding_1_1_i_encoder.html#adb440f5f1d5b9a4ba55df65163cc8c40" title="True if the output format will support transparency as it is currently configured.">SupportsTransparency</a>;
<a name="l00113"></a>00113 
<a name="l00114"></a>00114                 <span class="comment">// Recupero le dimensioni originali</span>
<a name="l00115"></a>00115                 var frame = BitmapFrame.Create(localStream.CopyToMemoryStream());
<a name="l00116"></a>00116                 System.Windows.Size originalSize = <span class="keyword">new</span> System.Windows.Size(frame.PixelWidth, frame.PixelHeight);
<a name="l00117"></a>00117 
<a name="l00118"></a>00118                 <span class="comment">// Resetto lo stream locale alla posizione iniziale, dopo aver letto i metadata</span>
<a name="l00119"></a>00119                 localStream.Position = 0;
<a name="l00120"></a>00120 
<a name="l00121"></a>00121 
<a name="l00122"></a>00122 
<a name="l00123"></a>00123                 <span class="comment">// Uhm... sono costretto a referenziare le System.Drawing (GDI) per questo,</span>
<a name="l00124"></a>00124                 <span class="comment">// TODO: chiedere al tipo se si puÃ² prevedere un costruttore di ImageState che non preveda un System.Drawing.Size come parametro</span>
<a name="l00125"></a>00125                 System.Drawing.Size orig = <span class="keyword">new</span> System.Drawing.Size((<span class="keywordtype">int</span>)originalSize.Width, (<span class="keywordtype">int</span>)originalSize.Height);
<a name="l00126"></a>00126 
<a name="l00127"></a>00127                 <span class="keyword">using</span> (<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> imageState = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a>(settings, orig, <span class="keyword">true</span>))
<a name="l00128"></a>00128                 {
<a name="l00129"></a>00129                     c.CurrentImageBuilder.Process(imageState);
<a name="l00130"></a>00130 
<a name="l00131"></a>00131                     Rectangle imageDest = <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html" title="Defines a collection of utility functions for manipulating polygons. These functions may be (re)moved...">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a61b50db80ba6c732565d07ef6163c0a0" title="Rounds a floating-point rectangle to an integer rectangle using System.Round.">ToRectangle</a>(<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html" title="Defines a collection of utility functions for manipulating polygons. These functions may be (re)moved...">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a2a0699cc81aa9335505c77939c6ba4bd" title="Returns a bounding box for the specified set of points.">GetBoundingBox</a>(imageState.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>[<span class="stringliteral">&quot;image&quot;</span>]));
<a name="l00132"></a>00132 
<a name="l00133"></a>00133                     BitmapSource finalImage;
<a name="l00134"></a>00134 
<a name="l00135"></a>00135                     BitmapImage bi = <span class="keyword">new</span> BitmapImage();
<a name="l00136"></a>00136                     bi.CacheOption = BitmapCacheOption.OnLoad;
<a name="l00137"></a>00137                     bi.BeginInit();
<a name="l00138"></a>00138                     bi.StreamSource = localStream;
<a name="l00139"></a>00139 
<a name="l00140"></a>00140 
<a name="l00141"></a>00141                     <a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_image_settings.html">WpfImageSettings</a> wpfImageSettings = imageState.WpfDestinationImageSettings(settings);
<a name="l00142"></a>00142 
<a name="l00143"></a>00143                     bi.DecodePixelWidth = Convert.ToInt32(wpfImageSettings.<a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_image_settings.html#aeba710c05caf82217635a0839ae966d5" title="The width of the image inside the rect drawned into the DrawingContext.">DestinationImageWidth</a>);
<a name="l00144"></a>00144                     bi.DecodePixelHeight = Convert.ToInt32(wpfImageSettings.<a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_image_settings.html#ad43328ef7f6204f6a98d46a865b7bed4" title="The height of the image inside the rect drawned into the DrawingContext.">DestinationImageHeight</a>);
<a name="l00145"></a>00145                     bi.EndInit();
<a name="l00146"></a>00146 
<a name="l00147"></a>00147                     <span class="comment">// Creation of the encoder</span>
<a name="l00148"></a>00148                     <a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_encoder_plugin.html">WpfEncoderPlugin</a> wpfEncoder = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_encoder_plugin.html">WpfEncoderPlugin</a>(settings, job.<a class="code" href="class_image_resizer_1_1_image_job.html#abcb3343acc3389bbefeae232b2a26773" title="If &#39;source&#39; contains any path-related data, it is copied into this member for use by format detetctio...">SourcePathData</a>);
<a name="l00149"></a>00149 
<a name="l00150"></a>00150 
<a name="l00151"></a>00151                     RenderTargetBitmap <span class="keyword">final</span> = <span class="keyword">new</span> RenderTargetBitmap(imageState.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#ab7d7513afe8fad1300bf8cb96942f06f" title="The dimensions of the bitmap afer all operations have been applied to it (Calling FlipRotate can chan...">finalSize</a>.Width, imageState.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#ab7d7513afe8fad1300bf8cb96942f06f" title="The dimensions of the bitmap afer all operations have been applied to it (Calling FlipRotate can chan...">finalSize</a>.Height, settings.Get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;dpi&quot;</span>, 96), settings.Get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;dpi&quot;</span>, 96), PixelFormats.Default);
<a name="l00152"></a>00152                     DrawingVisual dv = <span class="keyword">new</span> DrawingVisual();
<a name="l00153"></a>00153 
<a name="l00154"></a>00154                     <span class="keyword">using</span> (DrawingContext dc = dv.RenderOpen())
<a name="l00155"></a>00155                     {
<a name="l00156"></a>00156                         <span class="keywordtype">string</span> ARGBBackgroundColor = String.Format(<span class="stringliteral">&quot;#{0:X2}{1:X2}{2:X2}{3:X2}&quot;</span>, wpfEncoder.<a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_default_encoder.html#a2e1e40a944c8d1167d5aa07bdb104477" title="Returns the default mime-type for the OutputFormat.">MimeType</a>.Equals(<span class="stringliteral">&quot;image/jpeg&quot;</span>) ? 255 : settings.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a40623c01b19422d9dc93b8809ef3dbc2" title="[&quot;bgcolor&quot;]: Named and hex values are supported. (rgb and rgba, both 3, 6, and 8 digits).">BackgroundColor</a>.A, 
<a name="l00157"></a>00157                                                                                                 settings.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a40623c01b19422d9dc93b8809ef3dbc2" title="[&quot;bgcolor&quot;]: Named and hex values are supported. (rgb and rgba, both 3, 6, and 8 digits).">BackgroundColor</a>.R, 
<a name="l00158"></a>00158                                                                                                 settings.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a40623c01b19422d9dc93b8809ef3dbc2" title="[&quot;bgcolor&quot;]: Named and hex values are supported. (rgb and rgba, both 3, 6, and 8 digits).">BackgroundColor</a>.G, 
<a name="l00159"></a>00159                                                                                                 settings.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a40623c01b19422d9dc93b8809ef3dbc2" title="[&quot;bgcolor&quot;]: Named and hex values are supported. (rgb and rgba, both 3, 6, and 8 digits).">BackgroundColor</a>.B);
<a name="l00160"></a>00160 
<a name="l00161"></a>00161                         System.Windows.Media.Brush BrushBackgroundColor = <span class="keyword">new</span> System.Windows.Media.SolidColorBrush((System.Windows.Media.Color)System.Windows.Media.ColorConverter.ConvertFromString(ARGBBackgroundColor));
<a name="l00162"></a>00162 
<a name="l00163"></a>00163                         <span class="comment">/* todo: verificare */</span>
<a name="l00164"></a>00164                         dc.DrawRectangle(BrushBackgroundColor, null, <span class="keyword">new</span> Rect(0, 0, wpfImageSettings.<a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_image_settings.html#aeba710c05caf82217635a0839ae966d5" title="The width of the image inside the rect drawned into the DrawingContext.">DestinationImageWidth</a>, wpfImageSettings.<a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_image_settings.html#ad43328ef7f6204f6a98d46a865b7bed4" title="The height of the image inside the rect drawned into the DrawingContext.">DestinationImageHeight</a>));
<a name="l00165"></a>00165 
<a name="l00166"></a>00166                         Rect rect = <span class="keyword">new</span> Rect(wpfImageSettings.<a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_image_settings.html#ab0cc2e70ce481c2305d02f3b7496d28b" title="The x offset (positive or negative) used to draw the image rect inside the DrawingContext.">OffsetX</a>, wpfImageSettings.<a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_image_settings.html#a694c72469bb77a19a29abec3af5697f6" title="The y offset (positive or negative) used to draw the image rect inside the DrawingContext.">OffsetY</a>, wpfImageSettings.<a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_image_settings.html#aeba710c05caf82217635a0839ae966d5" title="The width of the image inside the rect drawned into the DrawingContext.">DestinationImageWidth</a>, wpfImageSettings.<a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_image_settings.html#ad43328ef7f6204f6a98d46a865b7bed4" title="The height of the image inside the rect drawned into the DrawingContext.">DestinationImageHeight</a>);
<a name="l00167"></a>00167 
<a name="l00168"></a>00168                         <span class="comment">//dc.PushTransform(new RotateTransform(settings.Rotate, (double)imageState.finalSize.Width / 2, (double)imageState.finalSize.Height / 2));</span>
<a name="l00169"></a>00169                         
<a name="l00170"></a>00170                         dc.DrawImage(bi, rect);
<a name="l00171"></a>00171                     }
<a name="l00172"></a>00172                     
<a name="l00173"></a>00173                     <span class="keyword">final</span>.Render(dv);
<a name="l00174"></a>00174                     finalImage = <span class="keyword">final</span>;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176                     <span class="comment">// Write the image to the output stream</span>
<a name="l00177"></a>00177                     wpfEncoder.Write(finalImage, (Stream)job.<a class="code" href="class_image_resizer_1_1_image_job.html#a04c90612666b1834d038ae9a4bac67b5" title="The destination Stream, physical path, or app-relative virtual path. If a Bitmap instance is desired...">Dest</a>);
<a name="l00178"></a>00178                 }
<a name="l00179"></a>00179             }
<a name="l00180"></a>00180             
<a name="l00181"></a>00181             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00182"></a>00182         }
<a name="l00183"></a>00183 
<a name="l00184"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_builder_plugin.html#a6373caeba27688f0523abdef2dbc6405">00184</a>         <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a> LayoutImage(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s) 
<a name="l00185"></a>00185         {
<a name="l00186"></a>00186             base.LayoutImage(s);
<a name="l00187"></a>00187 
<a name="l00188"></a>00188             <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86" title="What to do about remaining handlers/methods for the specified section.">RequestedAction</a>.None;
<a name="l00189"></a>00189         }
<a name="l00190"></a>00190 
<a name="l00191"></a>00191 
<a name="l00192"></a>00192         <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_builder_plugin.html">WpfBuilderPlugin</a>() { }
<a name="l00193"></a>00193 
<a name="l00194"></a>00194 
<a name="l00195"></a>00195 <span class="preprocessor">        #region IIssueProvider Members</span>
<a name="l00196"></a>00196 <span class="preprocessor"></span>
<a name="l00197"></a>00197         <span class="keyword">public</span> IEnumerable&lt;IIssue&gt; GetIssues()
<a name="l00198"></a>00198         {
<a name="l00199"></a>00199             <span class="keywordflow">throw</span> <span class="keyword">new</span> NotImplementedException();
<a name="l00200"></a>00200         }
<a name="l00201"></a>00201 
<a name="l00202"></a>00202 <span class="preprocessor">        #endregion</span>
<a name="l00203"></a>00203 <span class="preprocessor"></span>
<a name="l00204"></a>00204 <span class="preprocessor">        #region IFileExtensionPlugin Members</span>
<a name="l00205"></a>00205 <span class="preprocessor"></span>
<a name="l00206"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_wpf_builder_1_1_wpf_builder_plugin.html#a74487d8ce9ca4e7a79349b2b505add05">00206</a>         <span class="keyword">public</span> IEnumerable&lt;string&gt; GetSupportedFileExtensions()
<a name="l00207"></a>00207         {
<a name="l00208"></a>00208             <span class="keywordflow">return</span> <span class="keyword">new</span> <span class="keywordtype">string</span>[] { };
<a name="l00209"></a>00209         }
<a name="l00210"></a>00210 
<a name="l00211"></a>00211 <span class="preprocessor">        #endregion</span>
<a name="l00212"></a>00212 <span class="preprocessor"></span>    }
<a name="l00213"></a>00213 }
<a name="l00214"></a>00214 
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
