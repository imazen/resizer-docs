<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ImageResizer: C:/Users/Administrator/Documents/resizer/Plugins/Watermark/LegacyWatermarkFeatures.cs Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="resizer-icon-64.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.1.3</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">C:/Users/Administrator/Documents/resizer/Plugins/Watermark/LegacyWatermarkFeatures.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 ï»¿<span class="comment">/* Copyright (c) 2011 Nathanael Jones. See license.txt for your rights. */</span>
<a name="l00002"></a>00002 <span class="keyword">using</span> System;
<a name="l00003"></a>00003 <span class="keyword">using</span> System.Collections.Generic;
<a name="l00004"></a>00004 <span class="keyword">using</span> System.Text;
<a name="l00005"></a>00005 <span class="keyword">using</span> System.Collections.Specialized;
<a name="l00006"></a>00006 <span class="keyword">using</span> System.Drawing;
<a name="l00007"></a>00007 <span class="keyword">using</span> System.Web;
<a name="l00008"></a>00008 <span class="keyword">using</span> ImageResizer.Util;
<a name="l00009"></a>00009 <span class="keyword">using</span> ImageResizer.Resizing;
<a name="l00010"></a>00010 <span class="keyword">using</span> System.Web.Hosting;
<a name="l00011"></a>00011 <span class="keyword">using</span> ImageResizer.Configuration;
<a name="l00012"></a>00012 <span class="keyword">using</span> System.Web.Caching;
<a name="l00013"></a>00013 
<a name="l00014"></a>00014 <span class="keyword">namespace </span>ImageResizer.Plugins.Watermark {<span class="comment"></span>
<a name="l00015"></a>00015 <span class="comment">    /// &lt;summary&gt;</span>
<a name="l00016"></a>00016 <span class="comment">    /// Provides extensibility points for drawing watermarks and even modifying resizing/image settings</span>
<a name="l00017"></a>00017 <span class="comment">    /// &lt;/summary&gt;</span>
<a name="l00018"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_watermark_1_1_legacy_watermark_features.html">00018</a> <span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_image_resizer_1_1_plugins_1_1_watermark_1_1_legacy_watermark_features.html" title="Provides extensibility points for drawing watermarks and even modifying resizing/image settings...">LegacyWatermarkFeatures</a> : <a class="code" href="class_image_resizer_1_1_resizing_1_1_builder_extension.html" title="Provides a useable base class that can be used to modify the behavior of ImageBuilder. When registered with an ImageBuilder instance, the ImageBuilder will call the corresponding methods on the extension prior to executing its own methods.">BuilderExtension</a> {
<a name="l00019"></a>00019         [Obsolete(<span class="stringliteral">&quot;Use .OtherImages.Path instead&quot;</span>)]
<a name="l00020"></a>00020         <span class="keyword">public</span> <span class="keywordtype">string</span> watermarkDir = null;
<a name="l00021"></a>00021         [Obsolete(<span class="stringliteral">&quot;Use. OtherImages.Width/Height or a named preset instead&quot;</span>)]
<a name="l00022"></a>00022         <span class="keyword">public</span> SizeF watermarkSize = <span class="keyword">new</span> SizeF(1, 1);
<a name="l00023"></a>00023         [Obsolete(<span class="stringliteral">&quot;Use .OtherImages instead - it permits percentage and pixel values to be mixed.&quot;</span>)]
<a name="l00024"></a>00024         <span class="keyword">public</span> Boolean valuesPercentages = <span class="keyword">true</span>;
<a name="l00025"></a>00025         
<a name="l00026"></a>00026         <span class="keyword">public</span> Boolean keepAspectRatio = <span class="keyword">true</span>;
<a name="l00027"></a>00027         [Obsolete(<span class="stringliteral">&quot;Use .OtherImages.Top/Left or an xml preset instead. &quot;</span>)]
<a name="l00028"></a>00028         <span class="keyword">public</span> SizeF topLeftPadding = <span class="keyword">new</span> SizeF(0, 0);
<a name="l00029"></a>00029         [Obsolete(<span class="stringliteral">&quot;Use .OtherImages.Bottom/Right or an xml preset instead.&quot;</span>)]
<a name="l00030"></a>00030         <span class="keyword">public</span> SizeF bottomRightPadding = <span class="keyword">new</span> SizeF(0, 0);
<a name="l00031"></a>00031         [Obsolete(<span class="stringliteral">&quot;New behavior defaults to true&quot;</span>)]
<a name="l00032"></a>00032         <span class="keyword">public</span> Boolean hideIfTooSmall = <span class="keyword">false</span>;
<a name="l00033"></a>00033         [Obsolete(<span class="stringliteral">&quot;Use .OtherImages.Align or an xml preset instead.&quot;</span>)]
<a name="l00034"></a>00034         <span class="keyword">public</span> System.Drawing.ContentAlignment align = ContentAlignment.MiddleCenter;
<a name="l00035"></a>00035 
<a name="l00036"></a>00036 
<a name="l00037"></a>00037         <span class="keyword">protected</span> <a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html">Config</a> c;
<a name="l00038"></a>00038         
<a name="l00039"></a>00039 <span class="comment"></span>
<a name="l00040"></a>00040 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00041"></a>00041 <span class="comment">        /// Loads a bitmap, cached using asp.net&#39;s cache</span>
<a name="l00042"></a>00042 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00043"></a>00043 <span class="comment">        /// &lt;param name=&quot;localfile&quot;&gt;&lt;/param&gt;</span>
<a name="l00044"></a>00044 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00045"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_watermark_1_1_legacy_watermark_features.html#ad4f927e6cd43926ad66536dabd5ba0ed">00045</a> <span class="comment"></span>        <span class="keyword">public</span> Bitmap <a class="code" href="class_image_resizer_1_1_plugins_1_1_watermark_1_1_legacy_watermark_features.html#ad4f927e6cd43926ad66536dabd5ba0ed" title="Loads a bitmap, cached using asp.net&#39;s cache.">GetMemCachedBitmap</a>(<span class="keywordtype">string</span> virtualPath) {
<a name="l00046"></a>00046             <span class="comment">//If not ASP.NET, don&#39;t cache.</span>
<a name="l00047"></a>00047             <span class="keywordflow">if</span> (HttpContext.Current == null) <span class="keywordflow">return</span> c.CurrentImageBuilder.LoadImage(virtualPath, <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a>());
<a name="l00048"></a>00048 
<a name="l00049"></a>00049             <span class="keywordtype">string</span> key = virtualPath.ToLowerInvariant();
<a name="l00050"></a>00050             Bitmap b = HttpContext.Current.Cache[key] as Bitmap;
<a name="l00051"></a>00051             <span class="keywordflow">if</span> (b != null) <span class="keywordflow">return</span> b;
<a name="l00052"></a>00052 
<a name="l00053"></a>00053             b = c.CurrentImageBuilder.LoadImage(virtualPath, <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a>());
<a name="l00054"></a>00054             <span class="comment">//Query VPPs for cache dependency. TODO: Add support for IVirtualImageProviders to customize cache dependencies.</span>
<a name="l00055"></a>00055             CacheDependency cd = null;
<a name="l00056"></a>00056             <span class="keywordflow">if</span> (HostingEnvironment.VirtualPathProvider != null) cd = HostingEnvironment.VirtualPathProvider.GetCacheDependency(virtualPath, <span class="keyword">new</span> <span class="keywordtype">string</span>[] { }, DateTime.UtcNow);
<a name="l00057"></a>00057 
<a name="l00058"></a>00058             HttpContext.Current.Cache.Insert(key, b, cd);
<a name="l00059"></a>00059             <span class="keywordflow">return</span> b;
<a name="l00060"></a>00060         }
<a name="l00061"></a>00061 
<a name="l00062"></a>00062 
<a name="l00063"></a>00063         <span class="keyword">protected</span> <span class="keywordtype">bool</span> LegacyDrawWatermark(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html" title="Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...">ImageState</a> s) {
<a name="l00064"></a>00064             <span class="keywordtype">string</span> watermark = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>[<span class="stringliteral">&quot;watermark&quot;</span>]; <span class="comment">//from the querystring</span>
<a name="l00065"></a>00065             Graphics g = s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a14723e4f7de63667e37fcbdb6a00055b" title="A graphics object to write to the destination bitmap. If null, skip drawing commands, but continue layout logic.">destGraphics</a>;
<a name="l00066"></a>00066             <span class="keywordflow">if</span> (<span class="keywordtype">string</span>.IsNullOrEmpty(watermark) || g == null) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00067"></a>00067 
<a name="l00068"></a>00068             <span class="keywordflow">if</span> (watermarkDir == null) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00069"></a>00069 
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 
<a name="l00072"></a>00072             RectangleF imageBox = <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a2a0699cc81aa9335505c77939c6ba4bd" title="Returns a bounding box for the specified set of points.">GetBoundingBox</a>(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e" title="The layout object. Used for calculated and flowing the layout of the various rings around the image (...">layout</a>[<span class="stringliteral">&quot;image&quot;</span>]);
<a name="l00073"></a>00073             <span class="comment">//Floor and cieling values to prevent fractional placement.</span>
<a name="l00074"></a>00074             imageBox.Width = (float)Math.Floor(imageBox.Width);
<a name="l00075"></a>00075             imageBox.Height = (float)Math.Floor(imageBox.Height);
<a name="l00076"></a>00076             imageBox.X = (float)Math.Ceiling(imageBox.X);
<a name="l00077"></a>00077             imageBox.Y = (float)Math.Ceiling(imageBox.Y);
<a name="l00078"></a>00078 
<a name="l00079"></a>00079             <span class="keywordflow">if</span> (watermark.IndexOfAny(System.IO.Path.GetInvalidFileNameChars()) &gt; -1 ||
<a name="l00080"></a>00080                 watermark.IndexOfAny(<span class="keyword">new</span> <span class="keywordtype">char</span>[] { <span class="charliteral">&#39;\\&#39;</span>, <span class="charliteral">&#39;/&#39;</span> }) &gt; -1)
<a name="l00081"></a>00081                 <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00082"></a>00082 
<a name="l00083"></a>00083             <span class="comment">//Combine the directory with the base dir</span>
<a name="l00084"></a>00084 
<a name="l00085"></a>00085             <span class="comment">//Is watermarkDir a physical path?</span>
<a name="l00086"></a>00086             <span class="keywordtype">char</span> slash = watermarkDir.Contains(<span class="stringliteral">&quot;/&quot;</span>) ? <span class="charliteral">&#39;/&#39;</span> : <span class="charliteral">&#39;\\&#39;</span>;
<a name="l00087"></a>00087 
<a name="l00088"></a>00088             watermark = watermarkDir.TrimEnd(slash) + slash + watermark.TrimStart(slash);
<a name="l00089"></a>00089 
<a name="l00090"></a>00090             <span class="comment">//Verify the file exists if we&#39;re in ASP.NET. If the watermark doesn&#39;t exist, skip watermarking.</span>
<a name="l00091"></a>00091             <span class="keywordflow">if</span> (!c.Pipeline.FileExists(watermark, s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179" title="The commands to apply to the bitmap.">settings</a>) &amp;&amp; slash == <span class="charliteral">&#39;/&#39;</span>) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00092"></a>00092 
<a name="l00093"></a>00093             SizeF watermarkSize = this.watermarkSize;
<a name="l00094"></a>00094             SizeF topLeftPadding = this.topLeftPadding;
<a name="l00095"></a>00095             SizeF bottomRightPadding = this.bottomRightPadding;
<a name="l00096"></a>00096 
<a name="l00097"></a>00097 
<a name="l00098"></a>00098             <span class="comment">//Load the file specified in the querystring,</span>
<a name="l00099"></a>00099             Bitmap wb = GetMemCachedBitmap(watermark);
<a name="l00100"></a>00100             lock (wb) {
<a name="l00101"></a>00101                 <span class="comment">//If percentages, resolve to pixels</span>
<a name="l00102"></a>00102                 <span class="keywordflow">if</span> (valuesPercentages) {
<a name="l00103"></a>00103                     <span class="comment">//Force into 0..1 range, inclusive.</span>
<a name="l00104"></a>00104                     watermarkSize.Height = Math.Max(0, Math.Min(1, watermarkSize.Height));
<a name="l00105"></a>00105                     watermarkSize.Width = Math.Max(0, Math.Min(1, watermarkSize.Width));
<a name="l00106"></a>00106                     topLeftPadding.Height = Math.Max(0, Math.Min(1, topLeftPadding.Height));
<a name="l00107"></a>00107                     topLeftPadding.Width = Math.Max(0, Math.Min(1, topLeftPadding.Width));
<a name="l00108"></a>00108                     bottomRightPadding.Height = Math.Max(0, Math.Min(1, bottomRightPadding.Height));
<a name="l00109"></a>00109                     bottomRightPadding.Width = Math.Max(0, Math.Min(1, bottomRightPadding.Width));
<a name="l00110"></a>00110 
<a name="l00111"></a>00111                     <span class="comment">//Make sure everything adds up to 1</span>
<a name="l00112"></a>00112                     <span class="keywordtype">double</span> totalWidth = watermarkSize.Width + topLeftPadding.Width + bottomRightPadding.Width;
<a name="l00113"></a>00113                     <span class="keywordflow">if</span> (totalWidth &gt; 1) {
<a name="l00114"></a>00114                         totalWidth = 1 / totalWidth; <span class="comment">//Turn it into the factor we have to multiple by to make everything fit.</span>
<a name="l00115"></a>00115                         watermarkSize.Width *= (float)totalWidth;
<a name="l00116"></a>00116                         topLeftPadding.Width *= (float)totalWidth;
<a name="l00117"></a>00117                         bottomRightPadding.Width *= (float)totalWidth;
<a name="l00118"></a>00118                     }
<a name="l00119"></a>00119                     <span class="keywordtype">double</span> totalHeight = watermarkSize.Height + topLeftPadding.Height + bottomRightPadding.Height;
<a name="l00120"></a>00120                     <span class="keywordflow">if</span> (totalHeight &gt; 1) {
<a name="l00121"></a>00121                         totalHeight = 1 / totalHeight; <span class="comment">//Turn it into the factor we have to multiply by to make everything fit.</span>
<a name="l00122"></a>00122                         watermarkSize.Height *= (float)totalHeight;
<a name="l00123"></a>00123                         topLeftPadding.Height *= (float)totalHeight;
<a name="l00124"></a>00124                         bottomRightPadding.Height *= (float)totalHeight;
<a name="l00125"></a>00125                     }
<a name="l00126"></a>00126 
<a name="l00127"></a>00127                     <span class="comment">//Now, we can resolve the percentages to pixels.</span>
<a name="l00128"></a>00128                     watermarkSize.Height *= imageBox.Height;
<a name="l00129"></a>00129                     watermarkSize.Width *= imageBox.Width;
<a name="l00130"></a>00130                     topLeftPadding.Height *= imageBox.Height;
<a name="l00131"></a>00131                     topLeftPadding.Width *= imageBox.Width;
<a name="l00132"></a>00132                     bottomRightPadding.Height *= imageBox.Height;
<a name="l00133"></a>00133                     bottomRightPadding.Width *= imageBox.Width;
<a name="l00134"></a>00134                 }
<a name="l00135"></a>00135 
<a name="l00136"></a>00136                 <span class="comment">//Keep aspect ratio, shrinking further if needed.</span>
<a name="l00137"></a>00137                 <span class="keywordflow">if</span> (keepAspectRatio) watermarkSize = <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#aaccb0b4261dc176f5ad25b4bb09fd55f" title="Scales &#39;inner&#39; to fit inside &#39;bounding&#39; while maintaining aspect ratio. Only downscales.">DownScaleInside</a>(wb.Size, watermarkSize);
<a name="l00138"></a>00138 
<a name="l00139"></a>00139 
<a name="l00140"></a>00140                 <span class="comment">//Floor all values to avoid rounding errors and blurry lines.</span>
<a name="l00141"></a>00141                 watermarkSize = <span class="keyword">new</span> SizeF((<span class="keywordtype">float</span>)Math.Floor(watermarkSize.Width), (float)Math.Floor(watermarkSize.Height));
<a name="l00142"></a>00142                 topLeftPadding = <span class="keyword">new</span> SizeF((<span class="keywordtype">float</span>)Math.Floor(topLeftPadding.Width), (float)Math.Floor(topLeftPadding.Height));
<a name="l00143"></a>00143                 bottomRightPadding = <span class="keyword">new</span> SizeF((<span class="keywordtype">float</span>)Math.Floor(bottomRightPadding.Width), (float)Math.Floor(bottomRightPadding.Height));
<a name="l00144"></a>00144 
<a name="l00145"></a>00145 
<a name="l00146"></a>00146                 <span class="comment">//Check boundingbox</span>
<a name="l00147"></a>00147                 SizeF watermarkBoundingBox = <span class="keyword">new</span> SizeF(watermarkSize.Width + topLeftPadding.Width + bottomRightPadding.Width,
<a name="l00148"></a>00148                     watermarkSize.Height + topLeftPadding.Height + bottomRightPadding.Height);
<a name="l00149"></a>00149 
<a name="l00150"></a>00150                 <span class="comment">//Don&#39;t draw the watermark if it is too small.</span>
<a name="l00151"></a>00151                 <span class="keywordflow">if</span> (!<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a98c83ada594ba88b34d97d26176f8ada" title="Returns true if &#39;inner&#39; fits inside or equals &#39;outer&#39;.">FitsInside</a>(watermarkBoundingBox, imageBox.Size)) {
<a name="l00152"></a>00152                     <span class="keywordflow">if</span> (hideIfTooSmall) <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00153"></a>00153                     <span class="keywordflow">else</span> {
<a name="l00154"></a>00154                         SizeF oldSize = watermarkBoundingBox;
<a name="l00155"></a>00155                         watermarkBoundingBox = <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#aaccb0b4261dc176f5ad25b4bb09fd55f" title="Scales &#39;inner&#39; to fit inside &#39;bounding&#39; while maintaining aspect ratio. Only downscales.">DownScaleInside</a>(watermarkBoundingBox, imageBox.Size);
<a name="l00156"></a>00156                         watermarkSize.Width -= (oldSize.Width - watermarkBoundingBox.Width);
<a name="l00157"></a>00157                         watermarkSize.Height -= (oldSize.Height - watermarkBoundingBox.Height);
<a name="l00158"></a>00158                     }
<a name="l00159"></a>00159                 }
<a name="l00160"></a>00160                 <span class="comment">//Floor all values again</span>
<a name="l00161"></a>00161                 watermarkSize = <span class="keyword">new</span> SizeF((<span class="keywordtype">float</span>)Math.Floor(watermarkSize.Width), (float)Math.Floor(watermarkSize.Height));
<a name="l00162"></a>00162                 topLeftPadding = <span class="keyword">new</span> SizeF((<span class="keywordtype">float</span>)Math.Floor(topLeftPadding.Width), (float)Math.Floor(topLeftPadding.Height));
<a name="l00163"></a>00163                 bottomRightPadding = <span class="keyword">new</span> SizeF((<span class="keywordtype">float</span>)Math.Floor(bottomRightPadding.Width), (float)Math.Floor(bottomRightPadding.Height));
<a name="l00164"></a>00164 
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 
<a name="l00167"></a>00167                 <span class="keywordtype">float</span> innerWidth = (float)Math.Floor(imageBox.Width - Math.Abs(topLeftPadding.Width) - Math.Abs(bottomRightPadding.Width));
<a name="l00168"></a>00168                 <span class="keywordtype">float</span> innerHeight = (float)Math.Floor(imageBox.Height - Math.Abs(topLeftPadding.Height) - Math.Abs(bottomRightPadding.Height));
<a name="l00169"></a>00169 
<a name="l00170"></a>00170                 <span class="keywordtype">float</span> x = 0;
<a name="l00171"></a>00171                 <span class="keywordtype">float</span> y = 0;
<a name="l00172"></a>00172 
<a name="l00173"></a>00173                 <span class="keywordflow">if</span> (align == ContentAlignment.BottomCenter || align == ContentAlignment.BottomLeft || align == ContentAlignment.BottomRight)
<a name="l00174"></a>00174                     y = (innerHeight - watermarkSize.Height) + topLeftPadding.Height;
<a name="l00175"></a>00175 
<a name="l00176"></a>00176                 if (align == ContentAlignment.MiddleCenter || align == ContentAlignment.MiddleLeft || align == ContentAlignment.MiddleRight)
<a name="l00177"></a>00177                     y = (innerHeight - watermarkSize.Height) / 2 + topLeftPadding.Height;
<a name="l00178"></a>00178 
<a name="l00179"></a>00179                 if (align == ContentAlignment.TopCenter || align == ContentAlignment.TopLeft || align == ContentAlignment.TopRight)
<a name="l00180"></a>00180                     y = topLeftPadding.Height;
<a name="l00181"></a>00181 
<a name="l00182"></a>00182 
<a name="l00183"></a>00183                 <span class="keywordflow">if</span> (align == ContentAlignment.BottomRight || align == ContentAlignment.MiddleRight || align == ContentAlignment.TopRight)
<a name="l00184"></a>00184                     x = (innerWidth - watermarkSize.Width) + topLeftPadding.Width;
<a name="l00185"></a>00185 
<a name="l00186"></a>00186                 if (align == ContentAlignment.BottomCenter || align == ContentAlignment.MiddleCenter || align == ContentAlignment.TopCenter)
<a name="l00187"></a>00187                     x = (innerWidth - watermarkSize.Width) / 2 + topLeftPadding.Width;
<a name="l00188"></a>00188 
<a name="l00189"></a>00189                 if (align == ContentAlignment.BottomLeft || align == ContentAlignment.MiddleLeft || align == ContentAlignment.TopLeft)
<a name="l00190"></a>00190                     x = topLeftPadding.Width;
<a name="l00191"></a>00191 
<a name="l00192"></a>00192                 <span class="comment">//Draw watermark</span>
<a name="l00193"></a>00193                 g.DrawImage(wb, <span class="keyword">new</span> Rectangle((<span class="keywordtype">int</span>)(x + imageBox.X), (<span class="keywordtype">int</span>)(y + imageBox.Y), (<span class="keywordtype">int</span>)watermarkSize.Width, (<span class="keywordtype">int</span>)watermarkSize.Height));
<a name="l00194"></a>00194 
<a name="l00195"></a>00195             }
<a name="l00196"></a>00196             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00197"></a>00197         }
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 
<a name="l00200"></a>00200     }
<a name="l00201"></a>00201 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
