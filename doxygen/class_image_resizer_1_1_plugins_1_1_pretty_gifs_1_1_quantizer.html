<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ImageResizer: ImageResizer.Plugins.PrettyGifs.Quantizer Class Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="imageresizer-logo-00aec4.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.3.3</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="namespace_image_resizer.html">ImageResizer</a>      </li>
      <li class="navelem"><a class="el" href="namespace_image_resizer_1_1_plugins.html">Plugins</a>      </li>
      <li class="navelem"><a class="el" href="namespace_image_resizer_1_1_plugins_1_1_pretty_gifs.html">PrettyGifs</a>      </li>
      <li class="navelem"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html">Quantizer</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#properties">Properties</a>  </div>
  <div class="headertitle">
<div class="title">ImageResizer.Plugins.PrettyGifs.Quantizer Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="ImageResizer::Plugins::PrettyGifs::Quantizer" -->
<p>Abstract <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html" title="Abstract Quantizer class - handles the messy, algorithm-independent details of quantization. Subclasses must implement InitialQuantizePixel, GetPallete(), and QuantizePixel. Not thread-safe!">Quantizer</a> class - handles the messy, algorithm-independent details of quantization. Subclasses must implement InitialQuantizePixel, GetPallete(), and QuantizePixel. Not thread-safe!  
 <a href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#details">More...</a></p>
<div class="dynheader">
Inheritance diagram for ImageResizer.Plugins.PrettyGifs.Quantizer:</div>
<div class="dyncontent">
<div class="center"><img src="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer__inherit__graph.png" border="0" usemap="#_image_resizer_8_plugins_8_pretty_gifs_8_quantizer_inherit__map" alt="Inheritance graph"/></div>
<map name="_image_resizer_8_plugins_8_pretty_gifs_8_quantizer_inherit__map" id="_image_resizer_8_plugins_8_pretty_gifs_8_quantizer_inherit__map">
<area shape="rect" id="node3" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_octree_quantizer.html" title="Quantize using an Octree." alt="" coords="5,102,723,149"/></map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>

<p><a href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_1_1_color32.html">Color32</a></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Struct that defines a 32 bpp colour.  <a href="struct_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_1_1_color32.html#details">More...</a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ae9c0173984cccf071bd78cbe946b217c">Quantizer</a> (bool fixedPalette)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct the quantizer.  <a href="#ae9c0173984cccf071bd78cbe946b217c"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a04f97f70db162fe88b3d10dc3277f6d2">Reset</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Resets the quantizer so it can process a new image.  <a href="#a04f97f70db162fe88b3d10dc3277f6d2"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">Bitmap&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ab6b1a6dd3369b8a4674364a9c2d0f2ab">Quantize</a> (Image src)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Quantize an image and return the resulting output bitmap.  <a href="#ab6b1a6dd3369b8a4674364a9c2d0f2ab"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a72fe2283a0b4ea757173e9ac43049f18"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::ValidatePropertyValues" ref="a72fe2283a0b4ea757173e9ac43049f18" args="()" -->
virtual void&#160;</td><td class="memItemRight" valign="bottom"><b>ValidatePropertyValues</b> ()</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7b0b2e50b506368015f4bdcd03c4d7a1"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::QuantizeFullTrust" ref="a7b0b2e50b506368015f4bdcd03c4d7a1" args="(Bitmap firstPass, Bitmap copy, Bitmap copy2, Bitmap output)" -->
Bitmap&#160;</td><td class="memItemRight" valign="bottom"><b>QuantizeFullTrust</b> (Bitmap firstPass, Bitmap copy, Bitmap copy2, Bitmap output)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a92d19729f9c84f0c919e87247744311b"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::QuantizeLowTrust" ref="a92d19729f9c84f0c919e87247744311b" args="(Bitmap firstPass, Bitmap copy, Bitmap copy2, Bitmap output)" -->
Bitmap&#160;</td><td class="memItemRight" valign="bottom"><b>QuantizeLowTrust</b> (Bitmap firstPass, Bitmap copy, Bitmap copy2, Bitmap output)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a7d6b6c7781e51d87185f1ef6c3458576">AnalyzeImage</a> (BitmapData sourceData, int width, int height)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Execute the first pass through the pixels in the image.  <a href="#a7d6b6c7781e51d87185f1ef6c3458576"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a76ccba766ea0d00bd1edf9e470065757"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::AnalyzeImageLowTrust" ref="a76ccba766ea0d00bd1edf9e470065757" args="(Bitmap b, int width, int height)" -->
virtual void&#160;</td><td class="memItemRight" valign="bottom"><b>AnalyzeImageLowTrust</b> (Bitmap b, int width, int height)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a398dfbac3ddc2704c7e5c317eee5fc21">QuantizeImage</a> (BitmapData sourceData, BitmapData intermediate, Bitmap output, int width, int height, Rectangle bounds)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Execute a second pass through the bitmap. If dithering is enabled, sourceData will be modified.  <a href="#a398dfbac3ddc2704c7e5c317eee5fc21"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#adb7ea9913770ace53fc698211e41ef89">AdjustNeighborSource</a> (int offsetX, int offsetY, int deltaR, int deltaG, int deltaB, int deltaA)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Can only be called from QuantizePixel... This is how dithering is done... 5-18-09 ndj.  <a href="#adb7ea9913770ace53fc698211e41ef89"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3891671ba9b1f757c768e57811351c50"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::ToByte" ref="a3891671ba9b1f757c768e57811351c50" args="(int i)" -->
byte&#160;</td><td class="memItemRight" valign="bottom"><b>ToByte</b> (int i)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a6dc513b30a6b60d6f1bb8a737d5fd0f9">InitialQuantizePixel</a> (<a class="el" href="struct_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_1_1_color32.html">Color32</a> pixel)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Override this to process the pixel in the first pass of the algorithm.  <a href="#a6dc513b30a6b60d6f1bb8a737d5fd0f9"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">abstract byte&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a2bf22a06ffc3228886015e2dc0608360">QuantizePixel</a> (<a class="el" href="struct_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_1_1_color32.html">Color32</a> pixel)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Override this to process the pixel in the second pass of the algorithm.  <a href="#a2bf22a06ffc3228886015e2dc0608360"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">abstract ColorPalette&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#aca2b90e50d19a7f138ad5cbe58f10d52">GetPalette</a> (ColorPalette original)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the palette for the quantized image.  <a href="#aca2b90e50d19a7f138ad5cbe58f10d52"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="properties"></a>
Properties</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#af215735ead9e218ff72f8d7c67f8f03d">FixedPalette</a><code> [get]</code></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">(Readonly) If true, the algorithm can do everything in QuantizePixel, and InitialQuantizePixel will not be called. Implies ResizeForFirstPass=False and FourPass=false=  <a href="#af215735ead9e218ff72f8d7c67f8f03d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a352139f8cee49782d51ad22b7f280a26">PixelSize</a><code> [get]</code></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The number of bytes in a ARGB structure. Should be 4.  <a href="#a352139f8cee49782d51ad22b7f280a26"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ac33de902f0a7e08ad889d4954cf85ed4">FullTrust</a><code> [get, set]</code></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">If true, pointer arithmetic will be used instead of GetPixel. GetPixel is much slower. If false, OmitFinalStage will be assumed true, as only palette generation is possible in low trust. Defaults to true.  <a href="#ac33de902f0a7e08ad889d4954cf85ed4"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ae949d228b68d7950edac06944f20a13a">ResizeForFirstPass</a><code> [get, set]</code></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">If true, the first pass (InitialQuantizePixel) will be performed on a size-limited version of the original image to control performance. Ignored if FixedPalette=True.  <a href="#ae949d228b68d7950edac06944f20a13a"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ac9c8a3b3608f7d947cc7a161a457180d">FirstPassPixelCount</a><code> [get, set]</code></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The approximate number of pixels to use when making a scaled copy of the image for the first pass. Only used when ResizeForFirstPass=True and FirstPassPixelThreshold is exceeded.  <a href="#ac9c8a3b3608f7d947cc7a161a457180d"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a9af3382b16f21fa107afc50c5847393f">FirstPassPixelThreshold</a><code> [get, set]</code></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The maximum number of pixels the original image may contain before a scaled copy is made for the first pass. Only relevant when ResizeForFirstPass=True.  <a href="#a9af3382b16f21fa107afc50c5847393f"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ade30184747b7011c8773c9aac5a8df8e">FourPass</a><code> [get, set]</code></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">If true, image is re-paletted after quantization - forces 2 clones of the original image to be created. FixedPalette and OmitFinalStage should be false if this is used.  <a href="#ade30184747b7011c8773c9aac5a8df8e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a81b103d52bbc5e5946d680a73b75b682">OmitFinalStage</a><code> [get, set]</code></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">If true, a 32-bit image with an 8-bit palette will be returned instead of an 8-bit image, which GDI can save using median-cut quantization. Much faster than our final quantization pass, although it can't do transparency. Assumed true if FullTrust is false.  <a href="#a81b103d52bbc5e5946d680a73b75b682"></a><br/></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><p>Abstract <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html" title="Abstract Quantizer class - handles the messy, algorithm-independent details of quantization. Subclasses must implement InitialQuantizePixel, GetPallete(), and QuantizePixel. Not thread-safe!">Quantizer</a> class - handles the messy, algorithm-independent details of quantization. Subclasses must implement InitialQuantizePixel, GetPallete(), and QuantizePixel. Not thread-safe! </p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00031">31</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>
</div><hr/><h2>Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ae9c0173984cccf071bd78cbe946b217c"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::Quantizer" ref="ae9c0173984cccf071bd78cbe946b217c" args="(bool fixedPalette)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ae9c0173984cccf071bd78cbe946b217c">ImageResizer.Plugins.PrettyGifs.Quantizer.Quantizer</a> </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>fixedPalette</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Construct the quantizer. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">fixedPalette</td><td>If true, the quantization only needs to loop through the source pixels once - InitialQuantiize</td></tr>
  </table>
  </dd>
</dl>
<p>If you construct this class with a true value for singlePass, then the code will, when quantizing your image, only call the 'QuantizeImage' function. If two passes are required, the code will call 'InitialQuantizeImage' and then 'QuantizeImage'. </p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00122">122</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>
<div class="fragment"><pre class="fragment">        {
            _fixedPalette = fixedPalette;
            _pixelSize = Marshal.SizeOf(typeof (Color32));
        }
</pre></div>
</div>
</div>
<hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="adb7ea9913770ace53fc698211e41ef89"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::AdjustNeighborSource" ref="adb7ea9913770ace53fc698211e41ef89" args="(int offsetX, int offsetY, int deltaR, int deltaG, int deltaB, int deltaA)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#adb7ea9913770ace53fc698211e41ef89">ImageResizer.Plugins.PrettyGifs.Quantizer.AdjustNeighborSource</a> </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>offsetX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>offsetY</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>deltaR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>deltaG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>deltaB</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>deltaA</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [inline, protected]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Can only be called from QuantizePixel... This is how dithering is done... 5-18-09 ndj. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">offsetX</td><td></td></tr>
    <tr><td class="paramname">offsetY</td><td></td></tr>
    <tr><td class="paramname">deltaR</td><td></td></tr>
    <tr><td class="paramname">deltaG</td><td></td></tr>
    <tr><td class="paramname">deltaB</td><td></td></tr>
    <tr><td class="paramname">deltaA</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00461">461</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>
<div class="fragment"><pre class="fragment">        {
            <span class="keywordflow">if</span> (secondPassIntermediate == null) <span class="keywordflow">return</span>;
            <span class="keywordtype">int</span> x = secondPassX + offsetX;
            <span class="keywordtype">int</span> y = secondPassY + offsetY;
            <span class="keywordflow">if</span> (x &lt; 0 || x &gt;= secondPassIntermediate.Width) <span class="keywordflow">return</span>; <span class="comment">//do nothing;</span>
            <span class="keywordflow">if</span> (y &lt; 0 || y &gt;= secondPassIntermediate.Height) <span class="keywordflow">return</span>; <span class="comment">//do nothing</span>
            IntPtr p = (IntPtr)((<span class="keywordtype">long</span>)secondPassIntermediate.Scan0 + ((long)y * (<span class="keywordtype">long</span>)secondPassIntermediate.Stride) + (<a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a352139f8cee49782d51ad22b7f280a26" title="The number of bytes in a ARGB structure. Should be 4.">PixelSize</a> * x));
            <span class="comment">//Read the original color</span>
            Color32 c = <span class="keyword">new</span> Color32(p);

            c.Red = ToByte((<span class="keywordtype">int</span>)c.Red + deltaR);
            c.Green = ToByte((<span class="keywordtype">int</span>)c.Green + deltaG);
            c.Blue = ToByte((<span class="keywordtype">int</span>)c.Blue + deltaB);
            c.Alpha = ToByte((<span class="keywordtype">int</span>)c.Alpha + deltaA);
            
            Marshal.StructureToPtr(c, p, <span class="keyword">true</span>); <span class="comment">//False to not dispose old block. Since no reference to it exists (I believe PtrToStructure from Color32 copies, not references), this should be safe</span>
  
        }
</pre></div>
</div>
</div>
<a class="anchor" id="a7d6b6c7781e51d87185f1ef6c3458576"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::AnalyzeImage" ref="a7d6b6c7781e51d87185f1ef6c3458576" args="(BitmapData sourceData, int width, int height)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a7d6b6c7781e51d87185f1ef6c3458576">ImageResizer.Plugins.PrettyGifs.Quantizer.AnalyzeImage</a> </td>
          <td>(</td>
          <td class="paramtype">BitmapData&#160;</td>
          <td class="paramname"><em>sourceData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>height</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Execute the first pass through the pixels in the image. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">sourceData</td><td>The source data</td></tr>
    <tr><td class="paramname">width</td><td>The width in pixels of the image</td></tr>
    <tr><td class="paramname">height</td><td>The height in pixels of the image</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00323">323</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>
<div class="fragment"><pre class="fragment">        {
            <span class="comment">// Define the source data pointers. The source row is a byte to</span>
            <span class="comment">// keep addition of the stride value easier (as this is in bytes)              </span>
            IntPtr pSourceRow = sourceData.Scan0;

            <span class="comment">// Loop through each row</span>
            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row = 0; row &lt; height; row++)
            {
                <span class="comment">// Set the source pixel to the first pixel in this row</span>
                IntPtr pSourcePixel = pSourceRow;

                <span class="comment">// And loop through each column</span>
                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt; width; col++)
                {            
                    <a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a6dc513b30a6b60d6f1bb8a737d5fd0f9" title="Override this to process the pixel in the first pass of the algorithm.">InitialQuantizePixel</a>(<span class="keyword">new</span> Color32(pSourcePixel)); 
                    pSourcePixel = (IntPtr)((<span class="keywordtype">long</span>)pSourcePixel + <a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a352139f8cee49782d51ad22b7f280a26" title="The number of bytes in a ARGB structure. Should be 4.">PixelSize</a>); <span class="comment">//Increment afterwards</span>
                }       <span class="comment">// Now I have the pixel, call the FirstPassQuantize function...</span>

                <span class="comment">// Add the stride to the source row</span>
                pSourceRow = (IntPtr)((<span class="keywordtype">long</span>)pSourceRow + sourceData.Stride);
            }
        }
</pre></div>
</div>
</div>
<a class="anchor" id="aca2b90e50d19a7f138ad5cbe58f10d52"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::GetPalette" ref="aca2b90e50d19a7f138ad5cbe58f10d52" args="(ColorPalette original)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">abstract ColorPalette <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#aca2b90e50d19a7f138ad5cbe58f10d52">ImageResizer.Plugins.PrettyGifs.Quantizer.GetPalette</a> </td>
          <td>(</td>
          <td class="paramtype">ColorPalette&#160;</td>
          <td class="paramname"><em>original</em></td><td>)</td>
          <td><code> [protected, pure virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Retrieve the palette for the quantized image. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">original</td><td>Any old palette, this is overrwritten</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>The new color palette</dd></dl>

<p>Implemented in <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_octree_quantizer.html#a49760b1e0752212afe766b2802f86b10">ImageResizer.Plugins.PrettyGifs.OctreeQuantizer</a>.</p>

</div>
</div>
<a class="anchor" id="a6dc513b30a6b60d6f1bb8a737d5fd0f9"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::InitialQuantizePixel" ref="a6dc513b30a6b60d6f1bb8a737d5fd0f9" args="(Color32 pixel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a6dc513b30a6b60d6f1bb8a737d5fd0f9">ImageResizer.Plugins.PrettyGifs.Quantizer.InitialQuantizePixel</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_1_1_color32.html">Color32</a>&#160;</td>
          <td class="paramname"><em>pixel</em></td><td>)</td>
          <td><code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Override this to process the pixel in the first pass of the algorithm. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">pixel</td><td>The pixel to quantize</td></tr>
  </table>
  </dd>
</dl>
<p>This function need only be overridden if your quantize algorithm needs two passes, such as an Octree quantizer. </p>

<p>Reimplemented in <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_octree_quantizer.html#a2ae43ea54b1271764f94f95298910181">ImageResizer.Plugins.PrettyGifs.OctreeQuantizer</a>.</p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00513">513</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>
<div class="fragment"><pre class="fragment">        {
        }
</pre></div>
</div>
</div>
<a class="anchor" id="ab6b1a6dd3369b8a4674364a9c2d0f2ab"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::Quantize" ref="ab6b1a6dd3369b8a4674364a9c2d0f2ab" args="(Image src)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">Bitmap <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ab6b1a6dd3369b8a4674364a9c2d0f2ab">ImageResizer.Plugins.PrettyGifs.Quantizer.Quantize</a> </td>
          <td>(</td>
          <td class="paramtype">Image&#160;</td>
          <td class="paramname"><em>src</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Quantize an image and return the resulting output bitmap. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">source</td><td>The image to quantize</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>A quantized version of the image</dd></dl>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00151">151</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>

<p>Referenced by <a class="el" href="_pretty_gifs_8cs_source.html#l00160">ImageResizer.Plugins.PrettyGifs.PrettyGifs.SaveIndexed()</a>.</p>
<div class="fragment"><pre class="fragment">                                          {
            <span class="comment">//We just set up the Bitmap copies and handle their disposal - the real work happens in </span>
            <span class="comment">// QuantizeFullTrust and QuantizeLowTrust</span>
            Bitmap firstPass = null;
            Bitmap copy = null;
            Bitmap copy2 = null;
            Bitmap tempOutput = null;
            Bitmap result = null;
            <span class="keywordflow">try</span> {
                <span class="comment">// First off take a 32bpp copy of &#39;source&#39; if it&#39;s not a 32bpp Bitmap instance.</span>
                copy = src as Bitmap;
                <span class="keywordflow">if</span> (<a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ade30184747b7011c8773c9aac5a8df8e" title="If true, image is re-paletted after quantization - forces 2 clones of the original image to be create...">FourPass</a> || copy == null || !src.PixelFormat.Equals(PixelFormat.Format32bppArgb)) {
                    copy = <span class="keyword">new</span> Bitmap(src.Width, src.Height, PixelFormat.Format32bppArgb);

                    <span class="comment">// Now lock the bitmap into memory</span>
                    <span class="keyword">using</span> (Graphics g = Graphics.FromImage(copy)) {
                        g.PageUnit = GraphicsUnit.Pixel;

                        <span class="comment">// Draw the source image onto the copy bitmap,</span>
                        <span class="comment">// which will effect a widening as appropriate.</span>
                        g.DrawImage(src, <span class="keyword">new</span> Point(0, 0));

                    }
                }

                firstPass = copy;
                <span class="comment">//If we should make a resized version for the first pass, let&#39;s do it.</span>
                <span class="keywordflow">if</span> (!<a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#af215735ead9e218ff72f8d7c67f8f03d" title="(Readonly) If true, the algorithm can do everything in QuantizePixel, and InitialQuantizePixel will n...">FixedPalette</a> &amp;&amp; <a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ae949d228b68d7950edac06944f20a13a" title="If true, the first pass (InitialQuantizePixel) will be performed on a size-limited version of the ori...">ResizeForFirstPass</a> &amp;&amp; <a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a9af3382b16f21fa107afc50c5847393f" title="The maximum number of pixels the original image may contain before a scaled copy is made for the firs...">FirstPassPixelThreshold</a> &lt; copy.Width * copy.Height) {
                    <span class="keywordtype">double</span> factor = <a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ac9c8a3b3608f7d947cc7a161a457180d" title="The approximate number of pixels to use when making a scaled copy of the image for the first pass...">FirstPassPixelCount</a> / ((double)copy.Width * (<span class="keywordtype">double</span>)copy.Height);
                    firstPass = <span class="keyword">new</span> Bitmap((<span class="keywordtype">int</span>)Math.Floor((<span class="keywordtype">double</span>)copy.Width * factor), (int)Math.Floor((<span class="keywordtype">double</span>)copy.Height * factor), PixelFormat.Format32bppArgb);
                    <span class="keyword">using</span> (Graphics g = Graphics.FromImage(firstPass)) {
                        <span class="comment">//Use the low-quality settings - we want the original colors of the image, nearest neighbor is better than bicubic spline here.</span>
                        g.PageUnit = GraphicsUnit.Pixel;
                        g.InterpolationMode = System.Drawing.Drawing2D.InterpolationMode.NearestNeighbor;
                        g.PixelOffsetMode = System.Drawing.Drawing2D.PixelOffsetMode.HighSpeed;
                        g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.None;
                        g.DrawImage(copy, 0, 0, firstPass.Width, firstPass.Height);
                    }
                }
                copy2 = null;
                <span class="keywordflow">if</span> (<a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ade30184747b7011c8773c9aac5a8df8e" title="If true, image is re-paletted after quantization - forces 2 clones of the original image to be create...">FourPass</a>) {
                    copy2 = <span class="keyword">new</span> Bitmap(src.Width, src.Height, PixelFormat.Format32bppArgb);
                    <span class="keyword">using</span> (Graphics g = Graphics.FromImage(copy2)) {
                        g.PageUnit = GraphicsUnit.Pixel;
                        g.DrawImage(src, <span class="keyword">new</span> Point(0, 0));
                    }
                }
                <span class="comment">// And make an 8-bit output image</span>
                tempOutput = <span class="keyword">new</span> Bitmap(<a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a81b103d52bbc5e5946d680a73b75b682" title="If true, a 32-bit image with an 8-bit palette will be returned instead of an 8-bit image...">OmitFinalStage</a> ? 2 : src.Width, <a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a81b103d52bbc5e5946d680a73b75b682" title="If true, a 32-bit image with an 8-bit palette will be returned instead of an 8-bit image...">OmitFinalStage</a> ? 2 : src.Height, PixelFormat.Format8bppIndexed);

                <span class="comment">//Full trust and low trust are implemented differently. </span>
                <span class="keywordflow">if</span> (<a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ac33de902f0a7e08ad889d4954cf85ed4" title="If true, pointer arithmetic will be used instead of GetPixel. GetPixel is much slower. If false, OmitFinalStage will be assumed true, as only palette generation is possible in low trust. Defaults to true.">FullTrust</a>) {
                    result = QuantizeFullTrust(firstPass, copy, copy2, tempOutput);
                } <span class="keywordflow">else</span> {
                    result = QuantizeLowTrust(firstPass, copy, copy2, tempOutput);
                }
                <span class="keywordflow">return</span> result;
            } <span class="keywordflow">finally</span> {
                <span class="keywordflow">if</span> (firstPass != null &amp;&amp; firstPass != copy &amp;&amp; firstPass != src &amp;&amp; firstPass != result) firstPass.Dispose();
                <span class="keywordflow">if</span> (copy != null &amp;&amp; copy != src &amp;&amp; copy != result) copy.Dispose();
                <span class="keywordflow">if</span> (copy2 != null &amp;&amp; copy2 != src &amp;&amp; copy2 != result) copy2.Dispose();
                <span class="keywordflow">if</span> (tempOutput != null &amp;&amp; tempOutput != src &amp;&amp; tempOutput != result) tempOutput.Dispose();
            }

        }
</pre></div>
</div>
</div>
<a class="anchor" id="a398dfbac3ddc2704c7e5c317eee5fc21"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::QuantizeImage" ref="a398dfbac3ddc2704c7e5c317eee5fc21" args="(BitmapData sourceData, BitmapData intermediate, Bitmap output, int width, int height, Rectangle bounds)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a398dfbac3ddc2704c7e5c317eee5fc21">ImageResizer.Plugins.PrettyGifs.Quantizer.QuantizeImage</a> </td>
          <td>(</td>
          <td class="paramtype">BitmapData&#160;</td>
          <td class="paramname"><em>sourceData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BitmapData&#160;</td>
          <td class="paramname"><em>intermediate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Bitmap&#160;</td>
          <td class="paramname"><em>output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>height</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Rectangle&#160;</td>
          <td class="paramname"><em>bounds</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [inline, protected, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Execute a second pass through the bitmap. If dithering is enabled, sourceData will be modified. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">sourceData</td><td>The source bitmap, locked into memory</td></tr>
    <tr><td class="paramname">intermediate</td><td>The intermediate bitmap, used for 4-pass quantization. If specified, output will not actually be modified</td></tr>
    <tr><td class="paramname">output</td><td>The output bitmap</td></tr>
    <tr><td class="paramname">width</td><td>The width in pixels of the image</td></tr>
    <tr><td class="paramname">height</td><td>The height in pixels of the image</td></tr>
    <tr><td class="paramname">bounds</td><td>The bounding rectangle</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00371">371</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>
<div class="fragment"><pre class="fragment">        {
            secondPassIntermediate = (intermediate != null) ? intermediate : sourceData;<span class="comment">// Not thread safe.... But nothing here is anyways...//For dithering - 5-18-09 ndj</span>
            BitmapData outputData = null;
            
            <span class="keywordflow">try</span>
            {
                <span class="comment">// Lock the output bitmap into memory</span>
                <span class="keywordflow">if</span> (intermediate == null) outputData = output.LockBits(bounds, ImageLockMode.WriteOnly, PixelFormat.Format8bppIndexed);

                <span class="comment">// Define the source data pointers. The source row is a byte to</span>
                <span class="comment">// keep addition of the stride value easier (as this is in bytes)</span>
                IntPtr pSourceRow = sourceData.Scan0;
                IntPtr pSourcePixel = pSourceRow;
                IntPtr pPreviousPixel = pSourcePixel;

                <span class="comment">// Now define the destination data pointers</span>
                IntPtr pDestinationRow = IntPtr.Zero;
                <span class="keywordflow">if</span> (intermediate == null) pDestinationRow = outputData.Scan0;
                IntPtr pDestinationPixel = pDestinationRow;

                <span class="comment">// And convert the first pixel, so that I have values going into the loop</span>

                byte pixelValue = <a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a2bf22a06ffc3228886015e2dc0608360" title="Override this to process the pixel in the second pass of the algorithm.">QuantizePixel</a>(<span class="keyword">new</span> Color32(pSourcePixel));

                <span class="comment">// Assign the value of the first pixel</span>
                <span class="keywordflow">if</span> (intermediate == null) Marshal.WriteByte(pDestinationPixel, pixelValue);

                <span class="comment">// Loop through each row</span>
                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row = 0; row &lt; height; row++)
                {
                    secondPassY = row;  <span class="comment">//For dithering - 5-18-09 ndj</span>
                    <span class="comment">// Set the source pixel to the first pixel in this row</span>
                    pSourcePixel = pSourceRow;

                    <span class="comment">// And set the destination pixel pointer to the first pixel in the row</span>
                    <span class="keywordflow">if</span> (intermediate == null) pDestinationPixel = pDestinationRow;

                    <span class="comment">// Loop through each pixel on this scan line</span>
                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt; width; col++)
                    {
                        secondPassX = col; <span class="comment">//For dithering - 5-18-09 ndj</span>
                        <span class="comment">// Check if this is the same as the last pixel. If so use that value</span>
                        <span class="comment">// rather than calculating it again. This is an inexpensive optimisation.</span>
                        <span class="comment">// Nathanael: 2-11-09 changed from ReadByte to ReadInt32 on both.</span>
                        <span class="comment">// Otherwise this comparison may return true if only the blue component is the </span>
                        <span class="comment">// same in 2 subsequent pixels.</span>
                        <span class="keywordflow">if</span> (Marshal.ReadInt32(pPreviousPixel) != Marshal.ReadInt32(pSourcePixel) || (intermediate != null))
                        {
                            <span class="comment">// Quantize the pixel</span>
                            pixelValue = <a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a2bf22a06ffc3228886015e2dc0608360" title="Override this to process the pixel in the second pass of the algorithm.">QuantizePixel</a>(<span class="keyword">new</span> Color32(pSourcePixel));

                            <span class="comment">// And setup the previous pointer</span>
                            pPreviousPixel = pSourcePixel;
                        }

                        <span class="comment">// And set the pixel in the output</span>
                        <span class="keywordflow">if</span> (intermediate == null) Marshal.WriteByte(pDestinationPixel, pixelValue);

                        pSourcePixel = (IntPtr)((<span class="keywordtype">long</span>)pSourcePixel + <a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a352139f8cee49782d51ad22b7f280a26" title="The number of bytes in a ARGB structure. Should be 4.">PixelSize</a>);
                        <span class="keywordflow">if</span> (intermediate == null) pDestinationPixel = (IntPtr)((<span class="keywordtype">long</span>)pDestinationPixel + 1);

                    }

                    <span class="comment">// Add the stride to the source row</span>
                    pSourceRow = (IntPtr)((<span class="keywordtype">long</span>)pSourceRow + sourceData.Stride);

                    <span class="comment">// And to the destination row</span>
                    <span class="keywordflow">if</span> (intermediate == null) pDestinationRow = (IntPtr)((<span class="keywordtype">long</span>)pDestinationRow + outputData.Stride);
                }
            }
            <span class="keywordflow">finally</span>
            {
                <span class="comment">// Ensure that I unlock the output bits</span>
                <span class="keywordflow">if</span> (intermediate == null) output.UnlockBits(outputData);
                secondPassIntermediate = null;
            }
        }
</pre></div>
</div>
</div>
<a class="anchor" id="a2bf22a06ffc3228886015e2dc0608360"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::QuantizePixel" ref="a2bf22a06ffc3228886015e2dc0608360" args="(Color32 pixel)" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">abstract byte <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a2bf22a06ffc3228886015e2dc0608360">ImageResizer.Plugins.PrettyGifs.Quantizer.QuantizePixel</a> </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_1_1_color32.html">Color32</a>&#160;</td>
          <td class="paramname"><em>pixel</em></td><td>)</td>
          <td><code> [protected, pure virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Override this to process the pixel in the second pass of the algorithm. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">pixel</td><td>The pixel to quantize</td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd>The quantized value</dd></dl>

<p>Implemented in <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_octree_quantizer.html#a7a8dd490b27330aefe437aea78e91839">ImageResizer.Plugins.PrettyGifs.OctreeQuantizer</a>.</p>

</div>
</div>
<a class="anchor" id="a04f97f70db162fe88b3d10dc3277f6d2"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::Reset" ref="a04f97f70db162fe88b3d10dc3277f6d2" args="()" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">virtual void <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a04f97f70db162fe88b3d10dc3277f6d2">ImageResizer.Plugins.PrettyGifs.Quantizer.Reset</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline, virtual]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Resets the quantizer so it can process a new image. </p>

<p>Reimplemented in <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_octree_quantizer.html#a9beafc72579a427fbdcad46d83ce6566">ImageResizer.Plugins.PrettyGifs.OctreeQuantizer</a>.</p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00131">131</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>
<div class="fragment"><pre class="fragment">        {
            this.secondPassIntermediate = null;
            this.secondPassX = 0;
            this.secondPassY = 0;
          
        }
</pre></div>
</div>
</div>
<hr/><h2>Property Documentation</h2>
<a class="anchor" id="ac9c8a3b3608f7d947cc7a161a457180d"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::FirstPassPixelCount" ref="ac9c8a3b3608f7d947cc7a161a457180d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">long <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ac9c8a3b3608f7d947cc7a161a457180d">ImageResizer.Plugins.PrettyGifs.Quantizer.FirstPassPixelCount</a><code> [get, set]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The approximate number of pixels to use when making a scaled copy of the image for the first pass. Only used when ResizeForFirstPass=True and FirstPassPixelThreshold is exceeded. </p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00075">75</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>

<p>Referenced by <a class="el" href="_pretty_gifs_8cs_source.html#l00160">ImageResizer.Plugins.PrettyGifs.PrettyGifs.SaveIndexed()</a>.</p>

</div>
</div>
<a class="anchor" id="a9af3382b16f21fa107afc50c5847393f"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::FirstPassPixelThreshold" ref="a9af3382b16f21fa107afc50c5847393f" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">long <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a9af3382b16f21fa107afc50c5847393f">ImageResizer.Plugins.PrettyGifs.Quantizer.FirstPassPixelThreshold</a><code> [get, set]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The maximum number of pixels the original image may contain before a scaled copy is made for the first pass. Only relevant when ResizeForFirstPass=True. </p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00085">85</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>

<p>Referenced by <a class="el" href="_pretty_gifs_8cs_source.html#l00160">ImageResizer.Plugins.PrettyGifs.PrettyGifs.SaveIndexed()</a>.</p>

</div>
</div>
<a class="anchor" id="af215735ead9e218ff72f8d7c67f8f03d"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::FixedPalette" ref="af215735ead9e218ff72f8d7c67f8f03d" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#af215735ead9e218ff72f8d7c67f8f03d">ImageResizer.Plugins.PrettyGifs.Quantizer.FixedPalette</a><code> [get]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>(Readonly) If true, the algorithm can do everything in QuantizePixel, and InitialQuantizePixel will not be called. Implies ResizeForFirstPass=False and FourPass=false= </p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00038">38</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>

</div>
</div>
<a class="anchor" id="ade30184747b7011c8773c9aac5a8df8e"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::FourPass" ref="ade30184747b7011c8773c9aac5a8df8e" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ade30184747b7011c8773c9aac5a8df8e">ImageResizer.Plugins.PrettyGifs.Quantizer.FourPass</a><code> [get, set]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>If true, image is re-paletted after quantization - forces 2 clones of the original image to be created. FixedPalette and OmitFinalStage should be false if this is used. </p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00096">96</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>

<p>Referenced by <a class="el" href="_pretty_gifs_8cs_source.html#l00160">ImageResizer.Plugins.PrettyGifs.PrettyGifs.SaveIndexed()</a>.</p>

</div>
</div>
<a class="anchor" id="ac33de902f0a7e08ad889d4954cf85ed4"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::FullTrust" ref="ac33de902f0a7e08ad889d4954cf85ed4" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ac33de902f0a7e08ad889d4954cf85ed4">ImageResizer.Plugins.PrettyGifs.Quantizer.FullTrust</a><code> [get, set]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>If true, pointer arithmetic will be used instead of GetPixel. GetPixel is much slower. If false, OmitFinalStage will be assumed true, as only palette generation is possible in low trust. Defaults to true. </p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00056">56</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>

<p>Referenced by <a class="el" href="_pretty_gifs_8cs_source.html#l00160">ImageResizer.Plugins.PrettyGifs.PrettyGifs.SaveIndexed()</a>.</p>

</div>
</div>
<a class="anchor" id="a81b103d52bbc5e5946d680a73b75b682"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::OmitFinalStage" ref="a81b103d52bbc5e5946d680a73b75b682" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a81b103d52bbc5e5946d680a73b75b682">ImageResizer.Plugins.PrettyGifs.Quantizer.OmitFinalStage</a><code> [get, set]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>If true, a 32-bit image with an 8-bit palette will be returned instead of an 8-bit image, which GDI can save using median-cut quantization. Much faster than our final quantization pass, although it can't do transparency. Assumed true if FullTrust is false. </p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00107">107</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>

<p>Referenced by <a class="el" href="_pretty_gifs_8cs_source.html#l00160">ImageResizer.Plugins.PrettyGifs.PrettyGifs.SaveIndexed()</a>.</p>

</div>
</div>
<a class="anchor" id="a352139f8cee49782d51ad22b7f280a26"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::PixelSize" ref="a352139f8cee49782d51ad22b7f280a26" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a352139f8cee49782d51ad22b7f280a26">ImageResizer.Plugins.PrettyGifs.Quantizer.PixelSize</a><code> [get]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The number of bytes in a ARGB structure. Should be 4. </p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00047">47</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>

</div>
</div>
<a class="anchor" id="ae949d228b68d7950edac06944f20a13a"></a><!-- doxytag: member="ImageResizer::Plugins::PrettyGifs::Quantizer::ResizeForFirstPass" ref="ae949d228b68d7950edac06944f20a13a" args="" -->
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">bool <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ae949d228b68d7950edac06944f20a13a">ImageResizer.Plugins.PrettyGifs.Quantizer.ResizeForFirstPass</a><code> [get, set]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>If true, the first pass (InitialQuantizePixel) will be performed on a size-limited version of the original image to control performance. Ignored if FixedPalette=True. </p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00066">66</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>

<p>Referenced by <a class="el" href="_pretty_gifs_8cs_source.html#l00160">ImageResizer.Plugins.PrettyGifs.PrettyGifs.SaveIndexed()</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>C:/Users/Administrator/Documents/resizer/Plugins/PrettyGifs/<a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a></li>
</ul>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
