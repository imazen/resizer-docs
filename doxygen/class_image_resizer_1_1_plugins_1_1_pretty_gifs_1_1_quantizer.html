<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>ImageResizer: ImageResizer.Plugins.PrettyGifs.Quantizer Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="imageresizer-logo-00aec4.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.4.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespace_image_resizer.html">ImageResizer</a></li><li class="navelem"><a class="el" href="namespace_image_resizer_1_1_plugins.html">Plugins</a></li><li class="navelem"><a class="el" href="namespace_image_resizer_1_1_plugins_1_1_pretty_gifs.html">PrettyGifs</a></li><li class="navelem"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html">Quantizer</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-methods">Protected Member Functions</a> &#124;
<a href="#properties">Properties</a> &#124;
<a href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">ImageResizer.Plugins.PrettyGifs.Quantizer Class Reference<span class="mlabels"><span class="mlabel">abstract</span></span></div>  </div>
</div><!--header-->
<div class="contents">

<p>Abstract <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html" title="Abstract Quantizer class - handles the messy, algorithm-independent details of quantization. Subclasses must implement InitialQuantizePixel, GetPallete(), and QuantizePixel. Not thread-safe! ">Quantizer</a> class - handles the messy, algorithm-independent details of quantization. Subclasses must implement InitialQuantizePixel, GetPallete(), and QuantizePixel. Not thread-safe!  
 <a href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#details">More...</a></p>
<div class="dynheader">
Inheritance diagram for ImageResizer.Plugins.PrettyGifs.Quantizer:</div>
<div class="dyncontent">
<div class="center"><img src="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer__inherit__graph.png" border="0" usemap="#_image_resizer_8_plugins_8_pretty_gifs_8_quantizer_inherit__map" alt="Inheritance graph"/></div>
<map name="_image_resizer_8_plugins_8_pretty_gifs_8_quantizer_inherit__map" id="_image_resizer_8_plugins_8_pretty_gifs_8_quantizer_inherit__map">
<area shape="rect" id="node3" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_octree_quantizer.html" title="Quantize using an Octree " alt="" coords="5,137,424,218"/></map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="struct_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_1_1_color32.html">Color32</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Struct that defines a 32 bpp colour  <a href="struct_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_1_1_color32.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ae9c0173984cccf071bd78cbe946b217c"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ae9c0173984cccf071bd78cbe946b217c">Quantizer</a> (bool fixedPalette)</td></tr>
<tr class="memdesc:ae9c0173984cccf071bd78cbe946b217c"><td class="mdescLeft">&#160;</td><td class="mdescRight">Construct the quantizer  <a href="#ae9c0173984cccf071bd78cbe946b217c">More...</a><br/></td></tr>
<tr class="separator:ae9c0173984cccf071bd78cbe946b217c"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a04f97f70db162fe88b3d10dc3277f6d2"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a04f97f70db162fe88b3d10dc3277f6d2">Reset</a> ()</td></tr>
<tr class="memdesc:a04f97f70db162fe88b3d10dc3277f6d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Resets the quantizer so it can process a new image.  <a href="#a04f97f70db162fe88b3d10dc3277f6d2">More...</a><br/></td></tr>
<tr class="separator:a04f97f70db162fe88b3d10dc3277f6d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab6b1a6dd3369b8a4674364a9c2d0f2ab"><td class="memItemLeft" align="right" valign="top">Bitmap&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ab6b1a6dd3369b8a4674364a9c2d0f2ab">Quantize</a> (Image src)</td></tr>
<tr class="memdesc:ab6b1a6dd3369b8a4674364a9c2d0f2ab"><td class="mdescLeft">&#160;</td><td class="mdescRight">Quantize an image and return the resulting output bitmap  <a href="#ab6b1a6dd3369b8a4674364a9c2d0f2ab">More...</a><br/></td></tr>
<tr class="separator:ab6b1a6dd3369b8a4674364a9c2d0f2ab"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-methods"></a>
Protected Member Functions</h2></td></tr>
<tr class="memitem:a72fe2283a0b4ea757173e9ac43049f18"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a72fe2283a0b4ea757173e9ac43049f18"></a>
virtual void&#160;</td><td class="memItemRight" valign="bottom"><b>ValidatePropertyValues</b> ()</td></tr>
<tr class="separator:a72fe2283a0b4ea757173e9ac43049f18"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7b0b2e50b506368015f4bdcd03c4d7a1"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7b0b2e50b506368015f4bdcd03c4d7a1"></a>
Bitmap&#160;</td><td class="memItemRight" valign="bottom"><b>QuantizeFullTrust</b> (Bitmap firstPass, Bitmap copy, Bitmap copy2, Bitmap output)</td></tr>
<tr class="separator:a7b0b2e50b506368015f4bdcd03c4d7a1"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a92d19729f9c84f0c919e87247744311b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a92d19729f9c84f0c919e87247744311b"></a>
Bitmap&#160;</td><td class="memItemRight" valign="bottom"><b>QuantizeLowTrust</b> (Bitmap firstPass, Bitmap copy, Bitmap copy2, Bitmap output)</td></tr>
<tr class="separator:a92d19729f9c84f0c919e87247744311b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7d6b6c7781e51d87185f1ef6c3458576"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a7d6b6c7781e51d87185f1ef6c3458576">AnalyzeImage</a> (BitmapData sourceData, int width, int height)</td></tr>
<tr class="memdesc:a7d6b6c7781e51d87185f1ef6c3458576"><td class="mdescLeft">&#160;</td><td class="mdescRight">Execute the first pass through the pixels in the image  <a href="#a7d6b6c7781e51d87185f1ef6c3458576">More...</a><br/></td></tr>
<tr class="separator:a7d6b6c7781e51d87185f1ef6c3458576"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a76ccba766ea0d00bd1edf9e470065757"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a76ccba766ea0d00bd1edf9e470065757"></a>
virtual void&#160;</td><td class="memItemRight" valign="bottom"><b>AnalyzeImageLowTrust</b> (Bitmap b, int width, int height)</td></tr>
<tr class="separator:a76ccba766ea0d00bd1edf9e470065757"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a398dfbac3ddc2704c7e5c317eee5fc21"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a398dfbac3ddc2704c7e5c317eee5fc21">QuantizeImage</a> (BitmapData sourceData, BitmapData intermediate, Bitmap output, int width, int height, Rectangle bounds)</td></tr>
<tr class="memdesc:a398dfbac3ddc2704c7e5c317eee5fc21"><td class="mdescLeft">&#160;</td><td class="mdescRight">Execute a second pass through the bitmap. If dithering is enabled, sourceData will be modified.  <a href="#a398dfbac3ddc2704c7e5c317eee5fc21">More...</a><br/></td></tr>
<tr class="separator:a398dfbac3ddc2704c7e5c317eee5fc21"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:adb7ea9913770ace53fc698211e41ef89"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#adb7ea9913770ace53fc698211e41ef89">AdjustNeighborSource</a> (int offsetX, int offsetY, int deltaR, int deltaG, int deltaB, int deltaA)</td></tr>
<tr class="memdesc:adb7ea9913770ace53fc698211e41ef89"><td class="mdescLeft">&#160;</td><td class="mdescRight">Can only be called from QuantizePixel... This is how dithering is done... 5-18-09 ndj  <a href="#adb7ea9913770ace53fc698211e41ef89">More...</a><br/></td></tr>
<tr class="separator:adb7ea9913770ace53fc698211e41ef89"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a3891671ba9b1f757c768e57811351c50"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3891671ba9b1f757c768e57811351c50"></a>
byte&#160;</td><td class="memItemRight" valign="bottom"><b>ToByte</b> (int i)</td></tr>
<tr class="separator:a3891671ba9b1f757c768e57811351c50"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a6dc513b30a6b60d6f1bb8a737d5fd0f9"><td class="memItemLeft" align="right" valign="top">virtual void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a6dc513b30a6b60d6f1bb8a737d5fd0f9">InitialQuantizePixel</a> (<a class="el" href="struct_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_1_1_color32.html">Color32</a> pixel)</td></tr>
<tr class="memdesc:a6dc513b30a6b60d6f1bb8a737d5fd0f9"><td class="mdescLeft">&#160;</td><td class="mdescRight">Override this to process the pixel in the first pass of the algorithm  <a href="#a6dc513b30a6b60d6f1bb8a737d5fd0f9">More...</a><br/></td></tr>
<tr class="separator:a6dc513b30a6b60d6f1bb8a737d5fd0f9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2bf22a06ffc3228886015e2dc0608360"><td class="memItemLeft" align="right" valign="top">abstract byte&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a2bf22a06ffc3228886015e2dc0608360">QuantizePixel</a> (<a class="el" href="struct_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_1_1_color32.html">Color32</a> pixel)</td></tr>
<tr class="memdesc:a2bf22a06ffc3228886015e2dc0608360"><td class="mdescLeft">&#160;</td><td class="mdescRight">Override this to process the pixel in the second pass of the algorithm  <a href="#a2bf22a06ffc3228886015e2dc0608360">More...</a><br/></td></tr>
<tr class="separator:a2bf22a06ffc3228886015e2dc0608360"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aca2b90e50d19a7f138ad5cbe58f10d52"><td class="memItemLeft" align="right" valign="top">abstract ColorPalette&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#aca2b90e50d19a7f138ad5cbe58f10d52">GetPalette</a> (ColorPalette original)</td></tr>
<tr class="memdesc:aca2b90e50d19a7f138ad5cbe58f10d52"><td class="mdescLeft">&#160;</td><td class="mdescRight">Retrieve the palette for the quantized image  <a href="#aca2b90e50d19a7f138ad5cbe58f10d52">More...</a><br/></td></tr>
<tr class="separator:aca2b90e50d19a7f138ad5cbe58f10d52"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="properties"></a>
Properties</h2></td></tr>
<tr class="memitem:af215735ead9e218ff72f8d7c67f8f03d"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#af215735ead9e218ff72f8d7c67f8f03d">FixedPalette</a><code> [get]</code></td></tr>
<tr class="memdesc:af215735ead9e218ff72f8d7c67f8f03d"><td class="mdescLeft">&#160;</td><td class="mdescRight">(Readonly) If true, the algorithm can do everything in QuantizePixel, and InitialQuantizePixel will not be called. Implies ResizeForFirstPass=False and FourPass=false=  <a href="#af215735ead9e218ff72f8d7c67f8f03d">More...</a><br/></td></tr>
<tr class="separator:af215735ead9e218ff72f8d7c67f8f03d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a352139f8cee49782d51ad22b7f280a26"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a352139f8cee49782d51ad22b7f280a26">PixelSize</a><code> [get]</code></td></tr>
<tr class="memdesc:a352139f8cee49782d51ad22b7f280a26"><td class="mdescLeft">&#160;</td><td class="mdescRight">The number of bytes in a ARGB structure. Should be 4  <a href="#a352139f8cee49782d51ad22b7f280a26">More...</a><br/></td></tr>
<tr class="separator:a352139f8cee49782d51ad22b7f280a26"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac33de902f0a7e08ad889d4954cf85ed4"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ac33de902f0a7e08ad889d4954cf85ed4">FullTrust</a><code> [get, set]</code></td></tr>
<tr class="memdesc:ac33de902f0a7e08ad889d4954cf85ed4"><td class="mdescLeft">&#160;</td><td class="mdescRight">If true, pointer arithmetic will be used instead of GetPixel. GetPixel is much slower. If false, OmitFinalStage will be assumed true, as only palette generation is possible in low trust. Defaults to true.  <a href="#ac33de902f0a7e08ad889d4954cf85ed4">More...</a><br/></td></tr>
<tr class="separator:ac33de902f0a7e08ad889d4954cf85ed4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ae949d228b68d7950edac06944f20a13a"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ae949d228b68d7950edac06944f20a13a">ResizeForFirstPass</a><code> [get, set]</code></td></tr>
<tr class="memdesc:ae949d228b68d7950edac06944f20a13a"><td class="mdescLeft">&#160;</td><td class="mdescRight">If true, the first pass (InitialQuantizePixel) will be performed on a size-limited version of the original image to control performance. Ignored if FixedPalette=True  <a href="#ae949d228b68d7950edac06944f20a13a">More...</a><br/></td></tr>
<tr class="separator:ae949d228b68d7950edac06944f20a13a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac9c8a3b3608f7d947cc7a161a457180d"><td class="memItemLeft" align="right" valign="top">long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ac9c8a3b3608f7d947cc7a161a457180d">FirstPassPixelCount</a><code> [get, set]</code></td></tr>
<tr class="memdesc:ac9c8a3b3608f7d947cc7a161a457180d"><td class="mdescLeft">&#160;</td><td class="mdescRight">The approximate number of pixels to use when making a scaled copy of the image for the first pass. Only used when ResizeForFirstPass=True and FirstPassPixelThreshold is exceeded.  <a href="#ac9c8a3b3608f7d947cc7a161a457180d">More...</a><br/></td></tr>
<tr class="separator:ac9c8a3b3608f7d947cc7a161a457180d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9af3382b16f21fa107afc50c5847393f"><td class="memItemLeft" align="right" valign="top">long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a9af3382b16f21fa107afc50c5847393f">FirstPassPixelThreshold</a><code> [get, set]</code></td></tr>
<tr class="memdesc:a9af3382b16f21fa107afc50c5847393f"><td class="mdescLeft">&#160;</td><td class="mdescRight">The maximum number of pixels the original image may contain before a scaled copy is made for the first pass. Only relevant when ResizeForFirstPass=True  <a href="#a9af3382b16f21fa107afc50c5847393f">More...</a><br/></td></tr>
<tr class="separator:a9af3382b16f21fa107afc50c5847393f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ade30184747b7011c8773c9aac5a8df8e"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ade30184747b7011c8773c9aac5a8df8e">FourPass</a><code> [get, set]</code></td></tr>
<tr class="memdesc:ade30184747b7011c8773c9aac5a8df8e"><td class="mdescLeft">&#160;</td><td class="mdescRight">If true, image is re-paletted after quantization - forces 2 clones of the original image to be created. FixedPalette and OmitFinalStage should be false if this is used.  <a href="#ade30184747b7011c8773c9aac5a8df8e">More...</a><br/></td></tr>
<tr class="separator:ade30184747b7011c8773c9aac5a8df8e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a81b103d52bbc5e5946d680a73b75b682"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a81b103d52bbc5e5946d680a73b75b682">OmitFinalStage</a><code> [get, set]</code></td></tr>
<tr class="memdesc:a81b103d52bbc5e5946d680a73b75b682"><td class="mdescLeft">&#160;</td><td class="mdescRight">If true, a 32-bit image with an 8-bit palette will be returned instead of an 8-bit image, which GDI can save using median-cut quantization. Much faster than our final quantization pass, although it can't do transparency. Assumed true if FullTrust is false.  <a href="#a81b103d52bbc5e5946d680a73b75b682">More...</a><br/></td></tr>
<tr class="separator:a81b103d52bbc5e5946d680a73b75b682"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Abstract <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html" title="Abstract Quantizer class - handles the messy, algorithm-independent details of quantization. Subclasses must implement InitialQuantizePixel, GetPallete(), and QuantizePixel. Not thread-safe! ">Quantizer</a> class - handles the messy, algorithm-independent details of quantization. Subclasses must implement InitialQuantizePixel, GetPallete(), and QuantizePixel. Not thread-safe! </p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00031">31</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>
</div><h2 class="groupheader">Constructor &amp; Destructor Documentation</h2>
<a class="anchor" id="ae9c0173984cccf071bd78cbe946b217c"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">ImageResizer.Plugins.PrettyGifs.Quantizer.Quantizer </td>
          <td>(</td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>fixedPalette</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Construct the quantizer </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">fixedPalette</td><td>If true, the quantization only needs to loop through the source pixels once - InitialQuantiize</td></tr>
  </table>
  </dd>
</dl>
<p>If you construct this class with a true value for singlePass, then the code will, when quantizing your image, only call the 'QuantizeImage' function. If two passes are required, the code will call 'InitialQuantizeImage' and then 'QuantizeImage'. </p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00122">122</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;        {</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            _fixedPalette = fixedPalette;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;            _pixelSize = Marshal.SizeOf(typeof (Color32));</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;        }</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="adb7ea9913770ace53fc698211e41ef89"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">void ImageResizer.Plugins.PrettyGifs.Quantizer.AdjustNeighborSource </td>
          <td>(</td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>offsetX</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>offsetY</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>deltaR</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>deltaG</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>deltaB</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>deltaA</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Can only be called from QuantizePixel... This is how dithering is done... 5-18-09 ndj </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">offsetX</td><td></td></tr>
    <tr><td class="paramname">offsetY</td><td></td></tr>
    <tr><td class="paramname">deltaR</td><td></td></tr>
    <tr><td class="paramname">deltaG</td><td></td></tr>
    <tr><td class="paramname">deltaB</td><td></td></tr>
    <tr><td class="paramname">deltaA</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00461">461</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00462"></a><span class="lineno">  462</span>&#160;        {</div>
<div class="line"><a name="l00463"></a><span class="lineno">  463</span>&#160;            <span class="keywordflow">if</span> (secondPassIntermediate == null) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00464"></a><span class="lineno">  464</span>&#160;            <span class="keywordtype">int</span> x = secondPassX + offsetX;</div>
<div class="line"><a name="l00465"></a><span class="lineno">  465</span>&#160;            <span class="keywordtype">int</span> y = secondPassY + offsetY;</div>
<div class="line"><a name="l00466"></a><span class="lineno">  466</span>&#160;            <span class="keywordflow">if</span> (x &lt; 0 || x &gt;= secondPassIntermediate.Width) <span class="keywordflow">return</span>; <span class="comment">//do nothing;</span></div>
<div class="line"><a name="l00467"></a><span class="lineno">  467</span>&#160;            <span class="keywordflow">if</span> (y &lt; 0 || y &gt;= secondPassIntermediate.Height) <span class="keywordflow">return</span>; <span class="comment">//do nothing</span></div>
<div class="line"><a name="l00468"></a><span class="lineno">  468</span>&#160;            IntPtr p = (IntPtr)((<span class="keywordtype">long</span>)secondPassIntermediate.Scan0 + ((long)y * (<span class="keywordtype">long</span>)secondPassIntermediate.Stride) + (<a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a352139f8cee49782d51ad22b7f280a26">PixelSize</a> * x));</div>
<div class="line"><a name="l00469"></a><span class="lineno">  469</span>&#160;            <span class="comment">//Read the original color</span></div>
<div class="line"><a name="l00470"></a><span class="lineno">  470</span>&#160;            Color32 c = new Color32(p);</div>
<div class="line"><a name="l00471"></a><span class="lineno">  471</span>&#160;</div>
<div class="line"><a name="l00472"></a><span class="lineno">  472</span>&#160;            c.Red = ToByte((<span class="keywordtype">int</span>)c.Red + deltaR);</div>
<div class="line"><a name="l00473"></a><span class="lineno">  473</span>&#160;            c.Green = ToByte((<span class="keywordtype">int</span>)c.Green + deltaG);</div>
<div class="line"><a name="l00474"></a><span class="lineno">  474</span>&#160;            c.Blue = ToByte((<span class="keywordtype">int</span>)c.Blue + deltaB);</div>
<div class="line"><a name="l00475"></a><span class="lineno">  475</span>&#160;            c.Alpha = ToByte((<span class="keywordtype">int</span>)c.Alpha + deltaA);</div>
<div class="line"><a name="l00476"></a><span class="lineno">  476</span>&#160;            </div>
<div class="line"><a name="l00477"></a><span class="lineno">  477</span>&#160;            Marshal.StructureToPtr(c, p, true); <span class="comment">//False to not dispose old block. Since no reference to it exists (I believe PtrToStructure from Color32 copies, not references), this should be safe</span></div>
<div class="line"><a name="l00478"></a><span class="lineno">  478</span>&#160;  </div>
<div class="line"><a name="l00479"></a><span class="lineno">  479</span>&#160;        }</div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_html_a352139f8cee49782d51ad22b7f280a26"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a352139f8cee49782d51ad22b7f280a26">ImageResizer.Plugins.PrettyGifs.Quantizer.PixelSize</a></div><div class="ttdeci">int PixelSize</div><div class="ttdoc">The number of bytes in a ARGB structure. Should be 4 </div><div class="ttdef"><b>Definition:</b> <a href="_quantizer_8cs_source.html#l00047">Quantizer.cs:47</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a7d6b6c7781e51d87185f1ef6c3458576"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void ImageResizer.Plugins.PrettyGifs.Quantizer.AnalyzeImage </td>
          <td>(</td>
          <td class="paramtype">BitmapData&#160;</td>
          <td class="paramname"><em>sourceData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>height</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Execute the first pass through the pixels in the image </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sourceData</td><td>The source data</td></tr>
    <tr><td class="paramname">width</td><td>The width in pixels of the image</td></tr>
    <tr><td class="paramname">height</td><td>The height in pixels of the image</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00323">323</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;        {</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="comment">// Define the source data pointers. The source row is a byte to</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <span class="comment">// keep addition of the stride value easier (as this is in bytes)              </span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;            IntPtr pSourceRow = sourceData.Scan0;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            <span class="comment">// Loop through each row</span></div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row = 0; row &lt; height; row++)</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            {</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;                <span class="comment">// Set the source pixel to the first pixel in this row</span></div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;                IntPtr pSourcePixel = pSourceRow;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;</div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;                <span class="comment">// And loop through each column</span></div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt; width; col++)</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;                {            </div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;                    <a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a6dc513b30a6b60d6f1bb8a737d5fd0f9">InitialQuantizePixel</a>(<span class="keyword">new</span> Color32(pSourcePixel)); </div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;                    pSourcePixel = (IntPtr)((<span class="keywordtype">long</span>)pSourcePixel + <a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a352139f8cee49782d51ad22b7f280a26">PixelSize</a>); <span class="comment">//Increment afterwards</span></div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;                }       <span class="comment">// Now I have the pixel, call the FirstPassQuantize function...</span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;                <span class="comment">// Add the stride to the source row</span></div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;                pSourceRow = (IntPtr)((<span class="keywordtype">long</span>)pSourceRow + sourceData.Stride);</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            }</div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;        }</div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_html_a6dc513b30a6b60d6f1bb8a737d5fd0f9"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a6dc513b30a6b60d6f1bb8a737d5fd0f9">ImageResizer.Plugins.PrettyGifs.Quantizer.InitialQuantizePixel</a></div><div class="ttdeci">virtual void InitialQuantizePixel(Color32 pixel)</div><div class="ttdoc">Override this to process the pixel in the first pass of the algorithm </div><div class="ttdef"><b>Definition:</b> <a href="_quantizer_8cs_source.html#l00513">Quantizer.cs:513</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_html_a352139f8cee49782d51ad22b7f280a26"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a352139f8cee49782d51ad22b7f280a26">ImageResizer.Plugins.PrettyGifs.Quantizer.PixelSize</a></div><div class="ttdeci">int PixelSize</div><div class="ttdoc">The number of bytes in a ARGB structure. Should be 4 </div><div class="ttdef"><b>Definition:</b> <a href="_quantizer_8cs_source.html#l00047">Quantizer.cs:47</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="aca2b90e50d19a7f138ad5cbe58f10d52"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">abstract ColorPalette ImageResizer.Plugins.PrettyGifs.Quantizer.GetPalette </td>
          <td>(</td>
          <td class="paramtype">ColorPalette&#160;</td>
          <td class="paramname"><em>original</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Retrieve the palette for the quantized image </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">original</td><td>Any old palette, this is overrwritten</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The new color palette</dd></dl>

<p>Implemented in <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_octree_quantizer.html#a49760b1e0752212afe766b2802f86b10">ImageResizer.Plugins.PrettyGifs.OctreeQuantizer</a>.</p>

</div>
</div>
<a class="anchor" id="a6dc513b30a6b60d6f1bb8a737d5fd0f9"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void ImageResizer.Plugins.PrettyGifs.Quantizer.InitialQuantizePixel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_1_1_color32.html">Color32</a>&#160;</td>
          <td class="paramname"><em>pixel</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Override this to process the pixel in the first pass of the algorithm </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pixel</td><td>The pixel to quantize</td></tr>
  </table>
  </dd>
</dl>
<p>This function need only be overridden if your quantize algorithm needs two passes, such as an Octree quantizer. </p>

<p>Reimplemented in <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_octree_quantizer.html#a2ae43ea54b1271764f94f95298910181">ImageResizer.Plugins.PrettyGifs.OctreeQuantizer</a>.</p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00513">513</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00514"></a><span class="lineno">  514</span>&#160;        {</div>
<div class="line"><a name="l00515"></a><span class="lineno">  515</span>&#160;        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ab6b1a6dd3369b8a4674364a9c2d0f2ab"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">Bitmap ImageResizer.Plugins.PrettyGifs.Quantizer.Quantize </td>
          <td>(</td>
          <td class="paramtype">Image&#160;</td>
          <td class="paramname"><em>src</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Quantize an image and return the resulting output bitmap </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">source</td><td>The image to quantize</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>A quantized version of the image</dd></dl>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00151">151</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                                          {</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            <span class="comment">//We just set up the Bitmap copies and handle their disposal - the real work happens in </span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            <span class="comment">// QuantizeFullTrust and QuantizeLowTrust</span></div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            Bitmap firstPass = null;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            Bitmap copy = null;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            Bitmap copy2 = null;</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            Bitmap tempOutput = null;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            Bitmap result = null;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;            <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                <span class="comment">// First off take a 32bpp copy of &#39;source&#39; if it&#39;s not a 32bpp Bitmap instance.</span></div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                copy = src as Bitmap;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ade30184747b7011c8773c9aac5a8df8e">FourPass</a> || copy == null || !src.PixelFormat.Equals(PixelFormat.Format32bppArgb)) {</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                    copy = <span class="keyword">new</span> Bitmap(src.Width, src.Height, PixelFormat.Format32bppArgb);</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                    <span class="comment">// Now lock the bitmap into memory</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                    <span class="keyword">using</span> (Graphics g = Graphics.FromImage(copy)) {</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                        g.PageUnit = GraphicsUnit.Pixel;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                        <span class="comment">// Draw the source image onto the copy bitmap,</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                        <span class="comment">// which will effect a widening as appropriate.</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                        g.DrawImage(src, <span class="keyword">new</span> Point(0, 0));</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                    }</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                }</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                firstPass = copy;</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                <span class="comment">//If we should make a resized version for the first pass, let&#39;s do it.</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#af215735ead9e218ff72f8d7c67f8f03d">FixedPalette</a> &amp;&amp; <a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ae949d228b68d7950edac06944f20a13a">ResizeForFirstPass</a> &amp;&amp; <a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a9af3382b16f21fa107afc50c5847393f">FirstPassPixelThreshold</a> &lt; copy.Width * copy.Height) {</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;                    <span class="keywordtype">double</span> factor = <a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ac9c8a3b3608f7d947cc7a161a457180d">FirstPassPixelCount</a> / ((double)copy.Width * (<span class="keywordtype">double</span>)copy.Height);</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                    firstPass = <span class="keyword">new</span> Bitmap((<span class="keywordtype">int</span>)Math.Floor((<span class="keywordtype">double</span>)copy.Width * factor), (int)Math.Floor((<span class="keywordtype">double</span>)copy.Height * factor), PixelFormat.Format32bppArgb);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                    <span class="keyword">using</span> (Graphics g = Graphics.FromImage(firstPass)) {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                        <span class="comment">//Use the low-quality settings - we want the original colors of the image, nearest neighbor is better than bicubic spline here.</span></div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                        g.PageUnit = GraphicsUnit.Pixel;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                        g.InterpolationMode = System.Drawing.Drawing2D.InterpolationMode.NearestNeighbor;</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                        g.PixelOffsetMode = System.Drawing.Drawing2D.PixelOffsetMode.HighSpeed;</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                        g.SmoothingMode = System.Drawing.Drawing2D.SmoothingMode.None;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                        g.DrawImage(copy, 0, 0, firstPass.Width, firstPass.Height);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                    }</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                }</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                copy2 = null;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ade30184747b7011c8773c9aac5a8df8e">FourPass</a>) {</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                    copy2 = <span class="keyword">new</span> Bitmap(src.Width, src.Height, PixelFormat.Format32bppArgb);</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                    <span class="keyword">using</span> (Graphics g = Graphics.FromImage(copy2)) {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                        g.PageUnit = GraphicsUnit.Pixel;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                        g.DrawImage(src, <span class="keyword">new</span> Point(0, 0));</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                    }</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                }</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                <span class="comment">// And make an 8-bit output image</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                tempOutput = <span class="keyword">new</span> Bitmap(<a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a81b103d52bbc5e5946d680a73b75b682">OmitFinalStage</a> ? 2 : src.Width, <a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a81b103d52bbc5e5946d680a73b75b682">OmitFinalStage</a> ? 2 : src.Height, PixelFormat.Format8bppIndexed);</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                <span class="comment">//Full trust and low trust are implemented differently. </span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ac33de902f0a7e08ad889d4954cf85ed4">FullTrust</a>) {</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                    result = QuantizeFullTrust(firstPass, copy, copy2, tempOutput);</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                    result = QuantizeLowTrust(firstPass, copy, copy2, tempOutput);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                }</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            } <span class="keywordflow">finally</span> {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                <span class="keywordflow">if</span> (firstPass != null &amp;&amp; firstPass != copy &amp;&amp; firstPass != src &amp;&amp; firstPass != result) firstPass.Dispose();</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                <span class="keywordflow">if</span> (copy != null &amp;&amp; copy != src &amp;&amp; copy != result) copy.Dispose();</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                <span class="keywordflow">if</span> (copy2 != null &amp;&amp; copy2 != src &amp;&amp; copy2 != result) copy2.Dispose();</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                <span class="keywordflow">if</span> (tempOutput != null &amp;&amp; tempOutput != src &amp;&amp; tempOutput != result) tempOutput.Dispose();</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;        }</div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_html_af215735ead9e218ff72f8d7c67f8f03d"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#af215735ead9e218ff72f8d7c67f8f03d">ImageResizer.Plugins.PrettyGifs.Quantizer.FixedPalette</a></div><div class="ttdeci">bool FixedPalette</div><div class="ttdoc">(Readonly) If true, the algorithm can do everything in QuantizePixel, and InitialQuantizePixel will n...</div><div class="ttdef"><b>Definition:</b> <a href="_quantizer_8cs_source.html#l00038">Quantizer.cs:38</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_html_ade30184747b7011c8773c9aac5a8df8e"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ade30184747b7011c8773c9aac5a8df8e">ImageResizer.Plugins.PrettyGifs.Quantizer.FourPass</a></div><div class="ttdeci">bool FourPass</div><div class="ttdoc">If true, image is re-paletted after quantization - forces 2 clones of the original image to be create...</div><div class="ttdef"><b>Definition:</b> <a href="_quantizer_8cs_source.html#l00096">Quantizer.cs:96</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_html_a9af3382b16f21fa107afc50c5847393f"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a9af3382b16f21fa107afc50c5847393f">ImageResizer.Plugins.PrettyGifs.Quantizer.FirstPassPixelThreshold</a></div><div class="ttdeci">long FirstPassPixelThreshold</div><div class="ttdoc">The maximum number of pixels the original image may contain before a scaled copy is made for the firs...</div><div class="ttdef"><b>Definition:</b> <a href="_quantizer_8cs_source.html#l00085">Quantizer.cs:85</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_html_a81b103d52bbc5e5946d680a73b75b682"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a81b103d52bbc5e5946d680a73b75b682">ImageResizer.Plugins.PrettyGifs.Quantizer.OmitFinalStage</a></div><div class="ttdeci">bool OmitFinalStage</div><div class="ttdoc">If true, a 32-bit image with an 8-bit palette will be returned instead of an 8-bit image...</div><div class="ttdef"><b>Definition:</b> <a href="_quantizer_8cs_source.html#l00107">Quantizer.cs:107</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_html_ac33de902f0a7e08ad889d4954cf85ed4"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ac33de902f0a7e08ad889d4954cf85ed4">ImageResizer.Plugins.PrettyGifs.Quantizer.FullTrust</a></div><div class="ttdeci">bool FullTrust</div><div class="ttdoc">If true, pointer arithmetic will be used instead of GetPixel. GetPixel is much slower. If false, OmitFinalStage will be assumed true, as only palette generation is possible in low trust. Defaults to true. </div><div class="ttdef"><b>Definition:</b> <a href="_quantizer_8cs_source.html#l00056">Quantizer.cs:56</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_html_ac9c8a3b3608f7d947cc7a161a457180d"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ac9c8a3b3608f7d947cc7a161a457180d">ImageResizer.Plugins.PrettyGifs.Quantizer.FirstPassPixelCount</a></div><div class="ttdeci">long FirstPassPixelCount</div><div class="ttdoc">The approximate number of pixels to use when making a scaled copy of the image for the first pass...</div><div class="ttdef"><b>Definition:</b> <a href="_quantizer_8cs_source.html#l00075">Quantizer.cs:75</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_html_ae949d228b68d7950edac06944f20a13a"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#ae949d228b68d7950edac06944f20a13a">ImageResizer.Plugins.PrettyGifs.Quantizer.ResizeForFirstPass</a></div><div class="ttdeci">bool ResizeForFirstPass</div><div class="ttdoc">If true, the first pass (InitialQuantizePixel) will be performed on a size-limited version of the ori...</div><div class="ttdef"><b>Definition:</b> <a href="_quantizer_8cs_source.html#l00066">Quantizer.cs:66</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a398dfbac3ddc2704c7e5c317eee5fc21"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void ImageResizer.Plugins.PrettyGifs.Quantizer.QuantizeImage </td>
          <td>(</td>
          <td class="paramtype">BitmapData&#160;</td>
          <td class="paramname"><em>sourceData</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">BitmapData&#160;</td>
          <td class="paramname"><em>intermediate</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Bitmap&#160;</td>
          <td class="paramname"><em>output</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>width</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>height</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">Rectangle&#160;</td>
          <td class="paramname"><em>bounds</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">protected</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Execute a second pass through the bitmap. If dithering is enabled, sourceData will be modified. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">sourceData</td><td>The source bitmap, locked into memory</td></tr>
    <tr><td class="paramname">intermediate</td><td>The intermediate bitmap, used for 4-pass quantization. If specified, output will not actually be modified</td></tr>
    <tr><td class="paramname">output</td><td>The output bitmap</td></tr>
    <tr><td class="paramname">width</td><td>The width in pixels of the image</td></tr>
    <tr><td class="paramname">height</td><td>The height in pixels of the image</td></tr>
    <tr><td class="paramname">bounds</td><td>The bounding rectangle</td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00371">371</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            secondPassIntermediate = (intermediate != null) ? intermediate : sourceData;<span class="comment">// Not thread safe.... But nothing here is anyways...//For dithering - 5-18-09 ndj</span></div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            BitmapData outputData = null;</div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;            </div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;            <span class="keywordflow">try</span></div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;            {</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                <span class="comment">// Lock the output bitmap into memory</span></div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                <span class="keywordflow">if</span> (intermediate == null) outputData = output.LockBits(bounds, ImageLockMode.WriteOnly, PixelFormat.Format8bppIndexed);</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;                <span class="comment">// Define the source data pointers. The source row is a byte to</span></div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;                <span class="comment">// keep addition of the stride value easier (as this is in bytes)</span></div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;                IntPtr pSourceRow = sourceData.Scan0;</div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;                IntPtr pSourcePixel = pSourceRow;</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;                IntPtr pPreviousPixel = pSourcePixel;</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;                <span class="comment">// Now define the destination data pointers</span></div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;                IntPtr pDestinationRow = IntPtr.Zero;</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;                <span class="keywordflow">if</span> (intermediate == null) pDestinationRow = outputData.Scan0;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;                IntPtr pDestinationPixel = pDestinationRow;</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;                <span class="comment">// And convert the first pixel, so that I have values going into the loop</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;                byte pixelValue = <a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a2bf22a06ffc3228886015e2dc0608360">QuantizePixel</a>(<span class="keyword">new</span> Color32(pSourcePixel));</div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;                <span class="comment">// Assign the value of the first pixel</span></div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;                <span class="keywordflow">if</span> (intermediate == null) Marshal.WriteByte(pDestinationPixel, pixelValue);</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;                <span class="comment">// Loop through each row</span></div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> row = 0; row &lt; height; row++)</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                {</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;                    secondPassY = row;  <span class="comment">//For dithering - 5-18-09 ndj</span></div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;                    <span class="comment">// Set the source pixel to the first pixel in this row</span></div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;                    pSourcePixel = pSourceRow;</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;                    <span class="comment">// And set the destination pixel pointer to the first pixel in the row</span></div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;                    <span class="keywordflow">if</span> (intermediate == null) pDestinationPixel = pDestinationRow;</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;                    <span class="comment">// Loop through each pixel on this scan line</span></div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;                    <span class="keywordflow">for</span> (<span class="keywordtype">int</span> col = 0; col &lt; width; col++)</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;                    {</div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;                        secondPassX = col; <span class="comment">//For dithering - 5-18-09 ndj</span></div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;                        <span class="comment">// Check if this is the same as the last pixel. If so use that value</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;                        <span class="comment">// rather than calculating it again. This is an inexpensive optimisation.</span></div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;                        <span class="comment">// Nathanael: 2-11-09 changed from ReadByte to ReadInt32 on both.</span></div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;                        <span class="comment">// Otherwise this comparison may return true if only the blue component is the </span></div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                        <span class="comment">// same in 2 subsequent pixels.</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                        <span class="keywordflow">if</span> (Marshal.ReadInt32(pPreviousPixel) != Marshal.ReadInt32(pSourcePixel) || (intermediate != null))</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;                        {</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;                            <span class="comment">// Quantize the pixel</span></div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;                            pixelValue = <a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a2bf22a06ffc3228886015e2dc0608360">QuantizePixel</a>(<span class="keyword">new</span> Color32(pSourcePixel));</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;</div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;                            <span class="comment">// And setup the previous pointer</span></div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;                            pPreviousPixel = pSourcePixel;</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;                        }</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;</div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                        <span class="comment">// And set the pixel in the output</span></div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;                        <span class="keywordflow">if</span> (intermediate == null) Marshal.WriteByte(pDestinationPixel, pixelValue);</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;                        pSourcePixel = (IntPtr)((<span class="keywordtype">long</span>)pSourcePixel + <a class="code" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a352139f8cee49782d51ad22b7f280a26">PixelSize</a>);</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;                        <span class="keywordflow">if</span> (intermediate == null) pDestinationPixel = (IntPtr)((<span class="keywordtype">long</span>)pDestinationPixel + 1);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;                    }</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;                    <span class="comment">// Add the stride to the source row</span></div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;                    pSourceRow = (IntPtr)((<span class="keywordtype">long</span>)pSourceRow + sourceData.Stride);</div>
<div class="line"><a name="l00437"></a><span class="lineno">  437</span>&#160;</div>
<div class="line"><a name="l00438"></a><span class="lineno">  438</span>&#160;                    <span class="comment">// And to the destination row</span></div>
<div class="line"><a name="l00439"></a><span class="lineno">  439</span>&#160;                    <span class="keywordflow">if</span> (intermediate == null) pDestinationRow = (IntPtr)((<span class="keywordtype">long</span>)pDestinationRow + outputData.Stride);</div>
<div class="line"><a name="l00440"></a><span class="lineno">  440</span>&#160;                }</div>
<div class="line"><a name="l00441"></a><span class="lineno">  441</span>&#160;            }</div>
<div class="line"><a name="l00442"></a><span class="lineno">  442</span>&#160;            <span class="keywordflow">finally</span></div>
<div class="line"><a name="l00443"></a><span class="lineno">  443</span>&#160;            {</div>
<div class="line"><a name="l00444"></a><span class="lineno">  444</span>&#160;                <span class="comment">// Ensure that I unlock the output bits</span></div>
<div class="line"><a name="l00445"></a><span class="lineno">  445</span>&#160;                <span class="keywordflow">if</span> (intermediate == null) output.UnlockBits(outputData);</div>
<div class="line"><a name="l00446"></a><span class="lineno">  446</span>&#160;                secondPassIntermediate = null;</div>
<div class="line"><a name="l00447"></a><span class="lineno">  447</span>&#160;            }</div>
<div class="line"><a name="l00448"></a><span class="lineno">  448</span>&#160;        }</div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_html_a2bf22a06ffc3228886015e2dc0608360"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a2bf22a06ffc3228886015e2dc0608360">ImageResizer.Plugins.PrettyGifs.Quantizer.QuantizePixel</a></div><div class="ttdeci">abstract byte QuantizePixel(Color32 pixel)</div><div class="ttdoc">Override this to process the pixel in the second pass of the algorithm </div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_html_a352139f8cee49782d51ad22b7f280a26"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer.html#a352139f8cee49782d51ad22b7f280a26">ImageResizer.Plugins.PrettyGifs.Quantizer.PixelSize</a></div><div class="ttdeci">int PixelSize</div><div class="ttdoc">The number of bytes in a ARGB structure. Should be 4 </div><div class="ttdef"><b>Definition:</b> <a href="_quantizer_8cs_source.html#l00047">Quantizer.cs:47</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a2bf22a06ffc3228886015e2dc0608360"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">abstract byte ImageResizer.Plugins.PrettyGifs.Quantizer.QuantizePixel </td>
          <td>(</td>
          <td class="paramtype"><a class="el" href="struct_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_quantizer_1_1_color32.html">Color32</a>&#160;</td>
          <td class="paramname"><em>pixel</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">protected</span><span class="mlabel">pure virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Override this to process the pixel in the second pass of the algorithm </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">pixel</td><td>The pixel to quantize</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>The quantized value</dd></dl>

<p>Implemented in <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_octree_quantizer.html#a7a8dd490b27330aefe437aea78e91839">ImageResizer.Plugins.PrettyGifs.OctreeQuantizer</a>.</p>

</div>
</div>
<a class="anchor" id="a04f97f70db162fe88b3d10dc3277f6d2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">virtual void ImageResizer.Plugins.PrettyGifs.Quantizer.Reset </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span><span class="mlabel">virtual</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Resets the quantizer so it can process a new image. </p>

<p>Reimplemented in <a class="el" href="class_image_resizer_1_1_plugins_1_1_pretty_gifs_1_1_octree_quantizer.html#a9beafc72579a427fbdcad46d83ce6566">ImageResizer.Plugins.PrettyGifs.OctreeQuantizer</a>.</p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00131">131</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        {</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;            this.secondPassIntermediate = null;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            this.secondPassX = 0;</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;            this.secondPassY = 0;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;          </div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;        }</div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Property Documentation</h2>
<a class="anchor" id="ac9c8a3b3608f7d947cc7a161a457180d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">long ImageResizer.Plugins.PrettyGifs.Quantizer.FirstPassPixelCount</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">get</span><span class="mlabel">set</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The approximate number of pixels to use when making a scaled copy of the image for the first pass. Only used when ResizeForFirstPass=True and FirstPassPixelThreshold is exceeded. </p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00075">75</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>

<p>Referenced by <a class="el" href="_pretty_gifs_8cs_source.html#l00160">ImageResizer.Plugins.PrettyGifs.PrettyGifs.SaveIndexed()</a>.</p>

</div>
</div>
<a class="anchor" id="a9af3382b16f21fa107afc50c5847393f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">long ImageResizer.Plugins.PrettyGifs.Quantizer.FirstPassPixelThreshold</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">get</span><span class="mlabel">set</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The maximum number of pixels the original image may contain before a scaled copy is made for the first pass. Only relevant when ResizeForFirstPass=True </p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00085">85</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>

<p>Referenced by <a class="el" href="_pretty_gifs_8cs_source.html#l00160">ImageResizer.Plugins.PrettyGifs.PrettyGifs.SaveIndexed()</a>.</p>

</div>
</div>
<a class="anchor" id="af215735ead9e218ff72f8d7c67f8f03d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageResizer.Plugins.PrettyGifs.Quantizer.FixedPalette</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">get</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>(Readonly) If true, the algorithm can do everything in QuantizePixel, and InitialQuantizePixel will not be called. Implies ResizeForFirstPass=False and FourPass=false= </p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00038">38</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>

</div>
</div>
<a class="anchor" id="ade30184747b7011c8773c9aac5a8df8e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageResizer.Plugins.PrettyGifs.Quantizer.FourPass</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">get</span><span class="mlabel">set</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>If true, image is re-paletted after quantization - forces 2 clones of the original image to be created. FixedPalette and OmitFinalStage should be false if this is used. </p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00096">96</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>

</div>
</div>
<a class="anchor" id="ac33de902f0a7e08ad889d4954cf85ed4"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageResizer.Plugins.PrettyGifs.Quantizer.FullTrust</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">get</span><span class="mlabel">set</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>If true, pointer arithmetic will be used instead of GetPixel. GetPixel is much slower. If false, OmitFinalStage will be assumed true, as only palette generation is possible in low trust. Defaults to true. </p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00056">56</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>

</div>
</div>
<a class="anchor" id="a81b103d52bbc5e5946d680a73b75b682"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageResizer.Plugins.PrettyGifs.Quantizer.OmitFinalStage</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">get</span><span class="mlabel">set</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>If true, a 32-bit image with an 8-bit palette will be returned instead of an 8-bit image, which GDI can save using median-cut quantization. Much faster than our final quantization pass, although it can't do transparency. Assumed true if FullTrust is false. </p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00107">107</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>

</div>
</div>
<a class="anchor" id="a352139f8cee49782d51ad22b7f280a26"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int ImageResizer.Plugins.PrettyGifs.Quantizer.PixelSize</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">get</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>The number of bytes in a ARGB structure. Should be 4 </p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00047">47</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>

</div>
</div>
<a class="anchor" id="ae949d228b68d7950edac06944f20a13a"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageResizer.Plugins.PrettyGifs.Quantizer.ResizeForFirstPass</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">get</span><span class="mlabel">set</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>If true, the first pass (InitialQuantizePixel) will be performed on a size-limited version of the original image to control performance. Ignored if FixedPalette=True </p>

<p>Definition at line <a class="el" href="_quantizer_8cs_source.html#l00066">66</a> of file <a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>C:/Users/nathanael/Documents/resizer/Plugins/PrettyGifs/<a class="el" href="_quantizer_8cs_source.html">Quantizer.cs</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
