<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ImageResizer: C:/Users/Administrator/Documents/resizer/Plugins/FreeImage/FreeImageDecoder.cs Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="resizer-icon-64.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.2.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">C:/Users/Administrator/Documents/resizer/Plugins/FreeImage/FreeImageDecoder.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 ï»¿using System;
<a name="l00002"></a>00002 <span class="keyword">using</span> System.Collections.Generic;
<a name="l00003"></a>00003 <span class="keyword">using</span> System.Text;
<a name="l00004"></a>00004 <span class="keyword">using</span> ImageResizer.Resizing;
<a name="l00005"></a>00005 <span class="keyword">using</span> ImageResizer.Configuration.Issues;
<a name="l00006"></a>00006 <span class="keyword">using</span> FreeImageAPI;
<a name="l00007"></a>00007 <span class="keyword">using</span> System.Drawing;
<a name="l00008"></a>00008 <span class="keyword">using</span> System.IO;
<a name="l00009"></a>00009 <span class="keyword">using</span> System.Diagnostics;
<a name="l00010"></a>00010 
<a name="l00011"></a><a class="code" href="namespace_image_resizer_1_1_plugins_1_1_free_image_decoder.html">00011</a> <span class="keyword">namespace </span>ImageResizer.Plugins.FreeImageDecoder {
<a name="l00012"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_free_image_decoder_1_1_free_image_decoder_plugin.html">00012</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_image_resizer_1_1_plugins_1_1_free_image_decoder_1_1_free_image_decoder_plugin.html">FreeImageDecoderPlugin</a> : <a class="code" href="class_image_resizer_1_1_resizing_1_1_builder_extension.html" title="Provides a useable base class that can be used to modify the behavior of ImageBuilder. When registered with an ImageBuilder instance, the ImageBuilder will call the corresponding methods on the extension prior to executing its own methods.">BuilderExtension</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html" title="All plugins must implement this. Enables web.config addition and removal.">IPlugin</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_file_extension_plugin.html" title="For plugins that add support for new source file image extensions.">IFileExtensionPlugin</a>, <a class="code" href="interface_image_resizer_1_1_configuration_1_1_issues_1_1_i_issue_provider.html">IIssueProvider</a> {
<a name="l00013"></a>00013         <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_free_image_decoder_1_1_free_image_decoder_plugin.html">FreeImageDecoderPlugin</a>() {
<a name="l00014"></a>00014         }
<a name="l00015"></a>00015         <span class="keyword">private</span> <span class="keyword">static</span> IEnumerable&lt;string&gt; supportedExts = null;
<a name="l00016"></a>00016         <span class="keyword">public</span> <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html" title="All plugins must implement this. Enables web.config addition and removal.">IPlugin</a> Install(Configuration.Config c) {
<a name="l00017"></a>00017             <span class="keywordflow">if</span> (supportedExts == null &amp;&amp; FreeImage.IsAvailable()) {
<a name="l00018"></a>00018                 supportedExts = BuildSupportedList();
<a name="l00019"></a>00019             }
<a name="l00020"></a>00020             c.Plugins.add_plugin(<span class="keyword">this</span>);
<a name="l00021"></a>00021             <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00022"></a>00022         }
<a name="l00023"></a>00023 
<a name="l00024"></a>00024 
<a name="l00025"></a>00025 
<a name="l00026"></a>00026         <span class="keyword">public</span> IEnumerable&lt;string&gt; BuildSupportedList() {
<a name="l00027"></a>00027             FREE_IMAGE_FORMAT[] formats = (FREE_IMAGE_FORMAT[])Enum.GetValues(typeof(FREE_IMAGE_FORMAT));
<a name="l00028"></a>00028             List&lt;string&gt; extensions = <span class="keyword">new</span> List&lt;string&gt;();
<a name="l00029"></a>00029             <span class="keywordflow">foreach</span> (FREE_IMAGE_FORMAT format <span class="keywordflow">in</span> formats)
<a name="l00030"></a>00030                 <span class="keywordflow">if</span> (format != FREE_IMAGE_FORMAT.FIF_UNKNOWN)
<a name="l00031"></a>00031                     extensions.AddRange(FreeImage.GetFIFExtensionList(format).Split(<span class="charliteral">&#39;,&#39;</span>));
<a name="l00032"></a>00032             <span class="keywordflow">return</span> extensions;
<a name="l00033"></a>00033 
<a name="l00034"></a>00034         }
<a name="l00035"></a>00035 
<a name="l00036"></a>00036         <span class="keyword">public</span> <span class="keywordtype">bool</span> Uninstall(Configuration.Config c) {
<a name="l00037"></a>00037             c.Plugins.remove_plugin(<span class="keyword">this</span>);
<a name="l00038"></a>00038             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00039"></a>00039         }
<a name="l00040"></a>00040 
<a name="l00041"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_free_image_decoder_1_1_free_image_decoder_plugin.html#abd369d0a8085f2fa712432fc4ee15d03">00041</a>         <span class="keyword">public</span> IEnumerable&lt;string&gt; <a class="code" href="class_image_resizer_1_1_plugins_1_1_free_image_decoder_1_1_free_image_decoder_plugin.html#abd369d0a8085f2fa712432fc4ee15d03" title="If the plugin adds support for new file extensions (such as &quot;psd&quot;), they should be returned by this m...">GetSupportedFileExtensions</a>() {
<a name="l00042"></a>00042             <span class="keywordflow">if</span> (supportedExts == null) <span class="keywordflow">return</span> <span class="keyword">new</span> <span class="keywordtype">string</span>[] { };
<a name="l00043"></a>00043             <span class="keywordflow">else</span> <span class="keywordflow">return</span> supportedExts;
<a name="l00044"></a>00044         }
<a name="l00045"></a>00045 
<a name="l00046"></a>00046         <span class="keyword">public</span> <span class="keyword">override</span> System.Drawing.Bitmap DecodeStream(System.IO.Stream s, <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings, <span class="keywordtype">string</span> optionalPath) {
<a name="l00047"></a>00047             <span class="keywordflow">if</span> (!<span class="stringliteral">&quot;freeimage&quot;</span>.Equals(settings[<span class="stringliteral">&quot;decoder&quot;</span>], StringComparison.OrdinalIgnoreCase)) <span class="keywordflow">return</span> null;
<a name="l00048"></a>00048 
<a name="l00049"></a>00049             <span class="keywordflow">return</span> Decode(s,  settings);
<a name="l00050"></a>00050         }
<a name="l00051"></a>00051 
<a name="l00052"></a>00052         <span class="keyword">public</span> <span class="keyword">override</span> System.Drawing.Bitmap DecodeStreamFailed(System.IO.Stream s, <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings, <span class="keywordtype">string</span> optionalPath) {
<a name="l00053"></a>00053             <span class="keywordflow">try</span> {
<a name="l00054"></a>00054                  <span class="keywordflow">return</span> Decode(s,settings);
<a name="l00055"></a>00055                  
<a name="l00056"></a>00056             } <span class="keywordflow">catch</span> (Exception){
<a name="l00057"></a>00057                 <span class="keywordflow">return</span> null;
<a name="l00058"></a>00058             }
<a name="l00059"></a>00059         }
<a name="l00060"></a>00060 
<a name="l00061"></a>00061         <span class="keyword">public</span> Bitmap Decode(Stream s, ResizeSettings settings) {
<a name="l00062"></a>00062             <span class="keywordflow">if</span> (!FreeImageAPI.FreeImage.IsAvailable()) <span class="keywordflow">return</span> null;
<a name="l00063"></a>00063 
<a name="l00064"></a>00064             FREE_IMAGE_LOAD_FLAGS flags = FREE_IMAGE_LOAD_FLAGS.DEFAULT;
<a name="l00065"></a>00065             <span class="keywordtype">bool</span> autorotate = (<span class="stringliteral">&quot;true&quot;</span>.Equals(settings[<span class="stringliteral">&quot;autorotate&quot;</span>], StringComparison.OrdinalIgnoreCase));
<a name="l00066"></a>00066             <span class="keywordflow">if</span> (autorotate) flags |= FREE_IMAGE_LOAD_FLAGS.JPEG_EXIFROTATE;
<a name="l00067"></a>00067             Stopwatch sw = <span class="keyword">new</span> Stopwatch();
<a name="l00068"></a>00068             sw.Start();
<a name="l00069"></a>00069             FIBITMAP original = FreeImage.LoadFromStream(s, flags);
<a name="l00070"></a>00070             sw.Stop();
<a name="l00071"></a>00071             <span class="keywordflow">if</span> (original.IsNull) <span class="keywordflow">return</span> null;
<a name="l00072"></a>00072             <span class="keywordflow">try</span> {
<a name="l00073"></a>00073                 Bitmap b =  FreeImage.GetBitmap(original);
<a name="l00074"></a>00074                 <span class="keywordflow">if</span> (autorotate) <span class="keywordflow">try</span> { b.RemovePropertyItem(0x0112); } <span class="keywordflow">catch</span> { }
<a name="l00075"></a>00075                 <span class="keywordflow">return</span> b;
<a name="l00076"></a>00076             } <span class="keywordflow">finally</span> {
<a name="l00077"></a>00077                 <span class="keywordflow">if</span> (!original.IsNull) FreeImage.UnloadEx(ref original);
<a name="l00078"></a>00078             }
<a name="l00079"></a>00079         }
<a name="l00080"></a>00080 
<a name="l00081"></a>00081         <span class="keyword">public</span> IEnumerable&lt;IIssue&gt; GetIssues() {
<a name="l00082"></a>00082             List&lt;IIssue&gt; issues = <span class="keyword">new</span> List&lt;IIssue&gt;();
<a name="l00083"></a>00083             <span class="keywordflow">if</span> (!FreeImageAPI.FreeImage.IsAvailable()) issues.Add(<span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_configuration_1_1_issues_1_1_issue.html">Issue</a>(<span class="stringliteral">&quot;The FreeImage library is not available! All FreeImage plugins will be disabled.&quot;</span>, <a class="code" href="namespace_image_resizer_1_1_configuration_1_1_issues.html#ada2af2a44c17c99a124cadb8a92f8555">IssueSeverity</a>.Error));
<a name="l00084"></a>00084             <span class="keywordflow">return</span> issues;
<a name="l00085"></a>00085         }
<a name="l00086"></a>00086     }
<a name="l00087"></a>00087 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
