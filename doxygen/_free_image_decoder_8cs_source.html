<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ImageResizer: C:/Users/Administrator/Documents/resizer/Plugins/FreeImage/FreeImageDecoder.cs Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="imageresizer-logo-00aec4.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.3.3</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">C:/Users/Administrator/Documents/resizer/Plugins/FreeImage/FreeImageDecoder.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 ï»¿using System;
<a name="l00002"></a>00002 <span class="keyword">using</span> System.Collections.Generic;
<a name="l00003"></a>00003 <span class="keyword">using</span> System.Text;
<a name="l00004"></a>00004 <span class="keyword">using</span> ImageResizer.Resizing;
<a name="l00005"></a>00005 <span class="keyword">using</span> ImageResizer.Configuration.Issues;
<a name="l00006"></a>00006 <span class="keyword">using</span> FreeImageAPI;
<a name="l00007"></a>00007 <span class="keyword">using</span> System.Drawing;
<a name="l00008"></a>00008 <span class="keyword">using</span> System.IO;
<a name="l00009"></a>00009 <span class="keyword">using</span> System.Diagnostics;
<a name="l00010"></a>00010 <span class="keyword">using</span> System.Globalization;
<a name="l00011"></a>00011 <span class="keyword">using</span> ImageResizer.ExtensionMethods;
<a name="l00012"></a>00012 
<a name="l00013"></a><a class="code" href="namespace_image_resizer_1_1_plugins_1_1_free_image_decoder.html">00013</a> <span class="keyword">namespace </span>ImageResizer.Plugins.FreeImageDecoder {
<a name="l00014"></a>00014 
<a name="l00015"></a>00015     <span class="keyword">public</span> <span class="keyword">enum</span> ToneMappingAlgorithm {
<a name="l00016"></a>00016         None,
<a name="l00017"></a>00017         Reinhard,
<a name="l00018"></a>00018         Drago,
<a name="l00019"></a>00019         Fattal
<a name="l00020"></a>00020     }
<a name="l00021"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_free_image_decoder_1_1_free_image_decoder_plugin.html">00021</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_image_resizer_1_1_plugins_1_1_free_image_decoder_1_1_free_image_decoder_plugin.html">FreeImageDecoderPlugin</a> : <a class="code" href="class_image_resizer_1_1_resizing_1_1_builder_extension.html" title="Provides a useable base class that can be used to modify the behavior of ImageBuilder. When registered with an ImageBuilder instance, the ImageBuilder will call the corresponding methods on the extension prior to executing its own methods.">BuilderExtension</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html" title="All plugins must implement this. Enables web.config addition and removal.">IPlugin</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_file_extension_plugin.html" title="For plugins that add support for new source file image extensions.">IFileExtensionPlugin</a>, <a class="code" href="interface_image_resizer_1_1_configuration_1_1_issues_1_1_i_issue_provider.html">IIssueProvider</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_querystring_plugin.html" title="For plugins that access the query string (important!)">IQuerystringPlugin</a> {
<a name="l00022"></a>00022         <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_free_image_decoder_1_1_free_image_decoder_plugin.html">FreeImageDecoderPlugin</a>() {
<a name="l00023"></a>00023         }
<a name="l00024"></a>00024         <span class="keyword">private</span> <span class="keyword">static</span> IEnumerable&lt;string&gt; supportedExts = null;
<a name="l00025"></a>00025         <span class="keyword">public</span> <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html" title="All plugins must implement this. Enables web.config addition and removal.">IPlugin</a> Install(Configuration.Config c) {
<a name="l00026"></a>00026             <span class="keywordflow">if</span> (supportedExts == null &amp;&amp; FreeImage.IsAvailable()) {
<a name="l00027"></a>00027                 supportedExts = BuildSupportedList();
<a name="l00028"></a>00028             }
<a name="l00029"></a>00029             c.Plugins.add_plugin(<span class="keyword">this</span>);
<a name="l00030"></a>00030             <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00031"></a>00031         }
<a name="l00032"></a>00032 
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 
<a name="l00035"></a>00035         <span class="keyword">public</span> IEnumerable&lt;string&gt; BuildSupportedList() {
<a name="l00036"></a>00036             FREE_IMAGE_FORMAT[] formats = (FREE_IMAGE_FORMAT[])Enum.GetValues(typeof(FREE_IMAGE_FORMAT));
<a name="l00037"></a>00037             List&lt;string&gt; extensions = <span class="keyword">new</span> List&lt;string&gt;();
<a name="l00038"></a>00038             <span class="keywordflow">foreach</span> (FREE_IMAGE_FORMAT format <span class="keywordflow">in</span> formats)
<a name="l00039"></a>00039                 <span class="keywordflow">if</span> (format != FREE_IMAGE_FORMAT.FIF_UNKNOWN)
<a name="l00040"></a>00040                     extensions.AddRange(FreeImage.GetFIFExtensionList(format).Split(<span class="charliteral">&#39;,&#39;</span>));
<a name="l00041"></a>00041             <span class="keywordflow">return</span> extensions;
<a name="l00042"></a>00042 
<a name="l00043"></a>00043         }
<a name="l00044"></a>00044 
<a name="l00045"></a>00045         <span class="keyword">public</span> <span class="keywordtype">bool</span> Uninstall(Configuration.Config c) {
<a name="l00046"></a>00046             c.Plugins.remove_plugin(<span class="keyword">this</span>);
<a name="l00047"></a>00047             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00048"></a>00048         }
<a name="l00049"></a>00049 
<a name="l00050"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_free_image_decoder_1_1_free_image_decoder_plugin.html#abd369d0a8085f2fa712432fc4ee15d03">00050</a>         <span class="keyword">public</span> IEnumerable&lt;string&gt; <a class="code" href="class_image_resizer_1_1_plugins_1_1_free_image_decoder_1_1_free_image_decoder_plugin.html#abd369d0a8085f2fa712432fc4ee15d03" title="If the plugin adds support for new file extensions (such as &quot;psd&quot;), they should be returned by this m...">GetSupportedFileExtensions</a>() {
<a name="l00051"></a>00051             <span class="keywordflow">if</span> (supportedExts == null) <span class="keywordflow">return</span> <span class="keyword">new</span> <span class="keywordtype">string</span>[] { };
<a name="l00052"></a>00052             <span class="keywordflow">else</span> <span class="keywordflow">return</span> supportedExts;
<a name="l00053"></a>00053         }
<a name="l00054"></a>00054 
<a name="l00055"></a>00055         <span class="keyword">public</span> <span class="keyword">override</span> System.Drawing.Bitmap DecodeStream(System.IO.Stream s, <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings, <span class="keywordtype">string</span> optionalPath) {
<a name="l00056"></a>00056             <span class="keywordflow">if</span> (!<span class="stringliteral">&quot;freeimage&quot;</span>.Equals(settings[<span class="stringliteral">&quot;decoder&quot;</span>], StringComparison.OrdinalIgnoreCase)) <span class="keywordflow">return</span> null;
<a name="l00057"></a>00057 
<a name="l00058"></a>00058             <span class="keywordflow">return</span> Decode(s,  settings);
<a name="l00059"></a>00059         }
<a name="l00060"></a>00060 
<a name="l00061"></a>00061         <span class="keyword">public</span> <span class="keyword">override</span> System.Drawing.Bitmap DecodeStreamFailed(System.IO.Stream s, <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings, <span class="keywordtype">string</span> optionalPath) {
<a name="l00062"></a>00062             <span class="keywordflow">try</span> {
<a name="l00063"></a>00063                  <span class="keywordflow">return</span> Decode(s,settings);
<a name="l00064"></a>00064                  
<a name="l00065"></a>00065             } <span class="keywordflow">catch</span> (Exception){
<a name="l00066"></a>00066                 <span class="keywordflow">return</span> null;
<a name="l00067"></a>00067             }
<a name="l00068"></a>00068         }
<a name="l00069"></a>00069 
<a name="l00070"></a>00070         <span class="keyword">public</span> Bitmap Decode(Stream s, ResizeSettings settings) {
<a name="l00071"></a>00071             <span class="keywordflow">return</span> (Bitmap)DecodeAndCall(s, settings, delegate(ref FIBITMAP b, <span class="keywordtype">bool</span> MayDispose) {
<a name="l00072"></a>00072                  <span class="keywordtype">bool</span> usethumb = (<span class="stringliteral">&quot;true&quot;</span>.Equals(settings[<span class="stringliteral">&quot;usepreview&quot;</span>], StringComparison.OrdinalIgnoreCase));
<a name="l00073"></a>00073                 <span class="keywordtype">bool</span> autorotate = (<span class="stringliteral">&quot;true&quot;</span>.Equals(settings[<span class="stringliteral">&quot;autorotate&quot;</span>], StringComparison.OrdinalIgnoreCase));
<a name="l00074"></a>00074 
<a name="l00075"></a>00075                 <span class="keywordflow">return</span> Convert(b, autorotate &amp;&amp; !usethumb); <span class="comment">//because usepreview prevents autorotate from working at the freeimage level</span>
<a name="l00076"></a>00076             });
<a name="l00077"></a>00077         }
<a name="l00078"></a>00078         <span class="keyword">public</span> delegate <span class="keywordtype">object</span> DecodeCallback(ref FIBITMAP b, <span class="keywordtype">bool</span> mayUnloadOriginal);<span class="comment"></span>
<a name="l00079"></a>00079 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00080"></a>00080 <span class="comment">        /// Decodes the given stream, selects the correct page or frame, rotates it correctly (if autorotate=true), then executes the callback, then cleans up.</span>
<a name="l00081"></a>00081 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00082"></a>00082 <span class="comment">        /// &lt;param name=&quot;s&quot;&gt;&lt;/param&gt;</span>
<a name="l00083"></a>00083 <span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;&lt;/param&gt;</span>
<a name="l00084"></a>00084 <span class="comment">        /// &lt;param name=&quot;callback&quot;&gt;&lt;/param&gt;</span>
<a name="l00085"></a>00085 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00086"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_free_image_decoder_1_1_free_image_decoder_plugin.html#adbfde46b6173f4100677fb2bcf6bbd42">00086</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">static</span> <span class="keywordtype">object</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_free_image_decoder_1_1_free_image_decoder_plugin.html#adbfde46b6173f4100677fb2bcf6bbd42" title="Decodes the given stream, selects the correct page or frame, rotates it correctly (if autorotate=true...">DecodeAndCall</a>(Stream s, <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings, DecodeCallback callback){
<a name="l00087"></a>00087             <span class="keywordflow">if</span> (!FreeImageAPI.FreeImage.IsAvailable()) <span class="keywordflow">return</span> null;
<a name="l00088"></a>00088 
<a name="l00089"></a>00089             FREE_IMAGE_LOAD_FLAGS flags = FREE_IMAGE_LOAD_FLAGS.DEFAULT;
<a name="l00090"></a>00090 
<a name="l00091"></a>00091             <span class="comment">//If we&#39;re not tone-mapping the raw file, convert it for display</span>
<a name="l00092"></a>00092             <span class="keywordflow">if</span> (!HasToneMappingCommands(settings)) flags |= FREE_IMAGE_LOAD_FLAGS.RAW_DISPLAY;
<a name="l00093"></a>00093 
<a name="l00094"></a>00094             <span class="keywordtype">bool</span> usethumb = (<span class="stringliteral">&quot;true&quot;</span>.Equals(settings[<span class="stringliteral">&quot;usepreview&quot;</span>], StringComparison.OrdinalIgnoreCase));
<a name="l00095"></a>00095             <span class="keywordflow">if</span> (usethumb) flags |= FREE_IMAGE_LOAD_FLAGS.RAW_PREVIEW;
<a name="l00096"></a>00096 
<a name="l00097"></a>00097             <span class="keywordtype">bool</span> autorotate = (<span class="stringliteral">&quot;true&quot;</span>.Equals(settings[<span class="stringliteral">&quot;autorotate&quot;</span>], StringComparison.OrdinalIgnoreCase));
<a name="l00098"></a>00098             <span class="keywordflow">if</span> (autorotate) flags |= FREE_IMAGE_LOAD_FLAGS.JPEG_EXIFROTATE;
<a name="l00099"></a>00099 
<a name="l00100"></a>00100             <span class="keywordtype">int</span> page = 0;
<a name="l00101"></a>00101             <span class="keywordflow">if</span> (!<span class="keywordtype">string</span>.IsNullOrEmpty(settings[<span class="stringliteral">&quot;page&quot;</span>]) &amp;&amp; !<span class="keywordtype">int</span>.TryParse(settings[<span class="stringliteral">&quot;page&quot;</span>], NumberStyles.Integer, NumberFormatInfo.InvariantInfo, out page))
<a name="l00102"></a>00102                 page = 0;
<a name="l00103"></a>00103 
<a name="l00104"></a>00104             <span class="keywordtype">int</span> frame = 0;
<a name="l00105"></a>00105             <span class="keywordflow">if</span> (!<span class="keywordtype">string</span>.IsNullOrEmpty(settings[<span class="stringliteral">&quot;frame&quot;</span>]) &amp;&amp; !<span class="keywordtype">int</span>.TryParse(settings[<span class="stringliteral">&quot;frame&quot;</span>], NumberStyles.Integer, NumberFormatInfo.InvariantInfo, out frame))
<a name="l00106"></a>00106                 frame = 0;
<a name="l00107"></a>00107 
<a name="l00108"></a>00108             <span class="keywordflow">if</span> (page == 0 &amp;&amp; frame != 0) page = frame; 
<a name="l00109"></a>00109 
<a name="l00110"></a>00110             Stopwatch sw = <span class="keyword">new</span> Stopwatch();
<a name="l00111"></a>00111             sw.Start();
<a name="l00112"></a>00112 
<a name="l00113"></a>00113             <span class="keywordflow">if</span> (page &gt; 1) {
<a name="l00114"></a>00114                 FREE_IMAGE_FORMAT fmt = FREE_IMAGE_FORMAT.FIF_UNKNOWN;
<a name="l00115"></a>00115                 FIMULTIBITMAP mb = FreeImage.OpenMultiBitmapFromStream(s, ref fmt, flags);
<a name="l00116"></a>00116                 <span class="comment">//Prevent asking for a non-existent page</span>
<a name="l00117"></a>00117                 <span class="keywordtype">int</span> pages = FreeImage.GetPageCount(mb);
<a name="l00118"></a>00118                 <span class="keywordflow">if</span> (page &gt; pages) page = pages; 
<a name="l00119"></a>00119                 <span class="keywordflow">try</span> {
<a name="l00120"></a>00120                     <span class="keywordflow">if</span> (mb.IsNull) <span class="keywordflow">return</span> null;
<a name="l00121"></a>00121                     FIBITMAP bPage = FreeImage.LockPage(mb, page - 1);
<a name="l00122"></a>00122                     <span class="keywordflow">if</span> (bPage.IsNull) <span class="keywordflow">return</span> null;
<a name="l00123"></a>00123                     <span class="keywordflow">try</span> {
<a name="l00124"></a>00124                         sw.Stop();
<a name="l00125"></a>00125                         <span class="keywordflow">return</span> ToneMap(ref bPage, <span class="keyword">false</span>, settings, callback);
<a name="l00126"></a>00126                     } <span class="keywordflow">finally</span> {
<a name="l00127"></a>00127                         FreeImage.UnlockPage(mb, bPage, <span class="keyword">false</span>);
<a name="l00128"></a>00128                     }
<a name="l00129"></a>00129 
<a name="l00130"></a>00130                 } <span class="keywordflow">finally</span> {
<a name="l00131"></a>00131                     <span class="keywordflow">if</span> (!mb.IsNull) FreeImage.CloseMultiBitmapEx(ref mb, FREE_IMAGE_SAVE_FLAGS.DEFAULT);
<a name="l00132"></a>00132                 }
<a name="l00133"></a>00133 
<a name="l00134"></a>00134             } <span class="keywordflow">else</span> {
<a name="l00135"></a>00135                 FIBITMAP original = FIBITMAP.Zero;
<a name="l00136"></a>00136                 <span class="keywordflow">try</span> {
<a name="l00137"></a>00137                     original = FreeImage.LoadFromStream(s, flags);
<a name="l00138"></a>00138                     sw.Stop();
<a name="l00139"></a>00139                     <span class="keywordflow">if</span> (original.IsNull) <span class="keywordflow">return</span> null;
<a name="l00140"></a>00140                     <span class="keywordflow">return</span> ToneMap(ref original, <span class="keyword">true</span>, settings, callback);
<a name="l00141"></a>00141                 } <span class="keywordflow">finally</span> {
<a name="l00142"></a>00142                     <span class="keywordflow">if</span> (!original.IsNull) FreeImage.UnloadEx(ref original);
<a name="l00143"></a>00143                 }
<a name="l00144"></a>00144             }
<a name="l00145"></a>00145         }
<a name="l00146"></a>00146         <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">bool</span> HasToneMappingCommands(<a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings) {
<a name="l00147"></a>00147             <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">//Tone mapping is disabled, not yet functional</span>
<a name="l00148"></a>00148             <span class="keywordflow">return</span> <a class="code" href="class_image_resizer_1_1_extension_methods_1_1_name_value_collection_extensions.html">NameValueCollectionExtensions</a>.Get&lt;ToneMappingAlgorithm&gt;(settings, <span class="stringliteral">&quot;fi.tonemap&quot;</span>, ToneMappingAlgorithm.None) != ToneMappingAlgorithm.None;
<a name="l00149"></a>00149 
<a name="l00150"></a>00150         }
<a name="l00151"></a>00151 
<a name="l00152"></a>00152         <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">object</span> ToneMap(ref FIBITMAP b, <span class="keywordtype">bool</span> mayUnloadOriginal, <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings, DecodeCallback callback) {
<a name="l00153"></a>00153             <span class="keywordflow">return</span> callback(ref b, mayUnloadOriginal);<span class="comment">//Tone mapping is disabled, not yet functional</span>
<a name="l00154"></a>00154 
<a name="l00155"></a>00155             FIBITMAP m = FIBITMAP.Zero;
<a name="l00156"></a>00156             <span class="keywordflow">try</span> {
<a name="l00157"></a>00157                 var alg = <a class="code" href="class_image_resizer_1_1_extension_methods_1_1_name_value_collection_extensions.html">NameValueCollectionExtensions</a>.Get&lt;ToneMappingAlgorithm&gt;(settings, <span class="stringliteral">&quot;fi.tonemap&quot;</span>, ToneMappingAlgorithm.None);
<a name="l00158"></a>00158                 <span class="keywordflow">if</span> (alg == ToneMappingAlgorithm.Drago){
<a name="l00159"></a>00159                     m = FreeImage.TmoDrago03(b, 2.2, 0);
<a name="l00160"></a>00160                 }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (alg == ToneMappingAlgorithm.Reinhard){
<a name="l00161"></a>00161                     m = FreeImage.TmoReinhard05(b, 0, 0);
<a name="l00162"></a>00162                 }<span class="keywordflow">else</span> <span class="keywordflow">if</span> (alg == ToneMappingAlgorithm.Fattal){
<a name="l00163"></a>00163                     m = FreeImage.TmoFattal02(b, 0.5, 0.85);
<a name="l00164"></a>00164                 }<span class="keywordflow">else</span>{
<a name="l00165"></a>00165                     <span class="keywordflow">return</span> callback(ref b, mayUnloadOriginal);
<a name="l00166"></a>00166                 }
<a name="l00167"></a>00167                 <span class="keywordflow">if</span> (mayUnloadOriginal) FreeImage.UnloadEx(ref b);
<a name="l00168"></a>00168 
<a name="l00169"></a>00169                 <span class="keywordflow">return</span> callback(ref m, <span class="keyword">true</span>);
<a name="l00170"></a>00170             } <span class="keywordflow">finally</span> {
<a name="l00171"></a>00171                 <span class="keywordflow">if</span> (!m.IsNull) FreeImage.UnloadEx(ref m); 
<a name="l00172"></a>00172             }
<a name="l00173"></a>00173         }
<a name="l00174"></a>00174 
<a name="l00175"></a>00175         <span class="keyword">private</span> Bitmap Convert(FIBITMAP fi, <span class="keywordtype">bool</span> removeRotateFlag) {
<a name="l00176"></a>00176             Bitmap b = FreeImage.GetBitmap(fi);
<a name="l00177"></a>00177             <span class="keywordflow">if</span> (removeRotateFlag) <span class="keywordflow">try</span> { b.RemovePropertyItem(0x0112); } <span class="keywordflow">catch</span> { }
<a name="l00178"></a>00178             <span class="keywordflow">return</span> b;
<a name="l00179"></a>00179         }
<a name="l00180"></a>00180 
<a name="l00181"></a>00181         <span class="keyword">public</span> IEnumerable&lt;IIssue&gt; GetIssues() {
<a name="l00182"></a>00182             List&lt;IIssue&gt; issues = <span class="keyword">new</span> List&lt;IIssue&gt;();
<a name="l00183"></a>00183             <span class="keywordflow">if</span> (!FreeImageAPI.FreeImage.IsAvailable()) issues.Add(<span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_configuration_1_1_issues_1_1_issue.html">Issue</a>(<span class="stringliteral">&quot;The FreeImage library is not available! All FreeImage plugins will be disabled.&quot;</span>, <a class="code" href="namespace_image_resizer_1_1_configuration_1_1_issues.html#ada2af2a44c17c99a124cadb8a92f8555">IssueSeverity</a>.Error));
<a name="l00184"></a>00184             <span class="keywordflow">return</span> issues;
<a name="l00185"></a>00185         }
<a name="l00186"></a>00186 
<a name="l00187"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_free_image_decoder_1_1_free_image_decoder_plugin.html#a60005f876668b67f15b5df8d77fefd00">00187</a>         <span class="keyword">public</span> IEnumerable&lt;string&gt; <a class="code" href="class_image_resizer_1_1_plugins_1_1_free_image_decoder_1_1_free_image_decoder_plugin.html#a60005f876668b67f15b5df8d77fefd00" title="If the plugin reads any values from the querystring, the names of the keys should be specified here...">GetSupportedQuerystringKeys</a>() {
<a name="l00188"></a>00188             <span class="keywordflow">return</span> <span class="keyword">new</span> <span class="keywordtype">string</span>[] { <span class="stringliteral">&quot;usepreview&quot;</span>, <span class="stringliteral">&quot;autorotate&quot;</span>, <span class="stringliteral">&quot;page&quot;</span>, <span class="stringliteral">&quot;frame&quot;</span> };
<a name="l00189"></a>00189         }
<a name="l00190"></a>00190     }
<a name="l00191"></a>00191 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
