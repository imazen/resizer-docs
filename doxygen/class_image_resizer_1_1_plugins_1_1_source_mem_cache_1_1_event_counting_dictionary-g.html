<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ImageResizer: ImageResizer.Plugins.SourceMemCache.EventCountingDictionary&lt; T &gt; Class Template Reference</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="resizer-icon-64.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.2.1</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="namespace_image_resizer.html">ImageResizer</a>      </li>
      <li class="navelem"><a class="el" href="namespace_image_resizer_1_1_plugins.html">Plugins</a>      </li>
      <li class="navelem"><a class="el" href="namespace_image_resizer_1_1_plugins_1_1_source_mem_cache.html">SourceMemCache</a>      </li>
      <li class="navelem"><a class="el" href="class_image_resizer_1_1_plugins_1_1_source_mem_cache_1_1_event_counting_dictionary-g.html">EventCountingDictionary</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#properties">Properties</a> &#124;
<a href="#events">Events</a>  </div>
  <div class="headertitle">
<div class="title">ImageResizer.Plugins.SourceMemCache.EventCountingDictionary&lt; T &gt; Class Template Reference</div>  </div>
</div><!--header-->
<div class="contents">
<!-- doxytag: class="ImageResizer::Plugins::SourceMemCache::EventCountingDictionary-g" -->
<p>Maintains a dictionary of keys to counters. Counters track how many events have occured during the last X minutes/seconds/ticks for the given item. Can enforce size limits and cleanup empty counters on an inverval.  
 <a href="class_image_resizer_1_1_plugins_1_1_source_mem_cache_1_1_event_counting_dictionary-g.html#details">More...</a></p>

<p><a href="class_image_resizer_1_1_plugins_1_1_source_mem_cache_1_1_event_counting_dictionary-g-members.html">List of all members.</a></p>
<table class="memberdecls">
<tr><td colspan="2"><h2><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3f90ba4213594068eabf72403cb55226"></a><!-- doxytag: member="ImageResizer::Plugins::SourceMemCache::EventCountingDictionary&#45;g::EventKeyRemoved" ref="a3f90ba4213594068eabf72403cb55226" args="(EventCountingDictionary&lt; T &gt; sender, T key, int value)" -->
delegate void&#160;</td><td class="memItemRight" valign="bottom"><b>EventKeyRemoved</b> (EventCountingDictionary&lt; T &gt; sender, T key, int value)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a1ebd679cc2b96fdaa0257e36886b59d0"></a><!-- doxytag: member="ImageResizer::Plugins::SourceMemCache::EventCountingDictionary&#45;g::EventCountingDictionary" ref="a1ebd679cc2b96fdaa0257e36886b59d0" args="(IEqualityComparer&lt; T &gt; keyComparer, TimeSpan trackingDuration, EventCountingStrategy strategy)" -->
&#160;</td><td class="memItemRight" valign="bottom"><b>EventCountingDictionary</b> (IEqualityComparer&lt; T &gt; keyComparer, TimeSpan trackingDuration, <a class="el" href="class_image_resizer_1_1_plugins_1_1_source_mem_cache_1_1_event_counting_strategy.html">EventCountingStrategy</a> strategy)</td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_source_mem_cache_1_1_event_counting_dictionary-g.html#a6927997d5cb78498c3ca9f19633e0740">PingCleanup</a> ()</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Starts cleanup on a thread pool thread if it hasn't been started within the desired interval. If cleanup starts and other cleanup is running, it cancels. The assumption is that one cleanup of either type is enough within the interval.  <a href="#a6927997d5cb78498c3ca9f19633e0740"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_source_mem_cache_1_1_event_counting_dictionary-g.html#acf4be3acc59acc722b959f04a2600087">Increment</a> (T key, long customSize)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Increment the counter for the given item. Pings cleanup as well.  <a href="#acf4be3acc59acc722b959f04a2600087"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_source_mem_cache_1_1_event_counting_dictionary-g.html#a5f8603c3382d771176bf8dc6f56e0feb">GetValue</a> (T key)</td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">Calculate the counter value for the given item.  <a href="#a5f8603c3382d771176bf8dc6f56e0feb"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="properties"></a>
Properties</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">TimeSpan&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_source_mem_cache_1_1_event_counting_dictionary-g.html#a69bedacb7de8e4eeba6688374893b12e">TrackingDuration</a><code> [get]</code></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The duration for which to track events. For example, 5 minutes will keep a rolling value of how many events have occured in the last 5 minutes.  <a href="#a69bedacb7de8e4eeba6688374893b12e"></a><br/></td></tr>
<tr><td class="memItemLeft" align="right" valign="top">long&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_source_mem_cache_1_1_event_counting_dictionary-g.html#adb1767afe0bc4c72d96dacc2939ee3c4">ReportedBytesUsed</a><code> [get]</code></td></tr>
<tr><td class="mdescLeft">&#160;</td><td class="mdescRight">The estimated number of bytes used for tracking, plus the sum of the CustomSize values. Key space not included unless the caller always includes key size in CustomSize parameter.  <a href="#adb1767afe0bc4c72d96dacc2939ee3c4"></a><br/></td></tr>
<tr><td colspan="2"><h2><a name="events"></a>
Events</h2></td></tr>
<tr><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a4db8d453ff550105ea9f080cd48ff7f1"></a><!-- doxytag: member="ImageResizer::Plugins::SourceMemCache::EventCountingDictionary&#45;g::CounterRemoved" ref="a4db8d453ff550105ea9f080cd48ff7f1" args="" -->
EventKeyRemoved&#160;</td><td class="memItemRight" valign="bottom"><b>CounterRemoved</b></td></tr>
</table>
<hr/><a name="details" id="details"></a><h2>Detailed Description</h2>
<div class="textblock"><h3>template&lt;T&gt;<br/>
class ImageResizer::Plugins::SourceMemCache::EventCountingDictionary&lt; T &gt;</h3>

<p>Maintains a dictionary of keys to counters. Counters track how many events have occured during the last X minutes/seconds/ticks for the given item. Can enforce size limits and cleanup empty counters on an inverval. </p>
<dl class=""><dt><b>Template Parameters:</b></dt><dd>
  <table class="">
    <tr><td class="paramname">T</td><td></td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_event_counting_dictionary_8cs_source.html#l00056">56</a> of file <a class="el" href="_event_counting_dictionary_8cs_source.html">EventCountingDictionary.cs</a>.</p>
</div><hr/><h2>Member Function Documentation</h2>
<a class="anchor" id="a5f8603c3382d771176bf8dc6f56e0feb"></a><!-- doxytag: member="ImageResizer::Plugins::SourceMemCache::EventCountingDictionary&#45;g::GetValue" ref="a5f8603c3382d771176bf8dc6f56e0feb" args="(T key)" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">int <a class="el" href="class_image_resizer_1_1_plugins_1_1_source_mem_cache_1_1_event_counting_dictionary-g.html">ImageResizer.Plugins.SourceMemCache.EventCountingDictionary</a>&lt; T &gt;.<a class="el" href="class_image_resizer_1_1_plugins_1_1_source_mem_cache_1_1_event_counting_dictionary-g.html#a5f8603c3382d771176bf8dc6f56e0feb">GetValue</a> </td>
          <td>(</td>
          <td class="paramtype">T&#160;</td>
          <td class="paramname"><em>key</em></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Calculate the counter value for the given item. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">key</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="return"><dt><b>Returns:</b></dt><dd></dd></dl>

<p>Definition at line <a class="el" href="_event_counting_dictionary_8cs_source.html#l00260">260</a> of file <a class="el" href="_event_counting_dictionary_8cs_source.html">EventCountingDictionary.cs</a>.</p>
<div class="fragment"><pre class="fragment">                                   {
            EventCounter c;
            lock (syncLock) {
                keysToCounters.TryGetValue(key, out c);
            }
            <span class="keywordflow">if</span> (c == null) <span class="keywordflow">return</span> 0;
            <span class="keywordflow">return</span> c.GetValue();
        }
</pre></div>
</div>
</div>
<a class="anchor" id="acf4be3acc59acc722b959f04a2600087"></a><!-- doxytag: member="ImageResizer::Plugins::SourceMemCache::EventCountingDictionary&#45;g::Increment" ref="acf4be3acc59acc722b959f04a2600087" args="(T key, long customSize)" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_image_resizer_1_1_plugins_1_1_source_mem_cache_1_1_event_counting_dictionary-g.html">ImageResizer.Plugins.SourceMemCache.EventCountingDictionary</a>&lt; T &gt;.<a class="el" href="class_image_resizer_1_1_plugins_1_1_source_mem_cache_1_1_event_counting_dictionary-g.html#acf4be3acc59acc722b959f04a2600087">Increment</a> </td>
          <td>(</td>
          <td class="paramtype">T&#160;</td>
          <td class="paramname"><em>key</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">long&#160;</td>
          <td class="paramname"><em>customSize</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Increment the counter for the given item. Pings cleanup as well. </p>
<dl class="params"><dt><b>Parameters:</b></dt><dd>
  <table class="params">
    <tr><td class="paramname">key</td><td></td></tr>
    <tr><td class="paramname">customSize</td><td>Sets the custom size offset for the specified key (used for cleanup purposes). If -1, existing value will remain unchanged. </td></tr>
  </table>
  </dd>
</dl>

<p>Definition at line <a class="el" href="_event_counting_dictionary_8cs_source.html#l00247">247</a> of file <a class="el" href="_event_counting_dictionary_8cs_source.html">EventCountingDictionary.cs</a>.</p>
<div class="fragment"><pre class="fragment">                                                      {
            EventCounter c = GetOrAdd(key, customSize);
            <span class="keywordflow">if</span> (precision == EventCountingStrategy.ThreadingPrecision.Fast)
                c.Increment();
            <span class="keywordflow">else</span>
                c.IncrementExact();
            <a class="code" href="class_image_resizer_1_1_plugins_1_1_source_mem_cache_1_1_event_counting_dictionary-g.html#a6927997d5cb78498c3ca9f19633e0740" title="Starts cleanup on a thread pool thread if it hasn&#39;t been started within the desired interval...">PingCleanup</a>();
        }
</pre></div>
</div>
</div>
<a class="anchor" id="a6927997d5cb78498c3ca9f19633e0740"></a><!-- doxytag: member="ImageResizer::Plugins::SourceMemCache::EventCountingDictionary&#45;g::PingCleanup" ref="a6927997d5cb78498c3ca9f19633e0740" args="()" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">void <a class="el" href="class_image_resizer_1_1_plugins_1_1_source_mem_cache_1_1_event_counting_dictionary-g.html">ImageResizer.Plugins.SourceMemCache.EventCountingDictionary</a>&lt; T &gt;.<a class="el" href="class_image_resizer_1_1_plugins_1_1_source_mem_cache_1_1_event_counting_dictionary-g.html#a6927997d5cb78498c3ca9f19633e0740">PingCleanup</a> </td>
          <td>(</td>
          <td class="paramname"></td><td>)</td>
          <td><code> [inline]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>Starts cleanup on a thread pool thread if it hasn't been started within the desired interval. If cleanup starts and other cleanup is running, it cancels. The assumption is that one cleanup of either type is enough within the interval. </p>

<p>Definition at line <a class="el" href="_event_counting_dictionary_8cs_source.html#l00127">127</a> of file <a class="el" href="_event_counting_dictionary_8cs_source.html">EventCountingDictionary.cs</a>.</p>
<div class="fragment"><pre class="fragment">                                  {
            lock (timerLock) {
                <span class="keywordflow">if</span> (DateTime.Now.Ticks - lastStarted &gt; cleanupInterval) {
                    
                    <span class="keywordflow">if</span> (System.Threading.ThreadPool.QueueUserWorkItem(delegate(<span class="keywordtype">object</span> o){
                        Cleanup(CleanupMode.Maintenance);
                    })) lastStarted = DateTime.Now.Ticks;
                }
            }
        }
</pre></div>
</div>
</div>
<hr/><h2>Property Documentation</h2>
<a class="anchor" id="adb1767afe0bc4c72d96dacc2939ee3c4"></a><!-- doxytag: member="ImageResizer::Plugins::SourceMemCache::EventCountingDictionary&#45;g::ReportedBytesUsed" ref="adb1767afe0bc4c72d96dacc2939ee3c4" args="" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">long <a class="el" href="class_image_resizer_1_1_plugins_1_1_source_mem_cache_1_1_event_counting_dictionary-g.html">ImageResizer.Plugins.SourceMemCache.EventCountingDictionary</a>&lt; T &gt;.<a class="el" href="class_image_resizer_1_1_plugins_1_1_source_mem_cache_1_1_event_counting_dictionary-g.html#adb1767afe0bc4c72d96dacc2939ee3c4">ReportedBytesUsed</a><code> [get]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The estimated number of bytes used for tracking, plus the sum of the CustomSize values. Key space not included unless the caller always includes key size in CustomSize parameter. </p>

<p>Definition at line <a class="el" href="_event_counting_dictionary_8cs_source.html#l00095">95</a> of file <a class="el" href="_event_counting_dictionary_8cs_source.html">EventCountingDictionary.cs</a>.</p>

</div>
</div>
<a class="anchor" id="a69bedacb7de8e4eeba6688374893b12e"></a><!-- doxytag: member="ImageResizer::Plugins::SourceMemCache::EventCountingDictionary&#45;g::TrackingDuration" ref="a69bedacb7de8e4eeba6688374893b12e" args="" -->
<div class="memitem">
<div class="memproto">
<div class="memtemplate">
template&lt;T &gt; </div>
      <table class="memname">
        <tr>
          <td class="memname">TimeSpan <a class="el" href="class_image_resizer_1_1_plugins_1_1_source_mem_cache_1_1_event_counting_dictionary-g.html">ImageResizer.Plugins.SourceMemCache.EventCountingDictionary</a>&lt; T &gt;.<a class="el" href="class_image_resizer_1_1_plugins_1_1_source_mem_cache_1_1_event_counting_dictionary-g.html#a69bedacb7de8e4eeba6688374893b12e">TrackingDuration</a><code> [get]</code></td>
        </tr>
      </table>
</div>
<div class="memdoc">

<p>The duration for which to track events. For example, 5 minutes will keep a rolling value of how many events have occured in the last 5 minutes. </p>

<p>Definition at line <a class="el" href="_event_counting_dictionary_8cs_source.html#l00081">81</a> of file <a class="el" href="_event_counting_dictionary_8cs_source.html">EventCountingDictionary.cs</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>C:/Users/Administrator/Documents/resizer/Plugins/DiskCache/SourceMemCache/<a class="el" href="_event_counting_dictionary_8cs_source.html">EventCountingDictionary.cs</a></li>
</ul>
</div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
