<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ImageResizer: C:/Users/Administrator/Documents/resizer/Plugins/Watermark/ImageLayer.cs Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="imageresizer-logo-00aec4.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.3.3</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">C:/Users/Administrator/Documents/resizer/Plugins/Watermark/ImageLayer.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 ï»¿using System;
<a name="l00002"></a>00002 <span class="keyword">using</span> System.Collections.Generic;
<a name="l00003"></a>00003 <span class="keyword">using</span> System.Text;
<a name="l00004"></a>00004 <span class="keyword">using</span> System.Collections.Specialized;
<a name="l00005"></a>00005 <span class="keyword">using</span> System.Drawing;
<a name="l00006"></a>00006 <span class="keyword">using</span> ImageResizer.Util;
<a name="l00007"></a>00007 <span class="keyword">using</span> System.Web;
<a name="l00008"></a>00008 <span class="keyword">using</span> System.Web.Hosting;
<a name="l00009"></a>00009 <span class="keyword">using</span> System.Web.Caching;
<a name="l00010"></a>00010 <span class="keyword">using</span> ImageResizer.Configuration;
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 <span class="keyword">namespace </span>ImageResizer.Plugins.Watermark {
<a name="l00013"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_watermark_1_1_image_layer.html">00013</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_image_resizer_1_1_plugins_1_1_watermark_1_1_image_layer.html">ImageLayer</a>:<a class="code" href="class_image_resizer_1_1_plugins_1_1_watermark_1_1_layer.html">Layer</a> {
<a name="l00014"></a>00014         <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_watermark_1_1_image_layer.html">ImageLayer</a>(NameValueCollection attrs, <a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html">Config</a> c)
<a name="l00015"></a>00015             : base(attrs) {
<a name="l00016"></a>00016                 Path = attrs[<span class="stringliteral">&quot;path&quot;</span>];
<a name="l00017"></a>00017                 this.c = c;
<a name="l00018"></a>00018                 <span class="keywordflow">if</span> (!<span class="keywordtype">string</span>.IsNullOrEmpty(attrs[<span class="stringliteral">&quot;imageQuery&quot;</span>])) ImageQuery = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a>(attrs[<span class="stringliteral">&quot;imageQuery&quot;</span>]);
<a name="l00019"></a>00019         }
<a name="l00020"></a>00020 
<a name="l00021"></a>00021         <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_watermark_1_1_image_layer.html">ImageLayer</a>(<a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html">Config</a> c) {
<a name="l00022"></a>00022             this.c = c;
<a name="l00023"></a>00023         }
<a name="l00024"></a>00024         <span class="keyword">protected</span> <span class="keywordtype">string</span> _path = null;<span class="comment"></span>
<a name="l00025"></a>00025 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00026"></a>00026 <span class="comment">        /// The virtual path to the watermark image</span>
<a name="l00027"></a>00027 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00028"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_watermark_1_1_image_layer.html#a1ce9cebaa9b4b42c1344e7cfd10eae80">00028</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">string</span> Path {
<a name="l00029"></a>00029             <span class="keyword">get</span> { <span class="keywordflow">return</span> _path; }
<a name="l00030"></a>00030             <span class="keyword">set</span> { _path = value; }
<a name="l00031"></a>00031         }
<a name="l00032"></a>00032 
<a name="l00033"></a>00033         <span class="keyword">protected</span> <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> _imageQuery = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a>();
<a name="l00034"></a>00034         <span class="keyword">protected</span> <a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html">Config</a> c = null;
<a name="l00035"></a>00035 
<a name="l00036"></a>00036         <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html">Config</a> ConfigInstance { <span class="keyword">get</span> { <span class="keywordflow">return</span> c; } <span class="keyword">set</span> { c = value; } }<span class="comment"></span>
<a name="l00037"></a>00037 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00038"></a>00038 <span class="comment">        /// Settings to apply to the watermark before overlaying it on the image. </span>
<a name="l00039"></a>00039 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00040"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_watermark_1_1_image_layer.html#a31cc5a289521587dbb6f128fc5d9c096">00040</a> <span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> ImageQuery {
<a name="l00041"></a>00041             <span class="keyword">get</span> { <span class="keywordflow">return</span> _imageQuery; }
<a name="l00042"></a>00042             <span class="keyword">set</span> { _imageQuery = value; }
<a name="l00043"></a>00043         }
<a name="l00044"></a>00044 
<a name="l00045"></a>00045         <span class="keyword">public</span> <span class="keywordtype">void</span> CopyTo(<a class="code" href="class_image_resizer_1_1_plugins_1_1_watermark_1_1_image_layer.html">ImageLayer</a> other) {
<a name="l00046"></a>00046             base.CopyTo(other);
<a name="l00047"></a>00047             other.<a class="code" href="class_image_resizer_1_1_plugins_1_1_watermark_1_1_image_layer.html#a1ce9cebaa9b4b42c1344e7cfd10eae80" title="The virtual path to the watermark image.">Path</a> = Path;
<a name="l00048"></a>00048             other.<a class="code" href="class_image_resizer_1_1_plugins_1_1_watermark_1_1_image_layer.html#a31cc5a289521587dbb6f128fc5d9c096" title="Settings to apply to the watermark before overlaying it on the image.">ImageQuery</a> = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a>(ImageQuery);
<a name="l00049"></a>00049         }
<a name="l00050"></a>00050 
<a name="l00051"></a>00051         <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">object</span>[] GetHashBasis()
<a name="l00052"></a>00052         {
<a name="l00053"></a>00053             var b = <span class="keyword">new</span> <span class="keywordtype">object</span>[]{Path,ImageQuery};
<a name="l00054"></a>00054             var o = base.GetHashBasis();
<a name="l00055"></a>00055             <span class="keywordtype">object</span>[] combined = <span class="keyword">new</span> <span class="keywordtype">object</span>[b.Length + o.Length];
<a name="l00056"></a>00056             Array.Copy(b,combined,b.Length);
<a name="l00057"></a>00057             Array.Copy(o,0,combined,b.Length,o.Length);
<a name="l00058"></a>00058             <span class="keywordflow">return</span> combined;
<a name="l00059"></a>00059         }
<a name="l00060"></a>00060 
<a name="l00061"></a>00061         <span class="keyword">public</span> ImageLayer Copy() {
<a name="l00062"></a>00062             ImageLayer l = <span class="keyword">new</span> ImageLayer(this.c);
<a name="l00063"></a>00063             this.CopyTo(l);
<a name="l00064"></a>00064             <span class="keywordflow">return</span> l;
<a name="l00065"></a>00065         }<span class="comment"></span>
<a name="l00066"></a>00066 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00067"></a>00067 <span class="comment">        /// Loads a bitmap, cached using asp.net&#39;s cache</span>
<a name="l00068"></a>00068 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00069"></a>00069 <span class="comment">        /// &lt;param name=&quot;query&quot;&gt;&lt;/param&gt;</span>
<a name="l00070"></a>00070 <span class="comment">        /// &lt;param name=&quot;virtualPath&quot;&gt;&lt;/param&gt;</span>
<a name="l00071"></a>00071 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00072"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_watermark_1_1_image_layer.html#afb7aa1d3ac0266ae0781d9c27e9ec5e3">00072</a> <span class="comment"></span>        <span class="keyword">public</span> Bitmap <a class="code" href="class_image_resizer_1_1_plugins_1_1_watermark_1_1_image_layer.html#afb7aa1d3ac0266ae0781d9c27e9ec5e3" title="Loads a bitmap, cached using asp.net&#39;s cache.">GetMemCachedBitmap</a>(<span class="keywordtype">string</span> virtualPath, <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> query) {
<a name="l00073"></a>00073             <span class="comment">//If not ASP.NET, don&#39;t cache.</span>
<a name="l00074"></a>00074             <span class="keywordflow">if</span> (HttpContext.Current == null) <span class="keywordflow">return</span> c.<a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html#a9b11da5f1856427a835034d52700c093" title="Returns a shared instance of ImageManager, (or a subclass if it has been upgraded). Instances change whenever ImageBuilderExtensions change.">CurrentImageBuilder</a>.<a class="code" href="class_image_resizer_1_1_image_builder.html#a185dcaa809670c427788a45539f2f1f3" title="Loads a Bitmap from the specified source. If a filename is available, it will be attached to bitmap...">LoadImage</a>(virtualPath, query);
<a name="l00075"></a>00075 
<a name="l00076"></a>00076             <span class="keywordtype">string</span> key = virtualPath.ToLowerInvariant() + query.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae919f5cb01b299c62910acee4476dfcf" title="Returns a string containing all the settings in the class, in querystring form. Use ToStringEncoded()...">ToString</a>();
<a name="l00077"></a>00077             Bitmap b = HttpContext.Current.Cache[key] as Bitmap;
<a name="l00078"></a>00078             <span class="keywordflow">if</span> (b != null) <span class="keywordflow">return</span> b;
<a name="l00079"></a>00079 
<a name="l00080"></a>00080             b = c.<a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html#a9b11da5f1856427a835034d52700c093" title="Returns a shared instance of ImageManager, (or a subclass if it has been upgraded). Instances change whenever ImageBuilderExtensions change.">CurrentImageBuilder</a>.<a class="code" href="class_image_resizer_1_1_image_builder.html#a185dcaa809670c427788a45539f2f1f3" title="Loads a Bitmap from the specified source. If a filename is available, it will be attached to bitmap...">LoadImage</a>(virtualPath, query);
<a name="l00081"></a>00081             <span class="comment">//Query VPPs for cache dependency. TODO: Add support for IVirtualImageProviders to customize cache dependencies.</span>
<a name="l00082"></a>00082             CacheDependency cd = null;
<a name="l00083"></a>00083             <span class="keywordflow">if</span> (HostingEnvironment.VirtualPathProvider != null) cd = HostingEnvironment.VirtualPathProvider.GetCacheDependency(virtualPath, <span class="keyword">new</span> <span class="keywordtype">string</span>[] { }, DateTime.UtcNow);
<a name="l00084"></a>00084 
<a name="l00085"></a>00085             HttpContext.Current.Cache.Insert(key, b, cd);
<a name="l00086"></a>00086             <span class="keywordflow">return</span> b;
<a name="l00087"></a>00087         }
<a name="l00088"></a>00088 
<a name="l00089"></a>00089         <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">void</span> RenderTo(Resizing.ImageState s) {
<a name="l00090"></a>00090             <span class="keywordflow">if</span> (<span class="keywordtype">string</span>.IsNullOrEmpty(Path)) <span class="keywordflow">return</span>;
<a name="l00091"></a>00091 
<a name="l00092"></a>00092             s.destGraphics.CompositingMode = System.Drawing.Drawing2D.CompositingMode.SourceOver;
<a name="l00093"></a>00093             s.destGraphics.CompositingQuality = System.Drawing.Drawing2D.CompositingQuality.HighQuality;
<a name="l00094"></a>00094             s.destGraphics.InterpolationMode = System.Drawing.Drawing2D.InterpolationMode.HighQualityBicubic;
<a name="l00095"></a>00095 
<a name="l00096"></a>00096             <span class="comment">//If the image is a virtual gradient, allow delayed loading so the estimated width/height values can be used to create it the proper size. </span>
<a name="l00097"></a>00097             <span class="comment">//Otherwise, load immediately.</span>
<a name="l00098"></a>00098             Bitmap img = null;
<a name="l00099"></a>00099             <span class="keywordflow">if</span> (c.<a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html#ab7d8e32249817ef77f91508c087140d9" title="Access and modify settings related to the HttpModule pipline. Register URL rewriting hooks...">Pipeline</a>.<a class="code" href="class_image_resizer_1_1_configuration_1_1_pipeline_config.html#a23d81b98db36e450511ba6481ce02459" title="Returns either an IVirtualFile instance or a VirtualFile instance.">GetFile</a>(Path,ImageQuery) == null || !(c.<a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html#ab7d8e32249817ef77f91508c087140d9" title="Access and modify settings related to the HttpModule pipline. Register URL rewriting hooks...">Pipeline</a>.<a class="code" href="class_image_resizer_1_1_configuration_1_1_pipeline_config.html#a23d81b98db36e450511ba6481ce02459" title="Returns either an IVirtualFile instance or a VirtualFile instance.">GetFile</a>(Path,ImageQuery) is ImageResizer.Plugins.Basic.Gradient.GradientVirtualFile))
<a name="l00100"></a>00100                 img = GetMemCachedBitmap(Path, ImageQuery);
<a name="l00101"></a>00101            
<a name="l00102"></a>00102             <span class="comment">//Calculate the location for the bitmap</span>
<a name="l00103"></a>00103             RectangleF imgBounds = this.CalculateLayerCoordinates(s, delegate(<span class="keywordtype">double</span> maxwidth, <span class="keywordtype">double</span> maxheight) {
<a name="l00104"></a>00104                 <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> opts = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a>(ImageQuery);
<a name="l00105"></a>00105                 <span class="keywordflow">if</span> (Fill &amp;&amp; <span class="keywordtype">string</span>.IsNullOrEmpty(opts[<span class="stringliteral">&quot;scale&quot;</span>])) opts.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae7fc16e795fb8ebf6423f3df628dc404" title="[&quot;scale&quot;] Whether to downscale, upscale, upscale the canvas, or both upscale or downscale the image a...">Scale</a> = <a class="code" href="namespace_image_resizer.html#aca52f6f1e90c78a5e5e79c6d709a571c" title="Controls whether the image is allowed to upscale, downscale, both, or if only the canvas gets to be u...">ScaleMode</a>.Both;
<a name="l00106"></a>00106                 <span class="keywordflow">if</span> (!<span class="keywordtype">double</span>.IsNaN(maxwidth)) opts.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a80fd5f97f3264009aa2c2648bb1379d7" title="[&quot;maxwidth&quot;]: Sets the maximum desired width of the image. (minus padding, borders, margins, effects, and rotation). The image may be smaller than this value to maintain aspect ratio when both maxwidth and maxheight are specified.">MaxWidth</a> = (int)Math.Floor(maxwidth);
<a name="l00107"></a>00107                 <span class="keywordflow">if</span> (!<span class="keywordtype">double</span>.IsNaN(maxheight)) opts.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a16d3547dfb87d598876fb64e54c0a938" title="[&quot;maxheight&quot;]: Sets the maximum desired height of the image. (minus padding, borders, margins, effects, and rotation). The image may be smaller than this value to maintain aspect ratio when both maxwidth and maxheight are specified.">MaxHeight</a> = (int)Math.Floor(maxheight);
<a name="l00108"></a>00108 
<a name="l00109"></a>00109                 <span class="keywordflow">if</span> (img == null) img = GetMemCachedBitmap(Path, opts); <span class="comment">//Delayed creation allows the maxwidth/maxheight to be used in gradient plugin</span>
<a name="l00110"></a>00110                 lock (img) {
<a name="l00111"></a>00111                     <span class="keywordflow">return</span> <a class="code" href="class_image_resizer_1_1_image_builder.html" title="Provides methods for generating resized images, and for reading and writing them to disk...">ImageBuilder</a>.<a class="code" href="class_image_resizer_1_1_image_builder.html#afcfb7f40a65d121670118ccebfe1ca4b" title="Returns a shared instance of ImageBuilder or a subclass, equivalent to Config.Current.CurrentImageBuilder.">Current</a>.<a class="code" href="class_image_resizer_1_1_image_builder.html#ac0ad7c5f8e03ca9a50e6538677c3475d" title="Gets the final size of an image.">GetFinalSize</a>(img.Size, opts);
<a name="l00112"></a>00112                 }
<a name="l00113"></a>00113             }, <span class="keyword">true</span>);
<a name="l00114"></a>00114 
<a name="l00115"></a>00115             lock (img) { <span class="comment">//Only one reader from the cached bitmap at a time.</span>
<a name="l00116"></a>00116                 <span class="comment">//Skip rendering unless we have room to work with.</span>
<a name="l00117"></a>00117                 <span class="keywordflow">if</span> (imgBounds.Width &lt;2 || imgBounds.Height &lt; 2) <span class="keywordflow">return</span>;
<a name="l00118"></a>00118 
<a name="l00119"></a>00119 
<a name="l00120"></a>00120                 <span class="keywordflow">if</span> (ImageQuery.Keys.Count &gt; 0 || Fill) {
<a name="l00121"></a>00121                     <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a>(ImageQuery);
<a name="l00122"></a>00122                     <span class="keywordflow">if</span> (Fill &amp;&amp; <span class="keywordtype">string</span>.IsNullOrEmpty(settings[<span class="stringliteral">&quot;scale&quot;</span>])) settings.<a class="code" href="class_image_resizer_1_1_resize_settings.html#ae7fc16e795fb8ebf6423f3df628dc404" title="[&quot;scale&quot;] Whether to downscale, upscale, upscale the canvas, or both upscale or downscale the image a...">Scale</a> = <a class="code" href="namespace_image_resizer.html#aca52f6f1e90c78a5e5e79c6d709a571c" title="Controls whether the image is allowed to upscale, downscale, both, or if only the canvas gets to be u...">ScaleMode</a>.Both;
<a name="l00123"></a>00123 
<a name="l00124"></a>00124                     settings.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a80fd5f97f3264009aa2c2648bb1379d7" title="[&quot;maxwidth&quot;]: Sets the maximum desired width of the image. (minus padding, borders, margins, effects, and rotation). The image may be smaller than this value to maintain aspect ratio when both maxwidth and maxheight are specified.">MaxWidth</a> = (int)Math.Floor(imgBounds.Width);
<a name="l00125"></a>00125                     settings.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a16d3547dfb87d598876fb64e54c0a938" title="[&quot;maxheight&quot;]: Sets the maximum desired height of the image. (minus padding, borders, margins, effects, and rotation). The image may be smaller than this value to maintain aspect ratio when both maxwidth and maxheight are specified.">MaxHeight</a> = (int)Math.Floor(imgBounds.Height);
<a name="l00126"></a>00126 
<a name="l00127"></a>00127                     <span class="keyword">using</span> (Bitmap <span class="keyword">final</span> = <a class="code" href="class_image_resizer_1_1_image_builder.html" title="Provides methods for generating resized images, and for reading and writing them to disk...">ImageBuilder</a>.<a class="code" href="class_image_resizer_1_1_image_builder.html#afcfb7f40a65d121670118ccebfe1ca4b" title="Returns a shared instance of ImageBuilder or a subclass, equivalent to Config.Current.CurrentImageBuilder.">Current</a>.<a class="code" href="class_image_resizer_1_1_image_builder.html#a12f49b48e9244ee7f6e86fd60fffcc83" title="Resizes and processes the specified source image and returns a bitmap of the result. Note! This method assumes that transparency will be supported in the final output format, and therefore does not apply a matte color. Use &amp;bgcolor to specify a background color if you use this method with a non-transparent format such as Jpeg. If passed a source Stream, Bitmap, or Image instance, it will be disposed after use. Use disposeSource=False to disable that behavior.">Build</a>(img, settings,<span class="keyword">false</span>)) {
<a name="l00128"></a>00128                         s.destGraphics.DrawImage(<span class="keyword">final</span>, <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html" title="Defines a collection of utility functions for manipulating polygons. These functions may be (re)moved...">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a61b50db80ba6c732565d07ef6163c0a0" title="Rounds a floating-point rectangle to an integer rectangle using System.Round.">ToRectangle</a>(<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html" title="Defines a collection of utility functions for manipulating polygons. These functions may be (re)moved...">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#aeac5d0934fa58e4d0898c061697d567d" title="Moves &#39;inner&#39; so that the center of its bounding box equals the center of the bounding box of &#39;outer&#39;...">CenterInside</a>(<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html" title="Defines a collection of utility functions for manipulating polygons. These functions may be (re)moved...">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#aaccb0b4261dc176f5ad25b4bb09fd55f" title="Scales &#39;inner&#39; to fit inside &#39;bounding&#39; while maintaining aspect ratio. Only downscales.">DownScaleInside</a>(<span class="keyword">final</span>.Size,imgBounds.Size), imgBounds)));
<a name="l00129"></a>00129                     }
<a name="l00130"></a>00130                 } <span class="keywordflow">else</span> {
<a name="l00131"></a>00131 
<a name="l00132"></a>00132                     s.destGraphics.DrawImage(img, <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html" title="Defines a collection of utility functions for manipulating polygons. These functions may be (re)moved...">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a61b50db80ba6c732565d07ef6163c0a0" title="Rounds a floating-point rectangle to an integer rectangle using System.Round.">ToRectangle</a>(<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html" title="Defines a collection of utility functions for manipulating polygons. These functions may be (re)moved...">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#aeac5d0934fa58e4d0898c061697d567d" title="Moves &#39;inner&#39; so that the center of its bounding box equals the center of the bounding box of &#39;outer&#39;...">CenterInside</a>(<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html" title="Defines a collection of utility functions for manipulating polygons. These functions may be (re)moved...">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#aaccb0b4261dc176f5ad25b4bb09fd55f" title="Scales &#39;inner&#39; to fit inside &#39;bounding&#39; while maintaining aspect ratio. Only downscales.">DownScaleInside</a>(img.Size,imgBounds.Size), imgBounds)));
<a name="l00133"></a>00133                 }
<a name="l00134"></a>00134 
<a name="l00135"></a>00135             }
<a name="l00136"></a>00136         }
<a name="l00137"></a>00137     }
<a name="l00138"></a>00138 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
