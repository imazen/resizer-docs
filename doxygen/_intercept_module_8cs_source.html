<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>ImageResizer: C:/Users/nathanael/Documents/resizer/Core/InterceptModule.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="imageresizer-logo-00aec4.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.4.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_c6310732a22f63c0c2fc5595561e68f1.html">Core</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">InterceptModule.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* Copyright (c) 2011 Nathanael Jones. See license.txt for your rights */</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">using</span> System;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">using</span> ImageResizer.Configuration;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using</span> System.Web;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using</span> System.Collections.Specialized;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">using</span> System.Security.Principal;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">using</span> System.Web.Security;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using</span> System.Web.Hosting;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">using</span> System.Diagnostics;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">using</span> ImageResizer.Plugins;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">using</span> ImageResizer.Encoding;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">using</span> ImageResizer.Caching;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">using</span> ImageResizer.Util;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;<span class="keyword">using</span> System.Collections.Generic;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keyword">using</span> System.IO;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">using</span> ImageResizer.Resizing;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">using</span> ImageResizer.Plugins.Basic;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">using</span> ImageResizer.ExtensionMethods;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="comment">// This namespace contains the most frequently used classes.</span></div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keyword">namespace </span>ImageResizer {</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="comment">    /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="comment">    /// Monitors incoming image requests to determine if resizing (or other processing) is being requested.</span></div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="comment">    /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00026"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_intercept_module.html">   26</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_image_resizer_1_1_intercept_module.html">InterceptModule</a> : IHttpModule {</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment">        /// Called when the app is initialized</span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">        /// &lt;param name=&quot;context&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment"></span>        <span class="keywordtype">void</span> IHttpModule.Init(System.Web.HttpApplication context) {</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;            </div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;            <span class="comment">//We wait until after URL auth happens for security. (although we authorize again since we are doing URL rewriting)</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;            context.PostAuthorizeRequest -= <a class="code" href="class_image_resizer_1_1_intercept_module.html#ab7a18ae77265d4f17870541448c99fbf">CheckRequest_PostAuthorizeRequest</a>;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;            context.PostAuthorizeRequest += <a class="code" href="class_image_resizer_1_1_intercept_module.html#ab7a18ae77265d4f17870541448c99fbf">CheckRequest_PostAuthorizeRequest</a>;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;            <span class="comment">//This is where we set content-type and caching headers. content-type often don&#39;t match the</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;            <span class="comment">//file extension, so we have to override them</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;            context.PreSendRequestHeaders -= <a class="code" href="class_image_resizer_1_1_intercept_module.html#a9938e258c26e277886d13712010aaa34">context_PreSendRequestHeaders</a>;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;            context.PreSendRequestHeaders += <a class="code" href="class_image_resizer_1_1_intercept_module.html#a9938e258c26e277886d13712010aaa34">context_PreSendRequestHeaders</a>;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;            <span class="comment">//Say it&#39;s installed.</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;            conf.ModuleInstalled = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;        }</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;        <span class="keywordtype">void</span> IHttpModule.Dispose() { }<span class="comment"></span></div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;<span class="comment">        /// Current configuration. Same as Config.Current.Pipeline</span></div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_intercept_module.html#a58d5e9e6dfce4ac70f2c81abbb7414ce">   51</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <a class="code" href="interface_image_resizer_1_1_configuration_1_1_i_pipeline_config.html">IPipelineConfig</a> <a class="code" href="class_image_resizer_1_1_intercept_module.html#a58d5e9e6dfce4ac70f2c81abbb7414ce">conf</a> { <span class="keyword">get</span> { <span class="keywordflow">return</span> Config.Current.Pipeline; } }</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;<span class="comment">        /// This is where we filter requests and intercept those that want resizing performed.</span></div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;<span class="comment">        /// We first strip FakeExtension, then verify the remaining file extension is supported for decoding.</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;<span class="comment">        /// We fire URL rewriting events. If the result includes any supported querystring params afterwards, we process the request. Otherwise we let it fall back to IIS/ASP.NET.</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;<span class="comment">        /// If the file doesn&#39;t exist, we also ignore the request. They&#39;re going to cause a 404 anyway.</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;<span class="comment">        /// </span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;<span class="comment">        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">        /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_intercept_module.html#ab7a18ae77265d4f17870541448c99fbf">   62</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_image_resizer_1_1_intercept_module.html#ab7a18ae77265d4f17870541448c99fbf">CheckRequest_PostAuthorizeRequest</a>(<span class="keywordtype">object</span> sender, EventArgs e) {</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            <span class="comment">//Skip requests if the Request object isn&#39;t populated</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;            HttpApplication app = sender as HttpApplication;</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            <span class="keywordflow">if</span> (app == null) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            <span class="keywordflow">if</span> (app.Context == null) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            <span class="keywordflow">if</span> (app.Context.Request == null) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            conf.FirePostAuthorizeRequest(<span class="keyword">this</span>, app.Context);</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;            </div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            <span class="comment">//Allow handlers of the above event to change filePath/pathinfo so we can successfull test the extension</span></div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            <span class="keywordtype">string</span> originalPath = conf.PreRewritePath;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;           </div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            <span class="comment">//Trim fake extensions so IsAcceptedImageType will work properly</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;            <span class="keywordtype">string</span> filePath = conf.TrimFakeExtensions(originalPath);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;            <span class="comment">//Is this an image request? Checks the file extension for .jpg, .png, .tiff, etc.</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="class_image_resizer_1_1_intercept_module.html#a58d5e9e6dfce4ac70f2c81abbb7414ce">conf</a>.<a class="code" href="interface_image_resizer_1_1_configuration_1_1_i_pipeline_config.html#a77bea25b98cf43d427b9dbdb6417dd3b">SkipFileTypeCheck</a> || <a class="code" href="class_image_resizer_1_1_intercept_module.html#a58d5e9e6dfce4ac70f2c81abbb7414ce">conf</a>.<a class="code" href="interface_image_resizer_1_1_configuration_1_1_i_pipeline_config.html#ac7ef1f4af9d8eb435963582217d2ce15">IsAcceptedImageType</a>(filePath)) {</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                <span class="comment">//Copy the querystring so we can mod it to death without messing up other stuff.</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                NameValueCollection q = conf.ModifiedQueryString;</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                <span class="comment">//Call URL rewriting events</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                <a class="code" href="class_image_resizer_1_1_configuration_1_1_url_event_args.html">UrlEventArgs</a> ue = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_configuration_1_1_url_event_args.html">UrlEventArgs</a>(filePath, q);</div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                conf.FireRewritingEvents(<span class="keyword">this</span>, app.Context,ue);</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                <span class="comment">//Pull data back out of event object, resolving app-relative paths</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                <span class="keywordtype">string</span> virtualPath = PathUtils.ResolveAppRelativeAssumeAppRelative(ue.VirtualPath);</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                q = ue.QueryString;</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                <span class="comment">//Store the modified querystring in request for use by VirtualPathProviders</span></div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                conf.ModifiedQueryString = q; <span class="comment">// app.Context.Items[&quot;modifiedQueryString&quot;] = q;</span></div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                <span class="comment">//See if resizing is wanted (i.e. one of the querystring commands is present).</span></div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                <span class="comment">//Called after processPath so processPath can add them if needed.</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                <span class="comment">//Checks for thumnail, format, width, height, maxwidth, maxheight and a lot more</span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                <span class="keywordflow">if</span> (<a class="code" href="class_image_resizer_1_1_intercept_module.html#a58d5e9e6dfce4ac70f2c81abbb7414ce">conf</a>.<a class="code" href="interface_image_resizer_1_1_configuration_1_1_i_pipeline_config.html#aa596c84a40adc00dd0d6c7bd351476b5">HasPipelineDirective</a>(q)) {</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                    <span class="comment">//Who&#39;s the user</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                    IPrincipal user = app.Context.User as IPrincipal;</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                    <span class="comment">// no user (must be anonymous...).. Or authentication doesn&#39;t work for this suffix. Whatever, just avoid a nullref in the UrlAuthorizationModule</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                    <span class="keywordflow">if</span> (user == null)</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                        user = <span class="keyword">new</span> GenericPrincipal(<span class="keyword">new</span> GenericIdentity(<span class="keywordtype">string</span>.Empty, <span class="keywordtype">string</span>.Empty), <span class="keyword">new</span> <span class="keywordtype">string</span>[0]);</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                    <span class="comment">//Do we have permission to call UrlAuthorizationModule.CheckUrlAccessForPrincipal?</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;                    <span class="keywordtype">bool</span> canCheckUrl = System.Security.SecurityManager.IsGranted(<span class="keyword">new</span> System.Security.Permissions.SecurityPermission(System.Security.Permissions.PermissionState.Unrestricted));</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                    </div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                    </div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                    <span class="comment">//Run the rewritten path past the auth system again, using the result as the default &quot;AllowAccess&quot; value</span></div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                    <span class="keywordtype">bool</span> isAllowed = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                    <span class="keywordflow">if</span> (canCheckUrl &amp;&amp; !app.Context.SkipAuthorization) <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;                            isAllowed = UrlAuthorizationModule.CheckUrlAccessForPrincipal(virtualPath, user, <span class="stringliteral">&quot;GET&quot;</span>);</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                        } <span class="keywordflow">catch</span> (NotImplementedException) { } <span class="comment">//For MONO support</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                    </div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                    <a class="code" href="interface_image_resizer_1_1_configuration_1_1_i_url_authorization_event_args.html">IUrlAuthorizationEventArgs</a> authEvent = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_configuration_1_1_url_authorization_event_args.html">UrlAuthorizationEventArgs</a>(virtualPath, <span class="keyword">new</span> NameValueCollection(q), isAllowed);</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                    <span class="comment">//Allow user code to deny access, but not modify the url or querystring.</span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                    conf.FireAuthorizeImage(<span class="keyword">this</span>, app.Context, authEvent);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                    <span class="keywordflow">if</span> (!authEvent.AllowAccess) <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_processing_exception.html">ImageProcessingException</a>(403, <span class="stringliteral">&quot;Access denied&quot;</span>, <span class="stringliteral">&quot;Access denied&quot;</span>);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                    </div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                    </div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                    <span class="comment">//Does the file exist physically? (false if VppUsage=always or file is missing)</span></div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;                    <span class="keywordtype">bool</span> existsPhysically = (conf.VppUsage != VppUsageOption.Always) &amp;&amp; System.IO.File.Exists(HostingEnvironment.MapPath(virtualPath));</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;                    <span class="comment">//If not present physically (and VppUsage!=never), try to get the virtual file. Null indicates a missing file</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                    <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_file.html">IVirtualFile</a> vf = (conf.VppUsage != VppUsageOption.Never &amp;&amp; !existsPhysically) ? <a class="code" href="class_image_resizer_1_1_intercept_module.html#a58d5e9e6dfce4ac70f2c81abbb7414ce">conf</a>.<a class="code" href="interface_image_resizer_1_1_configuration_1_1_i_pipeline_config.html#a0c58a51a8bc68f0c131b67c700582a80">GetFile</a>(virtualPath, q) : null;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                    <span class="comment">//Only process files that exist</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                    <span class="keywordflow">if</span> (existsPhysically || vf != null) {</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                        <span class="keywordflow">try</span>{</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                            <a class="code" href="class_image_resizer_1_1_intercept_module.html#a55916ea27e905902663d2813fcfc9ebf">HandleRequest</a>(app.Context, virtualPath, q, vf);</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                            <span class="comment">//Catch not found exceptions</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                        } <span class="keywordflow">catch</span> (System.IO.FileNotFoundException notFound) { <span class="comment">//Some VPPs are optimisitic , or could be a race condition</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                            FileMissing(app.Context, virtualPath, q);</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                            <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_missing_exception.html">ImageMissingException</a>(<span class="stringliteral">&quot;The specified resource could not be located&quot;</span>, <span class="stringliteral">&quot;File not found&quot;</span>, notFound);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                        }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                    } <span class="keywordflow">else</span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                        FileMissing(app.Context, virtualPath, q);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                }</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            }</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        }</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        <span class="keyword">protected</span> <span class="keywordtype">void</span> FileMissing(HttpContext httpContext, <span class="keywordtype">string</span> virtualPath, NameValueCollection q) {</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            <span class="comment">//Fire the event (for default image redirection, etc) </span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            conf.FireImageMissing(<span class="keyword">this</span>, httpContext, <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_configuration_1_1_url_event_args.html">UrlEventArgs</a>( virtualPath, <span class="keyword">new</span> NameValueCollection(q)));</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;            <span class="comment">//Remove the image from context items so we don&#39;t try to write response headers.</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;            httpContext.Items[conf.ResponseArgsKey] = null;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;  </div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;<span class="comment">        /// Generates the resized image to disk (if needed), then rewrites the request to that location.</span></div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;<span class="comment">        /// Perform 404 checking before calling this method. Assumes file exists.</span></div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;<span class="comment">        /// Called during PostAuthorizeRequest</span></div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;<span class="comment">        /// &lt;param name=&quot;context&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;<span class="comment">        /// &lt;param name=&quot;virtualPath&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;<span class="comment">                /// &lt;param name=&quot;queryString&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;<span class="comment">                /// &lt;param name=&quot;vf&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00171"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_intercept_module.html#a55916ea27e905902663d2813fcfc9ebf">  171</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">virtual</span> <span class="keywordtype">void</span> <a class="code" href="class_image_resizer_1_1_intercept_module.html#a55916ea27e905902663d2813fcfc9ebf">HandleRequest</a>(HttpContext context, <span class="keywordtype">string</span> virtualPath, NameValueCollection queryString, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_file.html">IVirtualFile</a> vf) {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            Stopwatch s = <span class="keyword">new</span> Stopwatch();</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            s.Start();</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            </div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> settings = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a>(queryString);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            <span class="keywordtype">bool</span> isCaching = settings.Cache == ServerCacheMode.Always;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <span class="keywordtype">bool</span> isProcessing = settings.Process == ProcessWhen.Always;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            <span class="comment">//By default, we process it if is both (a) a recognized image extension, and (b) has a resizing directive (not just &#39;cache&#39;).</span></div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            <span class="keywordflow">if</span> (settings.Process == <a class="code" href="namespace_image_resizer.html#a089c1fb717c880fab9cb6c06a06cf35a">ProcessWhen</a>.Default){</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                <span class="comment">//Check for resize directive by removing (&#39;non-resizing&#39; items from the current querystring) </span></div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                NameValueCollection copy = <span class="keyword">new</span> NameValueCollection(queryString);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                copy.Remove(<span class="stringliteral">&quot;cache&quot;</span>); copy.Remove(<span class="stringliteral">&quot;process&quot;</span>); copy.Remove(<span class="stringliteral">&quot;useresizingpipeline&quot;</span>); copy.Remove(<span class="stringliteral">&quot;404&quot;</span>);</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                <span class="comment">//If the &#39;copy&#39; still has directives, and it&#39;s an image request, then let&#39;s process it.</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                isProcessing = conf.IsAcceptedImageType(virtualPath) &amp;&amp;  <a class="code" href="class_image_resizer_1_1_intercept_module.html#a58d5e9e6dfce4ac70f2c81abbb7414ce">conf</a>.<a class="code" href="interface_image_resizer_1_1_configuration_1_1_i_pipeline_config.html#aa596c84a40adc00dd0d6c7bd351476b5">HasPipelineDirective</a>(copy);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            }</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;</div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            <span class="comment">//By default, we only cache it if we&#39;re processing it. </span></div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <span class="keywordflow">if</span> (settings.Cache == <a class="code" href="namespace_image_resizer.html#a6b30c95c789b77db2c5aa905345d917c">ServerCacheMode</a>.Default &amp;&amp; isProcessing) </div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                isCaching = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;            <span class="comment">//Resolve the &#39;cache&#39; setting to &#39;no&#39; unless we want it cache.</span></div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;            <span class="keywordflow">if</span> (!isCaching) settings.Cache = ServerCacheMode.No;</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;            <span class="comment">//If we are neither processing nor caching, don&#39;t do anything more with the request</span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;            <span class="keywordflow">if</span> (!isProcessing &amp;&amp; !isCaching) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;            context.Items[conf.ResponseArgsKey] = <span class="stringliteral">&quot;&quot;</span>; <span class="comment">//We are handling the requests</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;            <span class="comment">//Communicate to the MVC plugin this request should not be affected by the UrlRoutingModule.</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;            context.Items[conf.StopRoutingKey] = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            <span class="comment">//Find out if we have a modified date that we can work with</span></div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            <span class="keywordtype">bool</span> hasModifiedDate = (vf == null) || vf is <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_file_with_modified_date.html">IVirtualFileWithModifiedDate</a>;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            DateTime modDate = DateTime.MinValue;</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            <span class="keywordflow">if</span> (hasModifiedDate &amp;&amp; vf != null) {</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                modDate = ((<a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_file_with_modified_date.html">IVirtualFileWithModifiedDate</a>)vf).ModifiedDateUTC;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                <span class="keywordflow">if</span> (modDate == DateTime.MinValue || modDate == DateTime.MaxValue) {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                    hasModifiedDate = <span class="keyword">false</span>; <span class="comment">//Skip modified date checking if the file has no modified date</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                }</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            }</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            <a class="code" href="interface_image_resizer_1_1_encoding_1_1_i_encoder.html">IEncoder</a> guessedEncoder = null;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            <span class="comment">//Only use an encoder to determine extension/mime-type when it&#39;s an image extension or when we&#39;ve set process = always.</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            <span class="keywordflow">if</span> (isProcessing) {</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                guessedEncoder = conf.GetImageBuilder().EncoderProvider.GetEncoder(settings, virtualPath);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                <span class="keywordflow">if</span> (guessedEncoder == null) <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_processing_exception.html">ImageProcessingException</a>(<span class="stringliteral">&quot;Image Resizer: No image encoder was found for the request.&quot;</span>);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;            }</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            <span class="comment">//Determine the file extenson for the caching system to use if we aren&#39;t processing the image</span></div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;            <span class="comment">//Use the exsiting one if is an image extension. If not, use &quot;unknown&quot;. </span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;            <span class="comment">// We don&#39;t want to suggest writing .exe or .aspx files to the cache! </span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            <span class="keywordtype">string</span> fallbackExtension = PathUtils.GetFullExtension(virtualPath).TrimStart(<span class="charliteral">&#39;.&#39;</span>); </div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;            <span class="keywordflow">if</span> (!<a class="code" href="class_image_resizer_1_1_intercept_module.html#a58d5e9e6dfce4ac70f2c81abbb7414ce">conf</a>.<a class="code" href="interface_image_resizer_1_1_configuration_1_1_i_pipeline_config.html#ac7ef1f4af9d8eb435963582217d2ce15">IsAcceptedImageType</a>(virtualPath)) fallbackExtension = <span class="stringliteral">&quot;unknown&quot;</span>;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            <span class="comment">//Determine the mime-type if we aren&#39;t processing the image.</span></div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            <span class="keywordtype">string</span> fallbackContentType = <span class="stringliteral">&quot;application/octet-stream&quot;</span>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            <span class="comment">//Support jpeg, png, gif, bmp, tiff mime-types. Otherwise use &quot;application/octet-stream&quot;. </span></div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;            <span class="comment">//We can&#39;t set it to null - it will default to text/html</span></div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            System.Drawing.Imaging.ImageFormat recognizedExtension = DefaultEncoder.GetImageFormatFromExtension(fallbackExtension);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            <span class="keywordflow">if</span> (recognizedExtension != null) fallbackContentType = DefaultEncoder.GetContentTypeFromImageFormat(recognizedExtension);</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;            <span class="comment">//Build CacheEventArgs</span></div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            <a class="code" href="class_image_resizer_1_1_caching_1_1_response_args.html">ResponseArgs</a> e = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_caching_1_1_response_args.html">ResponseArgs</a>();</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            e.RequestKey = virtualPath + PathUtils.BuildQueryString(queryString);</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;            e.RewrittenQuerystring = settings;</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;            e.ResponseHeaders.ContentType = isProcessing ? guessedEncoder.MimeType : fallbackContentType; </div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;            e.SuggestedExtension = isProcessing ? guessedEncoder.Extension : fallbackExtension;</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;            e.HasModifiedDate = hasModifiedDate;</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;            <span class="comment">//Add delegate for retrieving the modified date of the source file. </span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;            e.GetModifiedDateUTC = <span class="keyword">new</span> <a class="code" href="namespace_image_resizer_1_1_caching.html#aa07f9e07e851742ccee15c9caf69c1ba">ModifiedDateDelegate</a>(delegate() {</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                <span class="keywordflow">if</span> (vf == null)</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                    <span class="keywordflow">return</span> System.IO.File.GetLastWriteTimeUtc(HostingEnvironment.MapPath(virtualPath));</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">if</span> (hasModifiedDate)</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                    <span class="keywordflow">return</span> modDate;</div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                <span class="keywordflow">else</span> <span class="keywordflow">return</span> DateTime.MinValue; <span class="comment">//Won&#39;t be called, no modified date available.</span></div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;            });</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;            <span class="comment">//A delegate for accessing the source file</span></div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;            e.GetSourceImage = <span class="keyword">new</span> GetSourceImageDelegate(delegate() {</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;                <span class="keywordflow">return</span> (vf != null) ? vf.<a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_file.html#ab7b7a83101de09de66b663910b3febcc">Open</a>() : File.Open(HostingEnvironment.MapPath(virtualPath), FileMode.Open, FileAccess.Read, FileShare.Read);</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;            });</div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;</div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;            <span class="comment">//Add delegate for writing the data stream</span></div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;            e.ResizeImageToStream = <span class="keyword">new</span> <a class="code" href="namespace_image_resizer_1_1_caching.html#a51e885e7bc7d9c3c6906b6d51baad126">ResizeImageDelegate</a>(delegate(System.IO.Stream stream) {</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                <span class="comment">//This runs on a cache miss or cache invalid. This delegate is preventing from running in more</span></div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                <span class="comment">//than one thread at a time for the specified cache key</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                    if (!isProcessing) {</div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                        <span class="comment">//Just duplicate the data</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                        <span class="keyword">using</span> (Stream source = e.GetSourceImage())</div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                            StreamExtensions.CopyToStream(source, stream); <span class="comment">//4KiB buffer</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                        </div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                        <span class="comment">//Process the image</span></div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;                        <span class="keywordflow">if</span> (vf != null)</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;                            conf.GetImageBuilder().Build(vf, stream, settings);</div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;                        <span class="keywordflow">else</span></div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                            conf.GetImageBuilder().Build(HostingEnvironment.MapPath(virtualPath), stream, settings); <span class="comment">//Use a physical path to bypass virtual file system</span></div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;                    }</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;                    <span class="comment">//Catch not found exceptions</span></div>
<div class="line"><a name="l00277"></a><span class="lineno">  277</span>&#160;                } <span class="keywordflow">catch</span> (System.IO.FileNotFoundException notFound) {</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;                    <span class="comment">//This will be called later, if at all. </span></div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;                    FileMissing(context, virtualPath, queryString);</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;                    <span class="keywordflow">throw</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_image_missing_exception.html">ImageMissingException</a>(<span class="stringliteral">&quot;The specified resource could not be located&quot;</span>,<span class="stringliteral">&quot;File not found&quot;</span>, notFound);</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                }</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            });</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;            context.Items[conf.ResponseArgsKey] = e; <span class="comment">//store in context items</span></div>
<div class="line"><a name="l00286"></a><span class="lineno">  286</span>&#160;</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;            <span class="comment">//Fire events (for client-side caching plugins)</span></div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            conf.FirePreHandleImage(<span class="keyword">this</span>, context, e);</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;            <span class="comment">//Pass the rest of the work off to the caching module. It will handle rewriting/redirecting and everything. </span></div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            <span class="comment">//We handle request headers based on what is found in context.Items</span></div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            <a class="code" href="interface_image_resizer_1_1_caching_1_1_i_cache.html">ICache</a> cache = conf.GetCacheProvider().GetCachingSystem(context, e);</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;            <span class="comment">//Verify we have a caching system</span></div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;            <span class="keywordflow">if</span> (cache == null) <span class="keywordflow">throw</span> <span class="keyword">new</span> ImageProcessingException(<span class="stringliteral">&quot;Image Resizer: No caching plugin was found for the request&quot;</span>);</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;            </div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            cache.Process(context, e);</div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;            </div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;            s.Stop();</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            context.Items[<span class="stringliteral">&quot;ResizingTime&quot;</span>] = s.ElapsedMilliseconds;</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        }</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00306"></a><span class="lineno">  306</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;<span class="comment">        /// We don&#39;t actually send the data - but we still want to control the headers on the data.</span></div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;<span class="comment">        /// PreSendRequestHeaders allows us to change the content-type and cache headers at excatly the last</span></div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;<span class="comment">        /// &lt;param name=&quot;sender&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00311"></a><span class="lineno">  311</span>&#160;<span class="comment">        /// &lt;param name=&quot;e&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00312"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_intercept_module.html#a9938e258c26e277886d13712010aaa34">  312</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_image_resizer_1_1_intercept_module.html#a9938e258c26e277886d13712010aaa34">context_PreSendRequestHeaders</a>(<span class="keywordtype">object</span> sender, EventArgs e) {</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            <span class="comment">//Skip requests if the Request object isn&#39;t populated</span></div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;            HttpApplication app = sender as HttpApplication;</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;            <span class="keywordflow">if</span> (app == null) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;            <span class="keywordflow">if</span> (app.Context == null) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;            <span class="keywordflow">if</span> (app.Context.Items == null) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            <span class="keywordflow">if</span> (app.Context.Request == null) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            HttpContext context = app.Context;</div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            <span class="comment">//Skip requests if we don&#39;t have an object to work with.</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            <span class="keywordflow">if</span> (context.Items[conf.ResponseArgsKey] == null) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            <span class="comment">//Try to cast the object.</span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            <a class="code" href="interface_image_resizer_1_1_caching_1_1_i_response_args.html">IResponseArgs</a> obj = context.Items[conf.ResponseArgsKey] as <a class="code" href="interface_image_resizer_1_1_caching_1_1_i_response_args.html">IResponseArgs</a>;</div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            <span class="keywordflow">if</span> (obj == null) <span class="keywordflow">return</span>;</div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="comment">//Apply the headers</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <span class="keywordflow">if</span> (obj.<a class="code" href="interface_image_resizer_1_1_caching_1_1_i_response_args.html#a318f0208607e27b12ed78e692e03912b">ResponseHeaders</a>.<a class="code" href="interface_image_resizer_1_1_caching_1_1_i_response_headers.html#a0fcec2a5cc51fc00c036a01921a59a44">ApplyDuringPreSendRequestHeaders</a>)</div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;                obj.ResponseHeaders.ApplyToResponse(obj.ResponseHeaders, app.Context);</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;        }</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;    }</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;}</div>
<div class="ttc" id="interface_image_resizer_1_1_caching_1_1_i_cache_html"><div class="ttname"><a href="interface_image_resizer_1_1_caching_1_1_i_cache.html">ImageResizer.Caching.ICache</a></div><div class="ttdoc">Provides caching behavior </div><div class="ttdef"><b>Definition:</b> <a href="_i_cache_8cs_source.html#l00012">ICache.cs:12</a></div></div>
<div class="ttc" id="namespace_image_resizer_1_1_caching_html_aa07f9e07e851742ccee15c9caf69c1ba"><div class="ttname"><a href="namespace_image_resizer_1_1_caching.html#aa07f9e07e851742ccee15c9caf69c1ba">ImageResizer.Caching.ModifiedDateDelegate</a></div><div class="ttdeci">delegate DateTime ModifiedDateDelegate()</div><div class="ttdoc">A callback method to return the last modified date of the source file if available, or DateTime.MinValue if not available. </div></div>
<div class="ttc" id="interface_image_resizer_1_1_configuration_1_1_i_pipeline_config_html_a0c58a51a8bc68f0c131b67c700582a80"><div class="ttname"><a href="interface_image_resizer_1_1_configuration_1_1_i_pipeline_config.html#a0c58a51a8bc68f0c131b67c700582a80">ImageResizer.Configuration.IPipelineConfig.GetFile</a></div><div class="ttdeci">new IVirtualFile GetFile(string virtualPath, NameValueCollection queryString)</div></div>
<div class="ttc" id="interface_image_resizer_1_1_plugins_1_1_i_virtual_file_html"><div class="ttname"><a href="interface_image_resizer_1_1_plugins_1_1_i_virtual_file.html">ImageResizer.Plugins.IVirtualFile</a></div><div class="ttdoc">A virtual file to support IVirtualImageProvider </div><div class="ttdef"><b>Definition:</b> <a href="_i_virtual_file_8cs_source.html#l00010">IVirtualFile.cs:10</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_caching_1_1_response_args_html"><div class="ttname"><a href="class_image_resizer_1_1_caching_1_1_response_args.html">ImageResizer.Caching.ResponseArgs</a></div><div class="ttdoc">IResponseArgs implementation </div><div class="ttdef"><b>Definition:</b> <a href="_response_args_8cs_source.html#l00012">ResponseArgs.cs:12</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_configuration_1_1_i_pipeline_config_html_a77bea25b98cf43d427b9dbdb6417dd3b"><div class="ttname"><a href="interface_image_resizer_1_1_configuration_1_1_i_pipeline_config.html#a77bea25b98cf43d427b9dbdb6417dd3b">ImageResizer.Configuration.IPipelineConfig.SkipFileTypeCheck</a></div><div class="ttdeci">bool SkipFileTypeCheck</div><div class="ttdoc">Get or sets whether the file extension check should be applied to the current request. Defaults to true. If set to true, will only affect the current request, and will only cause the Resizer to evaluate the rewriting rules on the request. Processing may still not occur if no querystring values are specified. Add &amp;#39;cache=always&amp;#39; to force caching to occur. </div><div class="ttdef"><b>Definition:</b> <a href="_i_pipeline_config_8cs_source.html#l00070">IPipelineConfig.cs:70</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_caching_1_1_i_response_args_html_a318f0208607e27b12ed78e692e03912b"><div class="ttname"><a href="interface_image_resizer_1_1_caching_1_1_i_response_args.html#a318f0208607e27b12ed78e692e03912b">ImageResizer.Caching.IResponseArgs.ResponseHeaders</a></div><div class="ttdeci">IResponseHeaders ResponseHeaders</div><div class="ttdoc">The content-type of the data, among other things. Set ResponseHeaders.ApplyDuringPreSendRequestHeader...</div><div class="ttdef"><b>Definition:</b> <a href="_i_response_args_8cs_source.html#l00050">IResponseArgs.cs:50</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_intercept_module_html_a58d5e9e6dfce4ac70f2c81abbb7414ce"><div class="ttname"><a href="class_image_resizer_1_1_intercept_module.html#a58d5e9e6dfce4ac70f2c81abbb7414ce">ImageResizer.InterceptModule.conf</a></div><div class="ttdeci">IPipelineConfig conf</div><div class="ttdoc">Current configuration. Same as Config.Current.Pipeline </div><div class="ttdef"><b>Definition:</b> <a href="_intercept_module_8cs_source.html#l00051">InterceptModule.cs:51</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_caching_1_1_i_response_headers_html_a0fcec2a5cc51fc00c036a01921a59a44"><div class="ttname"><a href="interface_image_resizer_1_1_caching_1_1_i_response_headers.html#a0fcec2a5cc51fc00c036a01921a59a44">ImageResizer.Caching.IResponseHeaders.ApplyDuringPreSendRequestHeaders</a></div><div class="ttdeci">bool ApplyDuringPreSendRequestHeaders</div><div class="ttdoc">True if the application should automatically execute ApplyToResponse() during the PreSendRequestHeade...</div><div class="ttdef"><b>Definition:</b> <a href="_i_response_headers_8cs_source.html#l00069">IResponseHeaders.cs:69</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_configuration_1_1_url_event_args_html"><div class="ttname"><a href="class_image_resizer_1_1_configuration_1_1_url_event_args.html">ImageResizer.Configuration.UrlEventArgs</a></div><div class="ttdef"><b>Definition:</b> <a href="_url_event_args_8cs_source.html#l00010">UrlEventArgs.cs:10</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_configuration_1_1_url_authorization_event_args_html"><div class="ttname"><a href="class_image_resizer_1_1_configuration_1_1_url_authorization_event_args.html">ImageResizer.Configuration.UrlAuthorizationEventArgs</a></div><div class="ttdef"><b>Definition:</b> <a href="_url_authorization_event_args_8cs_source.html#l00007">UrlAuthorizationEventArgs.cs:7</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html">ImageResizer.ResizeSettings</a></div><div class="ttdoc">Represents the settings which will be used to process the image. Extends NameValueCollection to provi...</div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00020">ResizeSettings.cs:20</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_intercept_module_html_a55916ea27e905902663d2813fcfc9ebf"><div class="ttname"><a href="class_image_resizer_1_1_intercept_module.html#a55916ea27e905902663d2813fcfc9ebf">ImageResizer.InterceptModule.HandleRequest</a></div><div class="ttdeci">virtual void HandleRequest(HttpContext context, string virtualPath, NameValueCollection queryString, IVirtualFile vf)</div><div class="ttdoc">Generates the resized image to disk (if needed), then rewrites the request to that location...</div><div class="ttdef"><b>Definition:</b> <a href="_intercept_module_8cs_source.html#l00171">InterceptModule.cs:171</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_processing_exception_html"><div class="ttname"><a href="class_image_resizer_1_1_image_processing_exception.html">ImageResizer.ImageProcessingException</a></div><div class="ttdoc">Represents an non-recoverable exception that occured while processing the image. Possible causes are:...</div><div class="ttdef"><b>Definition:</b> <a href="_image_processing_exception_8cs_source.html#l00013">ImageProcessingException.cs:13</a></div></div>
<div class="ttc" id="namespace_image_resizer_1_1_caching_html_a51e885e7bc7d9c3c6906b6d51baad126"><div class="ttname"><a href="namespace_image_resizer_1_1_caching.html#a51e885e7bc7d9c3c6906b6d51baad126">ImageResizer.Caching.ResizeImageDelegate</a></div><div class="ttdeci">delegate void ResizeImageDelegate(Stream s)</div><div class="ttdoc">A callback method that will resize, encode, and write the data to the given stream. Callback may throw FileNotFoundException when running on top of an optimistic VPP </div></div>
<div class="ttc" id="interface_image_resizer_1_1_configuration_1_1_i_pipeline_config_html_aa596c84a40adc00dd0d6c7bd351476b5"><div class="ttname"><a href="interface_image_resizer_1_1_configuration_1_1_i_pipeline_config.html#aa596c84a40adc00dd0d6c7bd351476b5">ImageResizer.Configuration.IPipelineConfig.HasPipelineDirective</a></div><div class="ttdeci">bool HasPipelineDirective(NameValueCollection q)</div><div class="ttdoc">True if the querystring contains any directives that are understood by the pipeline ...</div></div>
<div class="ttc" id="class_image_resizer_1_1_intercept_module_html_ab7a18ae77265d4f17870541448c99fbf"><div class="ttname"><a href="class_image_resizer_1_1_intercept_module.html#ab7a18ae77265d4f17870541448c99fbf">ImageResizer.InterceptModule.CheckRequest_PostAuthorizeRequest</a></div><div class="ttdeci">virtual void CheckRequest_PostAuthorizeRequest(object sender, EventArgs e)</div><div class="ttdoc">This is where we filter requests and intercept those that want resizing performed. We first strip FakeExtension, then verify the remaining file extension is supported for decoding. We fire URL rewriting events. If the result includes any supported querystring params afterwards, we process the request. Otherwise we let it fall back to IIS/ASP.NET. If the file doesn&amp;#39;t exist, we also ignore the request. They&amp;#39;re going to cause a 404 anyway. </div><div class="ttdef"><b>Definition:</b> <a href="_intercept_module_8cs_source.html#l00062">InterceptModule.cs:62</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_caching_1_1_i_response_args_html"><div class="ttname"><a href="interface_image_resizer_1_1_caching_1_1_i_response_args.html">ImageResizer.Caching.IResponseArgs</a></div><div class="ttdoc">A collection of data and callbacks that can be passed to a caching object. </div><div class="ttdef"><b>Definition:</b> <a href="_i_response_args_8cs_source.html#l00027">IResponseArgs.cs:27</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_intercept_module_html"><div class="ttname"><a href="class_image_resizer_1_1_intercept_module.html">ImageResizer.InterceptModule</a></div><div class="ttdoc">Monitors incoming image requests to determine if resizing (or other processing) is being requested...</div><div class="ttdef"><b>Definition:</b> <a href="_intercept_module_8cs_source.html#l00026">InterceptModule.cs:26</a></div></div>
<div class="ttc" id="namespace_image_resizer_html_a089c1fb717c880fab9cb6c06a06cf35a"><div class="ttname"><a href="namespace_image_resizer.html#a089c1fb717c880fab9cb6c06a06cf35a">ImageResizer.ProcessWhen</a></div><div class="ttdeci">ProcessWhen</div><div class="ttdoc">When to process and re-encode the file. </div><div class="ttdef"><b>Definition:</b> <a href="_enumerations_8cs_source.html#l00054">Enumerations.cs:54</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_missing_exception_html"><div class="ttname"><a href="class_image_resizer_1_1_image_missing_exception.html">ImageResizer.ImageMissingException</a></div><div class="ttdoc">One or more source files was missing </div><div class="ttdef"><b>Definition:</b> <a href="_image_processing_exception_8cs_source.html#l00051">ImageProcessingException.cs:51</a></div></div>
<div class="ttc" id="namespace_image_resizer_html_a6b30c95c789b77db2c5aa905345d917c"><div class="ttname"><a href="namespace_image_resizer.html#a6b30c95c789b77db2c5aa905345d917c">ImageResizer.ServerCacheMode</a></div><div class="ttdeci">ServerCacheMode</div><div class="ttdoc">When to disk cache the image </div><div class="ttdef"><b>Definition:</b> <a href="_enumerations_8cs_source.html#l00036">Enumerations.cs:36</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_intercept_module_html_a9938e258c26e277886d13712010aaa34"><div class="ttname"><a href="class_image_resizer_1_1_intercept_module.html#a9938e258c26e277886d13712010aaa34">ImageResizer.InterceptModule.context_PreSendRequestHeaders</a></div><div class="ttdeci">void context_PreSendRequestHeaders(object sender, EventArgs e)</div><div class="ttdoc">We don&amp;#39;t actually send the data - but we still want to control the headers on the data...</div><div class="ttdef"><b>Definition:</b> <a href="_intercept_module_8cs_source.html#l00312">InterceptModule.cs:312</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_configuration_1_1_i_url_authorization_event_args_html"><div class="ttname"><a href="interface_image_resizer_1_1_configuration_1_1_i_url_authorization_event_args.html">ImageResizer.Configuration.IUrlAuthorizationEventArgs</a></div><div class="ttdef"><b>Definition:</b> <a href="_i_url_authorization_event_args_8cs_source.html#l00003">IUrlAuthorizationEventArgs.cs:3</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_configuration_1_1_i_pipeline_config_html_ac7ef1f4af9d8eb435963582217d2ce15"><div class="ttname"><a href="interface_image_resizer_1_1_configuration_1_1_i_pipeline_config.html#ac7ef1f4af9d8eb435963582217d2ce15">ImageResizer.Configuration.IPipelineConfig.IsAcceptedImageType</a></div><div class="ttdeci">bool IsAcceptedImageType(string filePath)</div><div class="ttdoc">True if the specified extension is one that the pipeline can handle </div></div>
<div class="ttc" id="interface_image_resizer_1_1_plugins_1_1_i_virtual_file_html_ab7b7a83101de09de66b663910b3febcc"><div class="ttname"><a href="interface_image_resizer_1_1_plugins_1_1_i_virtual_file.html#ab7b7a83101de09de66b663910b3febcc">ImageResizer.Plugins.IVirtualFile.Open</a></div><div class="ttdeci">Stream Open()</div><div class="ttdoc">Returns an opened stream to the file contents. </div></div>
<div class="ttc" id="interface_image_resizer_1_1_configuration_1_1_i_pipeline_config_html"><div class="ttname"><a href="interface_image_resizer_1_1_configuration_1_1_i_pipeline_config.html">ImageResizer.Configuration.IPipelineConfig</a></div><div class="ttdef"><b>Definition:</b> <a href="_i_pipeline_config_8cs_source.html#l00025">IPipelineConfig.cs:25</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_encoding_1_1_i_encoder_html"><div class="ttname"><a href="interface_image_resizer_1_1_encoding_1_1_i_encoder.html">ImageResizer.Encoding.IEncoder</a></div><div class="ttdoc">An image encoder. Exposes methods for suitability checking, encoding, transparency compatibility chec...</div><div class="ttdef"><b>Definition:</b> <a href="_i_encoder_8cs_source.html#l00013">IEncoder.cs:13</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_plugins_1_1_i_virtual_file_with_modified_date_html"><div class="ttname"><a href="interface_image_resizer_1_1_plugins_1_1_i_virtual_file_with_modified_date.html">ImageResizer.Plugins.IVirtualFileWithModifiedDate</a></div><div class="ttdoc">Always implement this if possible. Allows caching systems to detect changes to source files and inval...</div><div class="ttdef"><b>Definition:</b> <a href="_i_virtual_file_with_modified_date_8cs_source.html#l00011">IVirtualFileWithModifiedDate.cs:11</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
