<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>ImageResizer: ImageResizer.ImageUploadHelper Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="imageresizer-logo-00aec4.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.4.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespace_image_resizer.html">ImageResizer</a></li><li class="navelem"><a class="el" href="class_image_resizer_1_1_image_upload_helper.html">ImageUploadHelper</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#properties">Properties</a> &#124;
<a href="class_image_resizer_1_1_image_upload_helper-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">ImageResizer.ImageUploadHelper Class Reference</div>  </div>
</div><!--header-->
<div class="contents">
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:a3a4360ad99c05dcfb0196730d54bc488"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a3a4360ad99c05dcfb0196730d54bc488"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>ImageUploadHelper</b> (<a class="el" href="class_image_resizer_1_1_configuration_1_1_config.html">Config</a> c)</td></tr>
<tr class="separator:a3a4360ad99c05dcfb0196730d54bc488"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ac0155e5c99c20e7b97ae621b87be2f76"><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_image_upload_helper.html#ac0155e5c99c20e7b97ae621b87be2f76">GetExtension</a> (string path)</td></tr>
<tr class="memdesc:ac0155e5c99c20e7b97ae621b87be2f76"><td class="mdescLeft">&#160;</td><td class="mdescRight">Parses the file extension from the path and returns it. If it contains a multi-segment extension like .txt.zip, only "zip" will be returned.  <a href="#ac0155e5c99c20e7b97ae621b87be2f76">More...</a><br/></td></tr>
<tr class="separator:ac0155e5c99c20e7b97ae621b87be2f76"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:acca1b65183e8245775be323422a9b74e"><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_image_upload_helper.html#acca1b65183e8245775be323422a9b74e">NormalizeExtension</a> (string extension)</td></tr>
<tr class="memdesc:acca1b65183e8245775be323422a9b74e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Lowercases and normalizes some common extension aliases (jpeg-&gt;jpg, tiff-tif). Does not filter out non-image extensions!  <a href="#acca1b65183e8245775be323422a9b74e">More...</a><br/></td></tr>
<tr class="separator:acca1b65183e8245775be323422a9b74e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4b2ecaba51b887d0cf7024977ee1b7e6"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_image_upload_helper.html#a4b2ecaba51b887d0cf7024977ee1b7e6">IsExtensionWhitelisted</a> (string ext, string[] whitelistedFormats=null)</td></tr>
<tr class="memdesc:a4b2ecaba51b887d0cf7024977ee1b7e6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if the given extension is whitelisted.  <a href="#a4b2ecaba51b887d0cf7024977ee1b7e6">More...</a><br/></td></tr>
<tr class="separator:a4b2ecaba51b887d0cf7024977ee1b7e6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9632203e72e0a67660171ba11133203d"><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_image_upload_helper.html#a9632203e72e0a67660171ba11133203d">GetWhitelistedExtension</a> (Stream image=null, string originalPath=null, string[] whitelistedFormats=null)</td></tr>
<tr class="memdesc:a9632203e72e0a67660171ba11133203d"><td class="mdescLeft">&#160;</td><td class="mdescRight">Uses stream signatures first, then the original path, to detect the appropriate normalized image extension. Returns null if extension (or no whitelisted extension) is found.  <a href="#a9632203e72e0a67660171ba11133203d">More...</a><br/></td></tr>
<tr class="separator:a9632203e72e0a67660171ba11133203d"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af9695f6355701f86e8590e32905e11d2"><td class="memItemLeft" align="right" valign="top">bool&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_image_upload_helper.html#af9695f6355701f86e8590e32905e11d2">IsUploadedFileAnImage</a> (object uploadFile, string[] whitelistedFormats=null)</td></tr>
<tr class="memdesc:af9695f6355701f86e8590e32905e11d2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns true if the uploaded file is identified as an image (looks for the image signature, falling back to the user-provided filename).  <a href="#af9695f6355701f86e8590e32905e11d2">More...</a><br/></td></tr>
<tr class="separator:af9695f6355701f86e8590e32905e11d2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a38d70d73da5ee90b75045255d91fdf0f"><td class="memItemLeft" align="right" valign="top">int[]&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_image_upload_helper.html#a38d70d73da5ee90b75045255d91fdf0f">GetImageSize</a> (object s)</td></tr>
<tr class="memdesc:a38d70d73da5ee90b75045255d91fdf0f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the [width,height] of the first frame/page of the image. May return null or throw exceptions.  <a href="#a38d70d73da5ee90b75045255d91fdf0f">More...</a><br/></td></tr>
<tr class="separator:a38d70d73da5ee90b75045255d91fdf0f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3b0068662b73fbef20b50d792f9a24b"><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_image_upload_helper.html#ad3b0068662b73fbef20b50d792f9a24b">SaveUploadedFileSafely</a> (string baseDir, object uploadFile, string unrecognizedImageExtension=&quot;.unknown&quot;, string[] whitelistedFormats=null)</td></tr>
<tr class="memdesc:ad3b0068662b73fbef20b50d792f9a24b"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the name used for the file, without any path information. Name will be in "guid.ext" form. Will create any intermediate directories required.  <a href="#ad3b0068662b73fbef20b50d792f9a24b">More...</a><br/></td></tr>
<tr class="separator:ad3b0068662b73fbef20b50d792f9a24b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a63db738bc028d3bc3a829e409c7d7919"><td class="memItemLeft" align="right" valign="top">string&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_image_upload_helper.html#a63db738bc028d3bc3a829e409c7d7919">GenerateSafeImageName</a> (Stream image=null, string originalPath=null, string unrecognizedImageExtension=&quot;.unknown&quot;, string[] whitelistedFormats=null)</td></tr>
<tr class="memdesc:a63db738bc028d3bc3a829e409c7d7919"><td class="mdescLeft">&#160;</td><td class="mdescRight">Generates a safe name for your image in the form "guid.ext". Uses stream signatures first, then the path to determine the appropriate image extension. You can provide your own whitelist of extensions if desired; this defaults to the extensions supported by the currently installed set of plugins.  <a href="#a63db738bc028d3bc3a829e409c7d7919">More...</a><br/></td></tr>
<tr class="separator:a63db738bc028d3bc3a829e409c7d7919"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5094f5710bb0d31845fa32bf5657ca20"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_image_resizer_1_1_plugins_1_1_file_signature.html">FileSignature</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_image_upload_helper.html#a5094f5710bb0d31845fa32bf5657ca20">GuessFileTypeBySignature</a> (Stream s)</td></tr>
<tr class="memdesc:a5094f5710bb0d31845fa32bf5657ca20"><td class="mdescLeft">&#160;</td><td class="mdescRight">Tries to guess the file type of the given stream by the byte signature. Typically more reliable than file extensions - users constantly rename file extensions expecting it to change the actual encoding. Throws Argument exception if stream isn't seekable and readable. Returns null if there were no matches. Make sure the current position of the stream is at the beginning of the file, or you will get no results. Returns the stream to its original position  <a href="#a5094f5710bb0d31845fa32bf5657ca20">More...</a><br/></td></tr>
<tr class="separator:a5094f5710bb0d31845fa32bf5657ca20"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="properties"></a>
Properties</h2></td></tr>
<tr class="memitem:affbca6776b4a32fc043c99c259519c06"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="affbca6776b4a32fc043c99c259519c06"></a>
static <a class="el" href="class_image_resizer_1_1_image_upload_helper.html">ImageUploadHelper</a>&#160;</td><td class="memItemRight" valign="bottom"><b>Current</b><code> [get]</code></td></tr>
<tr class="separator:affbca6776b4a32fc043c99c259519c06"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock">
<p>Definition at line <a class="el" href="_image_upload_helper_8cs_source.html#l00013">13</a> of file <a class="el" href="_image_upload_helper_8cs_source.html">ImageUploadHelper.cs</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a63db738bc028d3bc3a829e409c7d7919"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">string ImageResizer.ImageUploadHelper.GenerateSafeImageName </td>
          <td>(</td>
          <td class="paramtype">Stream&#160;</td>
          <td class="paramname"><em>image</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>originalPath</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>unrecognizedImageExtension</em> = <code>&quot;.unknown&quot;</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string[]&#160;</td>
          <td class="paramname"><em>whitelistedFormats</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Generates a safe name for your image in the form "guid.ext". Uses stream signatures first, then the path to determine the appropriate image extension. You can provide your own whitelist of extensions if desired; this defaults to the extensions supported by the currently installed set of plugins. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">unrecognizedImageExtension</td><td>Pass null to have an ArgumentException thrown if the image type is not recognized as a whitelisted format</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="_image_upload_helper_8cs_source.html#l00188">188</a> of file <a class="el" href="_image_upload_helper_8cs_source.html">ImageUploadHelper.cs</a>.</p>

<p>Referenced by <a class="el" href="_image_upload_helper_8cs_source.html#l00155">ImageResizer.ImageUploadHelper.SaveUploadedFileSafely()</a>.</p>
<div class="fragment"><div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;        {   </div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;            var ext = <a class="code" href="class_image_resizer_1_1_image_upload_helper.html#a9632203e72e0a67660171ba11133203d">GetWhitelistedExtension</a>(image,originalPath,whitelistedFormats) ?? unrecognizedImageExtension;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <span class="keywordflow">if</span> (ext == null) <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;The provided image type is not recognized as a whitelisted format&quot;</span>);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;            <span class="keywordflow">return</span> Guid.NewGuid().ToString(<span class="stringliteral">&quot;N&quot;</span>, NumberFormatInfo.InvariantInfo) + ext;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;        }</div>
<div class="ttc" id="class_image_resizer_1_1_image_upload_helper_html_a9632203e72e0a67660171ba11133203d"><div class="ttname"><a href="class_image_resizer_1_1_image_upload_helper.html#a9632203e72e0a67660171ba11133203d">ImageResizer.ImageUploadHelper.GetWhitelistedExtension</a></div><div class="ttdeci">string GetWhitelistedExtension(Stream image=null, string originalPath=null, string[] whitelistedFormats=null)</div><div class="ttdoc">Uses stream signatures first, then the original path, to detect the appropriate normalized image exte...</div><div class="ttdef"><b>Definition:</b> <a href="_image_upload_helper_8cs_source.html#l00090">ImageUploadHelper.cs:90</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ac0155e5c99c20e7b97ae621b87be2f76"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">string ImageResizer.ImageUploadHelper.GetExtension </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>path</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Parses the file extension from the path and returns it. If it contains a multi-segment extension like .txt.zip, only "zip" will be returned. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="_image_upload_helper_8cs_source.html#l00030">30</a> of file <a class="el" href="_image_upload_helper_8cs_source.html">ImageUploadHelper.cs</a>.</p>

<p>Referenced by <a class="el" href="_image_upload_helper_8cs_source.html#l00090">ImageResizer.ImageUploadHelper.GetWhitelistedExtension()</a>.</p>
<div class="fragment"><div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;        {</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;            <span class="keywordtype">int</span> lastDot = path.LastIndexOfAny(<span class="keyword">new</span> <span class="keywordtype">char</span>[] { <span class="charliteral">&#39;.&#39;</span>, <span class="charliteral">&#39;/&#39;</span>, <span class="charliteral">&#39; &#39;</span>, <span class="charliteral">&#39;\\&#39;</span>, <span class="charliteral">&#39;?&#39;</span>, <span class="charliteral">&#39;&amp;&#39;</span>, <span class="charliteral">&#39;:&#39;</span> });</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;            <span class="keywordflow">if</span> (lastDot &gt; -1 &amp;&amp; path[lastDot] == <span class="charliteral">&#39;.&#39;</span>) <span class="keywordflow">return</span> path.Substring(lastDot + 1);</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a38d70d73da5ee90b75045255d91fdf0f"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">int [] ImageResizer.ImageUploadHelper.GetImageSize </td>
          <td>(</td>
          <td class="paramtype">object&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the [width,height] of the first frame/page of the image. May return null or throw exceptions. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td>May be an UploadFile, a seekable Stream, a physical path, or a virtual path to the image.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="_image_upload_helper_8cs_source.html#l00139">139</a> of file <a class="el" href="_image_upload_helper_8cs_source.html">ImageUploadHelper.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;                                           {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            var j = <span class="keyword">new</span> ImageJob(s,null);</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            j.ResetSourceStream = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;            j.DisposeSourceObject = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            c.CurrentImageBuilder.Build(j);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">new</span> <span class="keywordtype">int</span>[]{j.SourceWidth.Value,j.SourceHeight.Value};</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a9632203e72e0a67660171ba11133203d"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">string ImageResizer.ImageUploadHelper.GetWhitelistedExtension </td>
          <td>(</td>
          <td class="paramtype">Stream&#160;</td>
          <td class="paramname"><em>image</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>originalPath</em> = <code>null</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string[]&#160;</td>
          <td class="paramname"><em>whitelistedFormats</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Uses stream signatures first, then the original path, to detect the appropriate normalized image extension. Returns null if extension (or no whitelisted extension) is found. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">image</td><td></td></tr>
    <tr><td class="paramname">originalPath</td><td></td></tr>
    <tr><td class="paramname">whitelistedFormats</td><td>You can provide your own whitelist of extensions if desired (new string[]{"jpg","png"}). This defaults to the extensions supported by the currently installed set of plugins.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="_image_upload_helper_8cs_source.html#l00090">90</a> of file <a class="el" href="_image_upload_helper_8cs_source.html">ImageUploadHelper.cs</a>.</p>

<p>Referenced by <a class="el" href="_image_upload_helper_8cs_source.html#l00188">ImageResizer.ImageUploadHelper.GenerateSafeImageName()</a>, and <a class="el" href="_image_upload_helper_8cs_source.html#l00116">ImageResizer.ImageUploadHelper.IsUploadedFileAnImage()</a>.</p>
<div class="fragment"><div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;        {   </div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <a class="code" href="class_image_resizer_1_1_plugins_1_1_file_signature.html">FileSignature</a> sig = null;</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            <span class="keywordflow">if</span> (image != null &amp;&amp; image.CanSeek &amp;&amp; image.CanRead)</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                sig = <a class="code" href="class_image_resizer_1_1_image_upload_helper.html#a5094f5710bb0d31845fa32bf5657ca20">GuessFileTypeBySignature</a>(image);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            var sigExt = sig != null ? <a class="code" href="class_image_resizer_1_1_image_upload_helper.html#acca1b65183e8245775be323422a9b74e">NormalizeExtension</a>(sig.PrimaryFileExtension) : null;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <span class="keywordflow">if</span> (sigExt != null &amp;&amp; <a class="code" href="class_image_resizer_1_1_image_upload_helper.html#a4b2ecaba51b887d0cf7024977ee1b7e6">IsExtensionWhitelisted</a>(sigExt,whitelistedFormats)) <span class="keywordflow">return</span> sigExt;</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            <span class="comment">//Falback to untrusted ppath</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            <span class="keywordflow">if</span> (originalPath != null){</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                <span class="keywordtype">string</span> ext = <a class="code" href="class_image_resizer_1_1_image_upload_helper.html#acca1b65183e8245775be323422a9b74e">NormalizeExtension</a>(<a class="code" href="class_image_resizer_1_1_image_upload_helper.html#ac0155e5c99c20e7b97ae621b87be2f76">GetExtension</a>(originalPath));</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                <span class="keywordflow">if</span> (ext != null &amp; <a class="code" href="class_image_resizer_1_1_image_upload_helper.html#a4b2ecaba51b887d0cf7024977ee1b7e6">IsExtensionWhitelisted</a>(ext,whitelistedFormats)) <span class="keywordflow">return</span> ext;</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            }</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;            <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;        }</div>
<div class="ttc" id="class_image_resizer_1_1_image_upload_helper_html_a5094f5710bb0d31845fa32bf5657ca20"><div class="ttname"><a href="class_image_resizer_1_1_image_upload_helper.html#a5094f5710bb0d31845fa32bf5657ca20">ImageResizer.ImageUploadHelper.GuessFileTypeBySignature</a></div><div class="ttdeci">FileSignature GuessFileTypeBySignature(Stream s)</div><div class="ttdoc">Tries to guess the file type of the given stream by the byte signature. Typically more reliable than ...</div><div class="ttdef"><b>Definition:</b> <a href="_image_upload_helper_8cs_source.html#l00203">ImageUploadHelper.cs:203</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_upload_helper_html_ac0155e5c99c20e7b97ae621b87be2f76"><div class="ttname"><a href="class_image_resizer_1_1_image_upload_helper.html#ac0155e5c99c20e7b97ae621b87be2f76">ImageResizer.ImageUploadHelper.GetExtension</a></div><div class="ttdeci">string GetExtension(string path)</div><div class="ttdoc">Parses the file extension from the path and returns it. If it contains a multi-segment extension like...</div><div class="ttdef"><b>Definition:</b> <a href="_image_upload_helper_8cs_source.html#l00030">ImageUploadHelper.cs:30</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_upload_helper_html_acca1b65183e8245775be323422a9b74e"><div class="ttname"><a href="class_image_resizer_1_1_image_upload_helper.html#acca1b65183e8245775be323422a9b74e">ImageResizer.ImageUploadHelper.NormalizeExtension</a></div><div class="ttdeci">string NormalizeExtension(string extension)</div><div class="ttdoc">Lowercases and normalizes some common extension aliases (jpeg-&amp;gt;jpg, tiff-tif). Does not filter out no...</div><div class="ttdef"><b>Definition:</b> <a href="_image_upload_helper_8cs_source.html#l00042">ImageUploadHelper.cs:42</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_file_signature_html"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_file_signature.html">ImageResizer.Plugins.FileSignature</a></div><div class="ttdef"><b>Definition:</b> <a href="_file_signature_8cs_source.html#l00007">FileSignature.cs:7</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_image_upload_helper_html_a4b2ecaba51b887d0cf7024977ee1b7e6"><div class="ttname"><a href="class_image_resizer_1_1_image_upload_helper.html#a4b2ecaba51b887d0cf7024977ee1b7e6">ImageResizer.ImageUploadHelper.IsExtensionWhitelisted</a></div><div class="ttdeci">bool IsExtensionWhitelisted(string ext, string[] whitelistedFormats=null)</div><div class="ttdoc">Returns true if the given extension is whitelisted. </div><div class="ttdef"><b>Definition:</b> <a href="_image_upload_helper_8cs_source.html#l00068">ImageUploadHelper.cs:68</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a5094f5710bb0d31845fa32bf5657ca20"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_image_resizer_1_1_plugins_1_1_file_signature.html">FileSignature</a> ImageResizer.ImageUploadHelper.GuessFileTypeBySignature </td>
          <td>(</td>
          <td class="paramtype">Stream&#160;</td>
          <td class="paramname"><em>s</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Tries to guess the file type of the given stream by the byte signature. Typically more reliable than file extensions - users constantly rename file extensions expecting it to change the actual encoding. Throws Argument exception if stream isn't seekable and readable. Returns null if there were no matches. Make sure the current position of the stream is at the beginning of the file, or you will get no results. Returns the stream to its original position </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">s</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="_image_upload_helper_8cs_source.html#l00203">203</a> of file <a class="el" href="_image_upload_helper_8cs_source.html">ImageUploadHelper.cs</a>.</p>

<p>Referenced by <a class="el" href="_image_upload_helper_8cs_source.html#l00090">ImageResizer.ImageUploadHelper.GetWhitelistedExtension()</a>.</p>
<div class="fragment"><div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;        {</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;            <span class="keywordflow">if</span> (!(s.CanRead &amp;&amp; s.CanSeek)) <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;Stream must be seekable in order to guess the file type&quot;</span>);</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            List&lt;FileSignature&gt; signatures = <span class="keyword">new</span> List&lt;FileSignature&gt;();</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            <span class="keywordflow">foreach</span> (var p <span class="keywordflow">in</span> c.<a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html#aa8cdada7d657ec3078e5d16310f198f7">Plugins</a>.GetAll&lt;<a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_file_signature_provider.html">IFileSignatureProvider</a>&gt;())</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                signatures.AddRange(p.GetSignatures());</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;            </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <span class="keywordflow">if</span> (signatures.Count == 0) <span class="keywordflow">return</span> null; <span class="comment">//No signatures to compare!!</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;            <span class="comment">//Sort by length, longest first</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;            signatures.Sort(delegate(<a class="code" href="class_image_resizer_1_1_plugins_1_1_file_signature.html">FileSignature</a> a, <a class="code" href="class_image_resizer_1_1_plugins_1_1_file_signature.html">FileSignature</a> b){</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                <span class="keywordflow">return</span> b.Signature.Length.CompareTo(a.Signature.Length);</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;            });</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;            <span class="comment">//Copy the longest signature we may need to compare</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            byte[] buffer = <span class="keyword">new</span> byte[signatures[0].Signature.Length];</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            <span class="keywordtype">int</span> bytesRead = s.Read(buffer,0,buffer.Length);</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            s.Seek(bytesRead, SeekOrigin.Current);</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;            <span class="keywordflow">foreach</span> (var sig <span class="keywordflow">in</span> signatures)</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                <span class="keywordflow">if</span> (bytesRead &lt; sig.Signature.Length) <span class="keywordflow">continue</span>; <span class="comment">//Signature longer than file</span></div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                <span class="keywordflow">if</span> (sig.Signature.Length &lt; 1) <span class="keywordflow">continue</span>; <span class="comment">//Empty signature</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                <span class="keywordtype">bool</span> matches = <span class="keyword">true</span>;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; sig.Signature.Length; i++){</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                    <span class="keywordflow">if</span> (sig.Signature[i] != buffer[i])</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                    {</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                        matches = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                        <span class="keywordflow">break</span>;</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                    }</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                }</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                <span class="keywordflow">if</span> (matches)</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                {</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                    <span class="keywordflow">return</span> sig;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                }</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            }</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;            <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;        }</div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_file_signature_html"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_file_signature.html">ImageResizer.Plugins.FileSignature</a></div><div class="ttdef"><b>Definition:</b> <a href="_file_signature_8cs_source.html#l00007">FileSignature.cs:7</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_configuration_1_1_config_html_aa8cdada7d657ec3078e5d16310f198f7"><div class="ttname"><a href="class_image_resizer_1_1_configuration_1_1_config.html#aa8cdada7d657ec3078e5d16310f198f7">ImageResizer.Configuration.Config.Plugins</a></div><div class="ttdeci">PluginConfig Plugins</div><div class="ttdoc">Access and modify plugins </div><div class="ttdef"><b>Definition:</b> <a href="_config_8cs_source.html#l00085">Config.cs:85</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_plugins_1_1_i_file_signature_provider_html"><div class="ttname"><a href="interface_image_resizer_1_1_plugins_1_1_i_file_signature_provider.html">ImageResizer.Plugins.IFileSignatureProvider</a></div><div class="ttdef"><b>Definition:</b> <a href="_i_file_signature_provider_8cs_source.html#l00007">IFileSignatureProvider.cs:7</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a4b2ecaba51b887d0cf7024977ee1b7e6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageResizer.ImageUploadHelper.IsExtensionWhitelisted </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>ext</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string[]&#160;</td>
          <td class="paramname"><em>whitelistedFormats</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns true if the given extension is whitelisted. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">ext</td><td></td></tr>
    <tr><td class="paramname">whitelistedFormats</td><td>You can provide your own whitelist of extensions if desired (new string[]{"jpg","png"}). This defaults to the extensions supported by the currently installed set of plugins.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="_image_upload_helper_8cs_source.html#l00068">68</a> of file <a class="el" href="_image_upload_helper_8cs_source.html">ImageUploadHelper.cs</a>.</p>

<p>Referenced by <a class="el" href="_image_upload_helper_8cs_source.html#l00090">ImageResizer.ImageUploadHelper.GetWhitelistedExtension()</a>.</p>
<div class="fragment"><div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        {</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;            <span class="keywordflow">if</span> (whitelistedFormats == null)</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                <span class="keywordflow">return</span> c.Pipeline.IsAcceptedImageType(<span class="stringliteral">&quot;.&quot;</span> + ext);</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;            <span class="keywordflow">else</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            {</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                <span class="keywordflow">foreach</span> (var f <span class="keywordflow">in</span> whitelistedFormats)</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                {</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                    <span class="keywordflow">if</span> (ext.Equals(f, StringComparison.OrdinalIgnoreCase)) <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                }</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            }</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="af9695f6355701f86e8590e32905e11d2"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">bool ImageResizer.ImageUploadHelper.IsUploadedFileAnImage </td>
          <td>(</td>
          <td class="paramtype">object&#160;</td>
          <td class="paramname"><em>uploadFile</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string[]&#160;</td>
          <td class="paramname"><em>whitelistedFormats</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns true if the uploaded file is identified as an image (looks for the image signature, falling back to the user-provided filename). </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">uploadFile</td><td>Must be an HttpPostedFile or another class with both FileName and InputStream members </td></tr>
    <tr><td class="paramname">whitelistedFormats</td><td>You can provide your own whitelist of extensions if desired (new string[]{"jpg","png"}). This defaults to the extensions supported by the currently installed set of plugins.</td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="_image_upload_helper_8cs_source.html#l00116">116</a> of file <a class="el" href="_image_upload_helper_8cs_source.html">ImageUploadHelper.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;        {</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            <span class="keywordflow">if</span> (uploadFile == null) <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;            PropertyInfo pname = uploadFile.GetType().GetProperty(<span class="stringliteral">&quot;FileName&quot;</span>, typeof(<span class="keywordtype">string</span>));</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            PropertyInfo pstream = uploadFile.GetType().GetProperty(<span class="stringliteral">&quot;InputStream&quot;</span>);</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            <span class="keywordflow">if</span> (pname != null &amp;&amp; pstream != null)</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                var path = pname.GetValue(uploadFile, null) as <span class="keywordtype">string</span>;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                var s = pstream.GetValue(uploadFile, null) as Stream;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;                <span class="keywordflow">if</span> (s == null &amp;&amp; path == null) <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;The given upload file has a null .InputStream and .FileName&quot;</span>);</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;                <span class="keywordflow">return</span> <a class="code" href="class_image_resizer_1_1_image_upload_helper.html#a9632203e72e0a67660171ba11133203d">GetWhitelistedExtension</a>(s, path, whitelistedFormats) != null;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            }</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">false</span>;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;        }</div>
<div class="ttc" id="class_image_resizer_1_1_image_upload_helper_html_a9632203e72e0a67660171ba11133203d"><div class="ttname"><a href="class_image_resizer_1_1_image_upload_helper.html#a9632203e72e0a67660171ba11133203d">ImageResizer.ImageUploadHelper.GetWhitelistedExtension</a></div><div class="ttdeci">string GetWhitelistedExtension(Stream image=null, string originalPath=null, string[] whitelistedFormats=null)</div><div class="ttdoc">Uses stream signatures first, then the original path, to detect the appropriate normalized image exte...</div><div class="ttdef"><b>Definition:</b> <a href="_image_upload_helper_8cs_source.html#l00090">ImageUploadHelper.cs:90</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="acca1b65183e8245775be323422a9b74e"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">string ImageResizer.ImageUploadHelper.NormalizeExtension </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>extension</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Lowercases and normalizes some common extension aliases (jpeg-&gt;jpg, tiff-tif). Does not filter out non-image extensions! </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">path</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="_image_upload_helper_8cs_source.html#l00042">42</a> of file <a class="el" href="_image_upload_helper_8cs_source.html">ImageUploadHelper.cs</a>.</p>

<p>Referenced by <a class="el" href="_image_upload_helper_8cs_source.html#l00090">ImageResizer.ImageUploadHelper.GetWhitelistedExtension()</a>.</p>
<div class="fragment"><div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;        {</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;            <span class="keywordflow">if</span> (extension == null) <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;            extension = extension.ToLowerInvariant();</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  </div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;            var mapping = <span class="keyword">new</span> Dictionary&lt;string,string&gt;{</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                {<span class="stringliteral">&quot;jpeg&quot;</span>,<span class="stringliteral">&quot;jpg&quot;</span>},</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                {<span class="stringliteral">&quot;jpe&quot;</span>,<span class="stringliteral">&quot;jpg&quot;</span>},</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                {<span class="stringliteral">&quot;jif&quot;</span>,<span class="stringliteral">&quot;jpg&quot;</span>},</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                {<span class="stringliteral">&quot;jfif&quot;</span>,<span class="stringliteral">&quot;jpg&quot;</span>},</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                {<span class="stringliteral">&quot;jfi&quot;</span>,<span class="stringliteral">&quot;jpg&quot;</span>},</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                {<span class="stringliteral">&quot;exif&quot;</span>,<span class="stringliteral">&quot;jpg&quot;</span>},</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                {<span class="stringliteral">&quot;tiff&quot;</span>,<span class="stringliteral">&quot;tif&quot;</span>},</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;                {<span class="stringliteral">&quot;tff&quot;</span>,<span class="stringliteral">&quot;tif&quot;</span>},</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            };</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;            <span class="keywordflow">return</span> mapping.ContainsKey(extension) ? mapping[extension] : extension;</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        }</div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="ad3b0068662b73fbef20b50d792f9a24b"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname">string ImageResizer.ImageUploadHelper.SaveUploadedFileSafely </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>baseDir</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">object&#160;</td>
          <td class="paramname"><em>uploadFile</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>unrecognizedImageExtension</em> = <code>&quot;.unknown&quot;</code>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string[]&#160;</td>
          <td class="paramname"><em>whitelistedFormats</em> = <code>null</code>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Returns the name used for the file, without any path information. Name will be in "guid.ext" form. Will create any intermediate directories required. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">baseDir</td><td></td></tr>
    <tr><td class="paramname">uploadFile</td><td></td></tr>
    <tr><td class="paramname">unrecognizedImageExtension</td><td></td></tr>
    <tr><td class="paramname">whitelistedFormats</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="_image_upload_helper_8cs_source.html#l00155">155</a> of file <a class="el" href="_image_upload_helper_8cs_source.html">ImageUploadHelper.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;        {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;            PropertyInfo pname = uploadFile.GetType().GetProperty(<span class="stringliteral">&quot;FileName&quot;</span>, typeof(<span class="keywordtype">string</span>));</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;            PropertyInfo pstream = uploadFile.GetType().GetProperty(<span class="stringliteral">&quot;InputStream&quot;</span>);</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            <span class="keywordflow">if</span> (pname == null || pstream == null) <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;uploadFile.InputStream and uploadFile.fileName are required. Ensure you are passing in an HttpPostedFile instance or similar&quot;</span>);</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;            </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            var uploadPath = pname.GetValue(uploadFile, null) as <span class="keywordtype">string</span>;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            var uploadStream = pstream.GetValue(uploadFile, null) as Stream;</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            var name = <a class="code" href="class_image_resizer_1_1_image_upload_helper.html#a63db738bc028d3bc3a829e409c7d7919">GenerateSafeImageName</a>(uploadStream, uploadPath, unrecognizedImageExtension, whitelistedFormats);</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;            var dir = PathUtils.MapPathIfAppRelative(baseDir);</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            var finalpath = Path.Combine(dir, name);</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <span class="keywordtype">string</span> dirName = Path.GetDirectoryName(finalpath);</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            <span class="keywordflow">if</span> (!Directory.Exists(dirName)) Directory.CreateDirectory(dirName);</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            <span class="keyword">using</span> (var fileStream = <span class="keyword">new</span> FileStream(finalpath, FileMode.Create))</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            {</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                ImageResizer.ExtensionMethods.StreamExtensions.CopyToStream(uploadStream, fileStream);</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                fileStream.Flush();</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            }</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            <span class="keywordflow">return</span> name;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;        }</div>
<div class="ttc" id="class_image_resizer_1_1_image_upload_helper_html_a63db738bc028d3bc3a829e409c7d7919"><div class="ttname"><a href="class_image_resizer_1_1_image_upload_helper.html#a63db738bc028d3bc3a829e409c7d7919">ImageResizer.ImageUploadHelper.GenerateSafeImageName</a></div><div class="ttdeci">string GenerateSafeImageName(Stream image=null, string originalPath=null, string unrecognizedImageExtension=&quot;.unknown&quot;, string[] whitelistedFormats=null)</div><div class="ttdoc">Generates a safe name for your image in the form &amp;quot;guid.ext&amp;quot;. Uses stream signatures first...</div><div class="ttdef"><b>Definition:</b> <a href="_image_upload_helper_8cs_source.html#l00188">ImageUploadHelper.cs:188</a></div></div>
</div><!-- fragment -->
</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>C:/Users/nathanael/Documents/resizer/Plugins/UploadHelper/<a class="el" href="_image_upload_helper_8cs_source.html">ImageUploadHelper.cs</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
