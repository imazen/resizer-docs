<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>ImageResizer: C:/Users/nathanael/Documents/resizer/Contrib/PdfRenderer/PdfRenderer/PdfRenderer.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="imageresizer-logo-00aec4.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.4.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_90b50c2f20916556cfbebf8e7729840d.html">Contrib</a></li><li class="navelem"><a class="el" href="dir_107c60ddc2a0f73234ae5ae6034f1770.html">PdfRenderer</a></li><li class="navelem"><a class="el" href="dir_edaf2809ddd543c19cb57d3df979c4d1.html">PdfRenderer</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">PdfRenderer.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">// Copyright (c) 2012 Jason Morse and Nathanael Jones</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="comment">//</span></div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="comment">// Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files </span></div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="comment">// (the &quot;Software&quot;), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, </span></div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="comment">// merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is </span></div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="comment">// furnished to do so, subject to the following conditions:</span></div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="comment">// </span></div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="comment">// The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</span></div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="comment">// </span></div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="comment">// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES </span></div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="comment">// OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE </span></div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="comment">// LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN </span></div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="comment">// CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span></div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;<span class="keyword">using</span> System;</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;<span class="keyword">using</span> System.Collections.Generic;</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;<span class="keyword">using</span> System.Diagnostics.CodeAnalysis;</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;<span class="keyword">using</span> System.Drawing;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;<span class="keyword">using</span> System.IO;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;<span class="keyword">using</span> System.Linq;</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;<span class="keyword">using</span> System.Reflection;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;<span class="keyword">using</span> System.Xml.Serialization;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;<span class="keyword">using</span> ImageResizer.Configuration;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;<span class="keyword">using</span> ImageResizer.Configuration.Issues;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;<span class="keyword">using</span> ImageResizer.Plugins.PdfRenderer.Ghostscript;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;<span class="keyword">using</span> ImageResizer.Resizing;</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;<span class="keyword">using</span> ImageResizer.Util;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;<span class="keyword">using</span> System.Collections.Specialized;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="keyword">using</span> System.Globalization;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="keyword">using</span> ImageResizer.ExtensionMethods;</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="keyword">namespace </span>ImageResizer.Plugins.PdfRenderer</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;{<span class="comment"></span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">    /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">    ///   Ghostscript image resizer decoder capable of rendering postscript-based files to bitmaps.</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">    /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html">   37</a></span>&#160;<span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html">PdfRendererPlugin</a> : <a class="code" href="class_image_resizer_1_1_resizing_1_1_builder_extension.html">BuilderExtension</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html">IPlugin</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_file_extension_plugin.html">IFileExtensionPlugin</a>, <a class="code" href="interface_image_resizer_1_1_configuration_1_1_issues_1_1_i_issue_provider.html">IIssueProvider</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_querystring_plugin.html">IQuerystringPlugin</a></div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;    {</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;        <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html">PdfRendererPlugin</a>() {</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;        }</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;<span class="preprocessor">        #region Fields</span></div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;        <span class="keyword">private</span> <span class="keyword">static</span> readonly <span class="keywordtype">string</span>[] _queryStringKeys = <span class="keyword">new</span>[]</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                                                            {</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                                                                <span class="stringliteral">&quot;graphicsbits&quot;</span>,</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;                                                                <span class="stringliteral">&quot;textbits&quot;</span>,</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;                                                                <span class="stringliteral">&quot;page&quot;</span>,</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;                                                                <span class="stringliteral">&quot;width&quot;</span>,</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;                                                                <span class="stringliteral">&quot;height&quot;</span>,</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;                                                                <span class="stringliteral">&quot;maxwidth&quot;</span>,</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;                                                                <span class="stringliteral">&quot;maxheight&quot;</span></div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;                                                            };</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;        <span class="keyword">private</span> <span class="keyword">static</span> readonly <span class="keywordtype">string</span>[] _supportedExtensions = <span class="keyword">new</span>[]</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;                                                                {</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;                                                                    <span class="stringliteral">&quot;.pdf&quot;</span></div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;                                                                };</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;        <span class="keyword">private</span> <span class="keyword">static</span> readonly XmlSerializer _pdfInfoSerializer = <span class="keyword">new</span> XmlSerializer(typeof(<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_pdf_info.html">PdfInfo</a>));</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">string</span> _pdfInfoPath = null;<span class="comment"></span></div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;<span class="comment">        ///</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;<span class="comment"></span>        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">string</span> PdfInfoPath {</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            <span class="keyword">get</span> {</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                <span class="keywordflow">if</span> (_pdfInfoPath == null)  _pdfInfoPath = GetPathInfoResource();</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                <span class="keywordflow">return</span> _pdfInfoPath;</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            }</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;        }</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="comment">//TODO: needs to be static, it&#39;s process-wide</span></div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;        <span class="keyword">private</span> readonly <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_engine.html">GhostscriptEngine</a> _engine = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_engine.html">GhostscriptEngine</a>();</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;        <span class="keyword">private</span> readonly <span class="keywordtype">int</span>[] _validAlphaBitValues = <span class="keyword">new</span>[] { 1, 2, 4 };</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;        <span class="keyword">private</span> <span class="keywordtype">int</span> _defaultHeight = 600;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;        <span class="keyword">private</span> <span class="keywordtype">int</span> _defaultWidth = 800;</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;        <span class="keyword">private</span> <span class="keywordtype">int</span> _maxHeight = 4000;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;        <span class="keyword">private</span> <span class="keywordtype">int</span> _maxWidth = 4000;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;<span class="preprocessor">        #endregion</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;<span class="preprocessor">        #region Properties</span></div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;<span class="preprocessor"></span><span class="comment"></span></div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;<span class="comment">        ///   Gets or sets maximum height in pixels for rendered output.</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;<span class="comment">        /// &lt;exception cref = &quot;ArgumentOutOfRangeException&quot;&gt;</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;<span class="comment">        ///   Value is less than or equal to zero.</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;<span class="comment">        /// &lt;/exception&gt;</span></div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">int</span> MaxHeight</div>
<div class="line"><a name="l00091"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#a3e0a14d0f153303aeb94fa7cefbda7b6">   91</a></span>&#160;        {</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <span class="keyword">get</span> { <span class="keywordflow">return</span> _maxHeight; }</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;            set {</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                <span class="keywordflow">if</span>(value &lt;= 0)<span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentOutOfRangeException(<span class="stringliteral">&quot;value&quot;</span>, <span class="stringliteral">&quot;Maximum height must be greater than zero.&quot;</span>);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                _maxHeight = value;</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;            }</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;        }</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;<span class="comment">        ///   Gets or sets maximum width in pixels for rendered output.</span></div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;<span class="comment">        /// &lt;exception cref = &quot;ArgumentOutOfRangeException&quot;&gt;</span></div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;<span class="comment">        ///   Value is less than or equal to zero.</span></div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;<span class="comment">        /// &lt;/exception&gt;</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">int</span> MaxWidth</div>
<div class="line"><a name="l00106"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#adb436cf5a09ea271abe2986ed0013c0a">  106</a></span>&#160;        {</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            <span class="keyword">get</span> { <span class="keywordflow">return</span> _maxWidth; }</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            set {</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                <span class="keywordflow">if</span>(value &lt;= 0) <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentOutOfRangeException(<span class="stringliteral">&quot;value&quot;</span>, <span class="stringliteral">&quot;Maximum width must be greater than zero.&quot;</span>);</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                _maxWidth = value;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;        }</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;<span class="comment">        ///   Gets or sets the default height in pixels for rendered output if neither height nor width are specified.</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;<span class="comment">        /// &lt;exception cref = &quot;ArgumentOutOfRangeException&quot;&gt;</span></div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;<span class="comment">        ///   Value is less than or equal to zero.</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;<span class="comment">        /// &lt;/exception&gt;</span></div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">int</span> DefaultHeight</div>
<div class="line"><a name="l00121"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#a3308f56524f45ec33bde65684d11e0b7">  121</a></span>&#160;        {</div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            <span class="keyword">get</span> { <span class="keywordflow">return</span> _defaultHeight; }</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;            set</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;            {</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                <span class="keywordflow">if</span>(value &lt;= 0) <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentOutOfRangeException(<span class="stringliteral">&quot;value&quot;</span>, <span class="stringliteral">&quot;Default height must be greater than zero.&quot;</span>);</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                _defaultHeight = value;</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;            }</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;        }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;<span class="comment">        ///   Gets or sets the default width in pixels for rendered output if neither height nor width are specified.</span></div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;<span class="comment">        /// &lt;exception cref = &quot;ArgumentOutOfRangeException&quot;&gt;</span></div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;<span class="comment">        ///   Value is less than or equal to zero.</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;<span class="comment">        /// &lt;/exception&gt;</span></div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;<span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">int</span> DefaultWidth</div>
<div class="line"><a name="l00137"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#a913522db4ae25035e112c209c1538358">  137</a></span>&#160;        {</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;            <span class="keyword">get</span> { <span class="keywordflow">return</span> _defaultWidth; }</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            set</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;            {</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                <span class="keywordflow">if</span>(value &lt;= 0) <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentOutOfRangeException(<span class="stringliteral">&quot;value&quot;</span>, <span class="stringliteral">&quot;Default width must be greater than zero.&quot;</span>);</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                _defaultWidth = value;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            }</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;        }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;<span class="preprocessor">        #endregion</span></div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;<span class="preprocessor"></span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;        [SuppressMessage(<span class="stringliteral">&quot;Microsoft.Reliability&quot;</span>, <span class="stringliteral">&quot;CA2000:Dispose objects before losing scope&quot;</span>, Justification = <span class="stringliteral">&quot;Need to retain stream for bitmap backing store.&quot;</span>)]</div>
<div class="line"><a name="l00149"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#add95f557ea1eddc179797697bf5a843a">  149</a></span>&#160;        <span class="keyword">public</span> <span class="keyword">override</span> Bitmap <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#add95f557ea1eddc179797697bf5a843a">DecodeStream</a>(Stream s, <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> settings, <span class="keywordtype">string</span> optionalPath)</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;        {</div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;            <span class="keywordflow">if</span>(<span class="keywordtype">string</span>.IsNullOrEmpty(optionalPath))</div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;            {</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;                <span class="keywordflow">if</span> (s.CanSeek) {</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                    <span class="comment">//Check the header instead if no filename is present.</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                    byte[] header = <span class="keyword">new</span> byte[4];</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                    s.Read(header, 0, 4);</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                    <span class="keywordtype">bool</span> isPdf = (header[0] == <span class="charliteral">&#39;%&#39;</span> &amp;&amp; header[1] == <span class="charliteral">&#39;P&#39;</span> &amp;&amp; header[2] == <span class="charliteral">&#39;D&#39;</span> &amp;&amp; header[3] == <span class="charliteral">&#39;F&#39;</span>);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                    s.Seek(-4, SeekOrigin.Current); <span class="comment">//Restore position.</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;                    <span class="keywordflow">if</span> (!isPdf) <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;                    <span class="keywordflow">return</span> null; <span class="comment">//It&#39;s not seekable, we can&#39;t check the header. </span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                }</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!_supportedExtensions.Contains(Path.GetExtension(optionalPath), StringComparer.OrdinalIgnoreCase))</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;            {</div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                <span class="comment">// Not a supported format</span></div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;            }</div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;            <span class="comment">// Do not allow decoding if Ghostscript there are issues with performing this decode</span></div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <a class="code" href="interface_image_resizer_1_1_configuration_1_1_issues_1_1_i_issue.html">IIssue</a>[] issues = GetIssues().ToArray();</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            <span class="keywordflow">if</span>(issues.Length &gt; 0)</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            {</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                <span class="keywordtype">string</span> message = string.Join(Environment.NewLine, issues.Select(x =&gt; x.Summary).ToArray());</div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                <span class="keywordflow">throw</span> <span class="keyword">new</span> InvalidOperationException(message);</div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            }</div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            <span class="comment">// Must write input stream to a temporary file for Ghostscript to process.</span></div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;            FileInfo tempInputPathInfo = <span class="keyword">new</span> FileInfo(Path.GetTempFileName());</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <span class="keywordflow">try</span></div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                <span class="keyword">using</span>(FileStream tempInputStream = tempInputPathInfo.Create())</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                {</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                    StreamExtensions.CopyToStream(s, tempInputStream);</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                }</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                <span class="comment">// Get information about the PDF such as page count and media boxes</span></div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                <span class="comment">// Although this creates a second trip to Ghostscript engine, it&#39;s not possible to generate a rendered image in exact  </span></div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                <span class="comment">// dimensions requested. Skipping this step will cause a rendered image, of some size, to be resized further.</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_pdf_info.html">PdfInfo</a> pdfInfo = GetPdfInfo(tempInputPathInfo.FullName);</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                <span class="comment">// Extract the requested page number from resize settings, or default to first page</span></div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                <span class="keywordtype">int</span> pageNumber = settings.GetValueOrDefault(<span class="stringliteral">&quot;page&quot;</span>, 1);</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                <span class="comment">// Try to get the page number from PDF info. If not available, abort. This is caused by</span></div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                <span class="comment">// requesting a page that does not exist.</span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_page_info.html">PageInfo</a> pageInfo = pdfInfo.Pages.SingleOrDefault(x =&gt; x.Number == pageNumber);</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;                <span class="keywordflow">if</span>(pageInfo == null)</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                    <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                }</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                <span class="comment">// We only support media box (as opposed to clip, bleed, art, etc.) If this is not available, abort.</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                <span class="keywordflow">if</span>(pageInfo.MediaBox == null)</div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;                    <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                }</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                <span class="comment">// Get the output size of the generated bitmap by applying the resize settings and media box.</span></div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                Size outputSize = (pageInfo.Rotate == -90 || pageInfo.Rotate == 90) ? </div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                    GetOutputSize(settings, pageInfo.MediaBox.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a7145aef3affc3244969cad8841359e3f">Height</a>,pageInfo.MediaBox.Width) </div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                    : GetOutputSize(settings, pageInfo.MediaBox.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a80001d573cec108c39e5376f6d854993">Width</a>, pageInfo.MediaBox.Height) ;</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;</div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                </div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                <span class="comment">// Create default Ghostscript settings and apply the resize settings.</span></div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_settings.html">GhostscriptSettings</a> ghostscriptSettings = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_settings.html">GhostscriptSettings</a></div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                                                          {</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                                                              GhostscriptArgument.NoPause,</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                                                              GhostscriptArgument.Quiet,</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                                                              GhostscriptArgument.Safer,</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;                                                              GhostscriptArgument.Batch,</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                                                              {GhostscriptArgument.OutputDevice, <span class="stringliteral">&quot;pngalpha&quot;</span>},</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                                                              {GhostscriptArgument.MaxBitmap, 24000000},</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                                                              {GhostscriptArgument.RenderingThreads, 4},</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                                                              {GhostscriptArgument.GridFitTT, 0},</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;                                                              {GhostscriptArgument.AlignToPixels, 0}, <span class="comment">//Subpixel rendering depends on output device... perhaps testing would help determine if 1 would be better?</span></div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                                                              {GhostscriptArgument.FirstPage, pageNumber},</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                                                              {GhostscriptArgument.LastPage, pageNumber},</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                                                              GhostscriptArgument.Printed,</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                                                              GhostscriptArgument.PdfFitPage, </div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                                                              GhostscriptArgument.FixedMedia,</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;                                                              {GhostscriptArgument.Height, outputSize.Height},</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;                                                              {GhostscriptArgument.Width, outputSize.Width}</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;                                                          };</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;                ApplyResizeSettings(settings, ghostscriptSettings);</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;</div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                <span class="comment">// Have Ghostscript process the input to a PNG file with transparency.</span></div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                <span class="comment">// The PNG will be reloaded and further processed by the resizer pipeline.</span></div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;                FileInfo tempOutputPathInfo = <span class="keyword">new</span> FileInfo(Path.GetTempFileName());</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;                <span class="keywordflow">try</span></div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;                {</div>
<div class="line"><a name="l00244"></a><span class="lineno">  244</span>&#160;                    <span class="comment">// Add output file and input file. The input file must be the very last argument.</span></div>
<div class="line"><a name="l00245"></a><span class="lineno">  245</span>&#160;                    ghostscriptSettings.Add(GhostscriptArgument.OutputFile, tempOutputPathInfo.FullName);</div>
<div class="line"><a name="l00246"></a><span class="lineno">  246</span>&#160;                    ghostscriptSettings.Add(tempInputPathInfo.FullName);</div>
<div class="line"><a name="l00247"></a><span class="lineno">  247</span>&#160;                    _engine.Execute(ghostscriptSettings);</div>
<div class="line"><a name="l00248"></a><span class="lineno">  248</span>&#160;</div>
<div class="line"><a name="l00249"></a><span class="lineno">  249</span>&#160;                    <span class="comment">// NOTE: Do not dispose of memory stream because it is used as the backing source for the loaded bitmap.</span></div>
<div class="line"><a name="l00250"></a><span class="lineno">  250</span>&#160;                    MemoryStream memoryStream = <span class="keyword">new</span> MemoryStream((<span class="keywordtype">int</span>)tempOutputPathInfo.Length);</div>
<div class="line"><a name="l00251"></a><span class="lineno">  251</span>&#160;                    <span class="keyword">using</span>(FileStream fileStream = tempOutputPathInfo.Open(FileMode.Open))</div>
<div class="line"><a name="l00252"></a><span class="lineno">  252</span>&#160;                    {</div>
<div class="line"><a name="l00253"></a><span class="lineno">  253</span>&#160;                        StreamExtensions.CopyToStream(fileStream, memoryStream);</div>
<div class="line"><a name="l00254"></a><span class="lineno">  254</span>&#160;                    }</div>
<div class="line"><a name="l00255"></a><span class="lineno">  255</span>&#160;</div>
<div class="line"><a name="l00256"></a><span class="lineno">  256</span>&#160;                    <span class="comment">// Per ImagerResizer plugin example source code:</span></div>
<div class="line"><a name="l00257"></a><span class="lineno">  257</span>&#160;                    <span class="comment">// NOTE: If the Bitmap class is used for decoding, read gdi-bugs.txt and make sure you set b.Tag to new BitmapTag(optionalPath,stream);</span></div>
<div class="line"><a name="l00258"></a><span class="lineno">  258</span>&#160;                    <a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a> bitmapTag = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a>(<span class="stringliteral">&quot;ghostscript.png&quot;</span>, memoryStream);</div>
<div class="line"><a name="l00259"></a><span class="lineno">  259</span>&#160;                    <span class="keywordflow">return</span> <span class="keyword">new</span> Bitmap(memoryStream) { Tag = bitmapTag };</div>
<div class="line"><a name="l00260"></a><span class="lineno">  260</span>&#160;                }</div>
<div class="line"><a name="l00261"></a><span class="lineno">  261</span>&#160;                <span class="comment">//catch(GhostscriptException)</span></div>
<div class="line"><a name="l00262"></a><span class="lineno">  262</span>&#160;                <span class="comment">//{</span></div>
<div class="line"><a name="l00263"></a><span class="lineno">  263</span>&#160;                <span class="comment">//    // Conversion failed</span></div>
<div class="line"><a name="l00264"></a><span class="lineno">  264</span>&#160;                <span class="comment">//    return null; //or maybe we should show details? If it&#39;s a valid PDF?</span></div>
<div class="line"><a name="l00265"></a><span class="lineno">  265</span>&#160;                <span class="comment">//}</span></div>
<div class="line"><a name="l00266"></a><span class="lineno">  266</span>&#160;                <span class="keywordflow">finally</span></div>
<div class="line"><a name="l00267"></a><span class="lineno">  267</span>&#160;                {</div>
<div class="line"><a name="l00268"></a><span class="lineno">  268</span>&#160;                    tempOutputPathInfo.Delete();</div>
<div class="line"><a name="l00269"></a><span class="lineno">  269</span>&#160;                }</div>
<div class="line"><a name="l00270"></a><span class="lineno">  270</span>&#160;            }</div>
<div class="line"><a name="l00271"></a><span class="lineno">  271</span>&#160;            <span class="keywordflow">finally</span></div>
<div class="line"><a name="l00272"></a><span class="lineno">  272</span>&#160;            {</div>
<div class="line"><a name="l00273"></a><span class="lineno">  273</span>&#160;                tempInputPathInfo.Delete();</div>
<div class="line"><a name="l00274"></a><span class="lineno">  274</span>&#160;            }</div>
<div class="line"><a name="l00275"></a><span class="lineno">  275</span>&#160;        }</div>
<div class="line"><a name="l00276"></a><span class="lineno">  276</span>&#160;</div>
<div class="line"><a name="l00277"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#aa2569d1c6271764ffb056c127d3d09b3">  277</a></span>&#160;        <span class="keyword">public</span> <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html">IPlugin</a> <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#aa2569d1c6271764ffb056c127d3d09b3">Install</a>(<a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html">Config</a> c)</div>
<div class="line"><a name="l00278"></a><span class="lineno">  278</span>&#160;        {</div>
<div class="line"><a name="l00279"></a><span class="lineno">  279</span>&#160;            <span class="keywordflow">if</span>(c != null)</div>
<div class="line"><a name="l00280"></a><span class="lineno">  280</span>&#160;            {</div>
<div class="line"><a name="l00281"></a><span class="lineno">  281</span>&#160;                c.Plugins.add_plugin(<span class="keyword">this</span>);</div>
<div class="line"><a name="l00282"></a><span class="lineno">  282</span>&#160;            }</div>
<div class="line"><a name="l00283"></a><span class="lineno">  283</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">this</span>;</div>
<div class="line"><a name="l00284"></a><span class="lineno">  284</span>&#160;        }</div>
<div class="line"><a name="l00285"></a><span class="lineno">  285</span>&#160;</div>
<div class="line"><a name="l00286"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#ae7ccd1ffbc42060c81c420d72e54c9c0">  286</a></span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#ae7ccd1ffbc42060c81c420d72e54c9c0">Uninstall</a>(<a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html">Config</a> c)</div>
<div class="line"><a name="l00287"></a><span class="lineno">  287</span>&#160;        {</div>
<div class="line"><a name="l00288"></a><span class="lineno">  288</span>&#160;            <span class="keywordflow">if</span>(c != null)</div>
<div class="line"><a name="l00289"></a><span class="lineno">  289</span>&#160;            {</div>
<div class="line"><a name="l00290"></a><span class="lineno">  290</span>&#160;                c.Plugins.remove_plugin(<span class="keyword">this</span>);</div>
<div class="line"><a name="l00291"></a><span class="lineno">  291</span>&#160;            }</div>
<div class="line"><a name="l00292"></a><span class="lineno">  292</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00293"></a><span class="lineno">  293</span>&#160;        }</div>
<div class="line"><a name="l00294"></a><span class="lineno">  294</span>&#160;</div>
<div class="line"><a name="l00295"></a><span class="lineno">  295</span>&#160;        <span class="keyword">public</span> IEnumerable&lt;IIssue&gt; GetIssues()</div>
<div class="line"><a name="l00296"></a><span class="lineno">  296</span>&#160;        {</div>
<div class="line"><a name="l00297"></a><span class="lineno">  297</span>&#160;            <span class="keywordflow">if</span>(!<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_engine.html">GhostscriptEngine</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_engine.html#a83de3dd4f3cdc4d440f97e2f56be35f4">IsAvailable</a>()) <span class="comment">//Cached inside Ghostscript engine. </span></div>
<div class="line"><a name="l00298"></a><span class="lineno">  298</span>&#160;            {</div>
<div class="line"><a name="l00299"></a><span class="lineno">  299</span>&#160;                <span class="keywordtype">string</span> message = <span class="stringliteral">&quot;Ghostscript native library for this platform not found: &quot;</span> + GhostscriptEngine.NativeFileName;</div>
<div class="line"><a name="l00300"></a><span class="lineno">  300</span>&#160;                <a class="code" href="class_image_resizer_1_1_configuration_1_1_issues_1_1_issue.html">Issue</a> issue = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_configuration_1_1_issues_1_1_issue.html">Issue</a>(message, <a class="code" href="namespace_image_resizer_1_1_configuration_1_1_issues.html#ada2af2a44c17c99a124cadb8a92f8555">IssueSeverity</a>.Error);</div>
<div class="line"><a name="l00301"></a><span class="lineno">  301</span>&#160;                <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="interface_image_resizer_1_1_configuration_1_1_issues_1_1_i_issue.html">IIssue</a>[] { issue };</div>
<div class="line"><a name="l00302"></a><span class="lineno">  302</span>&#160;            }</div>
<div class="line"><a name="l00303"></a><span class="lineno">  303</span>&#160;            <span class="keywordflow">return</span> Enumerable.Empty&lt;<a class="code" href="interface_image_resizer_1_1_configuration_1_1_issues_1_1_i_issue.html">IIssue</a>&gt;();</div>
<div class="line"><a name="l00304"></a><span class="lineno">  304</span>&#160;        }</div>
<div class="line"><a name="l00305"></a><span class="lineno">  305</span>&#160;</div>
<div class="line"><a name="l00306"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#a49f26a69e30e3714b2129a84bf928234">  306</a></span>&#160;        <span class="keyword">public</span> IEnumerable&lt;string&gt; <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#a49f26a69e30e3714b2129a84bf928234">GetSupportedFileExtensions</a>()</div>
<div class="line"><a name="l00307"></a><span class="lineno">  307</span>&#160;        {</div>
<div class="line"><a name="l00308"></a><span class="lineno">  308</span>&#160;            <span class="keywordflow">return</span> _supportedExtensions;</div>
<div class="line"><a name="l00309"></a><span class="lineno">  309</span>&#160;        }</div>
<div class="line"><a name="l00310"></a><span class="lineno">  310</span>&#160;</div>
<div class="line"><a name="l00311"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#ac8c0fd79fad67de2650585fff2ab453a">  311</a></span>&#160;        <span class="keyword">public</span> IEnumerable&lt;string&gt; <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#ac8c0fd79fad67de2650585fff2ab453a">GetSupportedQuerystringKeys</a>()</div>
<div class="line"><a name="l00312"></a><span class="lineno">  312</span>&#160;        {</div>
<div class="line"><a name="l00313"></a><span class="lineno">  313</span>&#160;            <span class="keywordflow">return</span> _queryStringKeys;</div>
<div class="line"><a name="l00314"></a><span class="lineno">  314</span>&#160;        }</div>
<div class="line"><a name="l00315"></a><span class="lineno">  315</span>&#160;</div>
<div class="line"><a name="l00316"></a><span class="lineno">  316</span>&#160;        <span class="keyword">private</span> Size GetOutputSize(<a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> settings, <span class="keywordtype">double</span> boundingWidth, <span class="keywordtype">double</span> boundingHeight)</div>
<div class="line"><a name="l00317"></a><span class="lineno">  317</span>&#160;        {</div>
<div class="line"><a name="l00318"></a><span class="lineno">  318</span>&#160;            <span class="comment">// Output size is determined by resize settings, if available.</span></div>
<div class="line"><a name="l00319"></a><span class="lineno">  319</span>&#160;            <span class="comment">//  maxwidth, maxheight </span></div>
<div class="line"><a name="l00320"></a><span class="lineno">  320</span>&#160;            <span class="comment">//      – Fit the image within the specified bounds, preserving aspect ratio.</span></div>
<div class="line"><a name="l00321"></a><span class="lineno">  321</span>&#160;            <span class="comment">//  width, height </span></div>
<div class="line"><a name="l00322"></a><span class="lineno">  322</span>&#160;            <span class="comment">//      – Force the final width and/or height to certain dimensions. </span></div>
<div class="line"><a name="l00323"></a><span class="lineno">  323</span>&#160;            <span class="comment">//        Whitespace will be added if the aspect ratio is different.</span></div>
<div class="line"><a name="l00324"></a><span class="lineno">  324</span>&#160;            <span class="comment">// This plugin renders to a size within the requested size and then expects remaining plugins in the </span></div>
<div class="line"><a name="l00325"></a><span class="lineno">  325</span>&#160;            <span class="comment">// pipeline to perform and additional processing such as adding whitespace, etc.</span></div>
<div class="line"><a name="l00326"></a><span class="lineno">  326</span>&#160;            <span class="comment">// It can safely treat width/height as maxwidth/maxheight.</span></div>
<div class="line"><a name="l00327"></a><span class="lineno">  327</span>&#160;</div>
<div class="line"><a name="l00328"></a><span class="lineno">  328</span>&#160;            <span class="keywordtype">double</span> imageRatio = boundingWidth / boundingHeight;</div>
<div class="line"><a name="l00329"></a><span class="lineno">  329</span>&#160;            <span class="keywordtype">double</span> width = settings.Width;</div>
<div class="line"><a name="l00330"></a><span class="lineno">  330</span>&#160;            <span class="keywordtype">double</span> height = settings.Height;</div>
<div class="line"><a name="l00331"></a><span class="lineno">  331</span>&#160;            <span class="keywordtype">double</span> maxwidth = settings.MaxWidth;</div>
<div class="line"><a name="l00332"></a><span class="lineno">  332</span>&#160;            <span class="keywordtype">double</span> maxheight = settings.MaxHeight;</div>
<div class="line"><a name="l00333"></a><span class="lineno">  333</span>&#160;</div>
<div class="line"><a name="l00334"></a><span class="lineno">  334</span>&#160;            <span class="comment">//Allow overrides with pdfwidth and pdfheight when we *want* to rescale afterwards.</span></div>
<div class="line"><a name="l00335"></a><span class="lineno">  335</span>&#160;            <span class="keywordtype">int</span> pw = settings.Get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;pdfwidth&quot;</span>, -1);</div>
<div class="line"><a name="l00336"></a><span class="lineno">  336</span>&#160;            <span class="keywordtype">int</span> ph = settings.Get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;pdfheight&quot;</span>, -1);</div>
<div class="line"><a name="l00337"></a><span class="lineno">  337</span>&#160;            <span class="keywordflow">if</span> (pw &gt; 0) { width = pw; maxwidth = -1;}</div>
<div class="line"><a name="l00338"></a><span class="lineno">  338</span>&#160;            <span class="keywordflow">if</span> (ph &gt; 0) { height = ph; maxheight = -1; }</div>
<div class="line"><a name="l00339"></a><span class="lineno">  339</span>&#160;</div>
<div class="line"><a name="l00340"></a><span class="lineno">  340</span>&#160;            <span class="comment">//Handle cases of width/maxheight and height/maxwidth as in legacy versions. </span></div>
<div class="line"><a name="l00341"></a><span class="lineno">  341</span>&#160;            <span class="keywordflow">if</span> (width != -1 &amp;&amp; maxheight != -1) maxheight = Math.Min(maxheight, (width / imageRatio));</div>
<div class="line"><a name="l00342"></a><span class="lineno">  342</span>&#160;            <span class="keywordflow">if</span> (height != -1 &amp;&amp; maxwidth != -1) maxwidth = Math.Min(maxwidth, (height * imageRatio));</div>
<div class="line"><a name="l00343"></a><span class="lineno">  343</span>&#160;</div>
<div class="line"><a name="l00344"></a><span class="lineno">  344</span>&#160;            <span class="comment">//Eliminate cases where both a value and a max value are specified: use the smaller value for the width/height </span></div>
<div class="line"><a name="l00345"></a><span class="lineno">  345</span>&#160;            <span class="keywordflow">if</span> (maxwidth &gt; 0 &amp;&amp; width &gt; 0) { width = Math.Min(maxwidth, width); maxwidth = -1; }</div>
<div class="line"><a name="l00346"></a><span class="lineno">  346</span>&#160;            <span class="keywordflow">if</span> (maxheight &gt; 0 &amp;&amp; height &gt; 0) { height = Math.Min(maxheight, height); maxheight = -1; }</div>
<div class="line"><a name="l00347"></a><span class="lineno">  347</span>&#160;</div>
<div class="line"><a name="l00348"></a><span class="lineno">  348</span>&#160;            <span class="comment">//Move values to width/height</span></div>
<div class="line"><a name="l00349"></a><span class="lineno">  349</span>&#160;            <span class="keywordflow">if</span> (width &lt;= 0) width = maxwidth;</div>
<div class="line"><a name="l00350"></a><span class="lineno">  350</span>&#160;            <span class="keywordflow">if</span> (height &lt;= 0) height = maxheight;</div>
<div class="line"><a name="l00351"></a><span class="lineno">  351</span>&#160;</div>
<div class="line"><a name="l00352"></a><span class="lineno">  352</span>&#160;            <span class="comment">//Calculate missing value(s) </span></div>
<div class="line"><a name="l00353"></a><span class="lineno">  353</span>&#160;            <span class="keywordflow">if</span> (width &gt; 0 &amp;&amp; height &lt;= 0) height = width / imageRatio;</div>
<div class="line"><a name="l00354"></a><span class="lineno">  354</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> (height &gt; 0 &amp;&amp; width &lt;= 0) width = height * imageRatio;</div>
<div class="line"><a name="l00355"></a><span class="lineno">  355</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span>(width &lt;= 0 &amp;&amp; height &lt;= 0) { <span class="comment">// If neither width nor height as specified use default values</span></div>
<div class="line"><a name="l00356"></a><span class="lineno">  356</span>&#160;                width = DefaultWidth;</div>
<div class="line"><a name="l00357"></a><span class="lineno">  357</span>&#160;                height = DefaultHeight;</div>
<div class="line"><a name="l00358"></a><span class="lineno">  358</span>&#160;            }</div>
<div class="line"><a name="l00359"></a><span class="lineno">  359</span>&#160;</div>
<div class="line"><a name="l00360"></a><span class="lineno">  360</span>&#160;            <span class="comment">// Limit maximum output size</span></div>
<div class="line"><a name="l00361"></a><span class="lineno">  361</span>&#160;            width = Math.Min(width, this.MaxWidth);</div>
<div class="line"><a name="l00362"></a><span class="lineno">  362</span>&#160;            height = Math.Min(height, this.MaxHeight);</div>
<div class="line"><a name="l00363"></a><span class="lineno">  363</span>&#160;</div>
<div class="line"><a name="l00364"></a><span class="lineno">  364</span>&#160;            </div>
<div class="line"><a name="l00365"></a><span class="lineno">  365</span>&#160;            <span class="comment">// Determine the scaling values, and use the smallest to ensure we fit in the bounding box without changing </span></div>
<div class="line"><a name="l00366"></a><span class="lineno">  366</span>&#160;            <span class="comment">// the aspect ratio otherwise we will crop.</span></div>
<div class="line"><a name="l00367"></a><span class="lineno">  367</span>&#160;            <span class="comment">//Use a scaled version of boundingBox inside our maximum width and height constraints.</span></div>
<div class="line"><a name="l00368"></a><span class="lineno">  368</span>&#160;            <span class="keywordflow">return</span> PolygonMath.RoundPoints(PolygonMath.ScaleInside(<span class="keyword">new</span> SizeF((<span class="keywordtype">float</span>)boundingWidth, (<span class="keywordtype">float</span>)boundingHeight), <span class="keyword">new</span> SizeF((<span class="keywordtype">float</span>)width, (<span class="keywordtype">float</span>)height)));</div>
<div class="line"><a name="l00369"></a><span class="lineno">  369</span>&#160;        }</div>
<div class="line"><a name="l00370"></a><span class="lineno">  370</span>&#160;</div>
<div class="line"><a name="l00371"></a><span class="lineno">  371</span>&#160;        <span class="keyword">private</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_pdf_info.html">PdfInfo</a> GetPdfInfo(<span class="keywordtype">string</span> path)</div>
<div class="line"><a name="l00372"></a><span class="lineno">  372</span>&#160;        {</div>
<div class="line"><a name="l00373"></a><span class="lineno">  373</span>&#160;            <span class="keywordtype">string</span> output;</div>
<div class="line"><a name="l00374"></a><span class="lineno">  374</span>&#160;            <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_settings.html">GhostscriptSettings</a> settings = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_settings.html">GhostscriptSettings</a></div>
<div class="line"><a name="l00375"></a><span class="lineno">  375</span>&#160;                                           {</div>
<div class="line"><a name="l00376"></a><span class="lineno">  376</span>&#160;                                               GhostscriptArgument.NoDisplay,</div>
<div class="line"><a name="l00377"></a><span class="lineno">  377</span>&#160;                                               GhostscriptArgument.Quiet,</div>
<div class="line"><a name="l00378"></a><span class="lineno">  378</span>&#160;                                               {GhostscriptArgument.File, path},</div>
<div class="line"><a name="l00379"></a><span class="lineno">  379</span>&#160;                                               PdfInfoPath</div>
<div class="line"><a name="l00380"></a><span class="lineno">  380</span>&#160;                                           };</div>
<div class="line"><a name="l00381"></a><span class="lineno">  381</span>&#160;            output = _engine.Execute(settings);</div>
<div class="line"><a name="l00382"></a><span class="lineno">  382</span>&#160;</div>
<div class="line"><a name="l00383"></a><span class="lineno">  383</span>&#160;            <span class="comment">// Deserialize PDF info output from XML</span></div>
<div class="line"><a name="l00384"></a><span class="lineno">  384</span>&#160;            <span class="keyword">using</span>(StringReader outputReader = <span class="keyword">new</span> StringReader(output))</div>
<div class="line"><a name="l00385"></a><span class="lineno">  385</span>&#160;            {</div>
<div class="line"><a name="l00386"></a><span class="lineno">  386</span>&#160;                <span class="keywordflow">return</span> (<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_pdf_info.html">PdfInfo</a>)_pdfInfoSerializer.Deserialize(outputReader);</div>
<div class="line"><a name="l00387"></a><span class="lineno">  387</span>&#160;            }</div>
<div class="line"><a name="l00388"></a><span class="lineno">  388</span>&#160;        }</div>
<div class="line"><a name="l00389"></a><span class="lineno">  389</span>&#160;</div>
<div class="line"><a name="l00390"></a><span class="lineno">  390</span>&#160;        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">string</span> GetPathInfoResource()</div>
<div class="line"><a name="l00391"></a><span class="lineno">  391</span>&#160;        {</div>
<div class="line"><a name="l00392"></a><span class="lineno">  392</span>&#160;            <span class="comment">// TODO: Temp file is not deleted</span></div>
<div class="line"><a name="l00393"></a><span class="lineno">  393</span>&#160;</div>
<div class="line"><a name="l00394"></a><span class="lineno">  394</span>&#160;            <span class="comment">// Extract pdfInfo.ps file from embedded resource for when getting PDF information</span></div>
<div class="line"><a name="l00395"></a><span class="lineno">  395</span>&#160;            Assembly assembly = Assembly.GetExecutingAssembly();</div>
<div class="line"><a name="l00396"></a><span class="lineno">  396</span>&#160;            <span class="keywordtype">string</span> resourceName = assembly.GetManifestResourceNames().Single(x =&gt; x.EndsWith(<span class="stringliteral">&quot;pdfInfo.ps&quot;</span>, StringComparison.OrdinalIgnoreCase));</div>
<div class="line"><a name="l00397"></a><span class="lineno">  397</span>&#160;</div>
<div class="line"><a name="l00398"></a><span class="lineno">  398</span>&#160;            <span class="keywordtype">string</span> pdfInfoCommand;</div>
<div class="line"><a name="l00399"></a><span class="lineno">  399</span>&#160;            <span class="keyword">using</span>(StreamReader reader = <span class="keyword">new</span> StreamReader(assembly.GetManifestResourceStream(resourceName)))</div>
<div class="line"><a name="l00400"></a><span class="lineno">  400</span>&#160;            {</div>
<div class="line"><a name="l00401"></a><span class="lineno">  401</span>&#160;                pdfInfoCommand = reader.ReadToEnd();</div>
<div class="line"><a name="l00402"></a><span class="lineno">  402</span>&#160;            }</div>
<div class="line"><a name="l00403"></a><span class="lineno">  403</span>&#160;</div>
<div class="line"><a name="l00404"></a><span class="lineno">  404</span>&#160;            <span class="keywordtype">string</span> path = Path.GetTempFileName();</div>
<div class="line"><a name="l00405"></a><span class="lineno">  405</span>&#160;            File.WriteAllText(path, pdfInfoCommand);</div>
<div class="line"><a name="l00406"></a><span class="lineno">  406</span>&#160;            <span class="keywordflow">return</span> path;</div>
<div class="line"><a name="l00407"></a><span class="lineno">  407</span>&#160;        }</div>
<div class="line"><a name="l00408"></a><span class="lineno">  408</span>&#160;</div>
<div class="line"><a name="l00409"></a><span class="lineno">  409</span>&#160;        <span class="keyword">private</span> <span class="keywordtype">void</span> ApplyResizeSettings(ResizeSettings settings, <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_settings.html">GhostscriptSettings</a> ghostscriptSettings)</div>
<div class="line"><a name="l00410"></a><span class="lineno">  410</span>&#160;        {</div>
<div class="line"><a name="l00411"></a><span class="lineno">  411</span>&#160;            <span class="comment">// Parse resize settings</span></div>
<div class="line"><a name="l00412"></a><span class="lineno">  412</span>&#160;</div>
<div class="line"><a name="l00413"></a><span class="lineno">  413</span>&#160;            <span class="comment">// - graphicsAlphaBits</span></div>
<div class="line"><a name="l00414"></a><span class="lineno">  414</span>&#160;            <span class="keywordtype">int</span> graphicsAlphaBits = settings.GetValueOrDefault(<span class="stringliteral">&quot;graphicsbits&quot;</span>, 0);</div>
<div class="line"><a name="l00415"></a><span class="lineno">  415</span>&#160;            <span class="keywordflow">if</span>(!_validAlphaBitValues.Contains(graphicsAlphaBits))</div>
<div class="line"><a name="l00416"></a><span class="lineno">  416</span>&#160;            {</div>
<div class="line"><a name="l00417"></a><span class="lineno">  417</span>&#160;                <span class="comment">// Use default value</span></div>
<div class="line"><a name="l00418"></a><span class="lineno">  418</span>&#160;                graphicsAlphaBits = _validAlphaBitValues.Last();</div>
<div class="line"><a name="l00419"></a><span class="lineno">  419</span>&#160;            }</div>
<div class="line"><a name="l00420"></a><span class="lineno">  420</span>&#160;            ghostscriptSettings.Add(GhostscriptArgument.GraphicsAlphaBits, graphicsAlphaBits);</div>
<div class="line"><a name="l00421"></a><span class="lineno">  421</span>&#160;</div>
<div class="line"><a name="l00422"></a><span class="lineno">  422</span>&#160;            <span class="comment">// - textAlphaBits</span></div>
<div class="line"><a name="l00423"></a><span class="lineno">  423</span>&#160;            <span class="keywordtype">int</span> textAlphaBits = settings.GetValueOrDefault(<span class="stringliteral">&quot;textbits&quot;</span>, 0);</div>
<div class="line"><a name="l00424"></a><span class="lineno">  424</span>&#160;            <span class="keywordflow">if</span>(!_validAlphaBitValues.Contains(textAlphaBits))</div>
<div class="line"><a name="l00425"></a><span class="lineno">  425</span>&#160;            {</div>
<div class="line"><a name="l00426"></a><span class="lineno">  426</span>&#160;                <span class="comment">// Use default value</span></div>
<div class="line"><a name="l00427"></a><span class="lineno">  427</span>&#160;                textAlphaBits = _validAlphaBitValues.Last();</div>
<div class="line"><a name="l00428"></a><span class="lineno">  428</span>&#160;            }</div>
<div class="line"><a name="l00429"></a><span class="lineno">  429</span>&#160;            ghostscriptSettings.Add(GhostscriptArgument.TextAlphaBits, textAlphaBits);</div>
<div class="line"><a name="l00430"></a><span class="lineno">  430</span>&#160;</div>
<div class="line"><a name="l00431"></a><span class="lineno">  431</span>&#160;            ghostscriptSettings[GhostscriptArgument.GridFitTT] = (settings.Get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;gridfit&quot;</span>) == <span class="keyword">true</span> ? 2 : 0).ToString(NumberFormatInfo.InvariantInfo);</div>
<div class="line"><a name="l00432"></a><span class="lineno">  432</span>&#160;            ghostscriptSettings[GhostscriptArgument.AlignToPixels] = (settings.Get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;subpixels&quot;</span>) == <span class="keyword">true</span> ? 1 : 0).ToString(NumberFormatInfo.InvariantInfo);</div>
<div class="line"><a name="l00433"></a><span class="lineno">  433</span>&#160;            <span class="keywordflow">if</span> (settings.Get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;printed&quot;</span>,<span class="keyword">true</span>) == <span class="keyword">false</span>) ghostscriptSettings.Remove(<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#a3efbdbce6f8ff1626824fec3099c42b4">Printed</a>);</div>
<div class="line"><a name="l00434"></a><span class="lineno">  434</span>&#160;        }</div>
<div class="line"><a name="l00435"></a><span class="lineno">  435</span>&#160;    }</div>
<div class="line"><a name="l00436"></a><span class="lineno">  436</span>&#160;}</div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_page_info_html"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_page_info.html">ImageResizer.Plugins.PdfRenderer.Ghostscript.PageInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="_page_info_8cs_source.html#l00019">PageInfo.cs:19</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin_html_ae7ccd1ffbc42060c81c420d72e54c9c0"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#ae7ccd1ffbc42060c81c420d72e54c9c0">ImageResizer.Plugins.PdfRenderer.PdfRendererPlugin.Uninstall</a></div><div class="ttdeci">bool Uninstall(Config c)</div><div class="ttdoc">Uninstalls the plugin. Should reverse all changes made during Install </div><div class="ttdef"><b>Definition:</b> <a href="_pdf_renderer_8cs_source.html#l00286">PdfRenderer.cs:286</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_engine_html"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_engine.html">ImageResizer.Plugins.PdfRenderer.Ghostscript.GhostscriptEngine</a></div><div class="ttdoc">Provides a managed interface to Ghostscript API. </div><div class="ttdef"><b>Definition:</b> <a href="_ghostscript_engine_8cs_source.html#l00029">GhostscriptEngine.cs:29</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_configuration_1_1_config_html"><div class="ttname"><a href="class_image_resizer_1_1_configuration_1_1_config.html">ImageResizer.Configuration.Config</a></div><div class="ttdef"><b>Definition:</b> <a href="_config_8cs_source.html#l00022">Config.cs:22</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_configuration_1_1_issues_1_1_i_issue_provider_html"><div class="ttname"><a href="interface_image_resizer_1_1_configuration_1_1_issues_1_1_i_issue_provider.html">ImageResizer.Configuration.Issues.IIssueProvider</a></div><div class="ttdef"><b>Definition:</b> <a href="_i_issue_provider_8cs_source.html#l00007">IIssueProvider.cs:7</a></div></div>
<div class="ttc" id="namespace_image_resizer_1_1_configuration_1_1_issues_html_ada2af2a44c17c99a124cadb8a92f8555"><div class="ttname"><a href="namespace_image_resizer_1_1_configuration_1_1_issues.html#ada2af2a44c17c99a124cadb8a92f8555">ImageResizer.Configuration.Issues.IssueSeverity</a></div><div class="ttdeci">IssueSeverity</div><div class="ttdef"><b>Definition:</b> <a href="_issue_severity_8cs_source.html#l00007">IssueSeverity.cs:7</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_plugins_1_1_i_querystring_plugin_html"><div class="ttname"><a href="interface_image_resizer_1_1_plugins_1_1_i_querystring_plugin.html">ImageResizer.Plugins.IQuerystringPlugin</a></div><div class="ttdoc">For plugins that access the query string (important!) </div><div class="ttdef"><b>Definition:</b> <a href="_i_querystring_plugin_8cs_source.html#l00010">IQuerystringPlugin.cs:10</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html_a80001d573cec108c39e5376f6d854993"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html#a80001d573cec108c39e5376f6d854993">ImageResizer.ResizeSettings.Width</a></div><div class="ttdeci">int Width</div><div class="ttdoc">[&amp;quot;width&amp;quot;]: Sets the desired width of the image. (minus padding, borders, margins, effects, and rotation). The only instance the resulting image will be smaller is if the original source image is smaller. Set Scale=Both to upscale these images and ensure the output always matches &amp;#39;width&amp;#39; and &amp;#39;height&amp;#39;. If both width and height are specified, the image will be &amp;#39;letterboxed&amp;#39; to match the desired aspect ratio. Change the Mode property to adjust this behavior. </div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00066">ResizeSettings.cs:66</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_engine_html_a83de3dd4f3cdc4d440f97e2f56be35f4"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_engine.html#a83de3dd4f3cdc4d440f97e2f56be35f4">ImageResizer.Plugins.PdfRenderer.Ghostscript.GhostscriptEngine.IsAvailable</a></div><div class="ttdeci">static bool IsAvailable()</div><div class="ttdoc">Determines if the Ghostscript engine is available. </div><div class="ttdef"><b>Definition:</b> <a href="_ghostscript_engine_8cs_source.html#l00069">GhostscriptEngine.cs:69</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_plugins_1_1_i_file_extension_plugin_html"><div class="ttname"><a href="interface_image_resizer_1_1_plugins_1_1_i_file_extension_plugin.html">ImageResizer.Plugins.IFileExtensionPlugin</a></div><div class="ttdoc">For plugins that add support for new source file image extensions. </div><div class="ttdef"><b>Definition:</b> <a href="_i_file_extension_plugin_8cs_source.html#l00010">IFileExtensionPlugin.cs:10</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin_html_a49f26a69e30e3714b2129a84bf928234"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#a49f26a69e30e3714b2129a84bf928234">ImageResizer.Plugins.PdfRenderer.PdfRendererPlugin.GetSupportedFileExtensions</a></div><div class="ttdeci">IEnumerable&lt; string &gt; GetSupportedFileExtensions()</div><div class="ttdoc">If the plugin adds support for new file extensions (such as &amp;quot;psd&amp;quot;), they should be returned by this m...</div><div class="ttdef"><b>Definition:</b> <a href="_pdf_renderer_8cs_source.html#l00306">PdfRenderer.cs:306</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html">ImageResizer.ResizeSettings</a></div><div class="ttdoc">Represents the settings which will be used to process the image. Extends NameValueCollection to provi...</div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00020">ResizeSettings.cs:20</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_settings_html"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_settings.html">ImageResizer.Plugins.PdfRenderer.Ghostscript.GhostscriptSettings</a></div><div class="ttdoc">Ghostscript settings collection. </div><div class="ttdef"><b>Definition:</b> <a href="_ghostscript_settings_8cs_source.html#l00029">GhostscriptSettings.cs:29</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_configuration_1_1_issues_1_1_i_issue_html"><div class="ttname"><a href="interface_image_resizer_1_1_configuration_1_1_issues_1_1_i_issue.html">ImageResizer.Configuration.Issues.IIssue</a></div><div class="ttdef"><b>Definition:</b> <a href="_i_issue_8cs_source.html#l00007">IIssue.cs:7</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_configuration_1_1_issues_1_1_issue_html"><div class="ttname"><a href="class_image_resizer_1_1_configuration_1_1_issues_1_1_issue.html">ImageResizer.Configuration.Issues.Issue</a></div><div class="ttdef"><b>Definition:</b> <a href="_issue_8cs_source.html#l00007">Issue.cs:7</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_bitmap_tag_html"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">ImageResizer.Resizing.BitmapTag</a></div><div class="ttdef"><b>Definition:</b> <a href="_bitmap_tag_8cs_source.html#l00011">BitmapTag.cs:11</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_builder_extension_html"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_builder_extension.html">ImageResizer.Resizing.BuilderExtension</a></div><div class="ttdoc">Provides a useable base class that can be used to modify the behavior of ImageBuilder. When registered with an ImageBuilder instance, the ImageBuilder will call the corresponding methods on the extension prior to executing its own methods. </div><div class="ttdef"><b>Definition:</b> <a href="_builder_extension_8cs_source.html#l00011">BuilderExtension.cs:11</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin_html"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html">ImageResizer.Plugins.PdfRenderer.PdfRendererPlugin</a></div><div class="ttdoc">Ghostscript image resizer decoder capable of rendering postscript-based files to bitmaps. </div><div class="ttdef"><b>Definition:</b> <a href="_pdf_renderer_8cs_source.html#l00037">PdfRenderer.cs:37</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_plugins_1_1_i_plugin_html"><div class="ttname"><a href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html">ImageResizer.Plugins.IPlugin</a></div><div class="ttdoc">All plugins must implement this. Enables web.config addition and removal. </div><div class="ttdef"><b>Definition:</b> <a href="_i_plugin_8cs_source.html#l00011">IPlugin.cs:11</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument_html"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html">ImageResizer.Plugins.PdfRenderer.Ghostscript.GhostscriptArgument</a></div><div class="ttdoc">Ghostscript argument names </div><div class="ttdef"><b>Definition:</b> <a href="_ghostscript_argument_8cs_source.html#l00007">GhostscriptArgument.cs:7</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin_html_aa2569d1c6271764ffb056c127d3d09b3"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#aa2569d1c6271764ffb056c127d3d09b3">ImageResizer.Plugins.PdfRenderer.PdfRendererPlugin.Install</a></div><div class="ttdeci">IPlugin Install(Config c)</div><div class="ttdoc">Installs the plugin in the specified Config instance. The plugin must handle all the work of loading ...</div><div class="ttdef"><b>Definition:</b> <a href="_pdf_renderer_8cs_source.html#l00277">PdfRenderer.cs:277</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin_html_ac8c0fd79fad67de2650585fff2ab453a"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#ac8c0fd79fad67de2650585fff2ab453a">ImageResizer.Plugins.PdfRenderer.PdfRendererPlugin.GetSupportedQuerystringKeys</a></div><div class="ttdeci">IEnumerable&lt; string &gt; GetSupportedQuerystringKeys()</div><div class="ttdoc">If the plugin reads any values from the querystring, the names of the keys should be specified here...</div><div class="ttdef"><b>Definition:</b> <a href="_pdf_renderer_8cs_source.html#l00311">PdfRenderer.cs:311</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin_html_add95f557ea1eddc179797697bf5a843a"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#add95f557ea1eddc179797697bf5a843a">ImageResizer.Plugins.PdfRenderer.PdfRendererPlugin.DecodeStream</a></div><div class="ttdeci">override Bitmap DecodeStream(Stream s, ResizeSettings settings, string optionalPath)</div><div class="ttdoc">Extend this to support alternate image source formats. If the Bitmap class is used for decoding...</div><div class="ttdef"><b>Definition:</b> <a href="_pdf_renderer_8cs_source.html#l00149">PdfRenderer.cs:149</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument_html_a3efbdbce6f8ff1626824fec3099c42b4"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#a3efbdbce6f8ff1626824fec3099c42b4">ImageResizer.Plugins.PdfRenderer.Ghostscript.GhostscriptArgument.Printed</a></div><div class="ttdeci">const string Printed</div><div class="ttdoc">Determines whether the file should be displayed or printed using the &amp;quot;screen&amp;quot; or &amp;quot;printer&amp;quot; option...</div><div class="ttdef"><b>Definition:</b> <a href="_ghostscript_argument_8cs_source.html#l00197">GhostscriptArgument.cs:197</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_pdf_info_html"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_pdf_info.html">ImageResizer.Plugins.PdfRenderer.Ghostscript.PdfInfo</a></div><div class="ttdef"><b>Definition:</b> <a href="_pdf_info_8cs_source.html#l00024">PdfInfo.cs:24</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html_a7145aef3affc3244969cad8841359e3f"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html#a7145aef3affc3244969cad8841359e3f">ImageResizer.ResizeSettings.Height</a></div><div class="ttdeci">int Height</div><div class="ttdoc">[&amp;quot;height&amp;quot;]: Sets the desired height of the image. (minus padding, borders, margins, effects, and rotation) The only instance the resulting image will be smaller is if the original source image is smaller. Set Scale=Both to upscale these images and ensure the output always matches &amp;#39;width&amp;#39; and &amp;#39;height&amp;#39;. If both width and height are specified, the image will be &amp;#39;letterboxed&amp;#39; to match the desired aspect ratio. Change the Mode property to adjust this behavior. </div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00079">ResizeSettings.cs:79</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
