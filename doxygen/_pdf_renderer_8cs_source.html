<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ImageResizer: C:/Users/Administrator/Documents/resizer/Contrib/PdfRenderer/PdfRenderer/PdfRenderer.cs Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="imageresizer-logo-00aec4.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.3.3</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">C:/Users/Administrator/Documents/resizer/Contrib/PdfRenderer/PdfRenderer/PdfRenderer.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 ï»¿<span class="comment">// Copyright (c) 2012 Jason Morse and Nathanael Jones</span>
<a name="l00002"></a>00002 <span class="comment">//</span>
<a name="l00003"></a>00003 <span class="comment">// Permission is hereby granted, free of charge, to any person obtaining a copy of this software and associated documentation files </span>
<a name="l00004"></a>00004 <span class="comment">// (the &quot;Software&quot;), to deal in the Software without restriction, including without limitation the rights to use, copy, modify, </span>
<a name="l00005"></a>00005 <span class="comment">// merge, publish, distribute, sublicense, and/or sell copies of the Software, and to permit persons to whom the Software is </span>
<a name="l00006"></a>00006 <span class="comment">// furnished to do so, subject to the following conditions:</span>
<a name="l00007"></a>00007 <span class="comment">// </span>
<a name="l00008"></a>00008 <span class="comment">// The above copyright notice and this permission notice shall be included in all copies or substantial portions of the Software.</span>
<a name="l00009"></a>00009 <span class="comment">// </span>
<a name="l00010"></a>00010 <span class="comment">// THE SOFTWARE IS PROVIDED &quot;AS IS&quot;, WITHOUT WARRANTY OF ANY KIND, EXPRESS OR IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES </span>
<a name="l00011"></a>00011 <span class="comment">// OF MERCHANTABILITY, FITNESS FOR A PARTICULAR PURPOSE AND NONINFRINGEMENT. IN NO EVENT SHALL THE AUTHORS OR COPYRIGHT HOLDERS BE </span>
<a name="l00012"></a>00012 <span class="comment">// LIABLE FOR ANY CLAIM, DAMAGES OR OTHER LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING FROM, OUT OF OR IN </span>
<a name="l00013"></a>00013 <span class="comment">// CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS IN THE SOFTWARE.</span>
<a name="l00014"></a>00014 
<a name="l00015"></a>00015 <span class="keyword">using</span> System;
<a name="l00016"></a>00016 <span class="keyword">using</span> System.Collections.Generic;
<a name="l00017"></a>00017 <span class="keyword">using</span> System.Diagnostics.CodeAnalysis;
<a name="l00018"></a>00018 <span class="keyword">using</span> System.Drawing;
<a name="l00019"></a>00019 <span class="keyword">using</span> System.IO;
<a name="l00020"></a>00020 <span class="keyword">using</span> System.Linq;
<a name="l00021"></a>00021 <span class="keyword">using</span> System.Reflection;
<a name="l00022"></a>00022 <span class="keyword">using</span> System.Xml.Serialization;
<a name="l00023"></a>00023 <span class="keyword">using</span> ImageResizer.Configuration;
<a name="l00024"></a>00024 <span class="keyword">using</span> ImageResizer.Configuration.Issues;
<a name="l00025"></a>00025 <span class="keyword">using</span> ImageResizer.Plugins.PdfRenderer.Ghostscript;
<a name="l00026"></a>00026 <span class="keyword">using</span> ImageResizer.Resizing;
<a name="l00027"></a>00027 <span class="keyword">using</span> ImageResizer.Util;
<a name="l00028"></a>00028 <span class="keyword">using</span> System.Collections.Specialized;
<a name="l00029"></a>00029 <span class="keyword">using</span> System.Globalization;
<a name="l00030"></a>00030 <span class="keyword">using</span> ImageResizer.ExtensionMethods;
<a name="l00031"></a>00031 
<a name="l00032"></a>00032 <span class="keyword">namespace </span>ImageResizer.Plugins.PdfRenderer
<a name="l00033"></a>00033 {<span class="comment"></span>
<a name="l00034"></a>00034 <span class="comment">    /// &lt;summary&gt;</span>
<a name="l00035"></a>00035 <span class="comment">    ///   Ghostscript image resizer decoder capable of rendering postscript-based files to bitmaps.</span>
<a name="l00036"></a>00036 <span class="comment">    /// &lt;/summary&gt;</span>
<a name="l00037"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html">00037</a> <span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html" title="Ghostscript image resizer decoder capable of rendering postscript-based files to bitmaps.">PdfRendererPlugin</a> : <a class="code" href="class_image_resizer_1_1_resizing_1_1_builder_extension.html" title="Provides a useable base class that can be used to modify the behavior of ImageBuilder. When registered with an ImageBuilder instance, the ImageBuilder will call the corresponding methods on the extension prior to executing its own methods.">BuilderExtension</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html" title="All plugins must implement this. Enables web.config addition and removal.">IPlugin</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_file_extension_plugin.html" title="For plugins that add support for new source file image extensions.">IFileExtensionPlugin</a>, <a class="code" href="interface_image_resizer_1_1_configuration_1_1_issues_1_1_i_issue_provider.html">IIssueProvider</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_querystring_plugin.html" title="For plugins that access the query string (important!)">IQuerystringPlugin</a>
<a name="l00038"></a>00038     {
<a name="l00039"></a>00039 
<a name="l00040"></a>00040         <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html" title="Ghostscript image resizer decoder capable of rendering postscript-based files to bitmaps.">PdfRendererPlugin</a>() {
<a name="l00041"></a>00041         }
<a name="l00042"></a>00042 
<a name="l00043"></a>00043 <span class="preprocessor">        #region Fields</span>
<a name="l00044"></a>00044 <span class="preprocessor"></span>
<a name="l00045"></a>00045         <span class="keyword">private</span> <span class="keyword">static</span> readonly <span class="keywordtype">string</span>[] _queryStringKeys = <span class="keyword">new</span>[]
<a name="l00046"></a>00046                                                             {
<a name="l00047"></a>00047                                                                 <span class="stringliteral">&quot;graphicsbits&quot;</span>,
<a name="l00048"></a>00048                                                                 <span class="stringliteral">&quot;textbits&quot;</span>,
<a name="l00049"></a>00049                                                                 <span class="stringliteral">&quot;page&quot;</span>,
<a name="l00050"></a>00050                                                                 <span class="stringliteral">&quot;width&quot;</span>,
<a name="l00051"></a>00051                                                                 <span class="stringliteral">&quot;height&quot;</span>,
<a name="l00052"></a>00052                                                                 <span class="stringliteral">&quot;maxwidth&quot;</span>,
<a name="l00053"></a>00053                                                                 <span class="stringliteral">&quot;maxheight&quot;</span>
<a name="l00054"></a>00054                                                             };
<a name="l00055"></a>00055         <span class="keyword">private</span> <span class="keyword">static</span> readonly <span class="keywordtype">string</span>[] _supportedExtensions = <span class="keyword">new</span>[]
<a name="l00056"></a>00056                                                                 {
<a name="l00057"></a>00057                                                                     <span class="stringliteral">&quot;.pdf&quot;</span>
<a name="l00058"></a>00058                                                                 };
<a name="l00059"></a>00059         <span class="keyword">private</span> <span class="keyword">static</span> readonly XmlSerializer _pdfInfoSerializer = <span class="keyword">new</span> XmlSerializer(typeof(<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_pdf_info.html">PdfInfo</a>));
<a name="l00060"></a>00060         <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">string</span> _pdfInfoPath = null;<span class="comment"></span>
<a name="l00061"></a>00061 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00062"></a>00062 <span class="comment">        ///</span>
<a name="l00063"></a>00063 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00064"></a>00064 <span class="comment"></span>        <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">string</span> PdfInfoPath {
<a name="l00065"></a>00065             <span class="keyword">get</span> {
<a name="l00066"></a>00066                 <span class="keywordflow">if</span> (_pdfInfoPath == null)  _pdfInfoPath = GetPathInfoResource();
<a name="l00067"></a>00067                 <span class="keywordflow">return</span> _pdfInfoPath;
<a name="l00068"></a>00068             }
<a name="l00069"></a>00069         }
<a name="l00070"></a>00070 
<a name="l00071"></a>00071 
<a name="l00072"></a>00072         <span class="comment">//TODO: needs to be static, it&#39;s process-wide</span>
<a name="l00073"></a>00073         <span class="keyword">private</span> readonly <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_engine.html" title="Provides a managed interface to Ghostscript API.">GhostscriptEngine</a> _engine = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_engine.html" title="Provides a managed interface to Ghostscript API.">GhostscriptEngine</a>();
<a name="l00074"></a>00074         <span class="keyword">private</span> readonly <span class="keywordtype">int</span>[] _validAlphaBitValues = <span class="keyword">new</span>[] { 1, 2, 4 };
<a name="l00075"></a>00075         <span class="keyword">private</span> <span class="keywordtype">int</span> _defaultHeight = 600;
<a name="l00076"></a>00076         <span class="keyword">private</span> <span class="keywordtype">int</span> _defaultWidth = 800;
<a name="l00077"></a>00077         <span class="keyword">private</span> <span class="keywordtype">int</span> _maxHeight = 4000;
<a name="l00078"></a>00078         <span class="keyword">private</span> <span class="keywordtype">int</span> _maxWidth = 4000;
<a name="l00079"></a>00079 
<a name="l00080"></a>00080 <span class="preprocessor">        #endregion</span>
<a name="l00081"></a>00081 <span class="preprocessor"></span>
<a name="l00082"></a>00082 <span class="preprocessor">        #region Properties</span>
<a name="l00083"></a>00083 <span class="preprocessor"></span><span class="comment"></span>
<a name="l00084"></a>00084 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00085"></a>00085 <span class="comment">        ///   Gets or sets maximum height in pixels for rendered output.</span>
<a name="l00086"></a>00086 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00087"></a>00087 <span class="comment">        /// &lt;exception cref = &quot;ArgumentOutOfRangeException&quot;&gt;</span>
<a name="l00088"></a>00088 <span class="comment">        ///   Value is less than or equal to zero.</span>
<a name="l00089"></a>00089 <span class="comment">        /// &lt;/exception&gt;</span>
<a name="l00090"></a>00090 <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">int</span> MaxHeight
<a name="l00091"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#a3e0a14d0f153303aeb94fa7cefbda7b6">00091</a>         {
<a name="l00092"></a>00092             <span class="keyword">get</span> { <span class="keywordflow">return</span> _maxHeight; }
<a name="l00093"></a>00093             <span class="keyword">set</span> {
<a name="l00094"></a>00094                 <span class="keywordflow">if</span>(value &lt;= 0)<span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentOutOfRangeException(<span class="stringliteral">&quot;value&quot;</span>, <span class="stringliteral">&quot;Maximum height must be greater than zero.&quot;</span>);
<a name="l00095"></a>00095                 _maxHeight = value;
<a name="l00096"></a>00096             }
<a name="l00097"></a>00097         }
<a name="l00098"></a>00098 <span class="comment"></span>
<a name="l00099"></a>00099 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00100"></a>00100 <span class="comment">        ///   Gets or sets maximum width in pixels for rendered output.</span>
<a name="l00101"></a>00101 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00102"></a>00102 <span class="comment">        /// &lt;exception cref = &quot;ArgumentOutOfRangeException&quot;&gt;</span>
<a name="l00103"></a>00103 <span class="comment">        ///   Value is less than or equal to zero.</span>
<a name="l00104"></a>00104 <span class="comment">        /// &lt;/exception&gt;</span>
<a name="l00105"></a>00105 <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">int</span> MaxWidth
<a name="l00106"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#adb436cf5a09ea271abe2986ed0013c0a">00106</a>         {
<a name="l00107"></a>00107             <span class="keyword">get</span> { <span class="keywordflow">return</span> _maxWidth; }
<a name="l00108"></a>00108             <span class="keyword">set</span> {
<a name="l00109"></a>00109                 <span class="keywordflow">if</span>(value &lt;= 0) <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentOutOfRangeException(<span class="stringliteral">&quot;value&quot;</span>, <span class="stringliteral">&quot;Maximum width must be greater than zero.&quot;</span>);
<a name="l00110"></a>00110                 _maxWidth = value;
<a name="l00111"></a>00111             }
<a name="l00112"></a>00112         }
<a name="l00113"></a>00113 <span class="comment"></span>
<a name="l00114"></a>00114 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00115"></a>00115 <span class="comment">        ///   Gets or sets the default height in pixels for rendered output if neither height nor width are specified.</span>
<a name="l00116"></a>00116 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00117"></a>00117 <span class="comment">        /// &lt;exception cref = &quot;ArgumentOutOfRangeException&quot;&gt;</span>
<a name="l00118"></a>00118 <span class="comment">        ///   Value is less than or equal to zero.</span>
<a name="l00119"></a>00119 <span class="comment">        /// &lt;/exception&gt;</span>
<a name="l00120"></a>00120 <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">int</span> DefaultHeight
<a name="l00121"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#a3308f56524f45ec33bde65684d11e0b7">00121</a>         {
<a name="l00122"></a>00122             <span class="keyword">get</span> { <span class="keywordflow">return</span> _defaultHeight; }
<a name="l00123"></a>00123             <span class="keyword">set</span>
<a name="l00124"></a>00124             {
<a name="l00125"></a>00125                 <span class="keywordflow">if</span>(value &lt;= 0) <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentOutOfRangeException(<span class="stringliteral">&quot;value&quot;</span>, <span class="stringliteral">&quot;Default height must be greater than zero.&quot;</span>);
<a name="l00126"></a>00126                 _defaultHeight = value;
<a name="l00127"></a>00127             }
<a name="l00128"></a>00128         }
<a name="l00129"></a>00129 <span class="comment"></span>
<a name="l00130"></a>00130 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00131"></a>00131 <span class="comment">        ///   Gets or sets the default width in pixels for rendered output if neither height nor width are specified.</span>
<a name="l00132"></a>00132 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00133"></a>00133 <span class="comment">        /// &lt;exception cref = &quot;ArgumentOutOfRangeException&quot;&gt;</span>
<a name="l00134"></a>00134 <span class="comment">        ///   Value is less than or equal to zero.</span>
<a name="l00135"></a>00135 <span class="comment">        /// &lt;/exception&gt;</span>
<a name="l00136"></a>00136 <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">int</span> DefaultWidth
<a name="l00137"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#a913522db4ae25035e112c209c1538358">00137</a>         {
<a name="l00138"></a>00138             <span class="keyword">get</span> { <span class="keywordflow">return</span> _defaultWidth; }
<a name="l00139"></a>00139             <span class="keyword">set</span>
<a name="l00140"></a>00140             {
<a name="l00141"></a>00141                 <span class="keywordflow">if</span>(value &lt;= 0) <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentOutOfRangeException(<span class="stringliteral">&quot;value&quot;</span>, <span class="stringliteral">&quot;Default width must be greater than zero.&quot;</span>);
<a name="l00142"></a>00142                 _defaultWidth = value;
<a name="l00143"></a>00143             }
<a name="l00144"></a>00144         }
<a name="l00145"></a>00145 
<a name="l00146"></a>00146 <span class="preprocessor">        #endregion</span>
<a name="l00147"></a>00147 <span class="preprocessor"></span>
<a name="l00148"></a>00148         [SuppressMessage(<span class="stringliteral">&quot;Microsoft.Reliability&quot;</span>, <span class="stringliteral">&quot;CA2000:Dispose objects before losing scope&quot;</span>, Justification = <span class="stringliteral">&quot;Need to retain stream for bitmap backing store.&quot;</span>)]
<a name="l00149"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#add95f557ea1eddc179797697bf5a843a">00149</a>         <span class="keyword">public</span> <span class="keyword">override</span> Bitmap DecodeStream(Stream s, <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings, <span class="keywordtype">string</span> optionalPath)
<a name="l00150"></a>00150         {
<a name="l00151"></a>00151             <span class="keywordflow">if</span>(<span class="keywordtype">string</span>.IsNullOrEmpty(optionalPath))
<a name="l00152"></a>00152             {
<a name="l00153"></a>00153                 <span class="keywordflow">if</span> (s.CanSeek) {
<a name="l00154"></a>00154                     <span class="comment">//Check the header instead if no filename is present.</span>
<a name="l00155"></a>00155                     byte[] header = <span class="keyword">new</span> byte[4];
<a name="l00156"></a>00156                     s.Read(header, 0, 4);
<a name="l00157"></a>00157                     <span class="keywordtype">bool</span> isPdf = (header[0] == <span class="charliteral">&#39;%&#39;</span> &amp;&amp; header[1] == <span class="charliteral">&#39;P&#39;</span> &amp;&amp; header[2] == <span class="charliteral">&#39;D&#39;</span> &amp;&amp; header[3] == <span class="charliteral">&#39;F&#39;</span>);
<a name="l00158"></a>00158                     s.Seek(-4, SeekOrigin.Current); <span class="comment">//Restore position.</span>
<a name="l00159"></a>00159 
<a name="l00160"></a>00160                     <span class="keywordflow">if</span> (!isPdf) <span class="keywordflow">return</span> null;
<a name="l00161"></a>00161                 } <span class="keywordflow">else</span> {
<a name="l00162"></a>00162                     <span class="keywordflow">return</span> null; <span class="comment">//It&#39;s not seekable, we can&#39;t check the header. </span>
<a name="l00163"></a>00163                 }
<a name="l00164"></a>00164             } <span class="keywordflow">else</span> <span class="keywordflow">if</span>(!_supportedExtensions.Contains(Path.GetExtension(optionalPath), StringComparer.OrdinalIgnoreCase))
<a name="l00165"></a>00165             {
<a name="l00166"></a>00166                 <span class="comment">// Not a supported format</span>
<a name="l00167"></a>00167                 <span class="keywordflow">return</span> null;
<a name="l00168"></a>00168             }
<a name="l00169"></a>00169 
<a name="l00170"></a>00170             <span class="comment">// Do not allow decoding if Ghostscript there are issues with performing this decode</span>
<a name="l00171"></a>00171             <a class="code" href="interface_image_resizer_1_1_configuration_1_1_issues_1_1_i_issue.html">IIssue</a>[] issues = GetIssues().ToArray();
<a name="l00172"></a>00172             <span class="keywordflow">if</span>(issues.Length &gt; 0)
<a name="l00173"></a>00173             {
<a name="l00174"></a>00174                 <span class="keywordtype">string</span> message = <span class="keywordtype">string</span>.Join(Environment.NewLine, issues.Select(x =&gt; x.Summary).ToArray());
<a name="l00175"></a>00175                 <span class="keywordflow">throw</span> <span class="keyword">new</span> InvalidOperationException(message);
<a name="l00176"></a>00176             }
<a name="l00177"></a>00177 
<a name="l00178"></a>00178             <span class="comment">// Must write input stream to a temporary file for Ghostscript to process.</span>
<a name="l00179"></a>00179             FileInfo tempInputPathInfo = <span class="keyword">new</span> FileInfo(Path.GetTempFileName());
<a name="l00180"></a>00180             <span class="keywordflow">try</span>
<a name="l00181"></a>00181             {
<a name="l00182"></a>00182                 <span class="keyword">using</span>(FileStream tempInputStream = tempInputPathInfo.Create())
<a name="l00183"></a>00183                 {
<a name="l00184"></a>00184                     <a class="code" href="class_image_resizer_1_1_extension_methods_1_1_stream_extensions.html" title="Provides extension methods for copying streams.">StreamExtensions</a>.<a class="code" href="class_image_resizer_1_1_extension_methods_1_1_stream_extensions.html#a55239e9e68fb5bac89151a57e189d8de" title="Copies the remaining data from the this stream into the given stream.">CopyToStream</a>(s, tempInputStream);
<a name="l00185"></a>00185                 }
<a name="l00186"></a>00186 
<a name="l00187"></a>00187                 <span class="comment">// Get information about the PDF such as page count and media boxes</span>
<a name="l00188"></a>00188                 <span class="comment">// Although this creates a second trip to Ghostscript engine, it&#39;s not possible to generate a rendered image in exact  </span>
<a name="l00189"></a>00189                 <span class="comment">// dimensions requested. Skipping this step will cause a rendered image, of some size, to be resized further.</span>
<a name="l00190"></a>00190                 <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_pdf_info.html">PdfInfo</a> pdfInfo = GetPdfInfo(tempInputPathInfo.FullName);
<a name="l00191"></a>00191 
<a name="l00192"></a>00192                 <span class="comment">// Extract the requested page number from resize settings, or default to first page</span>
<a name="l00193"></a>00193                 <span class="keywordtype">int</span> pageNumber = settings.GetValueOrDefault(<span class="stringliteral">&quot;page&quot;</span>, 1);
<a name="l00194"></a>00194 
<a name="l00195"></a>00195                 <span class="comment">// Try to get the page number from PDF info. If not available, abort. This is caused by</span>
<a name="l00196"></a>00196                 <span class="comment">// requesting a page that does not exist.</span>
<a name="l00197"></a>00197                 <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_page_info.html">PageInfo</a> pageInfo = pdfInfo.Pages.SingleOrDefault(x =&gt; x.Number == pageNumber);
<a name="l00198"></a>00198                 <span class="keywordflow">if</span>(pageInfo == null)
<a name="l00199"></a>00199                 {
<a name="l00200"></a>00200                     <span class="keywordflow">return</span> null;
<a name="l00201"></a>00201                 }
<a name="l00202"></a>00202 
<a name="l00203"></a>00203                 <span class="comment">// We only support media box (as opposed to clip, bleed, art, etc.) If this is not available, abort.</span>
<a name="l00204"></a>00204                 <span class="keywordflow">if</span>(pageInfo.MediaBox == null)
<a name="l00205"></a>00205                 {
<a name="l00206"></a>00206                     <span class="keywordflow">return</span> null;
<a name="l00207"></a>00207                 }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209                 <span class="comment">// Get the output size of the generated bitmap by applying the resize settings and media box.</span>
<a name="l00210"></a>00210                 Size outputSize = (pageInfo.Rotate == -90 || pageInfo.Rotate == 90) ? 
<a name="l00211"></a>00211                     GetOutputSize(settings, pageInfo.MediaBox.Height,pageInfo.MediaBox.Width) 
<a name="l00212"></a>00212                     : GetOutputSize(settings, pageInfo.MediaBox.Width, pageInfo.MediaBox.Height) ;
<a name="l00213"></a>00213 
<a name="l00214"></a>00214 
<a name="l00215"></a>00215                 
<a name="l00216"></a>00216 
<a name="l00217"></a>00217                 <span class="comment">// Create default Ghostscript settings and apply the resize settings.</span>
<a name="l00218"></a>00218                 <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_settings.html" title="Ghostscript settings collection.">GhostscriptSettings</a> ghostscriptSettings = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_settings.html" title="Ghostscript settings collection.">GhostscriptSettings</a>
<a name="l00219"></a>00219                                                           {
<a name="l00220"></a>00220                                                               <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#af838dec1933dfcdd297f88ec9751d84c" title="Disables the prompt and pause at the end of each page. Normally one should use this (along with -dBAT...">NoPause</a>,
<a name="l00221"></a>00221                                                               <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#adfe61c50d0d840d9ce20c1695efdef61" title="Suppresses routine information comments on standard output. This is currently necessary when redirect...">Quiet</a>,
<a name="l00222"></a>00222                                                               <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#a135d1b12abf6c2274e2016162b6e5331" title="Disables the deletefile and renamefile operators, and the ability to open piped commands (pipecmd) at...">Safer</a>,
<a name="l00223"></a>00223                                                               <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#a6b3426dc1e170e1c68067e1c6c73fb8f" title="Causes Ghostscript to exit after processing all files named on the command line, rather than going in...">Batch</a>,
<a name="l00224"></a>00224                                                               {<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#a3ddc7bd98ef23e05bf173238be404f37" title="Output device.">OutputDevice</a>, <span class="stringliteral">&quot;pngalpha&quot;</span>},
<a name="l00225"></a>00225                                                               {<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#af8a09886fd1d199830ef57651e51bba7" title="If the amount of memory required to hold the pixmap for the window is no more than the value of MaxBi...">MaxBitmap</a>, 24000000},
<a name="l00226"></a>00226                                                               {<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#a5d0d8c925c98fa5ca6b6c6bacfd8671b" title="On a multi-core system where multiple threads can be dispatched to individual processors/cores, banding mode may provide higher performance since -dNumRenderingThreads=# can be used to take advantage of more than one CPU core when rendering the clist. The number of threads should generally be set to the number of available processor cores for best throughput.">RenderingThreads</a>, 4},
<a name="l00227"></a>00227                                                               {<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#abb987ef521c4109f80a0d46b3b3cae00" title="This specifies the initial value for the implementation specific user parameter GridFitTT. It controls grid fitting of True Type fonts (Sometimes referred to as &quot;hinting&quot;, but strictly speaking the latter is a feature of Type 1 fonts). Setting this to 2 enables automatic grid fitting for True Type glyphs. The value 0 disables grid fitting. The default value is 2. For more information see the description of the user parameter GridFitTT.">GridFitTT</a>, 0},
<a name="l00228"></a>00228                                                               {<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#a679496dcba0171da084d8f991ae50557" title="Chooses glyph alignment to integral pixel boundaries (if set to the value 1) or to subpixels (value 0...">AlignToPixels</a>, 0}, <span class="comment">//Subpixel rendering depends on output device... perhaps testing would help determine if 1 would be better?</span>
<a name="l00229"></a>00229                                                               {<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#abbf8cdd955e87ce065696b78d11c0f66" title="Begins interpreting on the designated page of the PDF document.">FirstPage</a>, pageNumber},
<a name="l00230"></a>00230                                                               {<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#a46bb1502a0bfdf2795c86ed82fc4b997" title="Stops interpreting on the designated page of the PDF document.">LastPage</a>, pageNumber},
<a name="l00231"></a>00231                                                               <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#a3efbdbce6f8ff1626824fec3099c42b4" title="Determines whether the file should be displayed or printed using the &quot;screen&quot; or &quot;printer&quot; option...">Printed</a>,
<a name="l00232"></a>00232                                                               <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#a65998ce86aa6d8ee8d1f06232bb0d504" title="Rather than selecting a PageSize given by the PDF MediaBox, TrimBox (see -dUseTrimBox), or CropBox (see -dUseCropBox), the PDF file will be scaled to fit the current device page size (usually the default page size). This is useful to avoid clipping information on a PDF document when sending to a printer that may have unprintable areas at the edge of the media larger than allowed for in the document. This is also useful for creating fixed size images of PDF files that may have a variety of page sizes, for example thumbnail images.">PdfFitPage</a>, 
<a name="l00233"></a>00233                                                               <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#a7f42528e12062c07074349d70fd35070" title="Causes the media size to be fixed after initialization, forcing pages of other sizes or orientations ...">FixedMedia</a>,
<a name="l00234"></a>00234                                                               {<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#ad131a407da4691f94c9b0ca3ddf20f5d" title="Specifies the output height in pixels.">Height</a>, outputSize.Height},
<a name="l00235"></a>00235                                                               {<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#afacefb5fa47da7073ce008a6263dc0cd" title="Specifies the output width in pixels.">Width</a>, outputSize.Width}
<a name="l00236"></a>00236                                                           };
<a name="l00237"></a>00237                 ApplyResizeSettings(settings, ghostscriptSettings);
<a name="l00238"></a>00238 
<a name="l00239"></a>00239                 <span class="comment">// Have Ghostscript process the input to a PNG file with transparency.</span>
<a name="l00240"></a>00240                 <span class="comment">// The PNG will be reloaded and further processed by the resizer pipeline.</span>
<a name="l00241"></a>00241                 FileInfo tempOutputPathInfo = <span class="keyword">new</span> FileInfo(Path.GetTempFileName());
<a name="l00242"></a>00242                 <span class="keywordflow">try</span>
<a name="l00243"></a>00243                 {
<a name="l00244"></a>00244                     <span class="comment">// Add output file and input file. The input file must be the very last argument.</span>
<a name="l00245"></a>00245                     ghostscriptSettings.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_settings.html#ad60176793e5097f7faa6b09eefbf0d2e" title="Adds an entry with the specified name and string representation of the value to the GhostscriptSettin...">Add</a>(<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#a7dfb7bf7a35bbb99c7a501244a0a7889" title="Output file path.">OutputFile</a>, tempOutputPathInfo.FullName);
<a name="l00246"></a>00246                     ghostscriptSettings.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_settings.html#ad60176793e5097f7faa6b09eefbf0d2e" title="Adds an entry with the specified name and string representation of the value to the GhostscriptSettin...">Add</a>(tempInputPathInfo.FullName);
<a name="l00247"></a>00247                     _engine.Execute(ghostscriptSettings);
<a name="l00248"></a>00248 
<a name="l00249"></a>00249                     <span class="comment">// NOTE: Do not dispose of memory stream because it is used as the backing source for the loaded bitmap.</span>
<a name="l00250"></a>00250                     MemoryStream memoryStream = <span class="keyword">new</span> MemoryStream((<span class="keywordtype">int</span>)tempOutputPathInfo.Length);
<a name="l00251"></a>00251                     <span class="keyword">using</span>(FileStream fileStream = tempOutputPathInfo.Open(FileMode.Open))
<a name="l00252"></a>00252                     {
<a name="l00253"></a>00253                         <a class="code" href="class_image_resizer_1_1_extension_methods_1_1_stream_extensions.html" title="Provides extension methods for copying streams.">StreamExtensions</a>.<a class="code" href="class_image_resizer_1_1_extension_methods_1_1_stream_extensions.html#a55239e9e68fb5bac89151a57e189d8de" title="Copies the remaining data from the this stream into the given stream.">CopyToStream</a>(fileStream, memoryStream);
<a name="l00254"></a>00254                     }
<a name="l00255"></a>00255 
<a name="l00256"></a>00256                     <span class="comment">// Per ImagerResizer plugin example source code:</span>
<a name="l00257"></a>00257                     <span class="comment">// NOTE: If the Bitmap class is used for decoding, read gdi-bugs.txt and make sure you set b.Tag to new BitmapTag(optionalPath,stream);</span>
<a name="l00258"></a>00258                     <a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a> bitmapTag = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_resizing_1_1_bitmap_tag.html">BitmapTag</a>(<span class="stringliteral">&quot;ghostscript.png&quot;</span>, memoryStream);
<a name="l00259"></a>00259                     <span class="keywordflow">return</span> <span class="keyword">new</span> Bitmap(memoryStream) { Tag = bitmapTag };
<a name="l00260"></a>00260                 }
<a name="l00261"></a>00261                 <span class="comment">//catch(GhostscriptException)</span>
<a name="l00262"></a>00262                 <span class="comment">//{</span>
<a name="l00263"></a>00263                 <span class="comment">//    // Conversion failed</span>
<a name="l00264"></a>00264                 <span class="comment">//    return null; //or maybe we should show details? If it&#39;s a valid PDF?</span>
<a name="l00265"></a>00265                 <span class="comment">//}</span>
<a name="l00266"></a>00266                 <span class="keywordflow">finally</span>
<a name="l00267"></a>00267                 {
<a name="l00268"></a>00268                     tempOutputPathInfo.Delete();
<a name="l00269"></a>00269                 }
<a name="l00270"></a>00270             }
<a name="l00271"></a>00271             <span class="keywordflow">finally</span>
<a name="l00272"></a>00272             {
<a name="l00273"></a>00273                 tempInputPathInfo.Delete();
<a name="l00274"></a>00274             }
<a name="l00275"></a>00275         }
<a name="l00276"></a>00276 
<a name="l00277"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#aa2569d1c6271764ffb056c127d3d09b3">00277</a>         <span class="keyword">public</span> <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html" title="All plugins must implement this. Enables web.config addition and removal.">IPlugin</a> Install(<a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html">Config</a> c)
<a name="l00278"></a>00278         {
<a name="l00279"></a>00279             <span class="keywordflow">if</span>(c != null)
<a name="l00280"></a>00280             {
<a name="l00281"></a>00281                 c.<a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html#aa8cdada7d657ec3078e5d16310f198f7" title="Access and modify plugins.">Plugins</a>.<a class="code" href="class_image_resizer_1_1_configuration_1_1_plugin_config.html#a24a5d36dc59eee7d980a8e9b4d00ead1" title="Only for use by plugins during IPlugin.Install. Call Plugin.Install instead of this method...">add_plugin</a>(<span class="keyword">this</span>);
<a name="l00282"></a>00282             }
<a name="l00283"></a>00283             <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00284"></a>00284         }
<a name="l00285"></a>00285 
<a name="l00286"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#ae7ccd1ffbc42060c81c420d72e54c9c0">00286</a>         <span class="keyword">public</span> <span class="keywordtype">bool</span> Uninstall(<a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html">Config</a> c)
<a name="l00287"></a>00287         {
<a name="l00288"></a>00288             <span class="keywordflow">if</span>(c != null)
<a name="l00289"></a>00289             {
<a name="l00290"></a>00290                 c.<a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html#aa8cdada7d657ec3078e5d16310f198f7" title="Access and modify plugins.">Plugins</a>.<a class="code" href="class_image_resizer_1_1_configuration_1_1_plugin_config.html#a0aae69c8ce761b0b5869fd63e2bcb863" title="For use only by plugins during .Uninstall. Removes the specified plugin from AllPlugins, QuerystringPlugins, CachingSystems, ImageEncoders, and ImageBuiderExtensions, based on which interfaces the instance implements. Plugins may register event handlers and modify settings - thus you should use the plugin&#39;s method to uninstall them vs. using this method.">remove_plugin</a>(<span class="keyword">this</span>);
<a name="l00291"></a>00291             }
<a name="l00292"></a>00292             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00293"></a>00293         }
<a name="l00294"></a>00294 
<a name="l00295"></a>00295         <span class="keyword">public</span> IEnumerable&lt;IIssue&gt; GetIssues()
<a name="l00296"></a>00296         {
<a name="l00297"></a>00297             <span class="keywordflow">if</span>(!<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_engine.html" title="Provides a managed interface to Ghostscript API.">GhostscriptEngine</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_engine.html#a83de3dd4f3cdc4d440f97e2f56be35f4" title="Determines if the Ghostscript engine is available.">IsAvailable</a>()) <span class="comment">//Cached inside Ghostscript engine. </span>
<a name="l00298"></a>00298             {
<a name="l00299"></a>00299                 <span class="keywordtype">string</span> message = <span class="stringliteral">&quot;Ghostscript native library for this platform not found: &quot;</span> + <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_engine.html" title="Provides a managed interface to Ghostscript API.">GhostscriptEngine</a>.NativeFileName;
<a name="l00300"></a>00300                 <a class="code" href="class_image_resizer_1_1_configuration_1_1_issues_1_1_issue.html">Issue</a> issue = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_configuration_1_1_issues_1_1_issue.html">Issue</a>(message, <a class="code" href="namespace_image_resizer_1_1_configuration_1_1_issues.html#ada2af2a44c17c99a124cadb8a92f8555">IssueSeverity</a>.Error);
<a name="l00301"></a>00301                 <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="interface_image_resizer_1_1_configuration_1_1_issues_1_1_i_issue.html">IIssue</a>[] { issue };
<a name="l00302"></a>00302             }
<a name="l00303"></a>00303             <span class="keywordflow">return</span> Enumerable.Empty&lt;<a class="code" href="interface_image_resizer_1_1_configuration_1_1_issues_1_1_i_issue.html">IIssue</a>&gt;();
<a name="l00304"></a>00304         }
<a name="l00305"></a>00305 
<a name="l00306"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#a49f26a69e30e3714b2129a84bf928234">00306</a>         <span class="keyword">public</span> IEnumerable&lt;string&gt; GetSupportedFileExtensions()
<a name="l00307"></a>00307         {
<a name="l00308"></a>00308             <span class="keywordflow">return</span> _supportedExtensions;
<a name="l00309"></a>00309         }
<a name="l00310"></a>00310 
<a name="l00311"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_pdf_renderer_plugin.html#ac8c0fd79fad67de2650585fff2ab453a">00311</a>         <span class="keyword">public</span> IEnumerable&lt;string&gt; GetSupportedQuerystringKeys()
<a name="l00312"></a>00312         {
<a name="l00313"></a>00313             <span class="keywordflow">return</span> _queryStringKeys;
<a name="l00314"></a>00314         }
<a name="l00315"></a>00315 
<a name="l00316"></a>00316         <span class="keyword">private</span> Size GetOutputSize(<a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings, <span class="keywordtype">double</span> boundingWidth, <span class="keywordtype">double</span> boundingHeight)
<a name="l00317"></a>00317         {
<a name="l00318"></a>00318             <span class="comment">// Output size is determined by resize settings, if available.</span>
<a name="l00319"></a>00319             <span class="comment">//  maxwidth, maxheight </span>
<a name="l00320"></a>00320             <span class="comment">//      â Fit the image within the specified bounds, preserving aspect ratio.</span>
<a name="l00321"></a>00321             <span class="comment">//  width, height </span>
<a name="l00322"></a>00322             <span class="comment">//      â Force the final width and/or height to certain dimensions. </span>
<a name="l00323"></a>00323             <span class="comment">//        Whitespace will be added if the aspect ratio is different.</span>
<a name="l00324"></a>00324             <span class="comment">// This plugin renders to a size within the requested size and then expects remaining plugins in the </span>
<a name="l00325"></a>00325             <span class="comment">// pipeline to perform and additional processing such as adding whitespace, etc.</span>
<a name="l00326"></a>00326             <span class="comment">// It can safely treat width/height as maxwidth/maxheight.</span>
<a name="l00327"></a>00327 
<a name="l00328"></a>00328             <span class="keywordtype">double</span> imageRatio = boundingWidth / boundingHeight;
<a name="l00329"></a>00329             <span class="keywordtype">double</span> width = settings.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a80001d573cec108c39e5376f6d854993" title="[&quot;width&quot;]: Sets the desired width of the image. (minus padding, borders, margins, effects, and rotation). The only instance the resulting image will be smaller is if the original source image is smaller. Set Scale=Both to upscale these images and ensure the output always matches &#39;width&#39; and &#39;height&#39;. If both width and height are specified, the image will be &#39;letterboxed&#39; to match the desired aspect ratio. Change the Mode property to adjust this behavior.">Width</a>;
<a name="l00330"></a>00330             <span class="keywordtype">double</span> height = settings.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a7145aef3affc3244969cad8841359e3f" title="[&quot;height&quot;]: Sets the desired height of the image. (minus padding, borders, margins, effects, and rotation) The only instance the resulting image will be smaller is if the original source image is smaller. Set Scale=Both to upscale these images and ensure the output always matches &#39;width&#39; and &#39;height&#39;. If both width and height are specified, the image will be &#39;letterboxed&#39; to match the desired aspect ratio. Change the Mode property to adjust this behavior.">Height</a>;
<a name="l00331"></a>00331             <span class="keywordtype">double</span> maxwidth = settings.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a80fd5f97f3264009aa2c2648bb1379d7" title="[&quot;maxwidth&quot;]: Sets the maximum desired width of the image. (minus padding, borders, margins, effects, and rotation). The image may be smaller than this value to maintain aspect ratio when both maxwidth and maxheight are specified.">MaxWidth</a>;
<a name="l00332"></a>00332             <span class="keywordtype">double</span> maxheight = settings.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a16d3547dfb87d598876fb64e54c0a938" title="[&quot;maxheight&quot;]: Sets the maximum desired height of the image. (minus padding, borders, margins, effects, and rotation). The image may be smaller than this value to maintain aspect ratio when both maxwidth and maxheight are specified.">MaxHeight</a>;
<a name="l00333"></a>00333 
<a name="l00334"></a>00334             <span class="comment">//Allow overrides with pdfwidth and pdfheight when we *want* to rescale afterwards.</span>
<a name="l00335"></a>00335             <span class="keywordtype">int</span> pw = settings.Get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;pdfwidth&quot;</span>, -1);
<a name="l00336"></a>00336             <span class="keywordtype">int</span> ph = settings.Get&lt;<span class="keywordtype">int</span>&gt;(<span class="stringliteral">&quot;pdfheight&quot;</span>, -1);
<a name="l00337"></a>00337             <span class="keywordflow">if</span> (pw &gt; 0) { width = pw; maxwidth = -1;}
<a name="l00338"></a>00338             <span class="keywordflow">if</span> (ph &gt; 0) { height = ph; maxheight = -1; }
<a name="l00339"></a>00339 
<a name="l00340"></a>00340             <span class="comment">//Handle cases of width/maxheight and height/maxwidth as in legacy versions. </span>
<a name="l00341"></a>00341             <span class="keywordflow">if</span> (width != -1 &amp;&amp; maxheight != -1) maxheight = Math.Min(maxheight, (width / imageRatio));
<a name="l00342"></a>00342             <span class="keywordflow">if</span> (height != -1 &amp;&amp; maxwidth != -1) maxwidth = Math.Min(maxwidth, (height * imageRatio));
<a name="l00343"></a>00343 
<a name="l00344"></a>00344             <span class="comment">//Eliminate cases where both a value and a max value are specified: use the smaller value for the width/height </span>
<a name="l00345"></a>00345             <span class="keywordflow">if</span> (maxwidth &gt; 0 &amp;&amp; width &gt; 0) { width = Math.Min(maxwidth, width); maxwidth = -1; }
<a name="l00346"></a>00346             <span class="keywordflow">if</span> (maxheight &gt; 0 &amp;&amp; height &gt; 0) { height = Math.Min(maxheight, height); maxheight = -1; }
<a name="l00347"></a>00347 
<a name="l00348"></a>00348             <span class="comment">//Move values to width/height</span>
<a name="l00349"></a>00349             <span class="keywordflow">if</span> (width &lt;= 0) width = maxwidth;
<a name="l00350"></a>00350             <span class="keywordflow">if</span> (height &lt;= 0) height = maxheight;
<a name="l00351"></a>00351 
<a name="l00352"></a>00352             <span class="comment">//Calculate missing value(s) </span>
<a name="l00353"></a>00353             <span class="keywordflow">if</span> (width &gt; 0 &amp;&amp; height &lt;= 0) height = width / imageRatio;
<a name="l00354"></a>00354             <span class="keywordflow">else</span> <span class="keywordflow">if</span> (height &gt; 0 &amp;&amp; width &lt;= 0) width = height * imageRatio;
<a name="l00355"></a>00355             <span class="keywordflow">else</span> <span class="keywordflow">if</span>(width &lt;= 0 &amp;&amp; height &lt;= 0) { <span class="comment">// If neither width nor height as specified use default values</span>
<a name="l00356"></a>00356                 width = DefaultWidth;
<a name="l00357"></a>00357                 height = DefaultHeight;
<a name="l00358"></a>00358             }
<a name="l00359"></a>00359 
<a name="l00360"></a>00360             <span class="comment">// Limit maximum output size</span>
<a name="l00361"></a>00361             width = Math.Min(width, this.MaxWidth);
<a name="l00362"></a>00362             height = Math.Min(height, this.MaxHeight);
<a name="l00363"></a>00363 
<a name="l00364"></a>00364             
<a name="l00365"></a>00365             <span class="comment">// Determine the scaling values, and use the smallest to ensure we fit in the bounding box without changing </span>
<a name="l00366"></a>00366             <span class="comment">// the aspect ratio otherwise we will crop.</span>
<a name="l00367"></a>00367             <span class="comment">//Use a scaled version of boundingBox inside our maximum width and height constraints.</span>
<a name="l00368"></a>00368             <span class="keywordflow">return</span> <a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html" title="Defines a collection of utility functions for manipulating polygons. These functions may be (re)moved...">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a3bd9aa254e8639eb72e580d324f929b9" title="Rounds the elements of the specified array [not used].">RoundPoints</a>(<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html" title="Defines a collection of utility functions for manipulating polygons. These functions may be (re)moved...">PolygonMath</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_polygon_math.html#a0495fc6849c286b9f880c900d1b66e7d" title="Scales &#39;inner&#39; to fit inside &#39;bounding&#39; while maintaining aspect ratio. Upscales and downscales...">ScaleInside</a>(<span class="keyword">new</span> SizeF((<span class="keywordtype">float</span>)boundingWidth, (<span class="keywordtype">float</span>)boundingHeight), <span class="keyword">new</span> SizeF((<span class="keywordtype">float</span>)width, (<span class="keywordtype">float</span>)height)));
<a name="l00369"></a>00369         }
<a name="l00370"></a>00370 
<a name="l00371"></a>00371         <span class="keyword">private</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_pdf_info.html">PdfInfo</a> GetPdfInfo(<span class="keywordtype">string</span> path)
<a name="l00372"></a>00372         {
<a name="l00373"></a>00373             <span class="keywordtype">string</span> output;
<a name="l00374"></a>00374             <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_settings.html" title="Ghostscript settings collection.">GhostscriptSettings</a> settings = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_settings.html" title="Ghostscript settings collection.">GhostscriptSettings</a>
<a name="l00375"></a>00375                                            {
<a name="l00376"></a>00376                                                <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#ad01d28e2f054ff236ab2e54bf0c40978" title="Initializes Ghostscript with a null device (a device that discards the output image) rather than the ...">NoDisplay</a>,
<a name="l00377"></a>00377                                                <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#adfe61c50d0d840d9ce20c1695efdef61" title="Suppresses routine information comments on standard output. This is currently necessary when redirect...">Quiet</a>,
<a name="l00378"></a>00378                                                {<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#ab1f1528aa8eee7c975f7e0eae182937f" title="Sets input file parameter.">File</a>, path},
<a name="l00379"></a>00379                                                PdfInfoPath
<a name="l00380"></a>00380                                            };
<a name="l00381"></a>00381             output = _engine.Execute(settings);
<a name="l00382"></a>00382 
<a name="l00383"></a>00383             <span class="comment">// Deserialize PDF info output from XML</span>
<a name="l00384"></a>00384             <span class="keyword">using</span>(StringReader outputReader = <span class="keyword">new</span> StringReader(output))
<a name="l00385"></a>00385             {
<a name="l00386"></a>00386                 <span class="keywordflow">return</span> (<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_pdf_info.html">PdfInfo</a>)_pdfInfoSerializer.Deserialize(outputReader);
<a name="l00387"></a>00387             }
<a name="l00388"></a>00388         }
<a name="l00389"></a>00389 
<a name="l00390"></a>00390         <span class="keyword">private</span> <span class="keyword">static</span> <span class="keywordtype">string</span> GetPathInfoResource()
<a name="l00391"></a>00391         {
<a name="l00392"></a>00392             <span class="comment">// TODO: Temp file is not deleted</span>
<a name="l00393"></a>00393 
<a name="l00394"></a>00394             <span class="comment">// Extract pdfInfo.ps file from embedded resource for when getting PDF information</span>
<a name="l00395"></a>00395             Assembly assembly = Assembly.GetExecutingAssembly();
<a name="l00396"></a>00396             <span class="keywordtype">string</span> resourceName = assembly.GetManifestResourceNames().Single(x =&gt; x.EndsWith(<span class="stringliteral">&quot;pdfInfo.ps&quot;</span>, StringComparison.OrdinalIgnoreCase));
<a name="l00397"></a>00397 
<a name="l00398"></a>00398             <span class="keywordtype">string</span> pdfInfoCommand;
<a name="l00399"></a>00399             <span class="keyword">using</span>(StreamReader reader = <span class="keyword">new</span> StreamReader(assembly.GetManifestResourceStream(resourceName)))
<a name="l00400"></a>00400             {
<a name="l00401"></a>00401                 pdfInfoCommand = reader.ReadToEnd();
<a name="l00402"></a>00402             }
<a name="l00403"></a>00403 
<a name="l00404"></a>00404             <span class="keywordtype">string</span> path = Path.GetTempFileName();
<a name="l00405"></a>00405             File.WriteAllText(path, pdfInfoCommand);
<a name="l00406"></a>00406             <span class="keywordflow">return</span> path;
<a name="l00407"></a>00407         }
<a name="l00408"></a>00408 
<a name="l00409"></a>00409         <span class="keyword">private</span> <span class="keywordtype">void</span> ApplyResizeSettings(ResizeSettings settings, <a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_settings.html" title="Ghostscript settings collection.">GhostscriptSettings</a> ghostscriptSettings)
<a name="l00410"></a>00410         {
<a name="l00411"></a>00411             <span class="comment">// Parse resize settings</span>
<a name="l00412"></a>00412 
<a name="l00413"></a>00413             <span class="comment">// - graphicsAlphaBits</span>
<a name="l00414"></a>00414             <span class="keywordtype">int</span> graphicsAlphaBits = settings.GetValueOrDefault(<span class="stringliteral">&quot;graphicsbits&quot;</span>, 0);
<a name="l00415"></a>00415             <span class="keywordflow">if</span>(!_validAlphaBitValues.Contains(graphicsAlphaBits))
<a name="l00416"></a>00416             {
<a name="l00417"></a>00417                 <span class="comment">// Use default value</span>
<a name="l00418"></a>00418                 graphicsAlphaBits = _validAlphaBitValues.Last();
<a name="l00419"></a>00419             }
<a name="l00420"></a>00420             ghostscriptSettings.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_settings.html#ad60176793e5097f7faa6b09eefbf0d2e" title="Adds an entry with the specified name and string representation of the value to the GhostscriptSettin...">Add</a>(<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#aa47d7b89c71e47b33155045308e96796" title="Control the use of subsample antialiasing; highly recommended for producing high quality rasterizatio...">GraphicsAlphaBits</a>, graphicsAlphaBits);
<a name="l00421"></a>00421 
<a name="l00422"></a>00422             <span class="comment">// - textAlphaBits</span>
<a name="l00423"></a>00423             <span class="keywordtype">int</span> textAlphaBits = settings.GetValueOrDefault(<span class="stringliteral">&quot;textbits&quot;</span>, 0);
<a name="l00424"></a>00424             <span class="keywordflow">if</span>(!_validAlphaBitValues.Contains(textAlphaBits))
<a name="l00425"></a>00425             {
<a name="l00426"></a>00426                 <span class="comment">// Use default value</span>
<a name="l00427"></a>00427                 textAlphaBits = _validAlphaBitValues.Last();
<a name="l00428"></a>00428             }
<a name="l00429"></a>00429             ghostscriptSettings.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_settings.html#ad60176793e5097f7faa6b09eefbf0d2e" title="Adds an entry with the specified name and string representation of the value to the GhostscriptSettin...">Add</a>(<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#a94447c6e9c9837d94e10393d5c345032" title="Control the use of subsample antialiasing; highly recommended for producing high quality rasterizatio...">TextAlphaBits</a>, textAlphaBits);
<a name="l00430"></a>00430 
<a name="l00431"></a>00431             ghostscriptSettings[<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#abb987ef521c4109f80a0d46b3b3cae00" title="This specifies the initial value for the implementation specific user parameter GridFitTT. It controls grid fitting of True Type fonts (Sometimes referred to as &quot;hinting&quot;, but strictly speaking the latter is a feature of Type 1 fonts). Setting this to 2 enables automatic grid fitting for True Type glyphs. The value 0 disables grid fitting. The default value is 2. For more information see the description of the user parameter GridFitTT.">GridFitTT</a>] = (settings.Get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;gridfit&quot;</span>) == <span class="keyword">true</span> ? 2 : 0).ToString(NumberFormatInfo.InvariantInfo);
<a name="l00432"></a>00432             ghostscriptSettings[<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#a679496dcba0171da084d8f991ae50557" title="Chooses glyph alignment to integral pixel boundaries (if set to the value 1) or to subpixels (value 0...">AlignToPixels</a>] = (settings.Get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;subpixels&quot;</span>) == <span class="keyword">true</span> ? 1 : 0).ToString(NumberFormatInfo.InvariantInfo);
<a name="l00433"></a>00433             <span class="keywordflow">if</span> (settings.Get&lt;<span class="keywordtype">bool</span>&gt;(<span class="stringliteral">&quot;printed&quot;</span>,<span class="keyword">true</span>) == <span class="keyword">false</span>) ghostscriptSettings.Remove(<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html" title="Ghostscript argument names.">GhostscriptArgument</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_pdf_renderer_1_1_ghostscript_1_1_ghostscript_argument.html#a3efbdbce6f8ff1626824fec3099c42b4" title="Determines whether the file should be displayed or printed using the &quot;screen&quot; or &quot;printer&quot; option...">Printed</a>);
<a name="l00434"></a>00434         }
<a name="l00435"></a>00435     }
<a name="l00436"></a>00436 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
