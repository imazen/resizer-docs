<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>ImageResizer: ImageResizer.Plugins.DiskCache.CustomDiskCache Class Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="imageresizer-logo-00aec4.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.4.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="inherits.html"><span>Class&#160;Hierarchy</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="namespace_image_resizer.html">ImageResizer</a></li><li class="navelem"><a class="el" href="namespace_image_resizer_1_1_plugins.html">Plugins</a></li><li class="navelem"><a class="el" href="namespace_image_resizer_1_1_plugins_1_1_disk_cache.html">DiskCache</a></li><li class="navelem"><a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html">CustomDiskCache</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-methods">Public Member Functions</a> &#124;
<a href="#pro-attribs">Protected Attributes</a> &#124;
<a href="#properties">Properties</a> &#124;
<a href="#events">Events</a> &#124;
<a href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">ImageResizer.Plugins.DiskCache.CustomDiskCache Class Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Handles access to a disk-based file cache. Handles locking and versioning. Supports subfolders for scalability.  
 <a href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#details">More...</a></p>
<div class="dynheader">
Collaboration diagram for ImageResizer.Plugins.DiskCache.CustomDiskCache:</div>
<div class="dyncontent">
<div class="center"><img src="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache__coll__graph.png" border="0" usemap="#_image_resizer_8_plugins_8_disk_cache_8_custom_disk_cache_coll__map" alt="Collaboration graph"/></div>
<map name="_image_resizer_8_plugins_8_disk_cache_8_custom_disk_cache_coll__map" id="_image_resizer_8_plugins_8_disk_cache_8_custom_disk_cache_coll__map">
<area shape="rect" id="node2" href="interface_image_resizer_1_1_configuration_1_1_logging_1_1_i_logger_provider.html" title="ImageResizer.Configuration.\lLogging.ILoggerProvider" alt="" coords="6,5,429,86"/><area shape="rect" id="node4" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_lock_provider.html" title="Provides locking based on a string key. Locks are local to the LockProvider instance. The class handles disposing of unused locks. Generally used for coordinating writes to files (of which there can be millions). Only keeps key/lock pairs in memory which are in use. Thread&#45;safe. " alt="" coords="18,110,417,191"/></map>
<center><span class="legend">[<a href="graph_legend.html">legend</a>]</span></center></div>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-methods"></a>
Public Member Functions</h2></td></tr>
<tr class="memitem:ad65b2baa1bc893dba09861249a3d3e3a"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="ad65b2baa1bc893dba09861249a3d3e3a"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>CustomDiskCache</b> (<a class="el" href="interface_image_resizer_1_1_configuration_1_1_logging_1_1_i_logger_provider.html">ILoggerProvider</a> lp, string physicalCachePath, int subfolders, bool hashModifiedDate)</td></tr>
<tr class="separator:ad65b2baa1bc893dba09861249a3d3e3a"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34d95dbe768305e32f057f3a0dd4c8c0"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a34d95dbe768305e32f057f3a0dd4c8c0"></a>
&#160;</td><td class="memItemRight" valign="bottom"><b>CustomDiskCache</b> (<a class="el" href="interface_image_resizer_1_1_configuration_1_1_logging_1_1_i_logger_provider.html">ILoggerProvider</a> lp, string physicalCachePath, int subfolders, bool hashModifiedDate, long asyncMaxQueuedBytes)</td></tr>
<tr class="separator:a34d95dbe768305e32f057f3a0dd4c8c0"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a262bea285f70f5a8a05732e1e6a8c794"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_cache_result.html">CacheResult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#a262bea285f70f5a8a05732e1e6a8c794">GetCachedFile</a> (string keyBasis, string extension, ResizeImageDelegate writeCallback, DateTime sourceModifiedUtc, int timeoutMs)</td></tr>
<tr class="memdesc:a262bea285f70f5a8a05732e1e6a8c794"><td class="mdescLeft">&#160;</td><td class="mdescRight">If the cached data exists and is up-to-date, returns the path to it. Otherwise, this function tries to cache the data and return the path.  <a href="#a262bea285f70f5a8a05732e1e6a8c794">More...</a><br/></td></tr>
<tr class="separator:a262bea285f70f5a8a05732e1e6a8c794"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43cbe092ec6180f6f30fff0c7dd4d270"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_cache_result.html">CacheResult</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#a43cbe092ec6180f6f30fff0c7dd4d270">GetCachedFile</a> (string keyBasis, string extension, ResizeImageDelegate writeCallback, DateTime sourceModifiedUtc, int timeoutMs, bool asynchronous)</td></tr>
<tr class="memdesc:a43cbe092ec6180f6f30fff0c7dd4d270"><td class="mdescLeft">&#160;</td><td class="mdescRight">May return either a physical file name or a MemoryStream with the data. Faster than GetCachedFile, as writes are (usually) asynchronous. If the write queue is full, the write is forced to be synchronous again. Identical to <a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#a262bea285f70f5a8a05732e1e6a8c794" title="If the cached data exists and is up-to-date, returns the path to it. Otherwise, this function tries t...">GetCachedFile()</a> when asynchronous=false  <a href="#a43cbe092ec6180f6f30fff0c7dd4d270">More...</a><br/></td></tr>
<tr class="separator:a43cbe092ec6180f6f30fff0c7dd4d270"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pro-attribs"></a>
Protected Attributes</h2></td></tr>
<tr class="memitem:a0f4fe512032fd04d911f145ad3ade5b9"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a0f4fe512032fd04d911f145ad3ade5b9"></a>
string&#160;</td><td class="memItemRight" valign="bottom"><b>physicalCachePath</b></td></tr>
<tr class="separator:a0f4fe512032fd04d911f145ad3ade5b9"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a48d5ad622ee02de3b956062f90d8ec8f"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a48d5ad622ee02de3b956062f90d8ec8f"></a>
int&#160;</td><td class="memItemRight" valign="bottom"><b>subfolders</b></td></tr>
<tr class="separator:a48d5ad622ee02de3b956062f90d8ec8f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99370251f138568a0c4f9cb87ab56810"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a99370251f138568a0c4f9cb87ab56810"></a>
bool&#160;</td><td class="memItemRight" valign="bottom"><b>hashModifiedDate</b></td></tr>
<tr class="separator:a99370251f138568a0c4f9cb87ab56810"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af4ac55f72a17ab2fc5f9422fee526ce5"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="af4ac55f72a17ab2fc5f9422fee526ce5"></a>
<a class="el" href="interface_image_resizer_1_1_configuration_1_1_logging_1_1_i_logger_provider.html">ILoggerProvider</a>&#160;</td><td class="memItemRight" valign="bottom"><b>lp</b></td></tr>
<tr class="separator:af4ac55f72a17ab2fc5f9422fee526ce5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a7314ff3f464f08ce4da211187774fc68"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a7314ff3f464f08ce4da211187774fc68"></a>
<a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_lock_provider.html">LockProvider</a>&#160;</td><td class="memItemRight" valign="bottom"><b>locks</b> = new <a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_lock_provider.html">LockProvider</a>()</td></tr>
<tr class="separator:a7314ff3f464f08ce4da211187774fc68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a80305f0f1c1c2e6f8306c2f9bc8ca860"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a80305f0f1c1c2e6f8306c2f9bc8ca860"></a>
<a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_lock_provider.html">LockProvider</a>&#160;</td><td class="memItemRight" valign="bottom"><b>queueLocks</b> = new <a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_lock_provider.html">LockProvider</a>()</td></tr>
<tr class="separator:a80305f0f1c1c2e6f8306c2f9bc8ca860"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="properties"></a>
Properties</h2></td></tr>
<tr class="memitem:a23470af46dacc7e6a575f0cfd67f642b"><td class="memItemLeft" align="right" valign="top"><a class="anchor" id="a23470af46dacc7e6a575f0cfd67f642b"></a>
string&#160;</td><td class="memItemRight" valign="bottom"><b>PhysicalCachePath</b><code> [get]</code></td></tr>
<tr class="separator:a23470af46dacc7e6a575f0cfd67f642b"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad6e28a6622b78c69d52b492ac1cd84dc"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_lock_provider.html">LockProvider</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#ad6e28a6622b78c69d52b492ac1cd84dc">Locks</a><code> [get]</code></td></tr>
<tr class="memdesc:ad6e28a6622b78c69d52b492ac1cd84dc"><td class="mdescLeft">&#160;</td><td class="mdescRight">Provides string-based locking for file write access.  <a href="#ad6e28a6622b78c69d52b492ac1cd84dc">More...</a><br/></td></tr>
<tr class="separator:ad6e28a6622b78c69d52b492ac1cd84dc"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a43828a7d93f9850dd2497a48013cbcd6"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_lock_provider.html">LockProvider</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#a43828a7d93f9850dd2497a48013cbcd6">QueueLocks</a><code> [get]</code></td></tr>
<tr class="memdesc:a43828a7d93f9850dd2497a48013cbcd6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Provides string-based locking for image resizing (not writing, just processing). Prevents duplication of efforts in asynchronous mode, where 'Locks' is not being used.  <a href="#a43828a7d93f9850dd2497a48013cbcd6">More...</a><br/></td></tr>
<tr class="separator:a43828a7d93f9850dd2497a48013cbcd6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a561a334189a8a0169f3e204bdb825502"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_async_1_1_async_write_collection.html">AsyncWriteCollection</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#a561a334189a8a0169f3e204bdb825502">CurrentWrites</a><code> [get]</code></td></tr>
<tr class="memdesc:a561a334189a8a0169f3e204bdb825502"><td class="mdescLeft">&#160;</td><td class="mdescRight">Contains all the queued and in-progress writes to the cache.  <a href="#a561a334189a8a0169f3e204bdb825502">More...</a><br/></td></tr>
<tr class="separator:a561a334189a8a0169f3e204bdb825502"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:abe47e92a8f0bee35ac7b08a02777b4ef"><td class="memItemLeft" align="right" valign="top"><a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_cache_index.html">CacheIndex</a>&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#abe47e92a8f0bee35ac7b08a02777b4ef">Index</a><code> [get]</code></td></tr>
<tr class="memdesc:abe47e92a8f0bee35ac7b08a02777b4ef"><td class="mdescLeft">&#160;</td><td class="mdescRight">Provides an in-memory index of the cache.  <a href="#abe47e92a8f0bee35ac7b08a02777b4ef">More...</a><br/></td></tr>
<tr class="separator:abe47e92a8f0bee35ac7b08a02777b4ef"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="events"></a>
Events</h2></td></tr>
<tr class="memitem:a3c6eebab73d41d608b5638aa0d992806"><td class="memItemLeft" align="right" valign="top">CacheResultHandler&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#a3c6eebab73d41d608b5638aa0d992806">CacheResultReturned</a></td></tr>
<tr class="memdesc:a3c6eebab73d41d608b5638aa0d992806"><td class="mdescLeft">&#160;</td><td class="mdescRight">Fired immediately before GetCachedFile return the result value.  <a href="#a3c6eebab73d41d608b5638aa0d992806">More...</a><br/></td></tr>
<tr class="separator:a3c6eebab73d41d608b5638aa0d992806"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Handles access to a disk-based file cache. Handles locking and versioning. Supports subfolders for scalability. </p>

<p>Definition at line <a class="el" href="_custom_disk_cache_8cs_source.html#l00020">20</a> of file <a class="el" href="_custom_disk_cache_8cs_source.html">CustomDiskCache.cs</a>.</p>
</div><h2 class="groupheader">Member Function Documentation</h2>
<a class="anchor" id="a262bea285f70f5a8a05732e1e6a8c794"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_cache_result.html">CacheResult</a> ImageResizer.Plugins.DiskCache.CustomDiskCache.GetCachedFile </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>keyBasis</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>extension</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ResizeImageDelegate&#160;</td>
          <td class="paramname"><em>writeCallback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DateTime&#160;</td>
          <td class="paramname"><em>sourceModifiedUtc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>timeoutMs</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>If the cached data exists and is up-to-date, returns the path to it. Otherwise, this function tries to cache the data and return the path. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">keyBasis</td><td>The basis for the key. Should not include the modified date, that is handled inside the function.</td></tr>
    <tr><td class="paramname">extension</td><td>The extension to use for the cached file.</td></tr>
    <tr><td class="paramname">writeCallback</td><td>A method that accepts a Stream argument and writes the data to it.</td></tr>
    <tr><td class="paramname">sourceModifiedUtc</td><td>The modified date of the source file. Should be DateTime.MinValue if not available</td></tr>
    <tr><td class="paramname">timeoutMs</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="_custom_disk_cache_8cs_source.html#l00090">90</a> of file <a class="el" href="_custom_disk_cache_8cs_source.html">CustomDiskCache.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                                                                                                                                                          {</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <span class="keywordflow">return</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#a262bea285f70f5a8a05732e1e6a8c794">GetCachedFile</a>(keyBasis, extension, writeCallback, sourceModifiedUtc, timeoutMs, <span class="keyword">false</span>);</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;        }</div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache_html_a262bea285f70f5a8a05732e1e6a8c794"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#a262bea285f70f5a8a05732e1e6a8c794">ImageResizer.Plugins.DiskCache.CustomDiskCache.GetCachedFile</a></div><div class="ttdeci">CacheResult GetCachedFile(string keyBasis, string extension, ResizeImageDelegate writeCallback, DateTime sourceModifiedUtc, int timeoutMs)</div><div class="ttdoc">If the cached data exists and is up-to-date, returns the path to it. Otherwise, this function tries t...</div><div class="ttdef"><b>Definition:</b> <a href="_custom_disk_cache_8cs_source.html#l00090">CustomDiskCache.cs:90</a></div></div>
</div><!-- fragment -->
</div>
</div>
<a class="anchor" id="a43cbe092ec6180f6f30fff0c7dd4d270"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_cache_result.html">CacheResult</a> ImageResizer.Plugins.DiskCache.CustomDiskCache.GetCachedFile </td>
          <td>(</td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>keyBasis</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">string&#160;</td>
          <td class="paramname"><em>extension</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">ResizeImageDelegate&#160;</td>
          <td class="paramname"><em>writeCallback</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">DateTime&#160;</td>
          <td class="paramname"><em>sourceModifiedUtc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>timeoutMs</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">bool&#160;</td>
          <td class="paramname"><em>asynchronous</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">inline</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>May return either a physical file name or a MemoryStream with the data. Faster than GetCachedFile, as writes are (usually) asynchronous. If the write queue is full, the write is forced to be synchronous again. Identical to <a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#a262bea285f70f5a8a05732e1e6a8c794" title="If the cached data exists and is up-to-date, returns the path to it. Otherwise, this function tries t...">GetCachedFile()</a> when asynchronous=false </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname">keyBasis</td><td></td></tr>
    <tr><td class="paramname">extension</td><td></td></tr>
    <tr><td class="paramname">writeCallback</td><td></td></tr>
    <tr><td class="paramname">sourceModifiedUtc</td><td></td></tr>
    <tr><td class="paramname">timeoutMs</td><td></td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd></dd></dl>

<p>Definition at line <a class="el" href="_custom_disk_cache_8cs_source.html#l00106">106</a> of file <a class="el" href="_custom_disk_cache_8cs_source.html">CustomDiskCache.cs</a>.</p>
<div class="fragment"><div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                                                                                                                                                                             {</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;            Stopwatch sw = null;</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            <span class="keywordflow">if</span> (lp.Logger != null) { sw = <span class="keyword">new</span> Stopwatch(); sw.Start(); }</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;            <span class="keywordtype">bool</span> hasModifiedDate = !sourceModifiedUtc.Equals(DateTime.MinValue);</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;</div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;</div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            <span class="comment">//Hash the modified date if needed.</span></div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            <span class="keywordflow">if</span> (hashModifiedDate &amp;&amp; hasModifiedDate)</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                keyBasis += <span class="stringliteral">&quot;|&quot;</span> + sourceModifiedUtc.Ticks.ToString(NumberFormatInfo.InvariantInfo);</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;            <span class="comment">//Relative to the cache directory. Not relative to the app or domain root</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            <span class="keywordtype">string</span> relativePath = <span class="keyword">new</span> UrlHasher().hash(keyBasis, subfolders, <span class="stringliteral">&quot;/&quot;</span>) + <span class="charliteral">&#39;.&#39;</span> + extension;</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;            <span class="comment">//Physical path</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;            <span class="keywordtype">string</span> physicalPath = PhysicalCachePath.TrimEnd(<span class="charliteral">&#39;\\&#39;</span>, <span class="charliteral">&#39;/&#39;</span>) + System.IO.Path.DirectorySeparatorChar +</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;                    relativePath.Replace(<span class="charliteral">&#39;/&#39;</span>, System.IO.Path.DirectorySeparatorChar);</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;</div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;            CacheResult result = <span class="keyword">new</span> CacheResult(<a class="code" href="namespace_image_resizer_1_1_plugins_1_1_disk_cache.html#afb29b25106a646c2ee694841e4b57fa8">CacheQueryResult</a>.Hit, physicalPath, relativePath);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            <span class="keywordtype">bool</span> compareModifiedDates = hasModifiedDate &amp;&amp; !hashModifiedDate;</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            </div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            <span class="keywordtype">bool</span> asyncFailed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;            </div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;            <span class="comment">//2013-apr-25: What happens if the file is still being written to disk - it&#39;s present but not complete? To handle that, we use mayBeLocked.</span></div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;            <span class="keywordtype">bool</span> mayBeLocked = Locks.MayBeLocked(relativePath.ToUpperInvariant());</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;             <span class="comment">//On the first check, verify the file exists using System.IO directly (the last &#39;true&#39; parameter).</span></div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;            <span class="keywordflow">if</span> (!asynchronous) {</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;                <span class="comment">//On the first check, verify the file exists using System.IO directly (the last &#39;true&#39; parameter)</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;                <span class="comment">//May throw an IOException if the file cannot be opened, and is locked by an external processes for longer than timeoutMs. </span></div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;                <span class="comment">//This method may take longer than timeoutMs under absolute worst conditions. </span></div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                <span class="keywordflow">if</span> (!TryWriteFile(result, physicalPath, relativePath, writeCallback, sourceModifiedUtc, timeoutMs, !mayBeLocked)) {</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;                    <span class="comment">//On failure</span></div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                    result.Result = CacheQueryResult.Failed;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;                }</div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            }</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <span class="keywordflow">else</span> <span class="keywordflow">if</span> ((!compareModifiedDates ? !<a class="code" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#abe47e92a8f0bee35ac7b08a02777b4ef">Index</a>.existsCertain(relativePath, physicalPath) : !Index.modifiedDateMatchesCertainExists(sourceModifiedUtc, relativePath, physicalPath)) || mayBeLocked)</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;            {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;                </div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;                <span class="comment">//Looks like a miss. Let&#39;s enter a lock for the creation of the file. This is a different locking system than for writing to the file - far less contention, as it doesn&#39;t include the </span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;                <span class="comment">//This prevents two identical requests from duplicating efforts. Different requests don&#39;t lock.</span></div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;                <span class="comment">//Lock execution using relativePath as the sync basis. Ignore casing differences. This prevents duplicate entries in the write queue and wasted CPU/RAM usage.</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;                <span class="keywordflow">if</span> (!<a class="code" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#a43828a7d93f9850dd2497a48013cbcd6">QueueLocks</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_lock_provider.html#aba5ee5d1323568b30fc351151524ac0c">TryExecute</a>(relativePath.ToUpperInvariant(), timeoutMs,</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;                    delegate() {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                        <span class="comment">//Now, if the item we seek is in the queue, we have a memcached hit. If not, we should check the index. It&#39;s possible the item has been written to disk already.</span></div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                        <span class="comment">//If both are a miss, we should see if there is enough room in the write queue. If not, switch to in-thread writing. </span></div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;                        <a class="code" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_async_1_1_async_write.html">AsyncWrite</a> t = CurrentWrites.Get(relativePath, sourceModifiedUtc);</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;</div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;                        <span class="keywordflow">if</span> (t != null) result.Data = t.GetReadonlyStream();</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                        </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                        <span class="comment">//On the second check, use cached data for speed. The cached data should be updated if another thread updated a file (but not if another process did).</span></div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                        <span class="comment">//When t == null, and we&#39;re inside QueueLocks, all work on the file must be finished, so we have no need to consult mayBeLocked.</span></div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;                        <span class="keywordflow">if</span> (t == null &amp;&amp; </div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;                            (!compareModifiedDates ? !<a class="code" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#abe47e92a8f0bee35ac7b08a02777b4ef">Index</a>.exists(relativePath, physicalPath) : !Index.modifiedDateMatches(sourceModifiedUtc, relativePath, physicalPath)))</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;                        {</div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;</div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;                            result.Result = CacheQueryResult.Miss;</div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;                            <span class="comment">//Still a miss, we even rechecked the filesystem. Write to memory.</span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;                            MemoryStream ms = <span class="keyword">new</span> MemoryStream(4096);  <span class="comment">//4K initial capacity is minimal, but this array will get copied around alot, better to underestimate.</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;                            <span class="comment">//Read, resize, process, and encode the image. Lots of exceptions thrown here.</span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;                            writeCallback(ms);</div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;                            ms.Position = 0;</div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;                            <a class="code" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_async_1_1_async_write.html">AsyncWrite</a> w = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_async_1_1_async_write.html">AsyncWrite</a>(<a class="code" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#a561a334189a8a0169f3e204bdb825502">CurrentWrites</a>,ms, physicalPath, relativePath, sourceModifiedUtc);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;                            <span class="keywordflow">if</span> (<a class="code" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#a561a334189a8a0169f3e204bdb825502">CurrentWrites</a>.<a class="code" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_async_1_1_async_write_collection.html#a92b45565d75d0c9c9a0d56d5b11fcac0">Queue</a>(w, delegate(<a class="code" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_async_1_1_async_write.html">AsyncWrite</a> job) {</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;                                <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;                                    Stopwatch swio = <span class="keyword">new</span> Stopwatch();</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;                                    </div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                                    swio.Start();</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                                    <span class="comment">//TODO: perhaps a different timeout?</span></div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                                    <span class="keywordflow">if</span> (!TryWriteFile(null, job.PhysicalPath, job.RelativePath, delegate(Stream s) { ((MemoryStream)job.<a class="code" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_async_1_1_async_write.html#a5955b11b1055470663e3ad3c04451e56">GetReadonlyStream</a>()).WriteTo(s); }, job.ModifiedDateUtc, timeoutMs, <span class="keyword">true</span>)) {</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;                                        swio.Stop();</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;                                        <span class="comment">//We failed to lock the file.</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;                                        <span class="keywordflow">if</span> (lp.Logger != null) </div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;                                            lp.Logger.Warn(<span class="stringliteral">&quot;Failed to flush async write, timeout exceeded after {1}ms - {0}&quot;</span>,  result.RelativePath, swio.ElapsedMilliseconds);</div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;                                        </div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;                                    } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;                                        swio.Stop();</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;                                        <span class="keywordflow">if</span> (lp.Logger != null)</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;                                            lp.Logger.Trace(<span class="stringliteral">&quot;{0}ms: Async write started {1}ms after enqueue for {2}&quot;</span>, swio.ElapsedMilliseconds.ToString().PadLeft(4), DateTime.UtcNow.Subtract(w.JobCreatedAt).Subtract(swio.Elapsed).TotalMilliseconds, result.RelativePath);</div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;                                    }</div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;</div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;                                } <span class="keywordflow">catch</span> (Exception ex) {</div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;                                    <span class="keywordflow">if</span> (lp.Logger != null) {</div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;                                        lp.Logger.Error(<span class="stringliteral">&quot;Failed to flush async write, {0} {1}\n{2}&quot;</span>,ex.ToString(), result.RelativePath,ex.StackTrace);</div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;                                    }</div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;                                } <span class="keywordflow">finally</span> {</div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;                                    CurrentWrites.Remove(job); <span class="comment">//Remove from the queue, it&#39;s done or failed. </span></div>
<div class="line"><a name="l00205"></a><span class="lineno">  205</span>&#160;                                }</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;                            })) {</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;                                <span class="comment">//We queued it! Send back a read-only memory stream</span></div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;                                result.Data = w.GetReadonlyStream();</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;                            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;                                asyncFailed = <span class="keyword">false</span>;</div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;                                <span class="comment">//We failed to queue it - either the ThreadPool was exhausted or we exceeded the MB limit for the write queue.</span></div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                                <span class="comment">//Write the MemoryStream to disk using the normal method.</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                                <span class="comment">//This is nested inside a queuelock because if we failed here, the next one will also. Better to force it to wait until the file is written to disk.</span></div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;                                <span class="keywordflow">if</span> (!TryWriteFile(result, physicalPath, relativePath, delegate(Stream s) { ms.WriteTo(s); }, sourceModifiedUtc, timeoutMs, <span class="keyword">false</span>)) {</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                                    <span class="keywordflow">if</span> (lp.Logger != null)</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                                        lp.Logger.Warn(<span class="stringliteral">&quot;Failed to queue async write, also failed to lock for sync writing: {0}&quot;</span>, result.RelativePath);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;                                        </div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;                                }</div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;                            }</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;</div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                        }</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                    })) {</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                    <span class="comment">//On failure</span></div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;                    result.Result = CacheQueryResult.Failed;</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;                }</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;            }</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;            <span class="keywordflow">if</span> (lp.Logger != null) {</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;                sw.Stop();</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                lp.Logger.Trace(<span class="stringliteral">&quot;{0}ms: {3}{1} for {2}, Key: {4}&quot;</span>, sw.ElapsedMilliseconds.ToString(NumberFormatInfo.InvariantInfo).PadLeft(4), result.Result.ToString(), result.RelativePath, asynchronous ? (asyncFailed ? <span class="stringliteral">&quot;Fallback to sync  &quot;</span> : <span class="stringliteral">&quot;Async &quot;</span>) : <span class="stringliteral">&quot;&quot;</span>, keyBasis);</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;            }</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            <span class="comment">//Fire event</span></div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;            <span class="keywordflow">if</span> (<a class="code" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#a3c6eebab73d41d608b5638aa0d992806">CacheResultReturned</a> != null) <a class="code" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#a3c6eebab73d41d608b5638aa0d992806">CacheResultReturned</a>(<span class="keyword">this</span>, result);</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;            <span class="keywordflow">return</span> result;</div>
<div class="line"><a name="l00237"></a><span class="lineno">  237</span>&#160;        }</div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache_html_a43828a7d93f9850dd2497a48013cbcd6"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#a43828a7d93f9850dd2497a48013cbcd6">ImageResizer.Plugins.DiskCache.CustomDiskCache.QueueLocks</a></div><div class="ttdeci">LockProvider QueueLocks</div><div class="ttdoc">Provides string-based locking for image resizing (not writing, just processing). Prevents duplication...</div><div class="ttdef"><b>Definition:</b> <a href="_custom_disk_cache_8cs_source.html#l00057">CustomDiskCache.cs:57</a></div></div>
<div class="ttc" id="namespace_image_resizer_1_1_plugins_1_1_disk_cache_html_afb29b25106a646c2ee694841e4b57fa8"><div class="ttname"><a href="namespace_image_resizer_1_1_plugins_1_1_disk_cache.html#afb29b25106a646c2ee694841e4b57fa8">ImageResizer.Plugins.DiskCache.CacheQueryResult</a></div><div class="ttdeci">CacheQueryResult</div><div class="ttdef"><b>Definition:</b> <a href="_cache_result_8cs_source.html#l00008">CacheResult.cs:8</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_lock_provider_html_aba5ee5d1323568b30fc351151524ac0c"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_lock_provider.html#aba5ee5d1323568b30fc351151524ac0c">ImageResizer.Plugins.DiskCache.LockProvider.TryExecute</a></div><div class="ttdeci">bool TryExecute(string key, int timeoutMs, LockCallback success)</div><div class="ttdoc">Attempts to execute the &amp;#39;success&amp;#39; callback inside a lock based on &amp;#39;key&amp;#39;. If successful, returns true. If the lock cannot be acquired within &amp;#39;timoutMs&amp;#39;, returns false In a worst-case scenario, it could take up to twice as long as &amp;#39;timeoutMs&amp;#39; to return false. </div><div class="ttdef"><b>Definition:</b> <a href="_lock_provider_8cs_source.html#l00053">LockProvider.cs:53</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_async_1_1_async_write_html_a5955b11b1055470663e3ad3c04451e56"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_async_1_1_async_write.html#a5955b11b1055470663e3ad3c04451e56">ImageResizer.Plugins.DiskCache.Async.AsyncWrite.GetReadonlyStream</a></div><div class="ttdeci">MemoryStream GetReadonlyStream()</div><div class="ttdoc">Wraps the data in a readonly MemoryStream so it can be accessed on another thread ...</div><div class="ttdef"><b>Definition:</b> <a href="_async_write_8cs_source.html#l00063">AsyncWrite.cs:63</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache_html_a561a334189a8a0169f3e204bdb825502"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#a561a334189a8a0169f3e204bdb825502">ImageResizer.Plugins.DiskCache.CustomDiskCache.CurrentWrites</a></div><div class="ttdeci">AsyncWriteCollection CurrentWrites</div><div class="ttdoc">Contains all the queued and in-progress writes to the cache. </div><div class="ttdef"><b>Definition:</b> <a href="_custom_disk_cache_8cs_source.html#l00065">CustomDiskCache.cs:65</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache_html_abe47e92a8f0bee35ac7b08a02777b4ef"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#abe47e92a8f0bee35ac7b08a02777b4ef">ImageResizer.Plugins.DiskCache.CustomDiskCache.Index</a></div><div class="ttdeci">CacheIndex Index</div><div class="ttdoc">Provides an in-memory index of the cache. </div><div class="ttdef"><b>Definition:</b> <a href="_custom_disk_cache_8cs_source.html#l00075">CustomDiskCache.cs:75</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_async_1_1_async_write_collection_html_a92b45565d75d0c9c9a0d56d5b11fcac0"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_async_1_1_async_write_collection.html#a92b45565d75d0c9c9a0d56d5b11fcac0">ImageResizer.Plugins.DiskCache.Async.AsyncWriteCollection.Queue</a></div><div class="ttdeci">bool Queue(AsyncWrite w, WriterDelegate writerDelegate)</div><div class="ttdoc">Returns false when (a) the specified AsyncWrite value already exists, (b) the queue is full...</div><div class="ttdef"><b>Definition:</b> <a href="_async_write_collection_8cs_source.html#l00069">AsyncWriteCollection.cs:69</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache_html_a3c6eebab73d41d608b5638aa0d992806"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_custom_disk_cache.html#a3c6eebab73d41d608b5638aa0d992806">ImageResizer.Plugins.DiskCache.CustomDiskCache.CacheResultReturned</a></div><div class="ttdeci">CacheResultHandler CacheResultReturned</div><div class="ttdoc">Fired immediately before GetCachedFile return the result value. </div><div class="ttdef"><b>Definition:</b> <a href="_custom_disk_cache_8cs_source.html#l00042">CustomDiskCache.cs:42</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_async_1_1_async_write_html"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_async_1_1_async_write.html">ImageResizer.Plugins.DiskCache.Async.AsyncWrite</a></div><div class="ttdef"><b>Definition:</b> <a href="_async_write_8cs_source.html#l00007">AsyncWrite.cs:7</a></div></div>
</div><!-- fragment -->
</div>
</div>
<h2 class="groupheader">Property Documentation</h2>
<a class="anchor" id="a561a334189a8a0169f3e204bdb825502"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_async_1_1_async_write_collection.html">AsyncWriteCollection</a> ImageResizer.Plugins.DiskCache.CustomDiskCache.CurrentWrites</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">get</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Contains all the queued and in-progress writes to the cache. </p>

<p>Definition at line <a class="el" href="_custom_disk_cache_8cs_source.html#l00065">65</a> of file <a class="el" href="_custom_disk_cache_8cs_source.html">CustomDiskCache.cs</a>.</p>

</div>
</div>
<a class="anchor" id="abe47e92a8f0bee35ac7b08a02777b4ef"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_cache_index.html">CacheIndex</a> ImageResizer.Plugins.DiskCache.CustomDiskCache.Index</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">get</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Provides an in-memory index of the cache. </p>

<p>Definition at line <a class="el" href="_custom_disk_cache_8cs_source.html#l00075">75</a> of file <a class="el" href="_custom_disk_cache_8cs_source.html">CustomDiskCache.cs</a>.</p>

</div>
</div>
<a class="anchor" id="ad6e28a6622b78c69d52b492ac1cd84dc"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_lock_provider.html">LockProvider</a> ImageResizer.Plugins.DiskCache.CustomDiskCache.Locks</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">get</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Provides string-based locking for file write access. </p>

<p>Definition at line <a class="el" href="_custom_disk_cache_8cs_source.html#l00049">49</a> of file <a class="el" href="_custom_disk_cache_8cs_source.html">CustomDiskCache.cs</a>.</p>

</div>
</div>
<a class="anchor" id="a43828a7d93f9850dd2497a48013cbcd6"></a>
<div class="memitem">
<div class="memproto">
<table class="mlabels">
  <tr>
  <td class="mlabels-left">
      <table class="memname">
        <tr>
          <td class="memname"><a class="el" href="class_image_resizer_1_1_plugins_1_1_disk_cache_1_1_lock_provider.html">LockProvider</a> ImageResizer.Plugins.DiskCache.CustomDiskCache.QueueLocks</td>
        </tr>
      </table>
  </td>
  <td class="mlabels-right">
<span class="mlabels"><span class="mlabel">get</span></span>  </td>
  </tr>
</table>
</div><div class="memdoc">

<p>Provides string-based locking for image resizing (not writing, just processing). Prevents duplication of efforts in asynchronous mode, where 'Locks' is not being used. </p>

<p>Definition at line <a class="el" href="_custom_disk_cache_8cs_source.html#l00057">57</a> of file <a class="el" href="_custom_disk_cache_8cs_source.html">CustomDiskCache.cs</a>.</p>

</div>
</div>
<h2 class="groupheader">Event Documentation</h2>
<a class="anchor" id="a3c6eebab73d41d608b5638aa0d992806"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">CacheResultHandler ImageResizer.Plugins.DiskCache.CustomDiskCache.CacheResultReturned</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Fired immediately before GetCachedFile return the result value. </p>

<p>Definition at line <a class="el" href="_custom_disk_cache_8cs_source.html#l00042">42</a> of file <a class="el" href="_custom_disk_cache_8cs_source.html">CustomDiskCache.cs</a>.</p>

</div>
</div>
<hr/>The documentation for this class was generated from the following file:<ul>
<li>C:/Users/nathanael/Documents/resizer/Plugins/DiskCache/<a class="el" href="_custom_disk_cache_8cs_source.html">CustomDiskCache.cs</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
