<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ImageResizer: C:/Users/Administrator/Documents/resizer/Plugins/S3Reader/S3VirtualPathProvider.cs Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="resizer-icon-64.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.1.3</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">C:/Users/Administrator/Documents/resizer/Plugins/S3Reader/S3VirtualPathProvider.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 ï»¿<span class="comment">/* Copyright (c) 2011 Nathanael Jones. See license.txt for your rights. */</span>
<a name="l00002"></a>00002 <span class="keyword">using</span> System;
<a name="l00003"></a>00003 <span class="keyword">using</span> System.Collections.Generic;
<a name="l00004"></a>00004 <span class="keyword">using</span> System.Web;
<a name="l00005"></a>00005 <span class="keyword">using</span> System.Web.Hosting;
<a name="l00006"></a>00006 <span class="keyword">using</span> System.Security.Permissions;
<a name="l00007"></a>00007 <span class="keyword">using</span> System.Web.Caching;
<a name="l00008"></a>00008 <span class="keyword">using</span> System.IO;
<a name="l00009"></a>00009 <span class="keyword">using</span> System.Data.Sql;
<a name="l00010"></a>00010 <span class="keyword">using</span> System.Data.SqlClient;
<a name="l00011"></a>00011 <span class="keyword">using</span> System.Configuration;
<a name="l00012"></a>00012 <span class="keyword">using</span> LitS3;
<a name="l00013"></a>00013 <span class="keyword">using</span> ImageResizer.Util;
<a name="l00014"></a>00014 <span class="keyword">namespace </span>ImageResizer.Plugins.S3Reader
<a name="l00015"></a>00015 {
<a name="l00016"></a>00016     <span class="comment"></span>
<a name="l00017"></a>00017 <span class="comment">    /// &lt;summary&gt;</span>
<a name="l00018"></a>00018 <span class="comment">    /// Allows clients to request objects located on another amazon S3 server through this server. Allows URL rewriting.</span>
<a name="l00019"></a>00019 <span class="comment">    /// &lt;/summary&gt;</span>
<a name="l00020"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_virtual_path_provider.html">00020</a> <span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_virtual_path_provider.html" title="Allows clients to request objects located on another amazon S3 server through this server...">S3VirtualPathProvider</a> : VirtualPathProvider, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_image_provider.html" title="Implement this to allow your class (or VirtualPathProvider subclass) to be used without registering i...">IVirtualImageProvider</a>
<a name="l00021"></a>00021     {
<a name="l00022"></a>00022 
<a name="l00023"></a>00023         <span class="keyword">public</span> delegate <span class="keywordtype">void</span> RewriteBucketAndKeyPath(<a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_virtual_path_provider.html" title="Allows clients to request objects located on another amazon S3 server through this server...">S3VirtualPathProvider</a> sender, <a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_path_event_args.html" title="Class to allow modifying the bucket and key request path.">S3PathEventArgs</a> e);
<a name="l00024"></a>00024 <span class="comment"></span>
<a name="l00025"></a>00025 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00026"></a>00026 <span class="comment">        /// Important! You should handle this event and throw an exception if a bucket that you do not own is requested. Otherwise other people&#39;s buckets could be accessed using your server.</span>
<a name="l00027"></a>00027 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00028"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_virtual_path_provider.html#a0d41267dbcc02afb14afeb0cbae77492">00028</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">event</span> RewriteBucketAndKeyPath <a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_virtual_path_provider.html#a0d41267dbcc02afb14afeb0cbae77492" title="Important! You should handle this event and throw an exception if a bucket that you do not own is req...">PreS3RequestFilter</a>;
<a name="l00029"></a>00029 <span class="comment"></span>
<a name="l00030"></a>00030 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00031"></a>00031 <span class="comment">        /// Execites the PreS3RequestFilter event and returns the result.</span>
<a name="l00032"></a>00032 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00033"></a>00033 <span class="comment">        /// &lt;param name=&quot;path&quot;&gt;&lt;/param&gt;</span>
<a name="l00034"></a>00034 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00035"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_virtual_path_provider.html#a448159e9a178355e5f0baecf555de3fe">00035</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">string</span> FilterPath(<span class="keywordtype">string</span> path)
<a name="l00036"></a>00036         {
<a name="l00037"></a>00037             <a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_path_event_args.html" title="Class to allow modifying the bucket and key request path.">S3PathEventArgs</a> e = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_path_event_args.html" title="Class to allow modifying the bucket and key request path.">S3PathEventArgs</a>(path);
<a name="l00038"></a>00038             <span class="keywordflow">if</span> (PreS3RequestFilter != null) PreS3RequestFilter(<span class="keyword">this</span>,e);
<a name="l00039"></a>00039             <span class="keywordflow">return</span> e.<a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_path_event_args.html#a7102aabd7dd732bec52e8660c25635b0" title="Path contains the bucket and key in the form &quot;bucket/key&quot;. Where key may contain additional forward s...">Path</a>;
<a name="l00040"></a>00040         }
<a name="l00041"></a>00041 
<a name="l00042"></a>00042         <span class="keyword">private</span> <span class="keywordtype">string</span> _virtualFilesystemPrefix = <span class="stringliteral">&quot;~/s3/&quot;</span>;<span class="comment"></span>
<a name="l00043"></a>00043 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00044"></a>00044 <span class="comment">        /// Requests starting with this path will be handled by this virtual path provider. Should be in app-relative form: &quot;~/s3/&quot;. Will be converted to root-relative form upon assigment. Trailing slash required, auto-added.</span>
<a name="l00045"></a>00045 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00046"></a>00046 <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">string</span> VirtualFilesystemPrefix
<a name="l00047"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_virtual_path_provider.html#ab19191d1cd2f926881f09cef89100456">00047</a>         {
<a name="l00048"></a>00048             <span class="keyword">get</span> { <span class="keywordflow">return</span> _virtualFilesystemPrefix; }
<a name="l00049"></a>00049             <span class="keyword">set</span> { <span class="keywordflow">if</span> (!value.EndsWith(<span class="stringliteral">&quot;/&quot;</span>)) value += <span class="stringliteral">&quot;/&quot;</span>;  _virtualFilesystemPrefix = <a class="code" href="class_image_resizer_1_1_util_1_1_path_utils.html">PathUtils</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_path_utils.html#a1a7e4faaa93c5b4d1f3652ccfc4dae82" title="Turns relative paths into domain-relative paths. Turns app-relative paths into domain relative paths...">ResolveAppRelativeAssumeAppRelative</a>(value); }
<a name="l00050"></a>00050         }
<a name="l00051"></a>00051         <span class="keyword">private</span> TimeSpan _metadataAbsoluteExpiration = TimeSpan.MaxValue;<span class="comment"></span>
<a name="l00052"></a>00052 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00053"></a>00053 <span class="comment">        /// Existence and modified date metadata about files is cached for, at longest, this amount of time after it is first stored.</span>
<a name="l00054"></a>00054 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00055"></a>00055 <span class="comment"></span>        <span class="keyword">public</span> TimeSpan MetadataAbsoluteExpiration
<a name="l00056"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_virtual_path_provider.html#a38e50849c519fedc6aeb95ad5eda1daa">00056</a>         {
<a name="l00057"></a>00057             <span class="keyword">get</span>
<a name="l00058"></a>00058             {
<a name="l00059"></a>00059                 <span class="keywordflow">return</span> _metadataAbsoluteExpiration;<span class="comment">//1 hr</span>
<a name="l00060"></a>00060             }
<a name="l00061"></a>00061             <span class="keyword">set</span>
<a name="l00062"></a>00062             {
<a name="l00063"></a>00063                 <span class="keywordflow">if</span> (!(value == TimeSpan.MaxValue || MetadataSlidingExpiration == TimeSpan.Zero)) <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;MetadataAbsoluteExpiration must be DateTime.MaxValue or MetadataSlidingExpiration must be timeSpan.Zero.&quot;</span>);
<a name="l00064"></a>00064                 _metadataAbsoluteExpiration = value;
<a name="l00065"></a>00065             }
<a name="l00066"></a>00066         }
<a name="l00067"></a>00067         <span class="keyword">private</span> TimeSpan _metadataSlidingExpiration = <span class="keyword">new</span> TimeSpan(0, 1, 0, 0); <span class="comment">//one hour</span><span class="comment"></span>
<a name="l00068"></a>00068 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00069"></a>00069 <span class="comment">        /// Existence and modified date metadata about files is cached for this long after it is last accessed.</span>
<a name="l00070"></a>00070 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00071"></a>00071 <span class="comment"></span>        <span class="keyword">public</span> TimeSpan MetadataSlidingExpiration
<a name="l00072"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_virtual_path_provider.html#a797191245f76e16af3ce438b3742f4ad">00072</a>         {
<a name="l00073"></a>00073             <span class="keyword">get</span>
<a name="l00074"></a>00074             {
<a name="l00075"></a>00075                 <span class="keywordflow">return</span> _metadataSlidingExpiration;<span class="comment">//1 hr</span>
<a name="l00076"></a>00076             }
<a name="l00077"></a>00077             <span class="keyword">set</span>
<a name="l00078"></a>00078             {
<a name="l00079"></a>00079                 <span class="keywordflow">if</span> (!(MetadataAbsoluteExpiration == TimeSpan.MaxValue || value == TimeSpan.Zero)) <span class="keywordflow">throw</span> <span class="keyword">new</span> ArgumentException(<span class="stringliteral">&quot;MetadataAbsoluteExpiration must be DateTime.MaxValue or MetadataSlidingExpiration must be timeSpan.Zero.&quot;</span>);
<a name="l00080"></a>00080                 _metadataSlidingExpiration = value;
<a name="l00081"></a>00081             }
<a name="l00082"></a>00082 
<a name="l00083"></a>00083         }
<a name="l00084"></a>00084 
<a name="l00085"></a>00085    
<a name="l00086"></a>00086         <span class="keyword">private</span> LitS3.S3Service service = null;<span class="comment"></span>
<a name="l00087"></a>00087 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00088"></a>00088 <span class="comment">        /// Gets and sets the S3Service object that specifies connection details such as authentication, encryption, etc.</span>
<a name="l00089"></a>00089 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00090"></a>00090 <span class="comment"></span>        <span class="keyword">public</span> S3Service Service
<a name="l00091"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_virtual_path_provider.html#aef3bf1f153772bd653d13602887ca4a3">00091</a>         {
<a name="l00092"></a>00092             <span class="keyword">get</span> { <span class="keywordflow">return</span> service; }
<a name="l00093"></a>00093             <span class="keyword">set</span> { service = value; }
<a name="l00094"></a>00094         }
<a name="l00095"></a>00095 
<a name="l00096"></a>00096         <span class="keyword">private</span> <span class="keywordtype">bool</span> _fastMode = <span class="keyword">true</span>;<span class="comment"></span>
<a name="l00097"></a>00097 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00098"></a>00098 <span class="comment">        /// If true, existence of bucket and key is assumed as long as prefix is present.</span>
<a name="l00099"></a>00099 <span class="comment">        /// Defaults to true. Also, no modified date information is provided, so the cache never gets updated. Requires 1 request instead of 2 to download the image.</span>
<a name="l00100"></a>00100 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00101"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_virtual_path_provider.html#a73df927cef18b20829ed898584cfdeff">00101</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">bool</span> FastMode { <span class="keyword">get</span> { <span class="keywordflow">return</span> _fastMode; } <span class="keyword">set</span> { _fastMode = value; } }<span class="comment"></span>
<a name="l00102"></a>00102 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00103"></a>00103 <span class="comment">        /// Create and configure a virtual path provider. </span>
<a name="l00104"></a>00104 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00105"></a>00105 <span class="comment">        /// &lt;param name=&quot;service&quot;&gt;Provide the authentication and ecryption settings. For public buckets, no settings are required. UseSSL should be false for best performance. &lt;/param&gt;</span>
<a name="l00106"></a>00106 <span class="comment">        /// &lt;param name=&quot;virtualFilesystemPrefix&quot;&gt;The virtual folder to allow client access of s3 from.&lt;/param&gt;</span>
<a name="l00107"></a>00107 <span class="comment">        /// &lt;param name=&quot;absoluteMetadataExpiration&quot;&gt;&lt;/param&gt;</span>
<a name="l00108"></a>00108 <span class="comment">        /// &lt;param name=&quot;slidingMetadataExpiration&quot;&gt;&lt;/param&gt;</span>
<a name="l00109"></a>00109 <span class="comment">        /// &lt;param name=&quot;bucketFilterCallback&quot;&gt;You should validate that the requested bucket is your own. If you only want one bucket, just prefix your bucket to the path.&lt;/param&gt;</span>
<a name="l00110"></a>00110 <span class="comment">        /// &lt;param name=&quot;fastMode&quot;&gt;If true, existence of bucket and key is assumed as long as prefix is present. Also, no modified date information is provided to the image resizer, so the cache never gets updated. Requires 1 request instead of 2 to download the image.&lt;/param&gt;</span>
<a name="l00111"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_virtual_path_provider.html#a6a3c5d5b26d0795aedc36bee9d8cac5f">00111</a> <span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_virtual_path_provider.html" title="Allows clients to request objects located on another amazon S3 server through this server...">S3VirtualPathProvider</a>(S3Service service, String virtualFilesystemPrefix, TimeSpan absoluteMetadataExpiration, TimeSpan slidingMetadataExpiration, RewriteBucketAndKeyPath bucketFilterCallback, Boolean fastMode)
<a name="l00112"></a>00112             : base()
<a name="l00113"></a>00113         {
<a name="l00114"></a>00114             this.service = service;
<a name="l00115"></a>00115             this.VirtualFilesystemPrefix = virtualFilesystemPrefix;
<a name="l00116"></a>00116             this.MetadataAbsoluteExpiration = absoluteMetadataExpiration;
<a name="l00117"></a>00117             this.MetadataSlidingExpiration = slidingMetadataExpiration;
<a name="l00118"></a>00118             this.PreS3RequestFilter += bucketFilterCallback;
<a name="l00119"></a>00119             this.FastMode = fastMode;
<a name="l00120"></a>00120         }
<a name="l00121"></a>00121 <span class="comment"></span>
<a name="l00122"></a>00122 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00123"></a>00123 <span class="comment">        /// Default settings: UseSSL=false, VirtualFileSystemPrefix = &quot;~/s3&quot;, SlidingExpiration = 1h, AbsoluteExpiration = maxvalue</span>
<a name="l00124"></a>00124 <span class="comment">        /// No bucket filtering is performed, so any amazon-hosted bucket can be accessed through this provider unless you add a bucket filter.</span>
<a name="l00125"></a>00125 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00126"></a>00126 <span class="comment">        /// &lt;param name=&quot;bucketFilterCallback&quot;&gt;You should validate that the requested bucket is your own. If you only want one bucket, just prefix your bucket to the path.&lt;/param&gt;</span>
<a name="l00127"></a>00127 <span class="comment">        /// &lt;param name=&quot;fastMode&quot;&gt;If true, existence of bucket and key is assumed as long as prefix is present. Also, no modified date information is provided to the image resizer, so the cache never gets updated. Requires 1 request instead of 2 to download the image.&lt;/param&gt;</span>
<a name="l00128"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_virtual_path_provider.html#a04017b8607a46423cc5279884b42c361">00128</a> <span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_virtual_path_provider.html" title="Allows clients to request objects located on another amazon S3 server through this server...">S3VirtualPathProvider</a>(RewriteBucketAndKeyPath bucketFilterCallback, Boolean fastMode)
<a name="l00129"></a>00129             : base()
<a name="l00130"></a>00130         {
<a name="l00131"></a>00131             this.service = <span class="keyword">new</span> S3Service();
<a name="l00132"></a>00132             this.service.UseSsl = <span class="keyword">false</span>;
<a name="l00133"></a>00133             this.PreS3RequestFilter += bucketFilterCallback;
<a name="l00134"></a>00134             this.FastMode = fastMode;
<a name="l00135"></a>00135         }
<a name="l00136"></a>00136   
<a name="l00137"></a>00137         <span class="keyword">protected</span> <span class="keyword">override</span> <span class="keywordtype">void</span> Initialize()
<a name="l00138"></a>00138         {
<a name="l00139"></a>00139 
<a name="l00140"></a>00140         }
<a name="l00141"></a>00141 <span class="comment"></span>
<a name="l00142"></a>00142 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00143"></a>00143 <span class="comment">        ///   Determines whether a specified virtual path is within</span>
<a name="l00144"></a>00144 <span class="comment">        ///   the virtual file system.</span>
<a name="l00145"></a>00145 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00146"></a>00146 <span class="comment">        /// &lt;param name=&quot;virtualPath&quot;&gt;An absolute virtual path.&lt;/param&gt;</span>
<a name="l00147"></a>00147 <span class="comment">        /// &lt;returns&gt;</span>
<a name="l00148"></a>00148 <span class="comment">        ///   true if the virtual path is within the </span>
<a name="l00149"></a>00149 <span class="comment">        ///   virtual file sytem; otherwise, false.</span>
<a name="l00150"></a>00150 <span class="comment">        /// &lt;/returns&gt;</span>
<a name="l00151"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_virtual_path_provider.html#a9dd1f1484dbbf071cbcf79b347c77fb5">00151</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">bool</span> IsPathVirtual(<span class="keywordtype">string</span> virtualPath)
<a name="l00152"></a>00152         {
<a name="l00153"></a>00153             <span class="keywordflow">return</span> virtualPath.StartsWith(VirtualFilesystemPrefix, StringComparison.OrdinalIgnoreCase);
<a name="l00154"></a>00154         }
<a name="l00155"></a>00155 
<a name="l00156"></a>00156         <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> FileExists(<span class="keywordtype">string</span> virtualPath)
<a name="l00157"></a>00157         {
<a name="l00158"></a>00158             <span class="keywordflow">if</span> (IsPathVirtual(virtualPath))
<a name="l00159"></a>00159             {
<a name="l00160"></a>00160                 <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_s3_reader_1_1_s3_file.html">S3File</a>(virtualPath, <span class="keyword">this</span>).Exists;
<a name="l00161"></a>00161             }
<a name="l00162"></a>00162             <span class="keywordflow">else</span>
<a name="l00163"></a>00163                 <span class="keywordflow">return</span> Previous.FileExists(virtualPath);
<a name="l00164"></a>00164         }
<a name="l00165"></a>00165 
<a name="l00166"></a>00166 
<a name="l00167"></a>00167         <span class="keyword">public</span> <span class="keyword">override</span> VirtualFile GetFile(<span class="keywordtype">string</span> virtualPath)
<a name="l00168"></a>00168         {
<a name="l00169"></a>00169             <span class="keywordflow">if</span> (IsPathVirtual(virtualPath))
<a name="l00170"></a>00170 
<a name="l00171"></a>00171                 <span class="keywordflow">return</span> <span class="keyword">new</span> S3File(virtualPath, <span class="keyword">this</span>);
<a name="l00172"></a>00172             <span class="keywordflow">else</span>
<a name="l00173"></a>00173                 <span class="keywordflow">return</span> Previous.GetFile(virtualPath);
<a name="l00174"></a>00174         }
<a name="l00175"></a>00175 <span class="comment"></span>
<a name="l00176"></a>00176 <span class="comment">        /**</span>
<a name="l00177"></a>00177 <span class="comment">         * Since we can&#39;t watch S3. If you want to invalidate the cache through code or sql, modify this class. For the ASP.NET cache, not the image resizer disk cache.</span>
<a name="l00178"></a>00178 <span class="comment">         */</span>
<a name="l00179"></a>00179         <span class="keyword">private</span> <span class="keyword">class </span>EmptyCacheDependency : CacheDependency
<a name="l00180"></a>00180         {
<a name="l00181"></a>00181             <span class="keyword">public</span> EmptyCacheDependency()
<a name="l00182"></a>00182             {
<a name="l00183"></a>00183             }
<a name="l00184"></a>00184         }
<a name="l00185"></a>00185         
<a name="l00186"></a>00186         <span class="keyword">public</span> <span class="keyword">override</span> CacheDependency GetCacheDependency(
<a name="l00187"></a>00187           <span class="keywordtype">string</span> virtualPath,
<a name="l00188"></a>00188           System.Collections.IEnumerable virtualPathDependencies,
<a name="l00189"></a>00189           DateTime utcStart)
<a name="l00190"></a>00190         {
<a name="l00191"></a>00191             <span class="keywordflow">if</span> (IsPathVirtual(virtualPath))
<a name="l00192"></a>00192                 <span class="keywordflow">return</span> <span class="keyword">new</span> EmptyCacheDependency();
<a name="l00193"></a>00193             <span class="keywordflow">else</span>
<a name="l00194"></a>00194                 <span class="keywordflow">return</span> Previous.GetCacheDependency(virtualPath, virtualPathDependencies, utcStart);
<a name="l00195"></a>00195         }
<a name="l00196"></a>00196 
<a name="l00197"></a>00197 
<a name="l00198"></a>00198 
<a name="l00199"></a>00199 
<a name="l00200"></a>00200         <span class="keyword">public</span> <span class="keywordtype">bool</span> FileExists(<span class="keywordtype">string</span> virtualPath, System.Collections.Specialized.NameValueCollection queryString) {
<a name="l00201"></a>00201             <span class="keywordflow">return</span> IsPathVirtual(virtualPath) &amp;&amp; <span class="keyword">new</span> S3File(virtualPath, <span class="keyword">this</span>).Exists;
<a name="l00202"></a>00202         }
<a name="l00203"></a>00203 
<a name="l00204"></a>00204         <span class="keyword">public</span> IVirtualFile GetFile(<span class="keywordtype">string</span> virtualPath, System.Collections.Specialized.NameValueCollection queryString) {
<a name="l00205"></a>00205             <span class="keywordflow">return</span> (IsPathVirtual(virtualPath)) ? <span class="keyword">new</span> S3File(virtualPath, <span class="keyword">this</span>) : null;
<a name="l00206"></a>00206         }
<a name="l00207"></a>00207     }
<a name="l00208"></a>00208 
<a name="l00209"></a>00209 
<a name="l00210"></a>00210     
<a name="l00211"></a>00211 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
