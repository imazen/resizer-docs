<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>ImageResizer: C:/Users/nathanael/Documents/resizer/Plugins/AdvancedFilters/AdvancedFilters.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="imageresizer-logo-00aec4.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.4.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_0b4eaef40a1fe20bedafe9e8e719ce66.html">Plugins</a></li><li class="navelem"><a class="el" href="dir_6ebbed10225b1bf2325ae1d4dbc264cb.html">AdvancedFilters</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">AdvancedFilters.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* Copyright (c) 2011 Nathanael Jones. See license.txt for your rights */</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">using</span> System;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">using</span> System.Collections.Generic;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using</span> System.Text;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using</span> ImageResizer;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">using</span> ImageResizer.Resizing;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">using</span> AForge.Imaging.Filters;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using</span> AForge;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">using</span> System.Globalization;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">using</span> ImageResizer.Util;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">using</span> System.Drawing;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">using</span> ImageResizer.ExtensionMethods;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">using</span> System.Drawing.Imaging;</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;</div>
<div class="line"><a name="l00015"></a><span class="lineno"><a class="line" href="namespace_image_resizer_1_1_plugins_1_1_advanced_filters.html">   15</a></span>&#160;<span class="keyword">namespace </span>ImageResizer.Plugins.<a class="code" href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html">AdvancedFilters</a> {</div>
<div class="line"><a name="l00016"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html">   16</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html">AdvancedFilters</a>:<a class="code" href="class_image_resizer_1_1_resizing_1_1_builder_extension.html">BuilderExtension</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html">IPlugin</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_querystring_plugin.html">IQuerystringPlugin</a> {</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;        <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html">AdvancedFilters</a>() {</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        }</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;        <span class="keyword">public</span> <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html">IPlugin</a> Install(Configuration.Config c) {</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;            c.Plugins.add_plugin(<span class="keyword">this</span>);</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">this</span>;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;        }</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> Uninstall(Configuration.Config c) {</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;            c.Plugins.remove_plugin(<span class="keyword">this</span>);</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;        }</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">        /// Calculates a radius based on the provided value, using min(width/height) as the normalizing factor. Querystring values are interpreted as 1/1000ths of the normalizing factor.</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">        /// &lt;param name=&quot;s&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">        /// &lt;param name=&quot;key&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">        /// &lt;param name=&quot;key2&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html#ac64f3ef30b544c1bb33b706978d6dee6">   37</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keywordtype">int</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html#ac64f3ef30b544c1bb33b706978d6dee6">GetRadius</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s, <span class="keywordtype">string</span> key, <span class="keywordtype">string</span> key2, <span class="keywordtype">double</span> units) {</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;            <span class="keywordtype">string</span> str = s.settings[key];</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;            <span class="keywordflow">if</span> (<span class="keywordtype">string</span>.IsNullOrEmpty(str) &amp;&amp; key2 != null) str = s.settings[key2];</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;            <span class="keywordflow">if</span> (<span class="keywordtype">string</span>.IsNullOrEmpty(str)) <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;            <span class="keywordtype">double</span> d;</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;            <span class="keywordflow">if</span> (<span class="keywordtype">double</span>.TryParse(str, <a class="code" href="class_image_resizer_1_1_util_1_1_parse_utils.html">ParseUtils</a>.<a class="code" href="class_image_resizer_1_1_util_1_1_parse_utils.html#a42453d70c2d660deaffbf5554be90f03">FloatingPointStyle</a>, NumberFormatInfo.InvariantInfo, out d) &amp;&amp; d &gt; 0) {</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                <span class="keywordtype">double</span> factor = Util.PolygonMath.GetShortestPair(s.layout[<span class="stringliteral">&quot;image&quot;</span>]) / units;</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                <span class="keywordflow">return</span> (<span class="keywordtype">int</span>)Math.Round(factor * d);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;            }</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;            <span class="keywordflow">return</span> -1;</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;        }</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;</div>
<div class="line"><a name="l00051"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html#aea7771c128270ddb68c9897b879240b1">   51</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html#aea7771c128270ddb68c9897b879240b1">PreRenderImage</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s)</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        {</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;            <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0">sourceBitmap</a> == null) <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;            <span class="keywordflow">if</span> (!s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>.<a class="code" href="class_image_resizer_1_1_resize_settings.html#a579b233682b72251b40f1c7515f2423f">WasOneSpecified</a>(<span class="stringliteral">&quot;a.featheredges&quot;</span>)) <span class="keywordflow">return</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a>.None;</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8cba68835deaa450ce6317f4e55ff51e">ApplyCropping</a>();</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;            s.EnsureRGBA();</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;            s.EnsurePreRenderBitmap();</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;            ApplyPreFiltersTo(ref s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#acd58bc890cee2f8d314ae94c2508d0b5">preRenderBitmap</a>, s);</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;        }</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;</div>
<div class="line"><a name="l00064"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html#a2f14f3c178492dbc8ba82dfe94db7545">   64</a></span>&#160;        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html#a2f14f3c178492dbc8ba82dfe94db7545">PostRenderImage</a>(<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s) {</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;            <span class="keywordflow">if</span> (s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a3ecc996b00bfe20e621a43107312233d">destBitmap</a> == null) <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;            Bitmap b = s.destBitmap;</div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;            ApplyFiltersTo(ref b, s);</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;            s.destBitmap = b;</div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;        }</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;</div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;        <span class="keyword">protected</span> <span class="keywordtype">void</span> ApplyPreFiltersTo(ref Bitmap b, <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s) {</div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;            <span class="keywordtype">string</span> str = null;</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;            <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;            <span class="keywordtype">double</span> units = s.settings.Get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;a.radiusunits&quot;</span>, 1000);</div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;            <span class="keywordtype">float</span> fin = s.settings.Get&lt;<span class="keywordtype">float</span>&gt;(<span class="stringliteral">&quot;a.featherin&quot;</span>, 1);</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;            <span class="keywordtype">float</span> fout = s.settings.Get&lt;<span class="keywordtype">float</span>&gt;(<span class="stringliteral">&quot;a.featherout&quot;</span>, 0);</div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;</div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;            i = GetRadius(s, <span class="stringliteral">&quot;a.featheredges&quot;</span>, null, units * (Util.PolygonMath.GetShortestPair(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e">layout</a>[<span class="stringliteral">&quot;image&quot;</span>]) / Math.Min(b.Width,b.Height)));</div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;            <span class="keywordflow">if</span> (i &gt; 0) <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_feather_edge.html">FeatherEdge</a>(fout, fin, i).ApplyInPlace(b);</div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;        }</div>
<div class="line"><a name="l00084"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html#a69c9bc72da157f93dffe47ea1a0c9613">   84</a></span>&#160;        <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html#a69c9bc72da157f93dffe47ea1a0c9613">ApplyFiltersTo</a>(ref Bitmap b, <a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageState</a> s){</div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;</div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;            <span class="comment">//TODO: if the image is unrotated, use a rectangle to limit the effect to the desired area</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;</div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;            <span class="keywordtype">string</span> str = null;</div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;            <span class="keywordtype">int</span> i = 0;</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;</div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;            <span class="comment">//If radiusunits is specified, use that code path.</span></div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;            <span class="keywordtype">double</span> units = s.settings.Get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;a.radiusunits&quot;</span>,1000);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;           </div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;            i = GetRadius(s, <span class="stringliteral">&quot;blur&quot;</span>, <span class="stringliteral">&quot;a.blur&quot;</span>, units);</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;            <span class="keywordflow">if</span> (i &gt; 0) <span class="keyword">new</span> GaussianBlur(1.4, i).ApplyInPlace(b);</div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;            i = GetRadius(s, <span class="stringliteral">&quot;sharpen&quot;</span>, <span class="stringliteral">&quot;a.sharpen&quot;</span>, units);</div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;            <span class="keywordflow">if</span> (i &gt; 0) <span class="keyword">new</span> GaussianSharpen(1.4, Math.Min(11,i)).ApplyInPlace(b);</div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;            i = GetRadius(s, <span class="stringliteral">&quot;a.oilpainting&quot;</span>, null, units);</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;            <span class="keywordflow">if</span> (i &gt; 0) <span class="keyword">new</span> OilPainting(i).ApplyInPlace(b);</div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;            <span class="keywordflow">if</span> (<span class="stringliteral">&quot;true&quot;</span>.Equals(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>[<span class="stringliteral">&quot;a.removenoise&quot;</span>], StringComparison.OrdinalIgnoreCase)) {</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                <span class="keyword">new</span> ConservativeSmoothing(3).ApplyInPlace(b);</div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                i = GetRadius(s, <span class="stringliteral">&quot;a.removenoise&quot;</span>, null, units);</div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                <span class="keywordflow">if</span> (i &gt; 0) <span class="keyword">new</span> ConservativeSmoothing(i).ApplyInPlace(b);</div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;            }</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;</div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;</div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;            <span class="comment">//Sobel only supports 8bpp grayscale images.</span></div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;            <span class="comment">//true/false</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            <span class="keywordflow">if</span> (<span class="stringliteral">&quot;true&quot;</span>.Equals(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>[<span class="stringliteral">&quot;a.sobel&quot;</span>], StringComparison.OrdinalIgnoreCase)){</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;                Bitmap old = b;</div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;                <span class="keywordflow">try</span>{</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;                    b = Grayscale.CommonAlgorithms.Y.Apply(b);</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;                }<span class="keywordflow">finally</span>{</div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;                    <span class="keywordflow">if</span> (old != s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0">sourceBitmap</a>) old.Dispose();</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;                }</div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;                </div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;                <span class="keyword">new</span> SobelEdgeDetector().ApplyInPlace(b);</div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;</div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;                str = s.settings[<span class="stringliteral">&quot;a.threshold&quot;</span>]; <span class="comment">//radius</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;                <span class="keywordflow">if</span> (!<span class="keywordtype">string</span>.IsNullOrEmpty(str) &amp;&amp; int.TryParse(str, NumberStyles.Integer, NumberFormatInfo.InvariantInfo, out i) &amp;&amp; i &gt; 0)</div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;                 <span class="keyword">new</span> Threshold(i).ApplyInPlace(b);</div>
<div class="line"><a name="l00127"></a><span class="lineno">  127</span>&#160;    </div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;            }</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;            <span class="comment">//Canny Edge Detector only supports 8bpp grayscale images.</span></div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;            <span class="comment">//true/false</span></div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;            <span class="keywordflow">if</span> (<span class="stringliteral">&quot;true&quot;</span>.Equals(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>[<span class="stringliteral">&quot;a.canny&quot;</span>], StringComparison.OrdinalIgnoreCase)) {</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;                Bitmap old = b;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;                <span class="keywordflow">try</span> {</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;                    b = Grayscale.CommonAlgorithms.Y.Apply(b);</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;                } <span class="keywordflow">finally</span> {</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;                    <span class="keywordflow">if</span> (old != s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0">sourceBitmap</a>) old.Dispose();</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;                }</div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;                <span class="keyword">new</span> CannyEdgeDetector().ApplyInPlace(b);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;</div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;            }</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;            <span class="comment">//true/false - duplicate with SimpleFilters?</span></div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;            <span class="keywordflow">if</span> (<span class="stringliteral">&quot;true&quot;</span>.Equals(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>[<span class="stringliteral">&quot;a.sepia&quot;</span>], StringComparison.OrdinalIgnoreCase))</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;                <span class="keyword">new</span> Sepia().ApplyInPlace(b);</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;            </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;            <span class="comment">//true/false</span></div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;            <span class="keywordflow">if</span> (<span class="stringliteral">&quot;true&quot;</span>.Equals(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>[<span class="stringliteral">&quot;a.equalize&quot;</span>], StringComparison.OrdinalIgnoreCase))</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;                <span class="keyword">new</span> HistogramEqualization().ApplyInPlace(b);</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;<span class="comment">            ///White balance adjustment</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;<span class="comment"></span>            var whiteAlg = s.settings.Get&lt;<a class="code" href="namespace_image_resizer_1_1_plugins_1_1_advanced_filters.html#a7a2b91bebff5f5da23b87878e278b4bb">HistogramThresholdAlgorithm</a>&gt;(<span class="stringliteral">&quot;a.balancewhite&quot;</span>);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;            var whiteVal = s.settings.Get&lt;<span class="keywordtype">double</span>&gt;(<span class="stringliteral">&quot;a.balancethreshold&quot;</span>);</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;</div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;            <span class="keywordflow">if</span> (whiteAlg != null || whiteVal != null) {</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;                var bal = <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_auto_white_balance.html">AutoWhiteBalance</a>(whiteAlg ?? <a class="code" href="namespace_image_resizer_1_1_plugins_1_1_advanced_filters.html#a7a2b91bebff5f5da23b87878e278b4bb">HistogramThresholdAlgorithm</a>.Area);</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;                <span class="keywordflow">if</span> (whiteVal != null) bal.LowThreshold = bal.HighThreshold = whiteVal.Value / 100;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;                bal.ApplyInPlace(b);</div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;            }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;</div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;            str = s.settings[<span class="stringliteral">&quot;a.posterize&quot;</span>]; <span class="comment">//number of colors to merge</span></div>
<div class="line"><a name="l00163"></a><span class="lineno">  163</span>&#160;            <span class="keywordflow">if</span> (!<span class="keywordtype">string</span>.IsNullOrEmpty(str) &amp;&amp; int.TryParse(str, NumberStyles.Integer, NumberFormatInfo.InvariantInfo, out i) &amp;&amp; i &gt; 0) {</div>
<div class="line"><a name="l00164"></a><span class="lineno">  164</span>&#160;                SimplePosterization sp = <span class="keyword">new</span> SimplePosterization();</div>
<div class="line"><a name="l00165"></a><span class="lineno">  165</span>&#160;                <span class="keywordflow">if</span> (i &lt; 1) i = 1; </div>
<div class="line"><a name="l00166"></a><span class="lineno">  166</span>&#160;                <span class="keywordflow">if</span> (i &gt; 255) i = 255;</div>
<div class="line"><a name="l00167"></a><span class="lineno">  167</span>&#160;                sp.PosterizationInterval =(byte)i;</div>
<div class="line"><a name="l00168"></a><span class="lineno">  168</span>&#160;                sp.ApplyInPlace(b); </div>
<div class="line"><a name="l00169"></a><span class="lineno">  169</span>&#160;            }</div>
<div class="line"><a name="l00170"></a><span class="lineno">  170</span>&#160;</div>
<div class="line"><a name="l00171"></a><span class="lineno">  171</span>&#160;            <span class="comment">//Pixellate doesn&#39;t support 32-bit images, only 24-bit</span></div>
<div class="line"><a name="l00172"></a><span class="lineno">  172</span>&#160;            <span class="comment">//str = s.settings[&quot;a.pixelate&quot;]; //number of colors to merge</span></div>
<div class="line"><a name="l00173"></a><span class="lineno">  173</span>&#160;            <span class="comment">//if (!string.IsNullOrEmpty(str) &amp;&amp; int.TryParse(str, out i)){</span></div>
<div class="line"><a name="l00174"></a><span class="lineno">  174</span>&#160;            <span class="comment">//     if (i &lt; 2) i = 2; </span></div>
<div class="line"><a name="l00175"></a><span class="lineno">  175</span>&#160;            <span class="comment">//    if (i &gt; 32) i = 32;</span></div>
<div class="line"><a name="l00176"></a><span class="lineno">  176</span>&#160;            <span class="comment">//    new Pixellate(i).ApplyInPlace(s.destBitmap); </span></div>
<div class="line"><a name="l00177"></a><span class="lineno">  177</span>&#160;            <span class="comment">//}</span></div>
<div class="line"><a name="l00178"></a><span class="lineno">  178</span>&#160;            </div>
<div class="line"><a name="l00179"></a><span class="lineno">  179</span>&#160;</div>
<div class="line"><a name="l00180"></a><span class="lineno">  180</span>&#160;            <span class="keywordtype">float</span> contrast = s.settings.Get&lt;<span class="keywordtype">float</span>&gt;(<span class="stringliteral">&quot;a.contrast&quot;</span>, 0);</div>
<div class="line"><a name="l00181"></a><span class="lineno">  181</span>&#160;            <span class="keywordtype">float</span> brightness = s.settings.Get&lt;<span class="keywordtype">float</span>&gt;(<span class="stringliteral">&quot;a.brightness&quot;</span>, 0);</div>
<div class="line"><a name="l00182"></a><span class="lineno">  182</span>&#160;            <span class="keywordtype">float</span> saturation = s.settings.Get&lt;<span class="keywordtype">float</span>&gt;(<span class="stringliteral">&quot;a.saturation&quot;</span>, 0);</div>
<div class="line"><a name="l00183"></a><span class="lineno">  183</span>&#160;</div>
<div class="line"><a name="l00184"></a><span class="lineno">  184</span>&#160;            <span class="keywordflow">if</span> (contrast != 0 || brightness != 0 || saturation != 0){</div>
<div class="line"><a name="l00185"></a><span class="lineno">  185</span>&#160;                HSLLinear adjust = <span class="keyword">new</span> HSLLinear();</div>
<div class="line"><a name="l00186"></a><span class="lineno">  186</span>&#160;                AdjustContrastBrightnessSaturation(adjust, contrast, brightness, saturation, <span class="stringliteral">&quot;true&quot;</span>.Equals(s.<a class="code" href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">settings</a>[<span class="stringliteral">&quot;a.truncate&quot;</span>]));</div>
<div class="line"><a name="l00187"></a><span class="lineno">  187</span>&#160;                adjust.ApplyInPlace(b);</div>
<div class="line"><a name="l00188"></a><span class="lineno">  188</span>&#160;            }</div>
<div class="line"><a name="l00189"></a><span class="lineno">  189</span>&#160;            <span class="comment">//TODO - add grayscale?</span></div>
<div class="line"><a name="l00190"></a><span class="lineno">  190</span>&#160;</div>
<div class="line"><a name="l00191"></a><span class="lineno">  191</span>&#160;            <span class="comment">//For adding fax-like thresholding, use BradleyLocalThresholding</span></div>
<div class="line"><a name="l00192"></a><span class="lineno">  192</span>&#160;</div>
<div class="line"><a name="l00193"></a><span class="lineno">  193</span>&#160;            <span class="comment">//For trimming solid-color whitespace, use Shrink</span></div>
<div class="line"><a name="l00194"></a><span class="lineno">  194</span>&#160;</div>
<div class="line"><a name="l00195"></a><span class="lineno">  195</span>&#160;        }</div>
<div class="line"><a name="l00196"></a><span class="lineno">  196</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00197"></a><span class="lineno">  197</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00198"></a><span class="lineno">  198</span>&#160;<span class="comment">        /// </span></div>
<div class="line"><a name="l00199"></a><span class="lineno">  199</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00200"></a><span class="lineno">  200</span>&#160;<span class="comment">        /// &lt;param name=&quot;f&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00201"></a><span class="lineno">  201</span>&#160;<span class="comment">        /// &lt;param name=&quot;contrast&quot;&gt;-1..1 float to adjust contrast. &lt;/param&gt;</span></div>
<div class="line"><a name="l00202"></a><span class="lineno">  202</span>&#160;<span class="comment">        /// &lt;param name=&quot;brightness&quot;&gt;-1..1 float to adjust luminance (brightness). 0 does nothing&lt;/param&gt;</span></div>
<div class="line"><a name="l00203"></a><span class="lineno">  203</span>&#160;<span class="comment">        /// &lt;param name=&quot;saturation&quot;&gt;-1..1 float to adjust saturation.  0 does nothing  &lt;/param&gt;</span></div>
<div class="line"><a name="l00204"></a><span class="lineno">  204</span>&#160;<span class="comment">        /// &lt;param name=&quot;truncate&quot;&gt;If false, adjusting brightness and luminance will adjust contrast also. True causes white/black washout instead.&lt;/param&gt;</span></div>
<div class="line"><a name="l00205"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html#af52859902b49d2eb03b00262889f5f78">  205</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keywordtype">void</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html#af52859902b49d2eb03b00262889f5f78">AdjustContrastBrightnessSaturation</a>(HSLLinear f, <span class="keywordtype">float</span> contrast, <span class="keywordtype">float</span> brightness, <span class="keywordtype">float</span> saturation, <span class="keywordtype">bool</span> truncate) {</div>
<div class="line"><a name="l00206"></a><span class="lineno">  206</span>&#160;            brightness = Math.Max(-1.0f, Math.Min(1.0f, brightness));</div>
<div class="line"><a name="l00207"></a><span class="lineno">  207</span>&#160;            saturation = Math.Max(-1.0f, Math.Min(1.0f, saturation));</div>
<div class="line"><a name="l00208"></a><span class="lineno">  208</span>&#160;            contrast = Math.Max(-1.0f, Math.Min(1.0f, contrast));</div>
<div class="line"><a name="l00209"></a><span class="lineno">  209</span>&#160;</div>
<div class="line"><a name="l00210"></a><span class="lineno">  210</span>&#160;</div>
<div class="line"><a name="l00211"></a><span class="lineno">  211</span>&#160;            <span class="comment">// create luminance filter</span></div>
<div class="line"><a name="l00212"></a><span class="lineno">  212</span>&#160;            <span class="keywordflow">if</span> (brightness &gt; 0) {</div>
<div class="line"><a name="l00213"></a><span class="lineno">  213</span>&#160;                f.InLuminance = <span class="keyword">new</span> Range(0.0f, 1.0f - (truncate ? brightness : 0)); <span class="comment">//TODO - isn&#39;t it better not to truncate, but compress?</span></div>
<div class="line"><a name="l00214"></a><span class="lineno">  214</span>&#160;                f.OutLuminance = <span class="keyword">new</span> Range(brightness, 1.0f);</div>
<div class="line"><a name="l00215"></a><span class="lineno">  215</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00216"></a><span class="lineno">  216</span>&#160;                f.InLuminance = <span class="keyword">new</span> Range((truncate ? -brightness : 0), 1.0f);</div>
<div class="line"><a name="l00217"></a><span class="lineno">  217</span>&#160;                f.OutLuminance = <span class="keyword">new</span> Range(0.0f, 1.0f + brightness);</div>
<div class="line"><a name="l00218"></a><span class="lineno">  218</span>&#160;            }</div>
<div class="line"><a name="l00219"></a><span class="lineno">  219</span>&#160;            <span class="comment">// create saturation filter</span></div>
<div class="line"><a name="l00220"></a><span class="lineno">  220</span>&#160;            <span class="keywordflow">if</span> (saturation &gt; 0) {</div>
<div class="line"><a name="l00221"></a><span class="lineno">  221</span>&#160;                f.InSaturation = <span class="keyword">new</span> Range(0.0f, 1.0f - (truncate ? saturation : 0)); <span class="comment">//Ditto?</span></div>
<div class="line"><a name="l00222"></a><span class="lineno">  222</span>&#160;                f.OutSaturation = <span class="keyword">new</span> Range(saturation, 1.0f);</div>
<div class="line"><a name="l00223"></a><span class="lineno">  223</span>&#160;            } <span class="keywordflow">else</span> {</div>
<div class="line"><a name="l00224"></a><span class="lineno">  224</span>&#160;                f.InSaturation = <span class="keyword">new</span> Range((truncate ? -saturation : 0), 1.0f);</div>
<div class="line"><a name="l00225"></a><span class="lineno">  225</span>&#160;                f.OutSaturation = <span class="keyword">new</span> Range(0.0f, 1.0f + saturation);</div>
<div class="line"><a name="l00226"></a><span class="lineno">  226</span>&#160;            }</div>
<div class="line"><a name="l00227"></a><span class="lineno">  227</span>&#160;</div>
<div class="line"><a name="l00228"></a><span class="lineno">  228</span>&#160;            <span class="keywordflow">if</span> (contrast &gt; 0) {</div>
<div class="line"><a name="l00229"></a><span class="lineno">  229</span>&#160;                <span class="keywordtype">float</span> adjustment =  contrast * (f.InLuminance.Max - f.InLuminance.Min) / 2;</div>
<div class="line"><a name="l00230"></a><span class="lineno">  230</span>&#160;                f.InLuminance = <span class="keyword">new</span> Range(f.InLuminance.Min + adjustment, f.InLuminance.Max - adjustment);</div>
<div class="line"><a name="l00231"></a><span class="lineno">  231</span>&#160;            } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (contrast &lt; 0) {</div>
<div class="line"><a name="l00232"></a><span class="lineno">  232</span>&#160;                <span class="keywordtype">float</span> adjustment = -contrast * (f.OutLuminance.Max - f.OutLuminance.Min) / 2;</div>
<div class="line"><a name="l00233"></a><span class="lineno">  233</span>&#160;                f.OutLuminance = <span class="keyword">new</span> Range(f.OutLuminance.Min + adjustment, f.OutLuminance.Max - adjustment);</div>
<div class="line"><a name="l00234"></a><span class="lineno">  234</span>&#160;            }</div>
<div class="line"><a name="l00235"></a><span class="lineno">  235</span>&#160;        }</div>
<div class="line"><a name="l00236"></a><span class="lineno">  236</span>&#160;</div>
<div class="line"><a name="l00237"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html#a7d79aa20acf3b420d028e3249ecbdcd4">  237</a></span>&#160;        <span class="keyword">public</span> IEnumerable&lt;string&gt; <a class="code" href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html#a7d79aa20acf3b420d028e3249ecbdcd4">GetSupportedQuerystringKeys</a>() {</div>
<div class="line"><a name="l00238"></a><span class="lineno">  238</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">new</span> <span class="keywordtype">string</span>[] { <span class="stringliteral">&quot;blur&quot;</span>, <span class="stringliteral">&quot;sharpen&quot;</span> , <span class="stringliteral">&quot;a.blur&quot;</span>, <span class="stringliteral">&quot;a.sharpen&quot;</span>, <span class="stringliteral">&quot;a.oilpainting&quot;</span>, <span class="stringliteral">&quot;a.removenoise&quot;</span>, </div>
<div class="line"><a name="l00239"></a><span class="lineno">  239</span>&#160;                                <span class="stringliteral">&quot;a.sobel&quot;</span>, <span class="stringliteral">&quot;a.threshold&quot;</span>, <span class="stringliteral">&quot;a.canny&quot;</span>, <span class="stringliteral">&quot;a.sepia&quot;</span>, <span class="stringliteral">&quot;a.equalize&quot;</span>, <span class="stringliteral">&quot;a.posterize&quot;</span>, </div>
<div class="line"><a name="l00240"></a><span class="lineno">  240</span>&#160;                                <span class="stringliteral">&quot;a.contrast&quot;</span>, <span class="stringliteral">&quot;a.brightness&quot;</span>, <span class="stringliteral">&quot;a.saturation&quot;</span>,<span class="stringliteral">&quot;a.truncate&quot;</span>,<span class="stringliteral">&quot;a.balancewhite&quot;</span>, <span class="stringliteral">&quot;a.balancethreshold&quot;</span>, <span class="stringliteral">&quot;a.featheredges&quot;</span>};</div>
<div class="line"><a name="l00241"></a><span class="lineno">  241</span>&#160;        }</div>
<div class="line"><a name="l00242"></a><span class="lineno">  242</span>&#160;    }</div>
<div class="line"><a name="l00243"></a><span class="lineno">  243</span>&#160;}</div>
<div class="ttc" id="namespace_image_resizer_1_1_resizing_html_a22bbb53580a122efe469a26ad584fa86"><div class="ttname"><a href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">ImageResizer.Resizing.RequestedAction</a></div><div class="ttdeci">RequestedAction</div><div class="ttdoc">What to do about remaining handlers/methods for the specified section </div><div class="ttdef"><b>Definition:</b> <a href="_abstract_image_processor_8cs_source.html#l00013">AbstractImageProcessor.cs:13</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters_html_a7d79aa20acf3b420d028e3249ecbdcd4"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html#a7d79aa20acf3b420d028e3249ecbdcd4">ImageResizer.Plugins.AdvancedFilters.AdvancedFilters.GetSupportedQuerystringKeys</a></div><div class="ttdeci">IEnumerable&lt; string &gt; GetSupportedQuerystringKeys()</div><div class="ttdoc">If the plugin reads any values from the querystring, the names of the keys should be specified here...</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_filters_8cs_source.html#l00237">AdvancedFilters.cs:237</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_image_state_html_a8cba68835deaa450ce6317f4e55ff51e"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8cba68835deaa450ce6317f4e55ff51e">ImageResizer.Resizing.ImageState.ApplyCropping</a></div><div class="ttdeci">void ApplyCropping()</div><div class="ttdoc">Applies copyRect (if it will have any effect), placing the result in preRenderBitmap, and resetting copyRect </div><div class="ttdef"><b>Definition:</b> <a href="_image_state_8cs_source.html#l00099">ImageState.cs:99</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_util_1_1_parse_utils_html_a42453d70c2d660deaffbf5554be90f03"><div class="ttname"><a href="class_image_resizer_1_1_util_1_1_parse_utils.html#a42453d70c2d660deaffbf5554be90f03">ImageResizer.Util.ParseUtils.FloatingPointStyle</a></div><div class="ttdeci">const NumberStyles FloatingPointStyle</div><div class="ttdoc">Defines a parsing style that permits leading/trailing whitespace, a leading negitve/postiive sign...</div><div class="ttdef"><b>Definition:</b> <a href="_parse_utils_8cs_source.html#l00017">ParseUtils.cs:17</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters_html"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html">ImageResizer.Plugins.AdvancedFilters.AdvancedFilters</a></div><div class="ttdef"><b>Definition:</b> <a href="_advanced_filters_8cs_source.html#l00016">AdvancedFilters.cs:16</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters_html_ac64f3ef30b544c1bb33b706978d6dee6"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html#ac64f3ef30b544c1bb33b706978d6dee6">ImageResizer.Plugins.AdvancedFilters.AdvancedFilters.GetRadius</a></div><div class="ttdeci">int GetRadius(ImageState s, string key, string key2, double units)</div><div class="ttdoc">Calculates a radius based on the provided value, using min(width/height) as the normalizing factor...</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_filters_8cs_source.html#l00037">AdvancedFilters.cs:37</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_auto_white_balance_html"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_auto_white_balance.html">ImageResizer.Plugins.AdvancedFilters.AutoWhiteBalance</a></div><div class="ttdef"><b>Definition:</b> <a href="_auto_white_balance_8cs_source.html#l00028">AutoWhiteBalance.cs:28</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_image_state_html_a7229be6e840514ac987e571bfa7a9179"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_image_state.html#a7229be6e840514ac987e571bfa7a9179">ImageResizer.Resizing.ImageState.settings</a></div><div class="ttdeci">ResizeSettings settings</div><div class="ttdoc">The commands to apply to the bitmap </div><div class="ttdef"><b>Definition:</b> <a href="_image_state_8cs_source.html#l00025">ImageState.cs:25</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_plugins_1_1_i_querystring_plugin_html"><div class="ttname"><a href="interface_image_resizer_1_1_plugins_1_1_i_querystring_plugin.html">ImageResizer.Plugins.IQuerystringPlugin</a></div><div class="ttdoc">For plugins that access the query string (important!) </div><div class="ttdef"><b>Definition:</b> <a href="_i_querystring_plugin_8cs_source.html#l00010">IQuerystringPlugin.cs:10</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_image_state_html_a3ecc996b00bfe20e621a43107312233d"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_image_state.html#a3ecc996b00bfe20e621a43107312233d">ImageResizer.Resizing.ImageState.destBitmap</a></div><div class="ttdeci">Bitmap destBitmap</div><div class="ttdoc">The destination bitmap. If null, skip drawing commands, but continue layout logic. </div><div class="ttdef"><b>Definition:</b> <a href="_image_state_8cs_source.html#l00178">ImageState.cs:178</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_image_state_html_a8aa9f1c77100b8bb71c5ffa1bdff62d0"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_image_state.html#a8aa9f1c77100b8bb71c5ffa1bdff62d0">ImageResizer.Resizing.ImageState.sourceBitmap</a></div><div class="ttdeci">Bitmap sourceBitmap</div><div class="ttdoc">The source bitmap. If null, skip drawing commands, but continue layout logic. </div><div class="ttdef"><b>Definition:</b> <a href="_image_state_8cs_source.html#l00066">ImageState.cs:66</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters_html_aea7771c128270ddb68c9897b879240b1"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html#aea7771c128270ddb68c9897b879240b1">ImageResizer.Plugins.AdvancedFilters.AdvancedFilters.PreRenderImage</a></div><div class="ttdeci">override RequestedAction PreRenderImage(ImageState s)</div><div class="ttdoc">Process.5(Render).9: Plugins have a chance to pre-process the source image before it gets rendered...</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_filters_8cs_source.html#l00051">AdvancedFilters.cs:51</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html_a579b233682b72251b40f1c7515f2423f"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html#a579b233682b72251b40f1c7515f2423f">ImageResizer.ResizeSettings.WasOneSpecified</a></div><div class="ttdeci">bool WasOneSpecified(params string[] keys)</div><div class="ttdoc">Returns true if any of the specified keys are present in this NameValueCollection ...</div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00132">ResizeSettings.cs:132</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_image_state_html"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_image_state.html">ImageResizer.Resizing.ImageState</a></div><div class="ttdoc">Encapsulates the state of an image being resized. Can be used to simulate a resize as well as actuall...</div><div class="ttdef"><b>Definition:</b> <a href="_image_state_8cs_source.html#l00015">ImageState.cs:15</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_image_state_html_acd58bc890cee2f8d314ae94c2508d0b5"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_image_state.html#acd58bc890cee2f8d314ae94c2508d0b5">ImageResizer.Resizing.ImageState.preRenderBitmap</a></div><div class="ttdeci">Bitmap preRenderBitmap</div><div class="ttdoc">An optional intermediate bitmap, created by plugins who need to process the source bitmap it gets ren...</div><div class="ttdef"><b>Definition:</b> <a href="_image_state_8cs_source.html#l00071">ImageState.cs:71</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters_html_a69c9bc72da157f93dffe47ea1a0c9613"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html#a69c9bc72da157f93dffe47ea1a0c9613">ImageResizer.Plugins.AdvancedFilters.AdvancedFilters.ApplyFiltersTo</a></div><div class="ttdeci">void ApplyFiltersTo(ref Bitmap b, ImageState s)</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_filters_8cs_source.html#l00084">AdvancedFilters.cs:84</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_builder_extension_html"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_builder_extension.html">ImageResizer.Resizing.BuilderExtension</a></div><div class="ttdoc">Provides a useable base class that can be used to modify the behavior of ImageBuilder. When registered with an ImageBuilder instance, the ImageBuilder will call the corresponding methods on the extension prior to executing its own methods. </div><div class="ttdef"><b>Definition:</b> <a href="_builder_extension_8cs_source.html#l00011">BuilderExtension.cs:11</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters_html_a2f14f3c178492dbc8ba82dfe94db7545"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html#a2f14f3c178492dbc8ba82dfe94db7545">ImageResizer.Plugins.AdvancedFilters.AdvancedFilters.PostRenderImage</a></div><div class="ttdeci">override RequestedAction PostRenderImage(ImageState s)</div><div class="ttdoc">Process.5(Render).11: After the image is drawn </div><div class="ttdef"><b>Definition:</b> <a href="_advanced_filters_8cs_source.html#l00064">AdvancedFilters.cs:64</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_image_state_html_a845b5dc0d563cd83e8591ceccdbfe31e"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_image_state.html#a845b5dc0d563cd83e8591ceccdbfe31e">ImageResizer.Resizing.ImageState.layout</a></div><div class="ttdeci">LayoutBuilder layout</div><div class="ttdoc">The layout object. Used for calculated and flowing the layout of the various rings around the image (...</div><div class="ttdef"><b>Definition:</b> <a href="_image_state_8cs_source.html#l00042">ImageState.cs:42</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_plugins_1_1_i_plugin_html"><div class="ttname"><a href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html">ImageResizer.Plugins.IPlugin</a></div><div class="ttdoc">All plugins must implement this. Enables web.config addition and removal. </div><div class="ttdef"><b>Definition:</b> <a href="_i_plugin_8cs_source.html#l00011">IPlugin.cs:11</a></div></div>
<div class="ttc" id="namespace_image_resizer_1_1_plugins_1_1_advanced_filters_html_a7a2b91bebff5f5da23b87878e278b4bb"><div class="ttname"><a href="namespace_image_resizer_1_1_plugins_1_1_advanced_filters.html#a7a2b91bebff5f5da23b87878e278b4bb">ImageResizer.Plugins.AdvancedFilters.HistogramThresholdAlgorithm</a></div><div class="ttdeci">HistogramThresholdAlgorithm</div><div class="ttdef"><b>Definition:</b> <a href="_auto_white_balance_8cs_source.html#l00012">AutoWhiteBalance.cs:12</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_feather_edge_html"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_feather_edge.html">ImageResizer.Plugins.AdvancedFilters.FeatherEdge</a></div><div class="ttdef"><b>Definition:</b> <a href="_feather_edge_8cs_source.html#l00011">FeatherEdge.cs:11</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_util_1_1_parse_utils_html"><div class="ttname"><a href="class_image_resizer_1_1_util_1_1_parse_utils.html">ImageResizer.Util.ParseUtils</a></div><div class="ttdoc">Provides invariant parsing &amp;amp; serialization of primitive types, like Enums, integers, floats, and booleans. </div><div class="ttdef"><b>Definition:</b> <a href="_parse_utils_8cs_source.html#l00012">ParseUtils.cs:12</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters_html_af52859902b49d2eb03b00262889f5f78"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_advanced_filters_1_1_advanced_filters.html#af52859902b49d2eb03b00262889f5f78">ImageResizer.Plugins.AdvancedFilters.AdvancedFilters.AdjustContrastBrightnessSaturation</a></div><div class="ttdeci">void AdjustContrastBrightnessSaturation(HSLLinear f, float contrast, float brightness, float saturation, bool truncate)</div><div class="ttdef"><b>Definition:</b> <a href="_advanced_filters_8cs_source.html#l00205">AdvancedFilters.cs:205</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
