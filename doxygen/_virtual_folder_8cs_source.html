<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ImageResizer: C:/Users/Administrator/Documents/resizer/Core/Plugins/Basic/VirtualFolder.cs Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="imageresizer-logo-00aec4.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.3.3</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">C:/Users/Administrator/Documents/resizer/Core/Plugins/Basic/VirtualFolder.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 ï»¿using System;
<a name="l00002"></a>00002 <span class="keyword">using</span> System.Collections.Generic;
<a name="l00003"></a>00003 <span class="keyword">using</span> System.Globalization;
<a name="l00004"></a>00004 <span class="keyword">using</span> System.Text;
<a name="l00005"></a>00005 <span class="keyword">using</span> System.Web;
<a name="l00006"></a>00006 <span class="keyword">using</span> System.Security.Permissions;
<a name="l00007"></a>00007 <span class="keyword">using</span> System.Web.Hosting;
<a name="l00008"></a>00008 <span class="keyword">using</span> ImageResizer.Plugins;
<a name="l00009"></a>00009 <span class="keyword">using</span> ImageResizer.Configuration;
<a name="l00010"></a>00010 <span class="keyword">using</span> System.IO;
<a name="l00011"></a>00011 <span class="keyword">using</span> System.Web.Caching;
<a name="l00012"></a>00012 <span class="keyword">using</span> System.Collections.Specialized;
<a name="l00013"></a>00013 <span class="keyword">using</span> System.Security;
<a name="l00014"></a>00014 <span class="keyword">using</span> ImageResizer.Configuration.Issues;
<a name="l00015"></a>00015 <span class="keyword">using</span> ImageResizer.Util;
<a name="l00016"></a>00016 <span class="keyword">using</span> ImageResizer.ExtensionMethods;
<a name="l00017"></a>00017 
<a name="l00018"></a>00018 <span class="keyword">namespace </span>ImageResizer.Plugins.Basic {<span class="comment"></span>
<a name="l00019"></a>00019 <span class="comment">    /// &lt;summary&gt;</span>
<a name="l00020"></a>00020 <span class="comment">    /// Functions exactly like an IIS virtual folder, but doesn&#39;t require IIS configuration.</span>
<a name="l00021"></a>00021 <span class="comment">    /// &lt;/summary&gt;</span>
<a name="l00022"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html">00022</a> <span class="comment"></span>    <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html" title="Functions exactly like an IIS virtual folder, but doesn&#39;t require IIS configuration.">VirtualFolder</a> : VirtualPathProvider, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_image_provider.html" title="Implement this to allow your class (or VirtualPathProvider subclass) to be used without registering i...">IVirtualImageProvider</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html" title="All plugins must implement this. Enables web.config addition and removal.">IPlugin</a> , <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_multi_instance_plugin.html" title="Tag your plugin with this interface if it supports having multiple instances registered at once...">IMultiInstancePlugin</a>, <a class="code" href="interface_image_resizer_1_1_configuration_1_1_issues_1_1_i_issue_provider.html">IIssueProvider</a>{
<a name="l00023"></a>00023 
<a name="l00024"></a>00024         <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html" title="Functions exactly like an IIS virtual folder, but doesn&#39;t require IIS configuration.">VirtualFolder</a>(<span class="keywordtype">string</span> virtualPath, <span class="keywordtype">string</span> physicalPath)
<a name="l00025"></a>00025             : <span class="keyword">this</span>(virtualPath,physicalPath,<span class="keyword">true</span>) {
<a name="l00026"></a>00026         }
<a name="l00027"></a>00027         <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html" title="Functions exactly like an IIS virtual folder, but doesn&#39;t require IIS configuration.">VirtualFolder</a>(<span class="keywordtype">string</span> virtualPath, <span class="keywordtype">string</span> physicalPath, <span class="keywordtype">bool</span> registerAsVpp)
<a name="l00028"></a>00028             : base() {
<a name="l00029"></a>00029             this.VirtualPath = virtualPath;
<a name="l00030"></a>00030             this.PhysicalPath = physicalPath;
<a name="l00031"></a>00031             this.RegisterAsVpp = registerAsVpp;
<a name="l00032"></a>00032         }
<a name="l00033"></a>00033 
<a name="l00034"></a>00034         <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html" title="Functions exactly like an IIS virtual folder, but doesn&#39;t require IIS configuration.">VirtualFolder</a>(NameValueCollection args)
<a name="l00035"></a>00035             : base() {
<a name="l00036"></a>00036             this.VirtualPath = args[<span class="stringliteral">&quot;virtualPath&quot;</span>];
<a name="l00037"></a>00037             this.PhysicalPath = args[<span class="stringliteral">&quot;physicalPath&quot;</span>];
<a name="l00038"></a>00038             this.RegisterAsVpp = <a class="code" href="class_image_resizer_1_1_extension_methods_1_1_name_value_collection_extensions.html">NameValueCollectionExtensions</a>.Get(args, <span class="stringliteral">&quot;vpp&quot;</span>, <span class="keyword">true</span>);
<a name="l00039"></a>00039         }
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 
<a name="l00042"></a>00042 
<a name="l00043"></a>00043         <span class="keyword">private</span> <span class="keywordtype">bool</span> _failedToRegisterVpp = <span class="keyword">false</span>;<span class="comment"></span>
<a name="l00044"></a>00044 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00045"></a>00045 <span class="comment">        /// True if the provider attempted to register itself as a VirtualPathProvider and failed due to limited security clearance.</span>
<a name="l00046"></a>00046 <span class="comment">        /// False if it did not attempt (say, due to missing IOPermission) , or if it succeeded.</span>
<a name="l00047"></a>00047 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00048"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#aea46e733ffc529cfa7136a2e48fe779d">00048</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">bool</span> FailedToRegisterVpp {
<a name="l00049"></a>00049             <span class="keyword">get</span> { <span class="keywordflow">return</span> _failedToRegisterVpp; }
<a name="l00050"></a>00050         }
<a name="l00051"></a>00051 <span class="comment"></span>
<a name="l00052"></a>00052 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00053"></a>00053 <span class="comment">        /// If true, the plugin will attempt to register itself as an application-wide VirtualPathProvider instead of a image resizer-specific IVirtualImageProvider.</span>
<a name="l00054"></a>00054 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00055"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#a86a0f4d2cd650294499895a18d407c05">00055</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">bool</span> RegisterAsVpp { <span class="keyword">get</span>; <span class="keyword">set</span>; }
<a name="l00056"></a>00056 
<a name="l00057"></a>00057         <span class="keyword">private</span> <span class="keywordtype">string</span> virtualPath = null;<span class="comment"></span>
<a name="l00058"></a>00058 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00059"></a>00059 <span class="comment">        /// The virtual path served by the VirtualFolder</span>
<a name="l00060"></a>00060 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00061"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#ab0c6a53316642080d5500c7a656f16e7">00061</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">string</span> VirtualPath {
<a name="l00062"></a>00062             <span class="keyword">get</span> { <span class="keywordflow">return</span> virtualPath; }
<a name="l00063"></a>00063             <span class="keyword">set</span> { virtualPath = normalizeVirtualPath(value); }
<a name="l00064"></a>00064         }
<a name="l00065"></a>00065 
<a name="l00066"></a>00066         <span class="keyword">private</span> <span class="keywordtype">string</span> physicalPath = null;<span class="comment"></span>
<a name="l00067"></a>00067 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00068"></a>00068 <span class="comment">        /// The physical path</span>
<a name="l00069"></a>00069 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00070"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#a8acf5f07add4086166790d079740e95e">00070</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">string</span> PhysicalPath {
<a name="l00071"></a>00071             <span class="keyword">get</span> { <span class="keywordflow">return</span> physicalPath; }
<a name="l00072"></a>00072             <span class="keyword">set</span> { physicalPath = resolvePhysicalPath(value); }
<a name="l00073"></a>00073         }
<a name="l00074"></a>00074 
<a name="l00075"></a>00075 
<a name="l00076"></a>00076         <span class="keyword">private</span> <span class="keywordtype">bool</span> registeredVpp = <span class="keyword">false</span>;<span class="comment"></span>
<a name="l00077"></a>00077 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00078"></a>00078 <span class="comment">        /// Registers the VirtualFolder plugin as a virtual path provider.</span>
<a name="l00079"></a>00079 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00080"></a>00080 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00081"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#a9761b1a23ef4918aaac5ee68fee6ec33">00081</a> <span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html" title="All plugins must implement this. Enables web.config addition and removal.">IPlugin</a> <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#a9761b1a23ef4918aaac5ee68fee6ec33" title="Registers the VirtualFolder plugin as a virtual path provider.">Install</a>(<a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html">Config</a> c) {
<a name="l00082"></a>00082             <span class="keywordflow">if</span> (!NoIOPermission &amp;&amp; RegisterAsVpp) {
<a name="l00083"></a>00083                 <span class="keywordflow">try</span> {
<a name="l00084"></a>00084                     HostingEnvironment.RegisterVirtualPathProvider(<span class="keyword">this</span>);
<a name="l00085"></a>00085                     registeredVpp = <span class="keyword">true</span>;
<a name="l00086"></a>00086                 } <span class="keywordflow">catch</span> (SecurityException) {
<a name="l00087"></a>00087                     this._failedToRegisterVpp =<span class="keyword">true</span>;
<a name="l00088"></a>00088                 }
<a name="l00089"></a>00089             }
<a name="l00090"></a>00090             c.<a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html#aa8cdada7d657ec3078e5d16310f198f7" title="Access and modify plugins.">Plugins</a>.<a class="code" href="class_image_resizer_1_1_configuration_1_1_plugin_config.html#a24a5d36dc59eee7d980a8e9b4d00ead1" title="Only for use by plugins during IPlugin.Install. Call Plugin.Install instead of this method...">add_plugin</a>(<span class="keyword">this</span>);
<a name="l00091"></a>00091             <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00092"></a>00092         }
<a name="l00093"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#a492853a24151106234ba0dad23d6aaf2">00093</a>         <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#a492853a24151106234ba0dad23d6aaf2" title="Uninstalls the plugin. Should reverse all changes made during Install.">Uninstall</a>(<a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html">Config</a> c) {
<a name="l00094"></a>00094             c.<a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html#aa8cdada7d657ec3078e5d16310f198f7" title="Access and modify plugins.">Plugins</a>.<a class="code" href="class_image_resizer_1_1_configuration_1_1_plugin_config.html#a0aae69c8ce761b0b5869fd63e2bcb863" title="For use only by plugins during .Uninstall. Removes the specified plugin from AllPlugins, QuerystringPlugins, CachingSystems, ImageEncoders, and ImageBuiderExtensions, based on which interfaces the instance implements. Plugins may register event handlers and modify settings - thus you should use the plugin&#39;s method to uninstall them vs. using this method.">remove_plugin</a>(<span class="keyword">this</span>);
<a name="l00095"></a>00095             <span class="keywordflow">return</span> !registeredVpp;<span class="comment">//Cannot truly remove a VPP</span>
<a name="l00096"></a>00096         }
<a name="l00097"></a>00097 
<a name="l00098"></a>00098         <span class="keyword">private</span> <span class="keywordtype">bool</span> noIOPermission = <span class="keyword">false</span>;<span class="comment"></span>
<a name="l00099"></a>00099 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00100"></a>00100 <span class="comment">        /// True if the plugin has detected it doesn&#39;t have sufficient IOPermission to operate.</span>
<a name="l00101"></a>00101 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00102"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#ab8bd68930f844ef5350cb7424d453715">00102</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">bool</span> NoIOPermission {
<a name="l00103"></a>00103             <span class="keyword">get</span> { <span class="keywordflow">return</span> noIOPermission; }
<a name="l00104"></a>00104         }
<a name="l00105"></a>00105 <span class="comment"></span>
<a name="l00106"></a>00106 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00107"></a>00107 <span class="comment">        /// Converts relative and app-relative paths to domain-relative virtual paths.</span>
<a name="l00108"></a>00108 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00109"></a>00109 <span class="comment">        /// &lt;param name=&quot;path&quot;&gt;&lt;/param&gt;</span>
<a name="l00110"></a>00110 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00111"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#aed7c8d4e3dce6e1c12f90c33b51e8f1c">00111</a> <span class="comment"></span>        <span class="keyword">protected</span> <span class="keywordtype">string</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#aed7c8d4e3dce6e1c12f90c33b51e8f1c" title="Converts relative and app-relative paths to domain-relative virtual paths.">normalizeVirtualPath</a>(<span class="keywordtype">string</span> path) {
<a name="l00112"></a>00112             <span class="keywordflow">if</span> (!path.StartsWith(<span class="stringliteral">&quot;/&quot;</span>)) path = HostingEnvironment.ApplicationVirtualPath.TrimEnd(<span class="charliteral">&#39;/&#39;</span>) + <span class="charliteral">&#39;/&#39;</span> + (path.StartsWith(<span class="stringliteral">&quot;~&quot;</span>) ? path.Substring(1) : path).TrimStart(<span class="charliteral">&#39;/&#39;</span>);
<a name="l00113"></a>00113             <span class="keywordflow">return</span> path;
<a name="l00114"></a>00114         }<span class="comment"></span>
<a name="l00115"></a>00115 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00116"></a>00116 <span class="comment">        /// Attempts to convert a phyiscal path into a collapsed rooted physical path.</span>
<a name="l00117"></a>00117 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00118"></a>00118 <span class="comment">        /// &lt;param name=&quot;path&quot;&gt;&lt;/param&gt;</span>
<a name="l00119"></a>00119 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00120"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#aa0b59acc876e62aec1897e53300d762e">00120</a> <span class="comment"></span>        <span class="keyword">protected</span> <span class="keywordtype">string</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#aa0b59acc876e62aec1897e53300d762e" title="Attempts to convert a phyiscal path into a collapsed rooted physical path.">resolvePhysicalPath</a>(<span class="keywordtype">string</span> path) {
<a name="l00121"></a>00121             
<a name="l00122"></a>00122             <span class="keywordflow">if</span> (!Path.IsPathRooted(path)) path = Path.Combine(HostingEnvironment.ApplicationPhysicalPath, path);
<a name="l00123"></a>00123             <span class="keywordflow">if</span> (NoIOPermission) <span class="keywordflow">return</span> collapsePath(path);
<a name="l00124"></a>00124 
<a name="l00125"></a>00125             <span class="keywordflow">try</span> {
<a name="l00126"></a>00126                 <span class="keywordflow">return</span> Path.GetFullPath(path);
<a name="l00127"></a>00127             } <span class="keywordflow">catch</span> (SecurityException) {
<a name="l00128"></a>00128                 noIOPermission = <span class="keyword">true</span>;
<a name="l00129"></a>00129                 <span class="keywordflow">return</span> collapsePath(path);
<a name="l00130"></a>00130             }
<a name="l00131"></a>00131         }<span class="comment"></span>
<a name="l00132"></a>00132 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00133"></a>00133 <span class="comment">        /// Collapses any .. segments</span>
<a name="l00134"></a>00134 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00135"></a>00135 <span class="comment">        /// &lt;param name=&quot;path&quot;&gt;&lt;/param&gt;</span>
<a name="l00136"></a>00136 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00137"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#a4585ac1429c6cafbf72840a174c7a788">00137</a> <span class="comment"></span>        <span class="keyword">protected</span> <span class="keywordtype">string</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#a4585ac1429c6cafbf72840a174c7a788" title="Collapses any .. segments.">collapsePath</a>(<span class="keywordtype">string</span> path) {
<a name="l00138"></a>00138             <span class="keywordtype">string</span> oldPath = path;
<a name="l00139"></a>00139             <span class="keywordflow">do</span> {
<a name="l00140"></a>00140                 oldPath = path;
<a name="l00141"></a>00141                 path = collapseOneLevel(oldPath);
<a name="l00142"></a>00142             } <span class="keywordflow">while</span> (oldPath != path);
<a name="l00143"></a>00143             <span class="keywordflow">return</span> path;
<a name="l00144"></a>00144         }
<a name="l00145"></a>00145 
<a name="l00146"></a>00146         <span class="keyword">protected</span> <span class="keywordtype">string</span> collapseOneLevel(<span class="keywordtype">string</span> path) {
<a name="l00147"></a>00147             <span class="keywordtype">int</span> up = path.Length - 1;
<a name="l00148"></a>00148             <span class="keywordflow">do</span> {
<a name="l00149"></a>00149                 up = path.LastIndexOf(System.IO.Path.DirectorySeparatorChar + <span class="stringliteral">&quot;..&quot;</span> + System.IO.Path.DirectorySeparatorChar, up);
<a name="l00150"></a>00150                 <span class="keywordflow">if</span> (up &lt; 0) <span class="keywordflow">return</span> path;
<a name="l00151"></a>00151                 <span class="keywordtype">int</span> prevSlash = path.LastIndexOf(System.IO.Path.DirectorySeparatorChar, up - 1);
<a name="l00152"></a>00152                 <span class="keywordflow">if</span> (prevSlash &lt; 0) <span class="keywordflow">return</span> path;
<a name="l00153"></a>00153                 <span class="keywordtype">string</span> segment = path.Substring(prevSlash + 1, up - prevSlash - 1);
<a name="l00154"></a>00154                 <span class="keywordflow">if</span> (segment.Equals(<span class="stringliteral">&quot;..&quot;</span>, StringComparison.OrdinalIgnoreCase)) {
<a name="l00155"></a>00155                     <span class="comment">//We can&#39;t combine \..\..\, just keep looking closer to the beginning of the string. We already adjusted &#39;up&#39;</span>
<a name="l00156"></a>00156                 } <span class="keywordflow">else</span> <span class="keywordflow">if</span> (segment.Equals(<span class="stringliteral">&quot;.&quot;</span>, StringComparison.OrdinalIgnoreCase)) {
<a name="l00157"></a>00157                     <span class="keywordflow">return</span> path.Substring(0, prevSlash) + path.Substring(up); <span class="comment">//Just remove \.\ sections</span>
<a name="l00158"></a>00158                 } <span class="keywordflow">else</span> {
<a name="l00159"></a>00159                     <span class="keywordflow">return</span> path.Substring(0, prevSlash) + path.Substring(up + 3); <span class="comment">//If it&#39;s not \.\ or \..\, remove both it and the following \..\</span>
<a name="l00160"></a>00160 <span class="comment">                }</span>
<a name="l00161"></a>00161             } <span class="keywordflow">while</span> (up &gt; 0);
<a name="l00162"></a>00162             <span class="keywordflow">return</span> path;
<a name="l00163"></a>00163         }
<a name="l00164"></a>00164 
<a name="l00165"></a>00165         <span class="keyword">public</span> <span class="keywordtype">string</span> VirtualToPhysical(<span class="keywordtype">string</span> virtualPath)
<a name="l00166"></a>00166         {
<a name="l00167"></a>00167             <span class="keywordflow">return</span> LocalMapPath(virtualPath);
<a name="l00168"></a>00168         }<span class="comment"></span>
<a name="l00169"></a>00169 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00170"></a>00170 <span class="comment">        /// Converts any virtual path in this folder to a physical path. Returns null if the virtual path is outside the folder.</span>
<a name="l00171"></a>00171 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00172"></a>00172 <span class="comment">        /// &lt;param name=&quot;virtualPath&quot;&gt;&lt;/param&gt;</span>
<a name="l00173"></a>00173 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00174"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#a4abb6be3a039108115bc7677d26b2e52">00174</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">string</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#a4abb6be3a039108115bc7677d26b2e52" title="Converts any virtual path in this folder to a physical path. Returns null if the virtual path is outs...">LocalMapPath</a>(<span class="keywordtype">string</span> virtualPath) {
<a name="l00175"></a>00175             virtualPath = normalizeVirtualPath(virtualPath);
<a name="l00176"></a>00176             <span class="keywordflow">if</span> (virtualPath.StartsWith(<span class="keyword">this</span>.VirtualPath, StringComparison.OrdinalIgnoreCase)) {
<a name="l00177"></a>00177                 <span class="keywordflow">return</span> Path.Combine(PhysicalPath, virtualPath.Substring(<span class="keyword">this</span>.VirtualPath.Length).TrimStart(<span class="charliteral">&#39;/&#39;</span>).Replace(<span class="charliteral">&#39;/&#39;</span>, Path.DirectorySeparatorChar));
<a name="l00178"></a>00178             }
<a name="l00179"></a>00179             <span class="keywordflow">return</span> null;
<a name="l00180"></a>00180         }<span class="comment"></span>
<a name="l00181"></a>00181 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00182"></a>00182 <span class="comment">        /// Returns true if the specified path is inside this virtual folder</span>
<a name="l00183"></a>00183 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00184"></a>00184 <span class="comment">        /// &lt;param name=&quot;virtualPath&quot;&gt;&lt;/param&gt;</span>
<a name="l00185"></a>00185 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00186"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#ae5dae2cdf6772f6f585f13ff0464a67f">00186</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#ae5dae2cdf6772f6f585f13ff0464a67f" title="Returns true if the specified path is inside this virtual folder.">IsVirtualPath</a>(<span class="keywordtype">string</span> virtualPath) {
<a name="l00187"></a>00187             virtualPath = normalizeVirtualPath(virtualPath);
<a name="l00188"></a>00188             <span class="keywordflow">return</span> virtualPath.StartsWith(this.VirtualPath, StringComparison.OrdinalIgnoreCase);
<a name="l00189"></a>00189         }<span class="comment"></span>
<a name="l00190"></a>00190 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00191"></a>00191 <span class="comment">        /// Returns true if (a) we have IOPermission, (b) the path is under our prefix, (c) the </span>
<a name="l00192"></a>00192 <span class="comment">        /// expected physical file does not exist (because we shouldn&#39;t interfere in that case), and</span>
<a name="l00193"></a>00193 <span class="comment">        /// (d) the other VPPs don&#39;t believe the file exists.</span>
<a name="l00194"></a>00194 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00195"></a>00195 <span class="comment">        /// &lt;param name=&quot;virtualPath&quot;&gt;&lt;/param&gt;</span>
<a name="l00196"></a>00196 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00197"></a>00197 <span class="comment"></span>        <span class="keyword">private</span> <span class="keywordtype">bool</span> isOnlyVirtualPath(<span class="keywordtype">string</span> virtualPath) {
<a name="l00198"></a>00198             <span class="keywordflow">if</span> (NoIOPermission) <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">//Don&#39;t act as a VPP if we don&#39;t have permission to operate.</span>
<a name="l00199"></a>00199             <span class="keywordflow">if</span> (!IsVirtualPath(virtualPath)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00200"></a>00200             <span class="keywordflow">if</span> (File.Exists(HostingEnvironment.MapPath(normalizeVirtualPath(virtualPath)))) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00201"></a>00201             <span class="keywordflow">if</span> (registeredVpp &amp;&amp; Previous.FileExists(virtualPath)) <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00202"></a>00202             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00203"></a>00203         }
<a name="l00204"></a>00204 
<a name="l00205"></a>00205 
<a name="l00206"></a>00206 
<a name="l00207"></a>00207         <span class="keyword">internal</span> <span class="keyword">protected</span> Stream getStream(<span class="keywordtype">string</span> virtualPath) {
<a name="l00208"></a>00208             <span class="keywordflow">if</span> (NoIOPermission || !IsVirtualPath(virtualPath)) <span class="keywordflow">return</span> null;
<a name="l00209"></a>00209             <span class="keywordflow">return</span> File.Open(LocalMapPath(virtualPath), FileMode.Open, FileAccess.Read, FileShare.Read);
<a name="l00210"></a>00210         }<span class="comment"></span>
<a name="l00211"></a>00211 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00212"></a>00212 <span class="comment">        /// Returns the LastWriteTimeUtc value for the specified virtual file in this folder, or DateTime.MinValue if missing.</span>
<a name="l00213"></a>00213 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00214"></a>00214 <span class="comment">        /// &lt;param name=&quot;virtualPath&quot;&gt;&lt;/param&gt;</span>
<a name="l00215"></a>00215 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00216"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#a7568a5fec26644bc3fc8e9c6c62e3d21">00216</a> <span class="comment"></span>        <span class="keyword">public</span> DateTime <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#a7568a5fec26644bc3fc8e9c6c62e3d21" title="Returns the LastWriteTimeUtc value for the specified virtual file in this folder, or DateTime...">GetDateModifiedUtc</a>(<span class="keywordtype">string</span> virtualPath) {
<a name="l00217"></a>00217             <span class="keywordtype">string</span> physicalPath = LocalMapPath(virtualPath);
<a name="l00218"></a>00218             <span class="keywordflow">if</span> (System.IO.File.Exists(physicalPath))
<a name="l00219"></a>00219                 <span class="keywordflow">return</span> System.IO.File.GetLastWriteTimeUtc(physicalPath);
<a name="l00220"></a>00220             <span class="keywordflow">else</span> <span class="keywordflow">return</span> DateTime.MinValue;
<a name="l00221"></a>00221         }
<a name="l00222"></a>00222 <span class="comment"></span>
<a name="l00223"></a>00223 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00224"></a>00224 <span class="comment">        /// Returns true if the file exists in this virtual folder, and would not be masking an existing file.</span>
<a name="l00225"></a>00225 <span class="comment">        /// Returns false if NoIOPermission is true.</span>
<a name="l00226"></a>00226 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00227"></a>00227 <span class="comment">        /// &lt;param name=&quot;virtualPath&quot;&gt;&lt;/param&gt;</span>
<a name="l00228"></a>00228 <span class="comment">        /// &lt;param name=&quot;queryString&quot;&gt;&lt;/param&gt;</span>
<a name="l00229"></a>00229 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00230"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#aa42b7d6fda2cea008cec82fae9627a9c">00230</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keywordtype">bool</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#aa42b7d6fda2cea008cec82fae9627a9c" title="Returns true if the file exists in this virtual folder, and would not be masking an existing file...">FileExists</a>(<span class="keywordtype">string</span> virtualPath, NameValueCollection queryString) {
<a name="l00231"></a>00231             <span class="keywordflow">if</span> (NoIOPermission) <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">//Because File.Exists is always false when IOPermission is missing, anyhow.</span>
<a name="l00232"></a>00232             <span class="keywordflow">if</span> (!IsVirtualPath(virtualPath)) <span class="keywordflow">return</span> <span class="keyword">false</span>; <span class="comment">//It&#39;s not even in our area.</span>
<a name="l00233"></a>00233             <span class="keywordflow">if</span> (File.Exists(LocalMapPath(virtualPath))){
<a name="l00234"></a>00234                 <span class="comment">//Ok, we could serve it, but existing files take precedence.</span>
<a name="l00235"></a>00235                 <span class="comment">//Return false if we would be masking an existing file.</span>
<a name="l00236"></a>00236                 <span class="keywordflow">return</span> !File.Exists(HostingEnvironment.MapPath(normalizeVirtualPath(virtualPath)));
<a name="l00237"></a>00237             }
<a name="l00238"></a>00238             <span class="keywordflow">return</span> <span class="keyword">false</span>;
<a name="l00239"></a>00239         }<span class="comment"></span>
<a name="l00240"></a>00240 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00241"></a>00241 <span class="comment">        /// Unless the path is not within the virtual folder, or IO permissions are missing, will return an IVirtualFile instance for the path. </span>
<a name="l00242"></a>00242 <span class="comment">        /// The file may or may not exist.</span>
<a name="l00243"></a>00243 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00244"></a>00244 <span class="comment">        /// &lt;param name=&quot;virtualPath&quot;&gt;&lt;/param&gt;</span>
<a name="l00245"></a>00245 <span class="comment">        /// &lt;param name=&quot;queryString&quot;&gt;&lt;/param&gt;</span>
<a name="l00246"></a>00246 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00247"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#a8d84bd2a87ff405820e55918947153c3">00247</a> <span class="comment"></span>        <span class="keyword">public</span> <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_file.html" title="A virtual file to support IVirtualImageProvider.">IVirtualFile</a> <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#a8d84bd2a87ff405820e55918947153c3" title="Unless the path is not within the virtual folder, or IO permissions are missing, will return an IVirt...">GetFile</a>(<span class="keywordtype">string</span> virtualPath, NameValueCollection queryString) {
<a name="l00248"></a>00248             <span class="keywordflow">if</span> (NoIOPermission) <span class="keywordflow">return</span> null;
<a name="l00249"></a>00249             <span class="keywordflow">if</span> (!IsVirtualPath(virtualPath)) <span class="keywordflow">return</span> null; <span class="comment">//It&#39;s not even in our area.</span>
<a name="l00250"></a>00250             <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder_1_1_virtual_folder_provider_virtual_file.html">VirtualFolderProviderVirtualFile</a>(virtualPath, <span class="keyword">this</span>);
<a name="l00251"></a>00251         }
<a name="l00252"></a>00252 <span class="comment"></span>
<a name="l00253"></a>00253 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00254"></a>00254 <span class="comment">        /// For internal use only by the .NET VPP system.</span>
<a name="l00255"></a>00255 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00256"></a>00256 <span class="comment">        /// &lt;param name=&quot;virtualPath&quot;&gt;&lt;/param&gt;</span>
<a name="l00257"></a>00257 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00258"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#a0b8f145683df85bb4b0032a21ebc52b5">00258</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">override</span> <span class="keywordtype">bool</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#a0b8f145683df85bb4b0032a21ebc52b5" title="For internal use only by the .NET VPP system.">FileExists</a>(<span class="keywordtype">string</span> virtualPath) {
<a name="l00259"></a>00259             <span class="keywordflow">if</span> (isOnlyVirtualPath(virtualPath))
<a name="l00260"></a>00260                 <span class="keywordflow">return</span> File.Exists(LocalMapPath(virtualPath));
<a name="l00261"></a>00261             <span class="keywordflow">else</span>
<a name="l00262"></a>00262                 <span class="keywordflow">return</span> Previous.FileExists(virtualPath);
<a name="l00263"></a>00263         }<span class="comment"></span>
<a name="l00264"></a>00264 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00265"></a>00265 <span class="comment">        /// For internal use only by the .NET VPP system.</span>
<a name="l00266"></a>00266 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00267"></a>00267 <span class="comment">        /// &lt;param name=&quot;virtualPath&quot;&gt;&lt;/param&gt;</span>
<a name="l00268"></a>00268 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00269"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#a1f1a914f95f86f6938c04911df01abdf">00269</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">override</span> VirtualFile <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#a1f1a914f95f86f6938c04911df01abdf" title="For internal use only by the .NET VPP system.">GetFile</a>(<span class="keywordtype">string</span> virtualPath) {
<a name="l00270"></a>00270             <span class="keywordflow">if</span> (isOnlyVirtualPath(virtualPath))
<a name="l00271"></a>00271                 <span class="keywordflow">return</span> <span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder_1_1_virtual_folder_provider_virtual_file.html">VirtualFolderProviderVirtualFile</a>(virtualPath, <span class="keyword">this</span>);
<a name="l00272"></a>00272             <span class="keywordflow">else</span>
<a name="l00273"></a>00273                 <span class="keywordflow">return</span> Previous.GetFile(virtualPath);
<a name="l00274"></a>00274         }<span class="comment"></span>
<a name="l00275"></a>00275 <span class="comment">        /// &lt;summary&gt;</span>
<a name="l00276"></a>00276 <span class="comment">        /// For internal use only by the .NET VPP system.</span>
<a name="l00277"></a>00277 <span class="comment">        /// &lt;/summary&gt;</span>
<a name="l00278"></a>00278 <span class="comment">        /// &lt;param name=&quot;virtualPath&quot;&gt;&lt;/param&gt;</span>
<a name="l00279"></a>00279 <span class="comment">        /// &lt;param name=&quot;virtualPathDependencies&quot;&gt;&lt;/param&gt;</span>
<a name="l00280"></a>00280 <span class="comment">        /// &lt;param name=&quot;utcStart&quot;&gt;&lt;/param&gt;</span>
<a name="l00281"></a>00281 <span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span>
<a name="l00282"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#aa8449c161a0096606f0dbbfe7556e17d">00282</a> <span class="comment"></span>        <span class="keyword">public</span> <span class="keyword">override</span> CacheDependency GetCacheDependency(
<a name="l00283"></a>00283           <span class="keywordtype">string</span> virtualPath,
<a name="l00284"></a>00284           System.Collections.IEnumerable virtualPathDependencies,
<a name="l00285"></a>00285           DateTime utcStart) {
<a name="l00286"></a>00286 
<a name="l00287"></a>00287               <span class="keywordflow">if</span> (!isOnlyVirtualPath(virtualPath)) <span class="keywordflow">return</span> Previous.GetCacheDependency(virtualPath, virtualPathDependencies, utcStart);
<a name="l00288"></a>00288 
<a name="l00289"></a>00289             List&lt;String&gt; deps = <span class="keyword">new</span> List&lt;string&gt;();
<a name="l00290"></a>00290             <span class="keywordflow">foreach</span> (<span class="keywordtype">string</span> s <span class="keywordflow">in</span> virtualPathDependencies) {
<a name="l00291"></a>00291                 deps.Add(s);
<a name="l00292"></a>00292             }
<a name="l00293"></a>00293 
<a name="l00294"></a>00294 
<a name="l00295"></a>00295              <span class="keywordflow">return</span> <span class="keyword">new</span> CacheDependency(<span class="keyword">new</span> <span class="keywordtype">string</span>[] { LocalMapPath(virtualPath) }, deps.ToArray(), utcStart);
<a name="l00296"></a>00296 
<a name="l00297"></a>00297         }
<a name="l00298"></a>00298 
<a name="l00299"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder_1_1_virtual_folder_provider_virtual_file.html">00299</a>         <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder_1_1_virtual_folder_provider_virtual_file.html">VirtualFolderProviderVirtualFile</a> : VirtualFile, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_file_with_modified_date.html" title="Always implement this if possible. Allows caching systems to detect changes to source files and inval...">IVirtualFileWithModifiedDate</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_file.html" title="A virtual file to support IVirtualImageProvider.">IVirtualFile</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_virtual_file_source_cache_key.html" title="This interface has nothing to do with output caching. This allows VirtualFile instances to override t...">IVirtualFileSourceCacheKey</a>{
<a name="l00300"></a>00300 
<a name="l00301"></a>00301             <span class="keyword">private</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html" title="Functions exactly like an IIS virtual folder, but doesn&#39;t require IIS configuration.">VirtualFolder</a> provider;
<a name="l00302"></a>00302 
<a name="l00303"></a>00303             <span class="keyword">private</span> Nullable&lt;bool&gt; _exists = null;
<a name="l00304"></a>00304             <span class="keyword">private</span> Nullable&lt;DateTime&gt; _fileModifiedDate = null;
<a name="l00305"></a>00305 
<a name="l00306"></a>00306             <span class="keyword">public</span> <span class="keywordtype">bool</span> Exists {
<a name="l00307"></a>00307                 <span class="keyword">get</span> {
<a name="l00308"></a>00308                     <span class="keywordflow">if</span> (_exists == null) _exists = provider.<a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#aa42b7d6fda2cea008cec82fae9627a9c" title="Returns true if the file exists in this virtual folder, and would not be masking an existing file...">FileExists</a>(this.VirtualPath);
<a name="l00309"></a>00309                     <span class="keywordflow">return</span> _exists.Value;
<a name="l00310"></a>00310                 }
<a name="l00311"></a>00311             }
<a name="l00312"></a>00312 
<a name="l00313"></a>00313             <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder_1_1_virtual_folder_provider_virtual_file.html">VirtualFolderProviderVirtualFile</a>(<span class="keywordtype">string</span> virtualPath, <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html" title="Functions exactly like an IIS virtual folder, but doesn&#39;t require IIS configuration.">VirtualFolder</a> provider)
<a name="l00314"></a>00314                 : base(virtualPath) {
<a name="l00315"></a>00315                 this.provider = provider;
<a name="l00316"></a>00316             }
<a name="l00317"></a>00317 
<a name="l00318"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder_1_1_virtual_folder_provider_virtual_file.html#adde5c3a6b32de48e366fa301a6b9144f">00318</a>             <span class="keyword">public</span> <span class="keyword">override</span> Stream <a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder_1_1_virtual_folder_provider_virtual_file.html#adde5c3a6b32de48e366fa301a6b9144f" title="Returns an opened stream to the file contents.">Open</a>() { <span class="keywordflow">return</span> provider.getStream(this.VirtualPath); }
<a name="l00319"></a>00319 
<a name="l00320"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder_1_1_virtual_folder_provider_virtual_file.html#a6010f92de4ee6876ffb20d6f80df18cf">00320</a>             <span class="keyword">public</span> DateTime ModifiedDateUTC {
<a name="l00321"></a>00321                 <span class="keyword">get</span> {
<a name="l00322"></a>00322                     <span class="keywordflow">if</span> (_fileModifiedDate == null) _fileModifiedDate = provider.<a class="code" href="class_image_resizer_1_1_plugins_1_1_basic_1_1_virtual_folder.html#a7568a5fec26644bc3fc8e9c6c62e3d21" title="Returns the LastWriteTimeUtc value for the specified virtual file in this folder, or DateTime...">GetDateModifiedUtc</a>(this.VirtualPath);
<a name="l00323"></a>00323                     <span class="keywordflow">return</span> _fileModifiedDate.Value;
<a name="l00324"></a>00324                 }
<a name="l00325"></a>00325             }
<a name="l00326"></a>00326 
<a name="l00327"></a>00327             <span class="keyword">public</span> <span class="keywordtype">string</span> GetCacheKey(<span class="keywordtype">bool</span> includeModifiedDate) {
<a name="l00328"></a>00328                 <span class="keywordflow">return</span> VirtualPath + (includeModifiedDate ? (<span class="stringliteral">&quot;_&quot;</span> + ModifiedDateUTC.Ticks.ToString(CultureInfo.InvariantCulture)) : <span class="stringliteral">&quot;&quot;</span>);
<a name="l00329"></a>00329             }
<a name="l00330"></a>00330         }
<a name="l00331"></a>00331 
<a name="l00332"></a>00332         <span class="keyword">public</span> IEnumerable&lt;IIssue&gt; GetIssues() {
<a name="l00333"></a>00333             List&lt;IIssue&gt; issues = <span class="keyword">new</span> List&lt;IIssue&gt;();
<a name="l00334"></a>00334 
<a name="l00335"></a>00335             <span class="keywordflow">if</span> (NoIOPermission) issues.Add(<span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_configuration_1_1_issues_1_1_issue.html">Issue</a>(<span class="stringliteral">&quot;The VirtualFolder plugin cannot serve files from \&quot;&quot;</span> +  PhysicalPath + <span class="stringliteral">&quot;\&quot; until you increase the trust level or modify the trust configuration to permit read access to the directory.&quot;</span>, <a class="code" href="namespace_image_resizer_1_1_configuration_1_1_issues.html#ada2af2a44c17c99a124cadb8a92f8555">IssueSeverity</a>.Error));
<a name="l00336"></a>00336             <span class="keywordflow">if</span> (FailedToRegisterVpp) issues.Add(<span class="keyword">new</span> <a class="code" href="class_image_resizer_1_1_configuration_1_1_issues_1_1_issue.html">Issue</a>(<span class="stringliteral">&quot;The VirtualFolder plugin failed to register itself as an app-wide VirtualPathProvider. It will only work for images proccessed by the image resizer.&quot;</span>, <a class="code" href="namespace_image_resizer_1_1_configuration_1_1_issues.html#ada2af2a44c17c99a124cadb8a92f8555">IssueSeverity</a>.Error));
<a name="l00337"></a>00337 
<a name="l00338"></a>00338 
<a name="l00339"></a>00339             <span class="keywordflow">return</span> issues;
<a name="l00340"></a>00340         }
<a name="l00341"></a>00341 
<a name="l00342"></a>00342 
<a name="l00343"></a>00343     }
<a name="l00344"></a>00344 
<a name="l00345"></a>00345 }
<a name="l00346"></a>00346 
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
