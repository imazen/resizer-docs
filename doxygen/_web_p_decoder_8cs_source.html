<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<title>ImageResizer: C:/Users/Administrator/Documents/resizer/Plugins/WebP/WebPDecoder.cs Source File</title>

<link href="tabs.css" rel="stylesheet" type="text/css"/>
<link href="doxygen.css" rel="stylesheet" type="text/css" />

<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>

</head>
<body>
<div id="top"><!-- do not remove this div! -->


<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  
  <td id="projectlogo"><img alt="Logo" src="imageresizer-logo-00aec4.png"/></td>
  
  
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.3.3</span>
   </div>
   
  </td>
  
  
  
 </tr>
 </tbody>
</table>
</div>

<!-- Generated by Doxygen 1.7.6.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">C:/Users/Administrator/Documents/resizer/Plugins/WebP/WebPDecoder.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><pre class="fragment"><a name="l00001"></a>00001 ï»¿using System;
<a name="l00002"></a>00002 <span class="keyword">using</span> System.Collections.Generic;
<a name="l00003"></a>00003 <span class="keyword">using</span> System.Text;
<a name="l00004"></a>00004 <span class="keyword">using</span> ImageResizer.Resizing;
<a name="l00005"></a>00005 <span class="keyword">using</span> System.Drawing;
<a name="l00006"></a>00006 <span class="keyword">using</span> System.IO;
<a name="l00007"></a>00007 <span class="keyword">using</span> Imazen.WebP;
<a name="l00008"></a>00008 
<a name="l00009"></a><a class="code" href="namespace_image_resizer_1_1_plugins_1_1_web_p_decoder.html">00009</a> <span class="keyword">namespace </span>ImageResizer.Plugins.WebPDecoder {
<a name="l00010"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_web_p_decoder_1_1_web_p_decoder_plugin.html">00010</a>     <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_image_resizer_1_1_plugins_1_1_web_p_decoder_1_1_web_p_decoder_plugin.html">WebPDecoderPlugin</a>:<a class="code" href="class_image_resizer_1_1_resizing_1_1_builder_extension.html" title="Provides a useable base class that can be used to modify the behavior of ImageBuilder. When registered with an ImageBuilder instance, the ImageBuilder will call the corresponding methods on the extension prior to executing its own methods.">BuilderExtension</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html" title="All plugins must implement this. Enables web.config addition and removal.">IPlugin</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_file_extension_plugin.html" title="For plugins that add support for new source file image extensions.">IFileExtensionPlugin</a> {
<a name="l00011"></a>00011 
<a name="l00012"></a>00012 
<a name="l00013"></a>00013 
<a name="l00014"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_web_p_decoder_1_1_web_p_decoder_plugin.html#a94173e7987074699f1f631f7e33181f3">00014</a>         <span class="keyword">public</span> <span class="keyword">override</span> Bitmap <a class="code" href="class_image_resizer_1_1_plugins_1_1_web_p_decoder_1_1_web_p_decoder_plugin.html#a94173e7987074699f1f631f7e33181f3" title="Extend this to support alternate image source formats. If the Bitmap class is used for decoding...">DecodeStream</a>(Stream s, <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings, <span class="keywordtype">string</span> optionalPath) {
<a name="l00015"></a>00015             <span class="keywordtype">bool</span> requested = <span class="stringliteral">&quot;webp&quot;</span>.Equals(settings[<span class="stringliteral">&quot;decoder&quot;</span>], StringComparison.OrdinalIgnoreCase);
<a name="l00016"></a>00016             <span class="keywordflow">if</span> (!<span class="keywordtype">string</span>.IsNullOrEmpty(settings[<span class="stringliteral">&quot;decoder&quot;</span>]) &amp;&amp; !requested) <span class="keywordflow">return</span> null; <span class="comment">//Don&#39;t take it away from the requested decoder</span>
<a name="l00017"></a>00017 
<a name="l00018"></a>00018             <span class="comment">//If a .webp is coming in, try first, before Bitmap tries to parse it.</span>
<a name="l00019"></a>00019             <span class="keywordflow">if</span> (requested || (optionalPath != null &amp;&amp; optionalPath.EndsWith(<span class="stringliteral">&quot;.webp&quot;</span>, StringComparison.OrdinalIgnoreCase))) {
<a name="l00020"></a>00020                 <span class="keywordflow">return</span> Decode(s);
<a name="l00021"></a>00021             }
<a name="l00022"></a>00022             <span class="keywordflow">return</span> null;
<a name="l00023"></a>00023         }
<a name="l00024"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_web_p_decoder_1_1_web_p_decoder_plugin.html#ad03405f06708749fdbc1e537d604ef61">00024</a>         <span class="keyword">public</span> <span class="keyword">override</span> Bitmap <a class="code" href="class_image_resizer_1_1_plugins_1_1_web_p_decoder_1_1_web_p_decoder_plugin.html#ad03405f06708749fdbc1e537d604ef61" title="Extensions are executed until one extension returns a non-null value. This is taken to mean that the ...">DecodeStreamFailed</a>(Stream s, <a class="code" href="class_image_resizer_1_1_resize_settings.html" title="Represents the settings which will be used to process the image. Extends NameValueCollection to provi...">ResizeSettings</a> settings, <span class="keywordtype">string</span> optionalPath) {
<a name="l00025"></a>00025             <span class="comment">//Catch WebP files not ending in .webp</span>
<a name="l00026"></a>00026             <span class="keywordflow">try</span> {
<a name="l00027"></a>00027                 <span class="keywordflow">return</span> Decode(s);
<a name="l00028"></a>00028             } <span class="keywordflow">catch</span> {
<a name="l00029"></a>00029 
<a name="l00030"></a>00030                 <span class="keywordflow">return</span> null;
<a name="l00031"></a>00031             }
<a name="l00032"></a>00032         }
<a name="l00033"></a>00033 
<a name="l00034"></a>00034 
<a name="l00035"></a>00035         <span class="keyword">private</span> Bitmap Decode(Stream s) {
<a name="l00036"></a>00036             <span class="keywordtype">long</span> length;
<a name="l00037"></a>00037             byte[] buffer = ExtensionMethods.StreamExtensions.CopyOrReturnBuffer(s, out length,<span class="keyword">false</span>,4096);
<a name="l00038"></a>00038             <span class="keywordflow">return</span> <span class="keyword">new</span> SimpleDecoder().DecodeFromBytes(buffer, length);
<a name="l00039"></a>00039         }
<a name="l00040"></a>00040 
<a name="l00041"></a>00041 
<a name="l00042"></a>00042         <span class="keyword">public</span> <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html" title="All plugins must implement this. Enables web.config addition and removal.">IPlugin</a> Install(Configuration.Config c) {
<a name="l00043"></a>00043             c.Plugins.add_plugin(<span class="keyword">this</span>);
<a name="l00044"></a>00044             <span class="keywordflow">return</span> <span class="keyword">this</span>;
<a name="l00045"></a>00045         }
<a name="l00046"></a>00046 
<a name="l00047"></a>00047         <span class="keyword">public</span> <span class="keywordtype">bool</span> Uninstall(Configuration.Config c) {
<a name="l00048"></a>00048             c.Plugins.remove_plugin(<span class="keyword">this</span>);
<a name="l00049"></a>00049             <span class="keywordflow">return</span> <span class="keyword">true</span>;
<a name="l00050"></a>00050         }
<a name="l00051"></a>00051 
<a name="l00052"></a><a class="code" href="class_image_resizer_1_1_plugins_1_1_web_p_decoder_1_1_web_p_decoder_plugin.html#a55c4c1e6d85533443f65dbff97f43802">00052</a>         <span class="keyword">public</span> IEnumerable&lt;string&gt; <a class="code" href="class_image_resizer_1_1_plugins_1_1_web_p_decoder_1_1_web_p_decoder_plugin.html#a55c4c1e6d85533443f65dbff97f43802" title="If the plugin adds support for new file extensions (such as &quot;psd&quot;), they should be returned by this m...">GetSupportedFileExtensions</a>() {
<a name="l00053"></a>00053             <span class="keywordflow">return</span> <span class="keyword">new</span> <span class="keywordtype">string</span>[] { <span class="stringliteral">&quot;.webp&quot;</span> };
<a name="l00054"></a>00054         }
<a name="l00055"></a>00055     }
<a name="l00056"></a>00056 }
</pre></div></div><!-- contents -->
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>



<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.7.6.1
</small></address>

</body>
</html>
