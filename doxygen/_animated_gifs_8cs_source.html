<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.5"/>
<title>ImageResizer: C:/Users/nathanael/Documents/resizer/Plugins/AnimatedGifs/AnimatedGifs.cs Source File</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectlogo"><img alt="Logo" src="imageresizer-logo-00aec4.png"/></td>
  <td style="padding-left: 0.5em;">
   <div id="projectname">ImageResizer
   &#160;<span id="projectnumber">3.4.0</span>
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Properties</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Events</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_0b4eaef40a1fe20bedafe9e8e719ce66.html">Plugins</a></li><li class="navelem"><a class="el" href="dir_ee96839579b8f01676acc9ac14f65264.html">AnimatedGifs</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">AnimatedGifs.cs</div>  </div>
</div><!--header-->
<div class="contents">
<div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;<span class="comment">/* Copyright (c) 2011 Nathanael Jones. See license.txt for your rights */</span></div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;<span class="keyword">using</span> System;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;<span class="keyword">using</span> System.Collections.Generic;</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;<span class="keyword">using</span> System.Text;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;<span class="keyword">using</span> ImageResizer;</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;<span class="keyword">using</span> System.IO;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;<span class="keyword">using</span> System.Drawing.Imaging;</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;<span class="keyword">using</span> System.Collections.Specialized;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;<span class="keyword">using</span> System.Drawing;</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;<span class="keyword">using</span> ImageResizer.Resizing;</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;<span class="keyword">using</span> ImageResizer.Encoding;</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;<span class="keyword">using</span> ImageResizer.Configuration;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;<span class="keyword">using</span> ImageResizer.Plugins.Basic;</div>
<div class="line"><a name="l00014"></a><span class="lineno"><a class="line" href="namespace_image_resizer_1_1_plugins_1_1_animated_gifs.html">   14</a></span>&#160;<span class="keyword">namespace </span>ImageResizer.Plugins.<a class="code" href="class_image_resizer_1_1_plugins_1_1_animated_gifs_1_1_animated_gifs.html">AnimatedGifs</a></div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;{</div>
<div class="line"><a name="l00016"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_plugins_1_1_animated_gifs_1_1_animated_gifs.html">   16</a></span>&#160;    <span class="keyword">public</span> <span class="keyword">class </span><a class="code" href="class_image_resizer_1_1_plugins_1_1_animated_gifs_1_1_animated_gifs.html">AnimatedGifs</a> : <a class="code" href="class_image_resizer_1_1_resizing_1_1_builder_extension.html">BuilderExtension</a>, <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html">IPlugin</a></div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;    {</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;        <a class="code" href="class_image_resizer_1_1_configuration_1_1_config.html">Config</a> c;</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;        <span class="keyword">public</span> <a class="code" href="class_image_resizer_1_1_plugins_1_1_animated_gifs_1_1_animated_gifs.html">AnimatedGifs</a>(){}</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;        <span class="keyword">public</span> <a class="code" href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html">IPlugin</a> Install(Configuration.Config c) {</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;            c.Plugins.add_plugin(<span class="keyword">this</span>);</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;            this.c = c;</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">this</span>;</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;        }</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;        <span class="keyword">public</span> <span class="keywordtype">bool</span> Uninstall(Configuration.Config c) {</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;            c.Plugins.remove_plugin(<span class="keyword">this</span>);</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;            <span class="keywordflow">return</span> <span class="keyword">true</span>;</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;        }</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;<span class="comment"></span></div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;<span class="comment">        /// We cannot fix buildToBitmap, only buildToStream</span></div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;<span class="comment">        /// &lt;param name=&quot;source&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;<span class="comment">        /// &lt;param name=&quot;dest&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;<span class="comment">        /// &lt;param name=&quot;settings&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00037"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_plugins_1_1_animated_gifs_1_1_animated_gifs.html#a87efbd57704156a9a554c96618a79307">   37</a></span>&#160;<span class="comment"></span>        <span class="keyword">protected</span> <span class="keyword">override</span> <a class="code" href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">RequestedAction</a> <a class="code" href="class_image_resizer_1_1_plugins_1_1_animated_gifs_1_1_animated_gifs.html#a87efbd57704156a9a554c96618a79307">buildToStream</a>(Bitmap source, Stream dest, <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> settings) {</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;            <span class="comment">//Determines output format, includes code for saving in a variety of formats.</span></div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;            <span class="keywordflow">if</span> (ImageFormat.Gif.Equals(source.RawFormat) &amp;&amp; <span class="comment">//If it&#39;s a GIF</span></div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;                settings[<span class="stringliteral">&quot;frame&quot;</span>] == null &amp;&amp;    <span class="comment">//With no frame specifier</span></div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;                source.FrameDimensionsList != null &amp;&amp; source.FrameDimensionsList.Length &gt; 0) { <span class="comment">//With multiple frames</span></div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;                <a class="code" href="interface_image_resizer_1_1_encoding_1_1_i_encoder.html">IEncoder</a> enc = c.Plugins.EncoderProvider.GetEncoder(settings, source);</div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;                </div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;                <span class="keywordflow">if</span> (enc.<a class="code" href="interface_image_resizer_1_1_encoding_1_1_i_encoder.html#a7cbe10dac3c2bad04d088ae6f20e4180">MimeType</a>.Equals(<span class="stringliteral">&quot;image/gif&quot;</span>, StringComparison.OrdinalIgnoreCase) &amp;&amp; source.GetFrameCount(FrameDimension.Time) &gt; 1) {</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;                    WriteAnimatedGif(source, dest, enc, settings);</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;                    <span class="keywordflow">return</span> RequestedAction.Cancel;</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;                }</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;            }</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;            <span class="keywordflow">return</span> RequestedAction.None;</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;        }</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;        </div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;        <span class="keyword">private</span>  <span class="keywordtype">void</span> WriteAnimatedGif(Bitmap src, Stream output, <a class="code" href="interface_image_resizer_1_1_encoding_1_1_i_encoder.html">IEncoder</a> ios, <a class="code" href="class_image_resizer_1_1_resize_settings.html">ResizeSettings</a> queryString)</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;        {</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;            <span class="comment">//http://www.fileformat.info/format/gif/egff.htm</span></div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;            <span class="comment">//http://www.fileformat.info/format/gif/spec/44ed77668592476fb7a682c714a68bac/view.htm</span></div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;</div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;            <span class="comment">//Heavily modified and patched from comments on http://bloggingabout.net/blogs/rick/archive/2005/05/10/3830.aspx</span></div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;            MemoryStream memoryStream = null;</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;            BinaryWriter writer = null;</div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;            <span class="comment">//Variable declaration</span></div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;            <span class="keywordflow">try</span></div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;            {</div>
<div class="line"><a name="l00064"></a><span class="lineno">   64</span>&#160;                writer = <span class="keyword">new</span> BinaryWriter(output);</div>
<div class="line"><a name="l00065"></a><span class="lineno">   65</span>&#160;                memoryStream = <span class="keyword">new</span> MemoryStream(4096);</div>
<div class="line"><a name="l00066"></a><span class="lineno">   66</span>&#160;                <span class="comment">//Write the GIF 89a sig</span></div>
<div class="line"><a name="l00067"></a><span class="lineno">   67</span>&#160;                writer.Write(<span class="keyword">new</span> byte[] { (byte)<span class="charliteral">&#39;G&#39;</span>, (byte)<span class="charliteral">&#39;I&#39;</span>, (byte)<span class="charliteral">&#39;F&#39;</span>, (byte)<span class="charliteral">&#39;8&#39;</span>, (byte)<span class="charliteral">&#39;9&#39;</span>, (byte)<span class="charliteral">&#39;a&#39;</span> });</div>
<div class="line"><a name="l00068"></a><span class="lineno">   68</span>&#160;                </div>
<div class="line"><a name="l00069"></a><span class="lineno">   69</span>&#160;                <span class="comment">//We parse this from the source image</span></div>
<div class="line"><a name="l00070"></a><span class="lineno">   70</span>&#160;                <span class="keywordtype">int</span> loops = GetLoops(src.PropertyItems);</div>
<div class="line"><a name="l00071"></a><span class="lineno">   71</span>&#160;                <span class="keywordtype">int</span>[] delays = GetDelays(src.PropertyItems);<span class="comment">//20736 (delays) 20737 (loop);</span></div>
<div class="line"><a name="l00072"></a><span class="lineno">   72</span>&#160;                </div>
<div class="line"><a name="l00073"></a><span class="lineno">   73</span>&#160;                <span class="keywordtype">int</span> frames = src.GetFrameCount(FrameDimension.Time);</div>
<div class="line"><a name="l00074"></a><span class="lineno">   74</span>&#160;                <span class="keywordflow">for</span> (<span class="keywordtype">int</span> frame = 0; frame &lt; frames; frame++)</div>
<div class="line"><a name="l00075"></a><span class="lineno">   75</span>&#160;                {</div>
<div class="line"><a name="l00076"></a><span class="lineno">   76</span>&#160;                    <span class="comment">//Select the frame</span></div>
<div class="line"><a name="l00077"></a><span class="lineno">   77</span>&#160;                    src.SelectActiveFrame(FrameDimension.Time, frame);</div>
<div class="line"><a name="l00078"></a><span class="lineno">   78</span>&#160;</div>
<div class="line"><a name="l00079"></a><span class="lineno">   79</span>&#160;      </div>
<div class="line"><a name="l00080"></a><span class="lineno">   80</span>&#160;                    <span class="comment">// http://radio.weblogs.com/0122832/2005/10/20.html</span></div>
<div class="line"><a name="l00081"></a><span class="lineno">   81</span>&#160;                    <span class="comment">//src.MakeTransparent(); This call makes some GIFs replicate the first image on all frames.. i.e. SelectActiveFrame doesn&#39;t work.</span></div>
<div class="line"><a name="l00082"></a><span class="lineno">   82</span>&#160;                    </div>
<div class="line"><a name="l00083"></a><span class="lineno">   83</span>&#160;                    <span class="keyword">using</span> (Bitmap b = c.CurrentImageBuilder.Build(src,queryString,<span class="keyword">false</span>)){</div>
<div class="line"><a name="l00084"></a><span class="lineno">   84</span>&#160;                        <span class="comment">//Useful to check if animation is occuring - sometimes the problem isn&#39;t the output file, but the input frames are </span></div>
<div class="line"><a name="l00085"></a><span class="lineno">   85</span>&#160;                        <span class="comment">//all the same.</span></div>
<div class="line"><a name="l00086"></a><span class="lineno">   86</span>&#160;                        <span class="comment">//for (var i = 0; i &lt; b.Height; i++) b.SetPixel(frame * 10, i, Color.Green);</span></div>
<div class="line"><a name="l00087"></a><span class="lineno">   87</span>&#160;                        <span class="comment">// b.Save(memoryStream, ImageFormat.Gif);</span></div>
<div class="line"><a name="l00088"></a><span class="lineno">   88</span>&#160;                        ios.Write(b, memoryStream); <span class="comment">//Allows quantization and dithering</span></div>
<div class="line"><a name="l00089"></a><span class="lineno">   89</span>&#160;                    }</div>
<div class="line"><a name="l00090"></a><span class="lineno">   90</span>&#160;                    </div>
<div class="line"><a name="l00091"></a><span class="lineno">   91</span>&#160;                    GifClass gif = <span class="keyword">new</span> GifClass();</div>
<div class="line"><a name="l00092"></a><span class="lineno">   92</span>&#160;                    gif.LoadGifPicture(memoryStream);</div>
<div class="line"><a name="l00093"></a><span class="lineno">   93</span>&#160;                    <span class="keywordflow">if</span> (frame == 0)</div>
<div class="line"><a name="l00094"></a><span class="lineno">   94</span>&#160;                    {</div>
<div class="line"><a name="l00095"></a><span class="lineno">   95</span>&#160;                        <span class="comment">//Only one screen descriptor per file. Steal from the first image</span></div>
<div class="line"><a name="l00096"></a><span class="lineno">   96</span>&#160;                        writer.Write(gif.m_ScreenDescriptor.ToArray());</div>
<div class="line"><a name="l00097"></a><span class="lineno">   97</span>&#160;                        <span class="comment">//How many times to loop the image (unless it is 1) IE and FF3 loop endlessley if loop=1</span></div>
<div class="line"><a name="l00098"></a><span class="lineno">   98</span>&#160;                        <span class="keywordflow">if</span> (loops != 1) </div>
<div class="line"><a name="l00099"></a><span class="lineno">   99</span>&#160;                            writer.Write(GifCreator.CreateLoopBlock(loops));</div>
<div class="line"><a name="l00100"></a><span class="lineno">  100</span>&#160;                    }</div>
<div class="line"><a name="l00101"></a><span class="lineno">  101</span>&#160;                    <span class="comment">//Restore frame delay</span></div>
<div class="line"><a name="l00102"></a><span class="lineno">  102</span>&#160;                    <span class="keywordtype">int</span> delay = 0;</div>
<div class="line"><a name="l00103"></a><span class="lineno">  103</span>&#160;                    <span class="keywordflow">if</span> (delays != null &amp;&amp; delays.Length &gt; frame) delay = delays[frame];</div>
<div class="line"><a name="l00104"></a><span class="lineno">  104</span>&#160;                    writer.Write(GifCreator.CreateGraphicControlExtensionBlock(delay)); <span class="comment">//The delay/transparent color block</span></div>
<div class="line"><a name="l00105"></a><span class="lineno">  105</span>&#160;                    writer.Write(gif.m_ImageDescriptor.ToArray()); <span class="comment">//The image desc</span></div>
<div class="line"><a name="l00106"></a><span class="lineno">  106</span>&#160;                    writer.Write(gif.m_ColorTable.ToArray()); <span class="comment">//The palette</span></div>
<div class="line"><a name="l00107"></a><span class="lineno">  107</span>&#160;                    writer.Write(gif.m_ImageData.ToArray()); <span class="comment">//Image data</span></div>
<div class="line"><a name="l00108"></a><span class="lineno">  108</span>&#160;</div>
<div class="line"><a name="l00109"></a><span class="lineno">  109</span>&#160;                    memoryStream.SetLength(0); <span class="comment">//Clear the mem stream, but leave it allocated for now</span></div>
<div class="line"><a name="l00110"></a><span class="lineno">  110</span>&#160;                    memoryStream.Seek(0, SeekOrigin.Begin); <span class="comment">//Reset memory buffer</span></div>
<div class="line"><a name="l00111"></a><span class="lineno">  111</span>&#160;                }</div>
<div class="line"><a name="l00112"></a><span class="lineno">  112</span>&#160;                </div>
<div class="line"><a name="l00113"></a><span class="lineno">  113</span>&#160;                writer.Write((byte)0x3B); <span class="comment">//End file</span></div>
<div class="line"><a name="l00114"></a><span class="lineno">  114</span>&#160;            }</div>
<div class="line"><a name="l00115"></a><span class="lineno">  115</span>&#160;            <span class="keywordflow">finally</span></div>
<div class="line"><a name="l00116"></a><span class="lineno">  116</span>&#160;            {</div>
<div class="line"><a name="l00117"></a><span class="lineno">  117</span>&#160;               <span class="keywordflow">if</span> (memoryStream != null) memoryStream.Dispose();</div>
<div class="line"><a name="l00118"></a><span class="lineno">  118</span>&#160;               <span class="comment">//if (writer != null) writer.Close</span></div>
<div class="line"><a name="l00119"></a><span class="lineno">  119</span>&#160;            }</div>
<div class="line"><a name="l00120"></a><span class="lineno">  120</span>&#160;        }<span class="comment"></span></div>
<div class="line"><a name="l00121"></a><span class="lineno">  121</span>&#160;<span class="comment">        /// &lt;summary&gt;</span></div>
<div class="line"><a name="l00122"></a><span class="lineno">  122</span>&#160;<span class="comment">        /// Returns the first PropertyItem with a matching ID</span></div>
<div class="line"><a name="l00123"></a><span class="lineno">  123</span>&#160;<span class="comment">        /// &lt;/summary&gt;</span></div>
<div class="line"><a name="l00124"></a><span class="lineno">  124</span>&#160;<span class="comment">        /// &lt;param name=&quot;items&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00125"></a><span class="lineno">  125</span>&#160;<span class="comment">        /// &lt;param name=&quot;id&quot;&gt;&lt;/param&gt;</span></div>
<div class="line"><a name="l00126"></a><span class="lineno">  126</span>&#160;<span class="comment">        /// &lt;returns&gt;&lt;/returns&gt;</span></div>
<div class="line"><a name="l00127"></a><span class="lineno"><a class="line" href="class_image_resizer_1_1_plugins_1_1_animated_gifs_1_1_animated_gifs.html#ad3c354c63dad9344b18c2f4b4a880566">  127</a></span>&#160;<span class="comment"></span>          <span class="keyword">protected</span> <span class="keyword">static</span> PropertyItem <a class="code" href="class_image_resizer_1_1_plugins_1_1_animated_gifs_1_1_animated_gifs.html#ad3c354c63dad9344b18c2f4b4a880566">getById</a>(PropertyItem[] items, <span class="keywordtype">int</span> <span class="keywordtype">id</span>)</div>
<div class="line"><a name="l00128"></a><span class="lineno">  128</span>&#160;          {</div>
<div class="line"><a name="l00129"></a><span class="lineno">  129</span>&#160;              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; items.Length; i++)</div>
<div class="line"><a name="l00130"></a><span class="lineno">  130</span>&#160;               <span class="keywordflow">if</span> (items[i] != null &amp;&amp; items[i].Id == <span class="keywordtype">id</span>)</div>
<div class="line"><a name="l00131"></a><span class="lineno">  131</span>&#160;                   <span class="keywordflow">return</span> items[i];</div>
<div class="line"><a name="l00132"></a><span class="lineno">  132</span>&#160;</div>
<div class="line"><a name="l00133"></a><span class="lineno">  133</span>&#160;              <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l00134"></a><span class="lineno">  134</span>&#160;          }</div>
<div class="line"><a name="l00135"></a><span class="lineno">  135</span>&#160;          <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keywordtype">int</span>[] GetDelays(PropertyItem[] items)</div>
<div class="line"><a name="l00136"></a><span class="lineno">  136</span>&#160;          {</div>
<div class="line"><a name="l00137"></a><span class="lineno">  137</span>&#160;              <span class="comment">//Property item ID 20736 http://bytes.com/groups/net-vb/692099-problem-animated-gifs</span></div>
<div class="line"><a name="l00138"></a><span class="lineno">  138</span>&#160;              PropertyItem pi = getById(items, 20736);</div>
<div class="line"><a name="l00139"></a><span class="lineno">  139</span>&#160;              <span class="keywordflow">if</span> (pi == null) <span class="keywordflow">return</span> null;</div>
<div class="line"><a name="l00140"></a><span class="lineno">  140</span>&#160;              <span class="comment">//Combine bytes into integers</span></div>
<div class="line"><a name="l00141"></a><span class="lineno">  141</span>&#160;              <span class="keywordtype">int</span>[] vals = <span class="keyword">new</span> <span class="keywordtype">int</span>[pi.Value.Length / 4];</div>
<div class="line"><a name="l00142"></a><span class="lineno">  142</span>&#160;              <span class="keywordflow">for</span> (<span class="keywordtype">int</span> i = 0; i &lt; pi.Value.Length; i+=4){</div>
<div class="line"><a name="l00143"></a><span class="lineno">  143</span>&#160;                  vals[i / 4] = BitConverter.ToInt32(pi.Value, i);</div>
<div class="line"><a name="l00144"></a><span class="lineno">  144</span>&#160;              }</div>
<div class="line"><a name="l00145"></a><span class="lineno">  145</span>&#160;              <span class="keywordflow">return</span> vals;</div>
<div class="line"><a name="l00146"></a><span class="lineno">  146</span>&#160;              </div>
<div class="line"><a name="l00147"></a><span class="lineno">  147</span>&#160;          }</div>
<div class="line"><a name="l00148"></a><span class="lineno">  148</span>&#160;          <span class="keyword">protected</span> <span class="keyword">static</span> <span class="keywordtype">int</span> GetLoops(PropertyItem[] items)</div>
<div class="line"><a name="l00149"></a><span class="lineno">  149</span>&#160;          {</div>
<div class="line"><a name="l00150"></a><span class="lineno">  150</span>&#160;            <span class="comment">// http://weblogs.asp.net/justin_rogers/archive/2004/01/19/60424.aspx</span></div>
<div class="line"><a name="l00151"></a><span class="lineno">  151</span>&#160;              <span class="comment">//Property item ID 20737</span></div>
<div class="line"><a name="l00152"></a><span class="lineno">  152</span>&#160;              PropertyItem pi = getById(items, 20737);</div>
<div class="line"><a name="l00153"></a><span class="lineno">  153</span>&#160;              <span class="keywordflow">if</span> (pi == null) <span class="keywordflow">return</span> 0;</div>
<div class="line"><a name="l00154"></a><span class="lineno">  154</span>&#160;              <span class="comment">//Combine bytes into integers</span></div>
<div class="line"><a name="l00155"></a><span class="lineno">  155</span>&#160;              <span class="keywordflow">return</span> pi.Value[0] + (pi.Value[1] &lt;&lt; 8);</div>
<div class="line"><a name="l00156"></a><span class="lineno">  156</span>&#160;          }</div>
<div class="line"><a name="l00157"></a><span class="lineno">  157</span>&#160;</div>
<div class="line"><a name="l00158"></a><span class="lineno">  158</span>&#160;</div>
<div class="line"><a name="l00159"></a><span class="lineno">  159</span>&#160;          </div>
<div class="line"><a name="l00160"></a><span class="lineno">  160</span>&#160;    }</div>
<div class="line"><a name="l00161"></a><span class="lineno">  161</span>&#160;    </div>
<div class="line"><a name="l00162"></a><span class="lineno">  162</span>&#160;}</div>
<div class="ttc" id="namespace_image_resizer_1_1_resizing_html_a22bbb53580a122efe469a26ad584fa86"><div class="ttname"><a href="namespace_image_resizer_1_1_resizing.html#a22bbb53580a122efe469a26ad584fa86">ImageResizer.Resizing.RequestedAction</a></div><div class="ttdeci">RequestedAction</div><div class="ttdoc">What to do about remaining handlers/methods for the specified section </div><div class="ttdef"><b>Definition:</b> <a href="_abstract_image_processor_8cs_source.html#l00013">AbstractImageProcessor.cs:13</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_configuration_1_1_config_html"><div class="ttname"><a href="class_image_resizer_1_1_configuration_1_1_config.html">ImageResizer.Configuration.Config</a></div><div class="ttdef"><b>Definition:</b> <a href="_config_8cs_source.html#l00022">Config.cs:22</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_encoding_1_1_i_encoder_html_a7cbe10dac3c2bad04d088ae6f20e4180"><div class="ttname"><a href="interface_image_resizer_1_1_encoding_1_1_i_encoder.html#a7cbe10dac3c2bad04d088ae6f20e4180">ImageResizer.Encoding.IEncoder.MimeType</a></div><div class="ttdeci">string MimeType</div><div class="ttdoc">Returns the appropriate mime-time for the output format as currently configured. </div><div class="ttdef"><b>Definition:</b> <a href="_i_encoder_8cs_source.html#l00040">IEncoder.cs:40</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_animated_gifs_1_1_animated_gifs_html_a87efbd57704156a9a554c96618a79307"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_animated_gifs_1_1_animated_gifs.html#a87efbd57704156a9a554c96618a79307">ImageResizer.Plugins.AnimatedGifs.AnimatedGifs.buildToStream</a></div><div class="ttdeci">override RequestedAction buildToStream(Bitmap source, Stream dest, ResizeSettings settings)</div><div class="ttdoc">We cannot fix buildToBitmap, only buildToStream </div><div class="ttdef"><b>Definition:</b> <a href="_animated_gifs_8cs_source.html#l00037">AnimatedGifs.cs:37</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_animated_gifs_1_1_animated_gifs_html_ad3c354c63dad9344b18c2f4b4a880566"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_animated_gifs_1_1_animated_gifs.html#ad3c354c63dad9344b18c2f4b4a880566">ImageResizer.Plugins.AnimatedGifs.AnimatedGifs.getById</a></div><div class="ttdeci">static PropertyItem getById(PropertyItem[] items, int id)</div><div class="ttdoc">Returns the first PropertyItem with a matching ID </div><div class="ttdef"><b>Definition:</b> <a href="_animated_gifs_8cs_source.html#l00127">AnimatedGifs.cs:127</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_plugins_1_1_animated_gifs_1_1_animated_gifs_html"><div class="ttname"><a href="class_image_resizer_1_1_plugins_1_1_animated_gifs_1_1_animated_gifs.html">ImageResizer.Plugins.AnimatedGifs.AnimatedGifs</a></div><div class="ttdef"><b>Definition:</b> <a href="_animated_gifs_8cs_source.html#l00016">AnimatedGifs.cs:16</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resize_settings_html"><div class="ttname"><a href="class_image_resizer_1_1_resize_settings.html">ImageResizer.ResizeSettings</a></div><div class="ttdoc">Represents the settings which will be used to process the image. Extends NameValueCollection to provi...</div><div class="ttdef"><b>Definition:</b> <a href="_resize_settings_8cs_source.html#l00020">ResizeSettings.cs:20</a></div></div>
<div class="ttc" id="class_image_resizer_1_1_resizing_1_1_builder_extension_html"><div class="ttname"><a href="class_image_resizer_1_1_resizing_1_1_builder_extension.html">ImageResizer.Resizing.BuilderExtension</a></div><div class="ttdoc">Provides a useable base class that can be used to modify the behavior of ImageBuilder. When registered with an ImageBuilder instance, the ImageBuilder will call the corresponding methods on the extension prior to executing its own methods. </div><div class="ttdef"><b>Definition:</b> <a href="_builder_extension_8cs_source.html#l00011">BuilderExtension.cs:11</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_plugins_1_1_i_plugin_html"><div class="ttname"><a href="interface_image_resizer_1_1_plugins_1_1_i_plugin.html">ImageResizer.Plugins.IPlugin</a></div><div class="ttdoc">All plugins must implement this. Enables web.config addition and removal. </div><div class="ttdef"><b>Definition:</b> <a href="_i_plugin_8cs_source.html#l00011">IPlugin.cs:11</a></div></div>
<div class="ttc" id="interface_image_resizer_1_1_encoding_1_1_i_encoder_html"><div class="ttname"><a href="interface_image_resizer_1_1_encoding_1_1_i_encoder.html">ImageResizer.Encoding.IEncoder</a></div><div class="ttdoc">An image encoder. Exposes methods for suitability checking, encoding, transparency compatibility chec...</div><div class="ttdef"><b>Definition:</b> <a href="_i_encoder_8cs_source.html#l00013">IEncoder.cs:13</a></div></div>
</div><!-- fragment --></div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.5
</small></address>
</body>
</html>
